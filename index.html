<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Agave Platform Developer Documentation</title>
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">


    <script src="https://use.typekit.net/squ8frf.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <!-- <script src="javascripts/jquery.min.js" type="text/javascript"></script> -->

      <script src="javascripts/all.js" type="text/javascript"></script>
    <script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-43163231-12', 'auto');
ga('require', 'eventTracker');
ga('require', 'outboundLinkTracker');
ga('require', 'urlChangeTracker');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script src="javascripts/autotrack.js" type="text/javascript" async="true"></script>

      <script>
        $(function() {
          setupLanguages(["shell","plaintext"]);
        });
      </script>
    <style>
    .js #fouc { display: none; }
    </style>
    <script type="text/javascript">
        document.documentElement.className = 'js';
    </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div id="fouc">
        <div class="tocify-wrapper">
          <img class="menu-logo" src="images/agave-docs-logo.png" />
          
            <div class="lang-selector">
                  <a href="#" data-language-name="shell">cURL</a>
                  <a href="#" data-language-name="plaintext">CLI</a>
            </div>
            <div class="search">
              <input type="text" class="search" id="input-search" placeholder="Search">
            </div>
            <ul class="search-results"></ul>
          <div id="toc">
          </div>
            <ul class="toc-footer">
                <li><a href='https://public.agaveapi.co/create_account' target='_blank'>Create an Account</a></li>
                <li><a href='https://bitbucket.org/taccaci/agave-flat/src/master/CHANGELOG.md' target='_blank'>CHANGELOG</a></li>
                <li><a href='http://status.agaveapi.co' target='_blank'>Status Page</a></li>
                <li><a href='http://support.agaveapi.co' target='_blank'>Issues</a></li>
                <li><a href='http://support.agaveapi.co' target='_blank'>Knowledge Base</a></li>
            </ul>
        </div>
        <div class="page-wrapper">
          <div class="dark-box"></div>
          <div class="content">
            
              <h1 id="introduction">Introduction</h1>
<pre class="highlight json"><code><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">                                         
 </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">                                        
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">   </span><span class="err">/$$$$$$</span><span class="w">  </span><span class="err">/$$</span><span class="w">    </span><span class="err">/$$</span><span class="w"> </span><span class="err">/$$$$$$</span><span class="w"> 
</span><span class="err">|</span><span class="w"> </span><span class="err">$$$$$$$$</span><span class="w"> </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$</span><span class="w"> </span><span class="err">|____</span><span class="w">  </span><span class="err">$$|</span><span class="w">  </span><span class="err">$$</span><span class="w">  </span><span class="err">/$$//$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">/$$$$$$$</span><span class="w"> </span><span class="err">\</span><span class="w">  </span><span class="err">$$/$$/|</span><span class="w"> </span><span class="err">$$$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w">  </span><span class="err">$$$/</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$_____/</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w">  </span><span class="err">$$$$$$$|</span><span class="w">  </span><span class="err">$$$$$$$</span><span class="w">   </span><span class="err">\</span><span class="w">  </span><span class="err">$/</span><span class="w">  </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$$</span><span class="w">
</span><span class="err">|__/</span><span class="w">  </span><span class="err">|__/</span><span class="w"> </span><span class="err">\____</span><span class="w">  </span><span class="err">$$</span><span class="w"> </span><span class="err">\_______/</span><span class="w">    </span><span class="err">\_/</span><span class="w">    </span><span class="err">\_______/</span><span class="w">
           </span><span class="err">/$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w">                              
          </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$/</span><span class="w">                              
           </span><span class="err">\______/</span><span class="w">                               
</span></code></pre>

<p>The Agave Platform (<a href="http://agaveapi.co">http://agaveapi.co</a>) is an open source, science-as-a-service API platform for powering your digital lab. Agave allows you to bring together your public, private, and shared high performance
computing (HPC), high throughput computing (HTC), Cloud, and Big Data resources under a single, web-friendly REST API.</p>

<ul>
<li>Run code</li>
<li>Manage data</li>
<li>Collaborate meaningfully</li>
<li>Integrate anywhere</li>
</ul>

<p>The Agave documentation site contains documentation, guides, tutorials, and lots of examples to help you build your own digital lab.</p>

<aside class="info">If you came here looking for a UI to interact with the platform and kick the tires, please see our reference web application, Agave ToGo, at <a href="http://togo.agaveapi.co/">http://togo.agaveapi.co/</a>.</aside>

              <h2 id="conventions">Conventions</h2>

<p>Throughout the documentation you will regularly encounter the following variables. These represent user-specific values that should be replaced when attempting any of the calls using your account. Once you log into this site, these values will be replaced with values appropriate for you to use when copying and pasting the examples on your own.</p>

<table>
    <thead>
        <tr>
            <th>Variable</th>
            <th>Description</th>
            <th>Example</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>${API_HOST}</td>
            <td>Base hostname of the API. </td>
            <td>public.agaveapi.co</td>
        </tr>
        <tr>
            <td>${API_VERSION}</td>
            <td>Version of the API endpoint.</td>
            <td>v2</td>
        </tr>
        <tr>
            <td>${API_USERNAME}</td>
            <td>Username of the current user.</td>
            <td>nryan</td>
        </tr>
        <tr>
            <td>${API_KEY}</td>
            <td>Client key used to request an access token from the Agave Auth service.</td>
            <td>hZ_z3f4Hf3CcgvGoMix0aksN4BOD6</td>
        </tr>
        <tr>
            <td>${API_SECRET}</td>
            <td>Client secret used to request an access token from the Agave Auth service.</td>
            <td>gTgpCecqtOc6Ao3GmZ_FecVSSV8a</td>
        </tr>
        <tr>
            <td>${API_TOKEN}</td>
            <td></td>
            <td>de32225c235cf47b9965997270a1496c</td>
        </tr>
    </tbody>
</table>

<h3 id="json-notation">JSON Notation</h3>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-09-04T16:59:33.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0001409867973952-5056a550b8-0001-014"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastCheck"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-02T13:03:25.000-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0001412273000497-5056a550b8-0001-015"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASSED"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STORAGE"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-02T13:03:25.000-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0001411825368981-5056a550b8-0001-015"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FAILED"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LOGIN"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"lastSuccess"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-02T11:03:13.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastUpdated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-02T13:03:25.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"nextUpdate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-02T14:03:15.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"systest"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"demo.storage.example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"updateSystemStatus"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"checks"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/monitor/v2/0001409867973952-5056a550b8-0001-014/checks"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"notifications"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/notifications/v2/?associatedUuid=0001409867973952-5056a550b8-0001-014"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/profiles/v2/systest"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/monitor/v2/0001409867973952-5056a550b8-0001-014"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/demo.storage.example.com"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>When describing the JSON objects passed back and forth with the APIs, Javascript dot notation will be used to refer to individual properties. For example, consider the following JSON object.</p>

<ul>
<li><code class="prettyprint">active</code> refers to the top level <code class="prettyprint">active</code> attribute in the response object.</li>
<li><code class="prettyprint">lastCheck.[].result</code> generically refers to the result attribute contained within any of the objects contained in the <code class="prettyprint">lastCheck</code> array.</li>
<li><code class="prettyprint">lastCheck.[0].result</code> specifically refers to the result attribute contained within the first object in the <code class="prettyprint">lastCheck</code> array.</li>
<li><code class="prettyprint">_links.self.href</code> refers to the href attribute in the checks object within the <code class="prettyprint">_links</code> object.</li>
</ul>

<h3 id="versioning">Versioning</h3>

<p>The current major version of Agave is given in the URI immediately following the API resource name. For example, if the endpoint is <code class="prettyprint">https://public.tenants.agaveapi.co/jobs/v2/</code>, the API version would be <code class="prettyprint">v2</code>. The current major version of agave is v2.</p>

<h3 id="slugs">Slugs</h3>

<p>In certain situations, usually where file system paths and names are involved in some way, Agave will generate slugify object names to make them safe to use. Slugs will be created on the fly by applying the following rules:</p>

<ol>
<li>Lowercase the string</li>
<li>Replace spaces with a dash</li>
<li>Remove any special characters and punctuation that might require encoding in the URL. Allowed characters are alphanumeric characters, numbers, underscores, and periods.</li>
</ol>

<h3 id="secure-communication">Secure communication</h3>

<p>Agave uses SSL to secure communication with the clients. If HTTPS is not specified in the request, the request will be redirected to a secure channel.</p>

<h3 id="rate-limiting">Rate limiting</h3>

<p>To make the API fast for everybody, rate limits apply. Unsigned requests are processed at the lowest rate limit. Signed requests with a valid access token benefit from higher rate limits — this is true even if endpoint doesn’t require an access token to be passed in the call.</p>

<h3 id="requests">Requests</h3>

<p>The Agave API is based on <a title="REST" href="http://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank">REST</a> principles: data resources are accessed via standard HTTPS requests in UTF-8 format to an API endpoint. Where possible, the API strives to use appropriate HTTP verbs for each action</p>

<table>
    <thead>
        <tr>
            <th>Verb</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>GET</td>
            <td>Used for retrieving resources.</td>
        </tr>
        <tr>
            <td>POST</td>
            <td>Used for creating resources.</td>
        </tr>
        <tr>
            <td>PUT</td>
            <td>Used for manipulating resources or collections.</td>
        </tr>
        <tr>
            <td>DELETE</td>
            <td>Used for deleting resources. </td>
        </tr>
    </tbody>
</table>

<h4 id="standard-query-parameters">Standard query parameters</h4>

<p>Several URL query parameters are common across all services. The following table lists them for reference</p>

<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Values</th>
            <th>Purpose</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>offset</td>
            <td>integer (zero-based)</td>
            <td>Skips the first <span class="code">offset<span> results in the response.</td>
        </tr>
        <tr>
            <td>limit</td>
            <td>integer</td>
            <td>Limits the number of responses to, at most, this number.</td>
        </tr>
        <tr>
            <td>pretty</td>
            <td>boolean</td>
            <td>If true, pretty prints the response. Default false.</td>
        </tr>
        <tr>
            <td>naked</td>
            <td>boolean</td>
            <td>If true, returns only the value of the <span class="code">result</span> attribute in the standard response wrapper.</td>
        </tr>
        <tr>
            <td>filter</td>
            <td>string</td>
            <td>A comma-delimited list of fields to return for each object in the response. Each field may be referenced using JSON notation. See the <a href="#custom-response">Response Customization</a> for more info.</td>
        </tr>
    </tbody>
</table>

<h3 id="responses">Responses</h3>

<p>All data is received and returned as a JSON object. The <a title="Live Documentation" href="/live-docs/">Live Docs</a> provide a description of all the retrievable objects.</p>

<h4 id="response-details">Response Details</h4>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Permission denied. You do not have permission to view this system"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.2.0-r8228"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Apart from the response code, all responses from Agave are in the form of a json object. The object takes the following form.</p>

<table>
    <thead>
        <tr>
            <th>Key</th>
            <th>Value Type</th>
            <th>Value Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>status</td>
            <td>string</td>
            <td>&ldquo;success&rdquo; if the call succeeded or &ldquo;error&rdquo; indicating that the call failed.</td>
        </tr>
        <tr>
            <td>message</td>
            <td>string</td>
            <td>A short description of the cause of the error. </td>
        </tr>
        <tr>
            <td>result</td>
            <td>object, array</td>
            <td>The JSON response object or array</td>
        </tr>
        <tr>
            <td>version</td>
            <td>string</td>
            <td>The current full release version of Agave. Ex &ldquo;2.2.0-r8228&rdquo;</td>
        </tr>
    </tbody>
</table>

<p>Here, for example, is the response that occurs when trying to fetch information for system to which you do not have access:</p>

<h4 id="naked-responses">Naked Responses</h4>

<p>In situations where you do not care to parse the wrapper for the raw response data, you may request a <em>naked</em> response from the API by adding <code class="prettyprint">naked=true</code> in to the request URL. This will return just the value of the <code class="prettyprint">result</code> attribute in the response wrapper.</p>

<h3 id="formatting">Formatting</h3>

<p>By default, all responses are serialized JSON. To receive pre-formatted JSON, add <code class="prettyprint">pretty=true</code> to any query string.</p>

<h3 id="pagination">Pagination</h3>

<p>All resource collections support a way of paging the dataset, taking an <code class="prettyprint">offset</code> and <code class="prettyprint">limit</code> as query parameters:</p>

<blockquote>
<p>Pagination using <code class="prettyprint">limit</code> and <code class="prettyprint">offset</code> query parameters.</p>
</blockquote>
<pre class="highlight html"><code>curl -sk -H "Authorization: Bearer ${API_KEY}" "https://public.tenants.agaveapi.co/jobs/v2/?offset=50<span class="ni">&amp;amp;</span>limit=25"
</code></pre>

<p>Note that offset numbering is zero-based and that omitting the offset parameter will return the first X elements. Unless specified, all result sets are paginated in groups of 100. Check the documentation for the specific endpoint to see specific information.</p>

<h3 id="timestamps">Timestamps</h3>

<p>Timestamps are returned in <a href="http://en.wikipedia.org/wiki/ISO_8601" target="_blank">ISO 8601</a> format as <a title="Offset to Coordinated Universal Time" href="http://en.wikipedia.org/wiki/Offset_to_Coordinated_Universal_Time" target="_blank">Coordinated Universal Time</a>(UTC) with zero offset: <code class="prettyprint">YYYY-MM-DDTHH:MM:SSZ</code>. If the time is imprecise (for example, the date/time of an album release), an additional field will show the precision; see for example, <code class="prettyprint">created</code> in an <a title="Job object" href="http://agaveapi.co/live-docs/#!/jobs/list_get_0" target="_blank">Job object</a>.</p>

<h3 id="cors">CORS</h3>

<p>Many modern applications choose to implement client-server communication exclusively in Javascript. For this reason, Agave provides <a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing" title="CORS" target="_blank">cross-origin resource sharing (CORS)</a> support so AJAX requests from a web browser are not constrained by cross-origin requests and can safely make GET, PUT, POST, and DELETE requests to the API.</p>

<h3 id="hypermedia">Hypermedia</h3>
<pre class="highlight plaintext"><code>{
    "associationIds": [],
    "created": "2013-11-16T11:25:38.900-06:00",
    "internalUsername": null,
    "lastUpdated": "2013-11-16T11:25:38.900-06:00",
    "name": "color",
    "owner": "nryan",
    "uuid": "0001384622738900-5056a550b8-0001-012",
    "value": "red",
    "_links": {
        "self": {
            "href": "https://public.tenants.agaveapi.co/meta/v2/data/0001384622738900-5056a550b8-0001-012"
        },
        "owner": {
            "href": "https://public.tenants.agaveapi.co/profiles/v2/nryan"
        }
    }
}
</code></pre>

<p>Agave strives to be a fully descriptive hypermedia API. Given any endpoint, you should be able to walk the API through the links provided in the <code class="prettyprint">_links</code> object in each resource representation. The following user metadata object contains two referenced objects. The first, <code class="prettyprint">self</code> is common to all objects, and contains the URL of that object. The second, <code class="prettyprint">owner</code> contains the URL to the profile of the user who created the object.</p>

              <h3 id="response-customization">Response Customization</h3>

<blockquote>
<p>Returns the user id, name, and email  </p>
</blockquote>
<pre class="highlight html"><code>/profiles/v2/?filter=id,name,email
</code></pre>

<blockquote>
<p>Returns the system name, status, app id, and the url to the archvied job output  </p>
</blockquote>
<pre class="highlight html"><code>/jobs/v2/?filter=name,status,appId,_links.archiveData.href
</code></pre>

<blockquote>
<p>Returns the system id, type, whether it is your default system, and the hostname in the storage config  </p>
</blockquote>
<pre class="highlight html"><code>/systems/v2/?filter=id,type,default,storage.host
</code></pre>

<p>In many situations, Agave may return back too much or too little information in the response to a query. For example, when searching jobs, the <code class="prettyprint">inputs</code> and <code class="prettyprint">parameters</code> fields are not included in the default summary response objects. You can customize the responses you receive from all the Science APIs using the <code class="prettyprint">filter</code> query parameter. The <code class="prettyprint">filter</code> query parameter takes a comma-delimited list of fields to return for each object in the response. Each field may be referenced using JSON notation similar to the search syntax (minus the <code class="prettyprint">.[operation]</code> suffix. The examples to the right show sample requests and responses.</p>

              <h3 id="status-codes">Status Codes</h3>

<p>The API uses the following response status codes, as defined in the <a href="https://www.ietf.org/rfc/rfc2616.txt" target="_blank">RFC 2616</a> on successful and unsuccessful requests.</p>

<h4 id="success-codes">Success Codes</h4>

<table><thead>
<tr>
<th>Response Code</th>
<th>Meaning</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Success</td>
<td>The request succeeded. Life is good.</td>
</tr>
<tr>
<td>201</td>
<td>Created</td>
<td>The request succeeded and a new resource was created. Only applicable on PUT and POST actions.</td>
</tr>
<tr>
<td>202</td>
<td>Accepted</td>
<td>The request has been accepted for processing, but the processing has not been completed. Common for all async actions such as job submissions, file transfers, etc.</td>
</tr>
<tr>
<td>206</td>
<td>Partial Content</td>
<td>The server has fulfilled the partial GET request for the resource. This will always be the return status of a request using a <code class="prettyprint">Range</code> header.</td>
</tr>
<tr>
<td>301</td>
<td>Moved Permanently</td>
<td>The requested resource has been assigned a new permanent URI. You should follow the <code class="prettyprint">Location</code> header, repeating the request.</td>
</tr>
<tr>
<td>304</td>
<td>Not Modified</td>
<td>You requested an action that succeeded, but did not modify the resource. Sound, fury, that whole thing.</td>
</tr>
</tbody></table>

<h4 id="error-codes">Error Codes</h4>

<table><thead>
<tr>
<th>Response Code</th>
<th>Meaning</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request</td>
<td>Your request was invalid</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
<td>Authentication required, but not provided</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
<td>You do not have permission to access the given resource</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
<td>No resource was found at the given URL</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed</td>
<td>You tried to access a resource with an invalid method</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable</td>
<td>You requested a response format that isn&rsquo;t supported</td>
</tr>
<tr>
<td>410</td>
<td>Gone</td>
<td>The resource you requested has been removed and/or deleted</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests</td>
<td>Curb your enthusiasm. You&rsquo;re going way to fast.</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error</td>
<td>It&rsquo;s not you, it&rsquo;s us. We had a problem processing your request. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable</td>
<td>The service is temporarially unavailable. Please try again later.</td>
</tr>
<tr>
<td>504</td>
<td>Gateway Timeout</td>
<td>The service, while acting as a gateway or proxy, did not receive a timely response from the upstream server.</td>
</tr>
</tbody></table>

              <h1 id="sdk">SDK</h1>

              <h1 id="web-api">Web API</h1>

<p>The Agave Science APIs power the Science-as-a-Service functionality of the Agave Platform. These web APIs allow you to manage all aspects of your code, collaborations, data, and your digital lab. </p>

<p>The Science APIs follow basic REST concepts and use JSON to exchange data. Formal documentation of all endpoints is available in <a href="/swagger/">Swagger 1.2</a> and <a href="/swagger/agave.json">OpenAPI</a> formats. An <a href="/live-docs/">interactive API browser</a> is available as well.   </p>

<aside class="info">You can read more about some of the <a href="#conventions">Conventions</a> we use in the introduction.</aside>  

              <h1 id="tutorials">Tutorials</h1>

              <h1 id="guides">Guides</h1>

<p>The Agave REST APIs enable applications to create and manage digital laboratories that spans campuses, the cloud, and multiple data centers using a cohesive set of web-friendly interfaces.</p>

              <h2 id="authorization">Authorization</h2>
<pre class="highlight json"><code><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">   </span><span class="err">/$$$$$$</span><span class="w">              </span><span class="err">/$$</span><span class="w">     </span><span class="err">/$$</span><span class="w">      
 </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">            </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">    </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">      
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$</span><span class="w">   </span><span class="err">/$$</span><span class="w"> </span><span class="err">/$$$$$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$|_</span><span class="w">  </span><span class="err">$$_/</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">    </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$/|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w">  </span><span class="err">$$$$$$/</span><span class="w">  </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$/|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
 </span><span class="err">\______/</span><span class="w"> </span><span class="err">|__/</span><span class="w">  </span><span class="err">|__/</span><span class="w"> </span><span class="err">\______/</span><span class="w">    </span><span class="err">\___/</span><span class="w">  </span><span class="err">|__/</span><span class="w">  </span><span class="err">|__/</span><span class="w">                                                          

</span></code></pre>

<p>Most requests to the Agave REST APIs require authorization; that is, the user must have granted permission for an application to access the requested data. To prove that the user has granted permission, the request header sent by the application must include a valid access token.</p>

<p>Before you can begin the authorization process, you will need to <a title="Client Registration" href="#client-registration/">register your client application</a>. That will give you a unique client key and secret key to use in the authorization flows.</p>

              <h3 id="supported-authorization-flows">Supported Authorization Flows</h3>

<p>The Agave REST APIs currently supports four authorization flows:</p>

<ol>
<li>The <a href="#authorization-code">Authorization Code</a> flow first gets a code then exchanges it for an access token and a refresh token. Since the exchange uses your client secret key, you should make that request server-side to keep the integrity of the key. An advantage of this flow is that you can use refresh tokens to extend the validity of the access token.</li>
<li>The <a href="#implicit-grant">Implicit Grant</a> flow is carried out client-side and does not involve secret keys. The access tokens that are issued are short-lived and there are no refresh tokens to extend them when they expire.</li>
<li><a href="#resource-owner-password-credentials">Resource Owner Password Credentials</a> flow is suitable for native and mobile applications as well as web services, this flow allows client applications to obtain an access token for a user by directly providing the user credentials in an authentication request. This flow exposes the user&rsquo;s credentials to the client application and is primarily used in situations where the client application is highly trusted such as the command line.</li>
<li>The <a href="#client-credentials">Client Credentials</a> flow enables users to interact with their own protected resources directly without requiring browser interaction. This is a critical addition for use at the command line, in scripts, and in offline programs. This flow assumes the person registering the client application and the user on whose behalf requests are made be the same person.</li>
</ol>

<table>
    <thead>
        <tr>
            <th>Flow</th>
            <th>Can fetch a user’s data by requesting access?</th>
            <th>Uses secret key? (key exchange must happen server-side!)</th>
            <th>Access token can be refreshed?</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Authorization Code</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>Yes</td>
        </tr>
        <tr>
            <td>Implicit Grant</td>
            <td>Yes</td>
            <td>No</td>
            <td>No</td>
        </tr>
        <tr>
            <td>Resource Owner Password Credentials</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>Yes</td>
        </tr>
        <tr>
            <td>Client Credentials</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
        </tr>
        <tr>
            <td>Unauthorized</td>
            <td>No</td>
            <td>No</td>
            <td>No</td>
        </tr>
    </tbody>
</table>

<aside class="notice"><b>Additional Help:</b> You can read our <a href="/tools/web-application-tutorial" title="Agave Web Application Tutorial">step-by-step tutorial</a> where we explain how to run an example application using these flows. In addition, we have a list of <a href="/tools/" title="Tools">handy wrappers and tools</a> for your language of choice.</aside>

<h3 id="token-lifetimes">Token lifetimes</h3>

<p>There are two kinds of tokens you will obtained: access and refresh. Access token lifetimes are configured by the organization operating each tenant and vary based on the flow used to obtain them. By default, access tokens are valid for 4 hours.</p>

<table>
  <thead>
    <tr>
      <th>Authorization Flow</th>
      <th>Access Token Lifetime</th>
      <th>Refresh Token Lifetime</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Authorization</td>
      <td>4 hours</td>
      <td>infinite</td>
    </tr>
    <tr>
      <td>Implicit</td>
      <td>1 hour</td>
      <td>n/a</td>
    </tr>
    <tr>
      <td>User Credential Password</td>
      <td>4 hours</td>
      <td>infinite</td>
    </tr>
    <tr>
      <td>Client Credentials</td>
      <td>4 hours</td>
      <td>n/a</td>
    </tr>
  </tbody>
</table>

<h3 id="authorization-code">Authorization Code</h3>

<p>The method is suitable for long-running applications in which the user logs in once and the access token can be refreshed. Since the token exchange involves sending your secret key, this should happen on a secure location, like a backend service, not from a client like a browser or mobile apps. This flow is described in <a href="http://tools.ietf.org/html/rfc6749#section-4.4" title="RFC-6749">RFC-6749</a>. This flow is also the authorization flow used in our REST API Tutorial.</p>

<p>
    <img src="/images/2014/09/Authorization-Code-Flow.png" alt="Authorization Code Flow Diagram" style="height: auto;"/>
</p>

<h4 id="1-your-application-requests-authorization">1. Your application requests authorization</h4>

<blockquote>
<p>A typical request will look something like this</p>
</blockquote>
<pre class="highlight http"><code><span class="err">https://public.tenants.agaveapi.co/authorize/?client_id=gTgp...SV8a&amp;amp;response_type=code&amp;amp;redirect_uri=https%3A%2F%2Fexample.com%2Fcallback&amp;amp;scope=PRODUCTION&amp;amp;state=866
</span></code></pre>

<p>The authorization process starts with your application sending a request to the Agave authorization service. (The reason your application sends this request can vary: it may be a step in the initialization of your application or in response to some user action, like a button click.) The request is sent to the /authorize endpoint of the Authorization service:</p>

<p>The request will include parameters in the query string:</p>

<table>
    <thead>
        <tr>
            <th>Request body parameter</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>response_type</td>
            <td><i>Required</i>. As defined in the OAuth 2.0 specification, this field must contain the value  &ldquo;code&rdquo;.</td>
        </tr>
        <tr>
            <td>client_id</td>
            <td><i>Required</i>. The application&rsquo;s client ID, obtained when the client application was registered with Agave (see <a href="/documentation/tutorials/client-registration/">Client Registration</a>).</td>
        </tr>
        <tr>
            <td>redirect_uri</td>
            <td><i>Required</i>. The URI to redirect to after the user grants/denies permission. This URI needs to have been entered in the Redirect URI whitelist that you specified when you registered your application. The value of <code>redirect_uri</code> here must exactly match one of the values you entered when you registered your application, including upper/lowercase, terminating slashes, etc.</td>
        </tr>
        <tr>
            <td>scope</td>
            <td><i>Optional</i>. A space-separated list of scopes. Currently only PRODUCTION is supported.</td>
        </tr>
        <tr>
            <td>state</td>
            <td><i>Optional,</i> but strongly recommended. The state can be useful for correlating requests and responses. Because your redirect_uri can be guessed, using a state value can increase your assurance that an incoming connection is the result of an authentication request. If you generate a random string or encode the hash of some client state (e.g., a cookie) in this state variable, you can validate the response to additionally ensure that the request and response originated in the same browser. This provides protection against attacks such as cross-site request forgery. See <a href="http://tools.ietf.org/html/rfc6749#section-4.4" title="RFC-6749">RFC-6749</a>. </td>
        </tr>
    </tbody>
</table>

<h4 id="2-the-user-is-asked-to-authorize-access-within-the-scopes">2. The user is asked to authorize access within the scopes</h4>

<p>The Agave Authorization service presents details of the scopes for which access is being sought. If the user is not logged in, they are prompted to do so using their API username and password.</p>

<p>When the user is logged in, they are asked to authorize access to the actions and services defined in the scopes.</p>

<h4 id="3-the-user-is-redirected-back-to-your-specified-uri">3. The user is redirected back to your specified URI</h4>

<blockquote>
<p>Let&rsquo;s assume you provided the following callback URL.</p>
</blockquote>
<pre class="highlight http"><code><span class="err">https://example.com/callback
</span></code></pre>

<p>After the user accepts (or denies) your request, the Agave Authorization service redirects back to the redirect_uri. If the user has accepted your request, the response query string contains a <code class="prettyprint">code</code> parameter with the access code you will use in the next step to retrieve an access token.</p>

<blockquote>
<p>Sample success redirect back from the server</p>
</blockquote>
<pre class="highlight http"><code><span class="err">https://example.com/callback?code=Pq3S..M4sY&amp;amp;state=866
</span></code></pre>

<table>
    <thead>
        <tr>
            <th>Query parameter 
</th>
            <th>Value 
</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>access_token 
</td>
            <td>An access token that can be provided in subsequent calls, for example to <a href="https://developer.spotify.com/spotify-web-api/">Spotify Web API</a> services. 
</td>
        </tr>
        <tr>
            <td>token_type 
</td>
            <td>Value: “bearer” 
</td>
        </tr>
        <tr>
            <td>expires_in 
</td>
            <td>The time period (in seconds) for which the access token is valid. 
</td>
        </tr>
        <tr>
            <td>state 
</td>
            <td>The value of the <code>state</code> parameter supplied in the request. 
</td>
        </tr>
    </tbody>
</table>

<p>If the user has denied access, there will be no access token and the final URL will have a query string containing the following parameters:</p>
<pre class="highlight plaintext"><code># Sample denial redirect back from the server
https://example.com/callback?error=access_denied&amp;amp;state=867
</code></pre>

<table>
    <thead>
        <tr>
            <th>Query parameter 
</th>
            <th>Value 
</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>error 
</td>
            <td>The reason authorization failed, for example: “access_denied” </td>
        </tr>
        <tr>
            <td>state 
</td>
            <td>The value of the state parameter supplied in the request. </td>
        </tr>
    </tbody>
</table>

<h4 id="4-your-application-requests-refresh-and-access-tokens">4. Your application requests refresh and access tokens</h4>
<pre class="highlight shell"><code>POST https://public.tenants.agaveapi.co/token
</code></pre>

<p>When the authorization code has been received, you will need to exchange it with an access token by making a POST request to the Agave Authorization service, this time to its <code class="prettyprint">/token</code> endpoint. The body of this POST request must contain the following parameters:</p>

<table>
    <thead>
        <tr>
            <th>Request body parameter</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>grant_type</td>
            <td><i>Required</i>. As defined in the OAuth 2.0 specification, this field must contain the value  &ldquo;authorization_code&rdquo;.</td>
        </tr>
        <tr>
            <td>code</td>
            <td><i>Required</i>. The authorization code returned from the initial request to the Account&rsquo;s <code>/authorize</code> endpoint. <br/></td>
        </tr>
        <tr>
            <td>redirect_uri</td>
            <td><i>Required</i>. This parameter is used for validation only (there is no actual redirection). The value of this parameter must <i>exactly</i> match the value of <code>redirect_uri</code> supplied when requesting the authorization code.</td>
        </tr>
        <tr>
            <td>client_id</td>
            <td><i>Required</i>. The application&rsquo;s client ID, obtained when the client application was registered with Agave (see <a href="/documentation/tutorials/client-registration/">Client Registration</a>).</td>
        </tr>
        <tr>
            <td>client_secret</td>
            <td><i>Required</i>. The application&rsquo;s client secret key, obtained when the client application was registered with Agave (see <a href="/documentation/tutorials/client-registration/">Client Registration</a>).</td>
        </tr>
    </tbody>
</table>

<h4 id="5-the-tokens-are-returned-to-your-application">5. The tokens are returned to your application</h4>
<pre class="highlight json"><code><span class="err">#</span><span class="w"> </span><span class="err">An</span><span class="w"> </span><span class="err">example</span><span class="w"> </span><span class="err">cURL</span><span class="w"> </span><span class="err">request</span><span class="w">
</span><span class="err">curl</span><span class="w"> </span><span class="err">-X</span><span class="w"> </span><span class="err">POST</span><span class="w"> </span><span class="err">-d</span><span class="w"> </span><span class="s2">"grant_type= authorization_code"</span><span class="w">
    </span><span class="err">-d</span><span class="w"> </span><span class="s2">"code=Pq3S..M4sY"</span><span class="w">
    </span><span class="err">-d</span><span class="w"> </span><span class="s2">"client_id=gTgp...SV8a"</span><span class="w">
    </span><span class="err">-d</span><span class="w"> </span><span class="s2">"client_secret=hZ_z3f...BOD6"</span><span class="w">
    </span><span class="err">-d</span><span class="w"> </span><span class="s2">"redirect_uri=https%3A%2F%2Fwww.foo.com%2Fauth"</span><span class="w">
    </span><span class="err">https://public.tenants.agaveapi.co/token</span><span class="w">
</span></code></pre>

<blockquote>
<p>The response would look something like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a742...12d2"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">14400</span><span class="p">,</span><span class="w">
    </span><span class="nt">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"d77c...Sacf"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bearer"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>On success, the response from the Agave Authorization service has the status code 200 OK in the response header, and a JSON object with the fields in the following table in the response body:</p>

<table>
    <thead>
        <tr>
            <th>Key 
</th>
            <th>Value type</th>
            <th>Value description
</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>access_token 
</td>
            <td>string</td>
            <td>An access token that can be provided in subsequent calls, for example to Agave REST APIs. 
</td>
        </tr>
        <tr>
            <td>token_type 
</td>
            <td>string</td>
            <td>How the access token may be used: always &ldquo;Bearer&rdquo;. 
</td>
        </tr>
        <tr>
            <td>expires_in 
</td>
            <td>int</td>
            <td>The time period (in seconds) for which the access token is valid. (Maximum 14400 seconds, or 4 hours.)
</td>
        </tr>
        <tr>
            <td>refresh_token</td>
            <td>string</td>
            <td>A token that can be sent to the Spotify Accounts service in place of an authorization code. (When the access code expires, send a POST request to the Accounts service <code>/token</code> endpoint, but use this code in place of an authorization code. A new access token will be returned. A new refresh token might be returned too.) </td>
        </tr>
    </tbody>
</table>

<h4 id="6-use-the-access-token-to-access-the-agave-rest-apis">6. Use the access token to access the Agave REST APIs</h4>

<blockquote>
<p>Make a call to the API</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: Bearer a742...12d2"</span>
    https://public.tenants.agaveapi.co/profiles/v2/me?pretty<span class="o">=</span><span class="nb">true</span>&amp;naked<span class="o">=</span><span class="nb">true</span>
</code></pre>

<blockquote>
<p>The response would look something like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"create_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"20140905072223Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rjohnson@mlb.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Randy"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"full_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Randy Johnson"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Johnson"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mobile_phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(123) 456-7890"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(123) 456-7890"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Active"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"uid"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rjohnson"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Once you have a valid access token, you can include it in <code class="prettyprint">Authorization</code> header for all subsequent requests to APIs in the Platform.</p>

<h4 id="7-requesting-access-token-from-refresh-token">7. Requesting access token from refresh token</h4>
<pre class="highlight shell"><code>curl -sku <span class="s2">"Authorization: Basic Qt3c...Rm1y="</span>
    -d <span class="nv">grant_type</span><span class="o">=</span>refresh_token
    -d <span class="nv">refresh_token</span><span class="o">=</span>d77c...Sacf
    https://public.tenants.agaveapi.co/token
</code></pre>

<blockquote>
<p>The response would look something like this.</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"61e6...Mc96"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">14400</span><span class="p">,</span><span class="w">
    </span><span class="nt">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bearer"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Access tokens are deliberately set to expire after a short time, usually 4 hours, after which new tokens may be granted by supplying the refresh token originally obtained during the authorization code exchange.</p>

<p>The request is sent to the token endpoint of the Agave Authorization service:</p>
<pre class="highlight plaintext"><code>POST https://public.tenants.agaveapi.co/token
</code></pre>

<p>The body of this POST request must contain the following parameters:</p>

<table>
    <thead>
        <tr>
            <th>Request body parameter</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>grant_type</td>
            <td><i>Required.</i> Set it to &ldquo;refresh_token&rdquo;. 
refresh_token </td>
        </tr>
        <tr>
            <td>refresh_token</td>
            <td><i>Required.</i> The refresh token returned from the authorization code exchange.</td>
        </tr>
    </tbody>
</table>

<p>The header of this POST request must contain the following parameter:</p>

<table>
    <thead>
        <tr>
            <th>Header parameter</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Authorization</td>
            <td><i>Required.</i> Base 64 encoded string that contains the client ID and client secret key. The field must have the format: <code>Authorization: Basic <base64 encoded client_id:client_secret></code>. (<i>This can also be achieved with curl using the `-u` option and specifying the raw colon separated client_id and client_secret.</i>)</td>
        </tr>
    </tbody>
</table>

<h3 id="implicit-grant">Implicit Grant</h3>

<p>Implicit grant flow is for clients that are implemented entirely using JavaScript and running in resource owner&rsquo;s browser. You do not need any server side code to use it. This flow is described in <a href="http://tools.ietf.org/html/rfc6749#section-4.4" title="RFC-6749">RFC-6749</a>.</p>

<p><img src="/images/2014/09/Implicit-Flow.png" alt="Implicit Flow" style="width: 100%; height:auto"/></p>

<h4 id="1-your-application-requests-authorization">1. Your application requests authorization</h4>
<pre class="highlight json"><code><span class="err">https://public.tenants.agaveapi.co/authorize?client_id=gTgp...SV</span><span class="mi">8</span><span class="err">a&amp;amp;redirect_uri=http:%</span><span class="mi">2</span><span class="err">F%</span><span class="mi">2</span><span class="err">Fexample.com%</span><span class="mi">2</span><span class="err">Fcallback&amp;amp;scope=PRODUCTION&amp;amp;response_type=token&amp;amp;state=</span><span class="mi">867</span><span class="w">
</span></code></pre>

<p>The flow starts off with your application redirecting the user to the <code class="prettyprint">/authorize</code> endpoint of the Authorization service. The request will include parameters in the query string:</p>

<table>
    <thead>
        <tr>
            <th>Request body parameter</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>response_type</td>
            <td><i>Required</i>. As defined in the OAuth 2.0 specification, this field must contain the value  &ldquo;token&rdquo;.</td>
        </tr>
        <tr>
            <td>client_id</td>
            <td><i>Required</i>. The application&rsquo;s client ID, obtained when the client application was registered with Agave (see <a href="/documentation/tutorials/client-registration/">Client Registration</a>).</td>
        </tr>
        <tr>
            <td>redirect_uri</td>
            <td><i>Required</i>. This parameter is used for validation only (there is no actual redirection). The value of this parameter must <i>exactly</i> match the value of <code>redirect_uri</code> supplied when requesting the authorization code.</td>
        </tr>
        <tr>
            <td>scope</td>
            <td><i>Required</i>. A space-separated list of scopes. Currently only PRODUCTION is supported.</td>
        </tr>
        <tr>
            <td>state</td>
            <td><i>Optional,</i> but strongly recommended. The state can be useful for correlating requests and responses. Because your redirect_uri can be guessed, using a state value can increase your assurance that an incoming connection is the result of an authentication request. If you generate a random string or encode the hash of some client state (e.g., a cookie) in this state variable, you can validate the response to additionally ensure that the request and response originated in the same browser. This provides protection against attacks such as cross-site request forgery. See <a href="http://tools.ietf.org/html/rfc6749#section-4.4" title="RFC-6749">RFC-6749</a>. </td>
        </tr>
        <tr>
            <td>show_dialog</td>
            <td><i>Optional</i>. Whether or not to force the user to approve the app again if they’ve already done so. If <code>false</code> (default), a user who has already approved the application may be automatically redirected to the URI specified by <code>redirect_uri</code>. If <code>true</code>, the user will not be automatically redirected and will have to approve the app again.</td>
        </tr>
    </tbody>
</table>

<h4 id="2-the-user-is-asked-to-authorize-access-within-the-scopes">2. The user is asked to authorize access within the scopes</h4>

<p>The Agave Authorization service presents details of the scopes for which access is being sought. If the user is not logged in, they are prompted to do so using their API username and password.</p>

<p>When the user is logged in, they are asked to authorize access to the services defined in the scopes. By default all of the Core Science APIs fall under a single scope called, <code class="prettyprint">PRODUCTION</code>.</p>

<h4 id="3-the-user-is-redirected-back-to-your-specified-uri">3. The user is redirected back to your specified URI</h4>

<blockquote>
<p>Let&rsquo;s assume we specified the following callback address.</p>
</blockquote>
<pre class="highlight http"><code><span class="err">https://example.com/callback
</span></code></pre>

<blockquote>
<p>A valid success response would be</p>
</blockquote>
<pre class="highlight http"><code><span class="err">https://example.com/callback?access_token=Vr17...amUa&amp;amp;token_type=bearer&amp;amp;expires_in=3600&amp;amp;state=867
</span></code></pre>

<p>After the user grants (or denies) access, the Agave Authorization service redirects the user to the <code class="prettyprint">redirect_uri</code>. If the user has granted access, the final URL will contain the following data parameters in the query string.</p>

<table>
    <thead>
        <tr>
            <th>Query parameter 
</th>
            <th>Value 
</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>access_token 
</td>
            <td>An access token that can be provided in subsequent calls, for example to <a href="https://developer.spotify.com/spotify-web-api/">Spotify Web API</a> services. 
</td>
        </tr>
        <tr>
            <td>token_type 
</td>
            <td>Value: “bearer” 
</td>
        </tr>
        <tr>
            <td>expires_in 
</td>
            <td>The time period (in seconds) for which the access token is valid. 
</td>
        </tr>
        <tr>
            <td>state 
</td>
            <td>The value of the <code>state</code> parameter supplied in the request. 
</td>
        </tr>
    </tbody>
</table>

<p>If the user has denied access, there will be no access token and the final URL will have a query string containing the following parameters:</p>

<blockquote>
<p>A failed response would resemble something like</p>
</blockquote>
<pre class="highlight shell"><code>https://example.com/callback?error<span class="o">=</span>access_denied&amp;amp;state<span class="o">=</span>867
</code></pre>

<table>
    <thead>
        <tr>
            <th>Query parameter 
</th>
            <th>Value 
</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>error 
</td>
            <td>The reason authorization failed, for example: “access_denied” </td>
        </tr>
        <tr>
            <td>state 
</td>
            <td>The value of the state parameter supplied in the request. </td>
        </tr>
    </tbody>
</table>

<h4 id="4-use-the-access-token-to-access-the-agave-rest-apis">4. Use the access token to access the Agave REST APIs</h4>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: Bearer 61e6...Mc96"</span> https://public.tenants.agaveapi.co/profiles/v2/me?pretty<span class="o">=</span><span class="nb">true</span>
</code></pre>

<blockquote>
<p>The response would look something like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"create_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"20140905072223Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan@mlb.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nolan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"full_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nolan Ryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mobile_phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(123) 456-7890"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(123) 456-7890"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Active"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"uid"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The access token allows you to make requests to any of the Agave REST APIs on behalf of the authenticated user.</p>

<h3 id="resource-owner-password-credentials">Resource Owner Password Credentials</h3>

<p>The method is suitable for scenarios where there is a high degree of trust between the end-user and the client application. This could be a Desktop application, shell script, or server-to-server communication where user authorization is needed. This flow is described in <a href="http://tools.ietf.org/html/rfc6749#section-4.4" title="RFC-6749">RFC-6749</a>.</p>

<p><img src="/images/2014/09/Resource-Owner-Password-Flow.png" style="width:100%; height:auto;"></p>

<h4 id="1-your-application-requests-authorization">1. Your application requests authorization</h4>
<pre class="highlight shell"><code>curl -sku <span class="s2">"Authorization: Basic Qt3c...Rm1y="</span>
    -d <span class="nv">grant_type</span><span class="o">=</span>password
    -d <span class="nv">username</span><span class="o">=</span>rjohnson
    -d <span class="nv">password</span><span class="o">=</span>password
    -d <span class="nv">scope</span><span class="o">=</span>PRODUCTION
    https://public.tenants.agaveapi.co/token
</code></pre>

<blockquote>
<p>The response would look something like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3Dsr...pv21"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">14400</span><span class="p">,</span><span class="w">
    </span><span class="nt">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dyVa...MqR0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bearer"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The request is sent to the <code class="prettyprint">/token</code> endpoint of the Agave Authentication service. The request will include the following parameters in the request body:</p>

<table>
    <thead>
        <tr>
            <th>Request body parameter</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>grant_type</td>
            <td><i>Required.</i> Set it to &ldquo;refresh_token&rdquo;.</td>
        </tr>
        <tr>
            <td>username</td>
            <td><i>Required.</i> The username of an active API user.</td>
        </tr>
        <tr>
            <td>password</td>
            <td><i>Required.</i> The password of an active API user.</td>
        </tr>
        <tr>
            <td>scope</td>
            <td><i>Required.</i> A space-separated list of scopes. Currently only PRODUCTION is supported.</td>
        </tr>
    </tbody>
</table>

<p>The header of this POST request must contain the following parameter:</p>

<table>
    <thead>
        <tr>
            <th>Header parameter</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Authorization</td>
            <td><i>Required.</i> Base 64 encoded string that contains the client ID and client secret key. The field must have the format: <code>Authorization: Basic <base64 encoded client_id:client_secret></code>. (<i>This can also be achieved with curl using the `-u` option and specifying the raw colon separated client_id and client_secret.</i>)</td>
        </tr>
    </tbody>
</table>

<aside class="notice">It is not necessary for the username and password sent in the authorization request correspond to those of the client credentials owner, you can obtain an access token for any user provided you have their username and password. It is important to note that this flow should ***only*** be used in situations of high trust where no browser is available to handle the HTTP redirects required by the Authorization Code flow. Collecting and/or unnecessarily exposing user passwords is a violation of the <a href="/terms-of-service/" title="Terms of Service">Terms of Service</a> and subject to immediate account revocation.</aside>
<pre class="highlight shell"><code>https://example.com/callback?error<span class="o">=</span>access_denied
</code></pre>

<p>If the user has not accepted your request or an error has occurred, the response query string contains an error parameter indicating the error that occurred during login. For example:</p>

<h4 id="2-use-the-access-token-to-access-the-agave-rest-apis">2. Use the access token to access the Agave REST APIs</h4>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: Bearer 3Dsr...pv21"</span>
    https://public.tenants.agaveapi.co/profiles/v2/me?pretty<span class="o">=</span><span class="nb">true</span>
</code></pre>

<blockquote>
<p>The response would look something like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"create_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"20140905072223Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rjohnson@mlb.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Randy"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"full_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Randy Johnson"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Johnson"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mobile_phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(123) 456-7890"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(123) 456-7890"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Active"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"uid"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rjohnson"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The access token allows you to make requests to any of the Agave REST APIs on behalf of the authenticated user.</p>

<h4 id="3-requesting-access-token-from-refresh-token">3. Requesting access token from refresh token</h4>
<pre class="highlight shell"><code>curl -sku <span class="s2">"Authorization: Basic Qt3c...Rm1y="</span>
    -d <span class="nv">grant_type</span><span class="o">=</span>refresh_token
    -d <span class="nv">refresh_token</span><span class="o">=</span>dyVa...MqR0
    -d <span class="nv">scope</span><span class="o">=</span>PRODUCTION
    https://public.tenants.agaveapi.co/token
</code></pre>

<blockquote>
<p>The response would look something like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8erF...NGly"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">14400</span><span class="p">,</span><span class="w">
    </span><span class="nt">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bearer"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Access tokens are deliberately set to expire after a short time, usually 4 hours, after which new tokens may be granted by supplying the refresh token obtained during original request.</p>

<p>The request is sent to the token endpoint of the Agave Authorization service. The body of this POST request must contain the following parameters:</p>

<table>
    <thead>
        <tr>
            <th>Request body parameter</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>grant_type</td>
            <td><i>Required.</i> Set it to &ldquo;refresh_token&rdquo;. 
refresh_token </td>
        </tr>
        <tr>
            <td>refresh_token</td>
            <td><i>Required.</i> The refresh token returned from the authorization code exchange.</td>
        </tr>
        <tr>
            <td>scope</td>
            <td>Required. A space-separated list of scopes. <i>Required.</i> Currently only PRODUCTION is supported.</td>
        </tr>
    </tbody>
</table>

<p>The header of this POST request must contain the following parameter:</p>

<table>
    <thead>
        <tr>
            <th>Header parameter</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Authorization</td>
            <td><i>Required.</i> Base 64 encoded string that contains the client ID and client secret key. The field must have the format: <code>Authorization: Basic <base64 encoded client_id:client_secret></code>. (<i>This can also be achieved with curl using the `-u` option and specifying the raw colon separated client_id and client_secret.</i>)</td>
        </tr>
    </tbody>
</table>

<h3 id="client-credentials">Client Credentials</h3>

<p>The method is suitable for authenticating your requests to the Agave REST API. This flow is described in <a href="http://tools.ietf.org/html/rfc6749#section-4.4" title="RFC-6749">RFC-6749</a>.</p>

<p><img src="/images/2014/09/Client-Credentials-Flow.png" style="width:100%; height:auto;"></p>

<h4 id="1-your-application-requests-authorization">1. Your application requests authorization</h4>
<pre class="highlight shell"><code>curl -sku <span class="s2">"Authorization: Basic Qt3c...Rm1y="</span>
    -d <span class="nv">grant_type</span><span class="o">=</span>client_credentials
    -d <span class="nv">scope</span><span class="o">=</span>PRODUCTION
    https://public.tenants.agaveapi.co/token
</code></pre>

<blockquote>
<p>The response would look something like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"61e6...Mc96"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">14400</span><span class="p">,</span><span class="w">
    </span><span class="nt">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bearer"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The request is sent to the <code class="prettyprint">/token</code> endpoint of the Agave Authentication service. The request must include the following parameters in the request body:</p>

<table>
    <thead>
        <tr>
            <th>Request body parameter</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>grant_type</td>
            <td><i>Required.</i> Set it to &ldquo;refresh_token&rdquo;.</td>
        </tr>
        <tr>
            <td>scope</td>
            <td><i>Optional.</i> A space-separated list of scopes. Currently on PRODUCTION is supported.</td>
        </tr>
    </tbody>
</table>

<p>The header of this POST request must contain the following parameter:</p>

<table>
    <thead>
        <tr>
            <th>Header parameter</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Authorization</td>
            <td><i>Required.</i> Base 64 encoded string that contains the client ID and client secret key. The field must have the format: <code>Authorization: Basic <base64 encoded client_id:client_secret></code>. (<i>This can also be achieved with curl using the `-u` option and specifying the raw colon separated client_id and client_secret.</i>)</td>
        </tr>
    </tbody>
</table>

<h4 id="2-use-the-access-token-to-access-the-agave-rest-apis">2. Use the access token to access the Agave REST APIs</h4>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: Bearer 61e6...Mc96"</span>
     https://public.tenants.agaveapi.co/profiles/v2/me
</code></pre>

<blockquote>
<p>The response would look something like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan@mlb.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"firstName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Nolan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Ryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"position"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"null"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"institution"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Houston Astros"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(123) 456-7890"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"fax"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"researchArea"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"department"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"city"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Houston"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"TX"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"country"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"USA"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gender"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"M"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/profiles/v2/nryan"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"users"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/profiles/v2/nryan/users"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The access token allows you to make requests to any of the Agave REST APIs on behalf of the authenticated user.</p>

              <h2 id="clients-and-api-keys">Clients and API Keys</h2>
<pre class="highlight json"><code><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">  </span><span class="err">/$$</span><span class="w"> </span><span class="err">/$$</span><span class="w">                       </span><span class="err">/$$</span><span class="w">
 </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$|__/</span><span class="w">                      </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\__/|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$</span><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">  </span><span class="err">/$$$$$$$</span><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">   </span><span class="err">/$$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">      </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$$|_</span><span class="w">  </span><span class="err">$$_/</span><span class="w">  </span><span class="err">/$$_____/</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">      </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">   </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">    </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$_____/|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$\____</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$/|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$|</span><span class="w">  </span><span class="err">$$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$//$$$$$$$/</span><span class="w">
 </span><span class="err">\______/</span><span class="w"> </span><span class="err">|__/|__/</span><span class="w"> </span><span class="err">\_______/|__/</span><span class="w">  </span><span class="err">|__/</span><span class="w">   </span><span class="err">\___/</span><span class="w"> </span><span class="err">|_______/</span><span class="w">
</span></code></pre>

<p>By now you already have a user account. Your user account identifies you to the web applications you interact with. A username and password is sufficient for interacting with an application because the application has a user interface, so it knows that the authenticated user is the same one interacting with it. The Agave API does not have a user interface, so simply providing it a username and password is not sufficient. Agave needs to know both the user on whose behalf it is acting as well as the client application that is making the call. Whereas every person has a single user account, they may leverage multiple services to do their daily work. They may start out using <a href="https://togo.agaveapi.co/" title="iPlant Discovery Environment" target="_blank">Agave ToGo</a> to kick of an analysis, then switch to <a href="https://edublog/" title="MyPlant" target="_blank">MyPlant</a> to discuss some results, then receive an Slack notice that new data has been shared with them, click a <a href="#postits" title="Pre-Authenticated URL Shortening with PostIts">PostIt</a> link that allows them to download the data directly to their desktop, edit the file locally, and save it in a local folder that syncs with their iPlant <a href="http://www.iplantcollaborative.org/discover/data-store" title="iPlant Data Store" target="_blank">cloud storage</a> in the background.</p>

<p>In each of the above interactions, the user is the same, but the context with which they interact with the Agave is different. Further, the above interactions all involved client applications developed by the same organization. The situation is further complicated when one or more 3rd party client applications are used to leverage the infrastructure. Agave needs to track both the users and client applications with whom it interacts. It does this through the issuance of API keys.</p>

<p>Agave uses <a href="http://oauth.net/2" title="OAuth2" target="_blank">OAuth2</a> to authenticate users and make authorization decisions about what APIs client applications have permission to access. A discussion of OAuth2 is out of the context of this tutorial. You can read more about it on the <a href="http://oauth.net/2" title="OAuth2" target="_blank">OAuth2</a> website or from the websites of any of the many other service providers using it today. In this section, we will walk you through getting your API keys so we can stay focused on learning how to interact with the Agave&rsquo;s APIs.</p>

<h3 id="creating-a-new-client-application">Creating a new client application</h3>

<p>In order to interact with any of the Agave APIs, you will need to first get a set of API keys. You can get your API keys from the <a href="http://agaveapi.co/live-docs/#!/clients/create_post_1" title="Clients API">Clients service</a>. The example below shows how to get your API keys using both curl and the <a href="http://agaveapi.co/agave-cli/" title="Agave CLI">Agave CLI</a>.</p>
<pre class="highlight shell"><code>curl -sku <span class="s2">"</span><span class="nv">$API_USERNAME</span><span class="s2">:</span><span class="nv">$API_PASSWORD</span><span class="s2">"</span> -X POST -d <span class="s2">"client_name=my_cli_app"</span> -d <span class="s2">"description=Client app used for scripting up cool stuff"</span> https://public.tenants.agaveapi.co/clients/v2
</code></pre>
<pre class="highlight plaintext"><code>clients-create -S -v -N my_cli_app -D "Client app used for scripting up cool stuff"
</code></pre>

<blockquote>
<p>Note: the -S option will store the new API keys for future use so you don&rsquo;t need to manually enter then when you authenticate later.</p>

<p>The response to this call will look something like:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">  
   </span><span class="nt">"callbackUrl"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
   </span><span class="nt">"key"</span><span class="p">:</span><span class="s2">"gTgp...SV8a"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"secret"</span><span class="p">:</span><span class="s2">"hZ_z3f...BOD6"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"Client app used for scripting up cool stuff"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"my_cli_app"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"tier"</span><span class="p">:</span><span class="s2">"Unlimited"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"_links"</span><span class="p">:{</span><span class="w">  
      </span><span class="nt">"self"</span><span class="p">:{</span><span class="w">  
         </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/clients/v2/my_cli_app"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"subscriber"</span><span class="p">:{</span><span class="w">  
         </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.coprofiles/v2/nryan"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"subscriptions"</span><span class="p">:{</span><span class="w">  
         </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/clients/v2/my_cli_app/subscriptions/"</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Your API keys should be kept in a secure place and not shared with others. This will prevent other, unauthorized client applications from impersonating your application. If you are developing a web application, you should also provide a valid callbackUrl when creating your keys. This will reduce the risk of your keys being reused even if they are compromised. You should also create a unique set of API keys for each client application you develop. This will allow you to better monitor your usage on a client application-to-application basis and reduce the possibility of inadvertently hitting usage quotas due to cumulative usage across client applications.</p>

<h3 id="listing-your-existing-client-applications">Listing your existing client applications</h3>
<pre class="highlight shell"><code>curl -sku <span class="s2">"</span><span class="nv">$API_USERNAME</span><span class="s2">:</span><span class="nv">$API_PASSWORD</span><span class="s2">"</span> https://public.tenants.agaveapi.co/clients/v2
</code></pre>
<pre class="highlight plaintext"><code>clients-list -v
</code></pre>

<blockquote>
<p>The response to this call will look something like:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">  
   </span><span class="p">{</span><span class="w">  
      </span><span class="nt">"callbackUrl"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="nt">"key"</span><span class="p">:</span><span class="s2">"xn8b...0y3d"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"DefaultApplication"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tier"</span><span class="p">:</span><span class="s2">"Unlimited"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"_links"</span><span class="p">:{</span><span class="w">  
         </span><span class="nt">"self"</span><span class="p">:{</span><span class="w">  
            </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/clients/v2/DefaultApplication"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nt">"subscriber"</span><span class="p">:{</span><span class="w">  
            </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.coprofiles/v2/nryan"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nt">"subscriptions"</span><span class="p">:{</span><span class="w">  
            </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/clients/v2/DefaultApplication/subscriptions/"</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="p">{</span><span class="w">  
      </span><span class="nt">"callbackUrl"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="nt">"key"</span><span class="p">:</span><span class="s2">"gTgp...SV8a"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"Client app used for scripting up cool stuff"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"my_cli_app"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tier"</span><span class="p">:</span><span class="s2">"Unlimited"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"_links"</span><span class="p">:{</span><span class="w">  
         </span><span class="nt">"self"</span><span class="p">:{</span><span class="w">  
            </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/clients/v2/my_cli_app"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nt">"subscriber"</span><span class="p">:{</span><span class="w">  
            </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.coprofiles/v2/nryan"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nt">"subscriptions"</span><span class="p">:{</span><span class="w">  
            </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/clients/v2/my_cli_app/subscriptions/"</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>Over time you may develop several client applications. Managing several sets of API keys can become tricky. You can see which applications you have created by querying the Clients service.</p>

<aside class="notice">In the last response you will notice that the client secret was not returned as part of the response objects. If you need to recover your client secret, just recreate the client app. Your client keys will not change, but the response will include your secret key.</aside>

<h3 id="deleting-client-registrations">Deleting client registrations</h3>
<pre class="highlight shell"><code>curl -sku <span class="s2">"</span><span class="nv">$API_USERNAME</span><span class="s2">:</span><span class="nv">$API_PASSWORD</span><span class="s2">"</span> -X DELETE https://public.tenants.agaveapi.co/clients/v2/my_cli_app
</code></pre>
<pre class="highlight plaintext"><code>clients-delete -v my_cli_app
</code></pre>

<blockquote>
<p>The response to this call is simply a null result object.</p>
</blockquote>

<p>At some point you may need to delete a client. You can do this by requesting a DELETE on your client in the Clients service.</p>

<h3 id="listing-current-subscriptions">Listing current subscriptions</h3>
<pre class="highlight shell"><code>curl -sku <span class="s2">"</span><span class="nv">$API_USERNAME</span><span class="s2">:</span><span class="nv">$API_PASSWORD</span><span class="s2">"</span> https://public.tenants.agaveapi.co/clients/v2/my_cli_app/subscriptions
</code></pre>
<pre class="highlight plaintext"><code>clients-subscriptions-list -v my_cli_app
</code></pre>

<blockquote>
<p>The response to this call will look something like:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
     </span><span class="nt">"context"</span><span class="p">:</span><span class="s2">"/apps"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"Apps"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"provider"</span><span class="p">:</span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"PUBLISHED"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"version"</span><span class="p">:</span><span class="s2">"v2"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"tier"</span><span class="p">:</span><span class="s2">"Unlimited"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"_links"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"api"</span><span class="p">:{</span><span class="w">
           </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/apps/v2/"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"client"</span><span class="p">:{</span><span class="w">
           </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/clients/v2/systest_test_client"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"self"</span><span class="p">:{</span><span class="w">
           </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/clients/v2/systest_test_client/subscriptions/"</span><span class="w">
        </span><span class="p">}</span><span class="w">
     </span><span class="p">}</span><span class="w">   
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
     </span><span class="nt">"context"</span><span class="p">:</span><span class="s2">"/files"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"Files"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"provider"</span><span class="p">:</span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"PUBLISHED"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"version"</span><span class="p">:</span><span class="s2">"v2"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"tier"</span><span class="p">:</span><span class="s2">"Unlimited"</span><span class="w">
     </span><span class="s2">"_links"</span><span class="err">:</span><span class="p">{</span><span class="w">
        </span><span class="nt">"api"</span><span class="p">:{</span><span class="w">
           </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"client"</span><span class="p">:{</span><span class="w">
           </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/clients/v2/systest_test_client"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"self"</span><span class="p">:{</span><span class="w">
           </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/clients/v2/systest_test_client/subscriptions/"</span><span class="w">
        </span><span class="p">}</span><span class="w">
     </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>When you register a new client application and get your API keys, you are given access to all the Agave APIs by default. You can see the APIs you have access to by querying the subscriptions collection of your client.</p>

<h3 id="updating-client-subscriptions">Updating client subscriptions</h3>
<pre class="highlight shell"><code>curl -sku <span class="s2">"</span><span class="nv">$API_USERNAME</span><span class="s2">:</span><span class="nv">$API_PASSWORD</span><span class="s2">"</span> -X POST -d <span class="s2">"name=transforms"</span> https://public.tenants.agaveapi.co/clients/v2/my_cli_app/subscriptions
</code></pre>
<pre class="highlight plaintext"><code>clients-subscriptions-update -v -N transforms my_cli_app
</code></pre>

<blockquote>
<p>You can also use a wildcard to resubscribe to all active APIs.</p>
</blockquote>
<pre class="highlight shell"><code>curl -sku <span class="s2">"</span><span class="nv">$API_USERNAME</span><span class="s2">:</span><span class="nv">$API_PASSWORD</span><span class="s2">"</span> -X POST -d <span class="s2">"name=*"</span> https://public.tenants.agaveapi.co/clients/v2/my_cli_app/subscriptions
</code></pre>
<pre class="highlight plaintext"><code>clients-subscriptions-update -v -N * my_cli_app
</code></pre>

<blockquote>
<p>The response to this call will be a JSON array identical to the one returned when listing your subscriptions.</p>
</blockquote>

<p>Over time, new APIs will be deployed. When this happens you will need to subscribe to the new APIs. You can do this by POSTing a request to the subscription collection with the information about the new API.</p>

              <h2 id="systems">Systems</h2>
<pre class="highlight json"><code><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">                     </span><span class="err">/$$</span><span class="w">
 </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">                   </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\__//$$</span><span class="w">   </span><span class="err">/$$</span><span class="w"> </span><span class="err">/$$$$$$$/$$$$$$</span><span class="w">   </span><span class="err">/$$$$$$</span><span class="w"> </span><span class="err">/$$$$$$/$$$$</span><span class="w">
</span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$/$$_____|_</span><span class="w">  </span><span class="err">$$_/</span><span class="w">  </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$|</span><span class="w"> </span><span class="err">$$_</span><span class="w">  </span><span class="err">$$_</span><span class="w">  </span><span class="err">$$</span><span class="w">
 </span><span class="err">\____</span><span class="w">  </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w">  </span><span class="err">$$$$$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">   </span><span class="err">|</span><span class="w"> </span><span class="err">$$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w">
 </span><span class="err">/$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$\____</span><span class="w">  </span><span class="err">$$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$|</span><span class="w"> </span><span class="err">$$_____|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w">  </span><span class="err">$$$$$$$/$$$$$$$/</span><span class="w"> </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
 </span><span class="err">\______/</span><span class="w"> </span><span class="err">\____</span><span class="w">  </span><span class="err">$|_______/</span><span class="w">   </span><span class="err">\___/</span><span class="w">  </span><span class="err">\_______|__/</span><span class="w"> </span><span class="err">|__/</span><span class="w"> </span><span class="err">|__/</span><span class="w">
          </span><span class="err">/$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
         </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$/</span><span class="w">
          </span><span class="err">\______/</span><span class="w">
</span></code></pre>

<p>A system in Agave represents a server or collection of servers. A server can be physical, virtual, or a collection of servers exposed through a single hostname or ip address. Systems are identified and referenced in Agave by a unique ID unrelated to their ip address or hostname. Because of this, a single physical system may be registered multiple times. This allows different users to configure and use a system in whatever way they need to for their specific needs.</p>

<p>Systems come in two flavors: storage and execution. Storage systems are only used for storing and interacting with data. Execution systems are used for running apps (aka jobs or batch jobs) as well as storing and interacting with data.</p>

<p>The Systems service gives you the ability to add and discover storage and compute resources for use in the rest of the API. You may add as many or as few storage systems as you need to power your digital lab. When you register a system, it is private to you and you alone. Systems can also be published into the public space for all users to use. Depending on who is administering Agave for your organization, this may have already happened and you may already have one or more storage systems available to you by default.</p>

<p>In this tutorial we walk you through how to discovery, manage, share, and configure systems for your specific needs. This tutorial is best done in a hands-on manner, so if you do not have a compute or storage system of your own to use, you can grab a VM from our sandbox.</p>

<h3 id="discovering-systems">Discovering systems</h3>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://public.tenants.agaveapi.co/systems/v2/
</code></pre>
<pre class="highlight plaintext"><code>systems-list -v
</code></pre>

<blockquote>
<p>The response will be something like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"data.agaveapi.co"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"iPlant Data Store"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"STORAGE"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"The iPlant Data Store is where your data are stored. The Data Store is cloud-based and is the central repository from which data is accessed by all of iPlant&amp;#039;s technologies."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"public"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"default"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/data.agaveapi.co"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"docker.iplantcollaborative.org"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Demo Docker VM"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"EXECUTION"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Atmosphere VM used for Docker demonstrations and tutorials."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"public"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"default"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/docker.iplantcollaborative.org"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>The Systems service allows you to list and search for systems you have registered and systems that have been shared with you. To get a list of all your systems, make a GET request on the Systems collection.</p>

<p>System description can get rather verbose, so a summary object is returned when listing a resource collection. The summary object contains the most critical fields in order to reduce response size when retrieving a user&rsquo;s systems. You can customize this behavior using the <code class="prettyprint">filter</code> query parameter.</p>

<aside class="notice">The above response my vary depending on who administers Agave for your organization. To customize this tutorial for your specific account, login.</aside>

<h3 id="filtering-results">Filtering results</h3>

<blockquote>
<p>List all systems (up to the page limit)</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://public.tenants.agaveapi.co/systems/v2/?type<span class="o">=</span>storage
</code></pre>
<pre class="highlight plaintext"><code>systems-list -v -S
</code></pre>

<blockquote>
<p>Only execution systems</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://public.tenants.agaveapi.co/systems/v2/?type<span class="o">=</span>execution
</code></pre>
<pre class="highlight plaintext"><code>systems-list -v -E
</code></pre>

<blockquote>
<p>Only public systems</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://public.tenants.agaveapi.co/systems/v2/?publicOnly<span class="o">=</span><span class="nb">true</span>
</code></pre>
<pre class="highlight plaintext"><code>systems-list -v -P
</code></pre>

<blockquote>
<p>Only private systems</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://public.tenants.agaveapi.co/systems/v2/?privateOnly<span class="o">=</span><span class="nb">true</span>
</code></pre>
<pre class="highlight plaintext"><code>systems-list -v -Q
</code></pre>

<blockquote>
<p>Only return default systems</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://public.tenants.agaveapi.co/systems/v2/?default<span class="o">=</span><span class="nb">true</span>
</code></pre>
<pre class="highlight plaintext"><code>systems-list -v -D
</code></pre>

<p>You can further filter the results by type, scope, and default status. See the search section for further filtering options.</p>

<h3 id="system-details">System details</h3>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://public.tenants.agaveapi.co/systems/v2/data.agaveapi.co
</code></pre>
<pre class="highlight plaintext"><code>systems-list -v data.agaveapi.co
</code></pre>

<blockquote>
<p>The response will be something like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"site"</span><span class="p">:</span><span class="w"> </span><span class="s2">"agaveapi.co"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data.agaveapi.co"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"revision"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
  </span><span class="nt">"default"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"lastModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-30T21:43:11.000-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cloud storage system for the Agave Public tenant"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Agave Cloud Storage"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dooley"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"roles"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/data.agaveapi.co/roles"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/data.agaveapi.co/credentials"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/data.agaveapi.co"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/data/?q=%7B%22associationIds%22%3A%224602981590618992154-242ac116-0001-006%22%7D"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"globalDefault"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"available"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4602981590618992154-242ac116-0001-006"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"public"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STORAGE"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"storage"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"mirror"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w">
    </span><span class="nt">"homeDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/home"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SFTP"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"corral.tacc.utexas.edu"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"publicAppsDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/apps"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"proxy"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rootDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/gpfs/corral3/repl/projects/agave/root"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"auth"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SSHKEYS"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>To query for detailed information about a specific system, add the system id to the url and make another GET request.</p>

<p>This time, the response will be a JSON object with a full system description. The following is the description of a storage system. In the next section we talk more about storage systems and how to register one of your own.</p>

              <h3 id="storage-systems">Storage systems</h3>

<p>A storage systems can be thought of as an individual data repository that you want to access through Agave. The following JSON object shows how a basic storage systems is described.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
   </span><span class="nt">"id"</span><span class="p">:</span><span class="s2">"sftp.storage.example.com"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"Example SFTP Storage System"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"STORAGE"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"My example storage system using SFTP to store data for testing"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"storage"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"host"</span><span class="p">:</span><span class="s2">"storage.example.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"port"</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span><span class="w">
      </span><span class="nt">"protocol"</span><span class="p">:</span><span class="s2">"SFTP"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"rootDir"</span><span class="p">:</span><span class="s2">"/"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"homeDir"</span><span class="p">:</span><span class="s2">"/home/systest"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"auth"</span><span class="p">:{</span><span class="w">
         </span><span class="nt">"username"</span><span class="p">:</span><span class="s2">"systest"</span><span class="p">,</span><span class="w">
         </span><span class="nt">"password"</span><span class="p">:</span><span class="s2">"changeit"</span><span class="p">,</span><span class="w">
         </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"PASSWORD"</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The first four attribute are common to both storage and execution systems. The <code class="prettyprint">storage</code> attribute describes the connectivity and authentication information needed to connect to the remote system. Here we describe a SFTP server accessible on <code class="prettyprint">port</code> 22 at <code class="prettyprint">host</code> storage.example.com. We specify that we want the <code class="prettyprint">rootDir</code>, or virtual system root exposed through Agave, to be the system&rsquo;s physical root directory, and we want the authenticated user&rsquo;s home directory to be the <code class="prettyprint">homeDir</code>, or virtual home directory and base of all relative paths given to Agave. Finally, we tell Agave to use password based authentication and provided the necessary credentials.</p>

<aside class="notice">This example is given as a simple illustration of how to describe a systems for use by Agave. In most situations you should **NOT** provide your username and password. In fact, if you are using a compute or storage systems from your university or government-funded labs it is, at best, against the user agreement and, at worst, illegal to give your password to a third party service such as Agave. In these situations, use one of the many other authentication options such as SSH keys, X509 authentication, or a 3rd party authentication service like the MyProxy Gateway.</aside>

<p>The full list of storage system attributes is described in the following table.</p>

<table>
    <thead>
        <tr>
            <th>Attribute</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>available</td>
            <td>boolean</td>
            <td>Whether the system is currently available for use in the API. Unavailable systems will not be visible to anyone but the owner. This differs from the <code>status</code> attribute in that a system may be UP, but not available for use in Agave. Defaults to true</td>
        </tr>
        <tr>
            <td>description</td>
            <td>string</td>
            <td>Verbose description of this system.</td>
        </tr>
        <tr>
            <td>id</td>
            <td>string </td>
            <td><b>Required:</b> A unique identifier you assign to the system. A system id must be globally unique across a tenant and cannot be reused once deleted. </td>
        </tr>
        <tr>
            <td>name</td>
            <td>string</td>
            <td><b>Required:</b> Common display name for this system.</td>
        </tr>
        <tr>
            <td>site</td>
            <td>string</td>
            <td>The site associated with this system. Primarily for logical grouping.</td>
        </tr>
        <tr>
            <td>status</td>
            <td>UP, DOWN, MAINTENANCE, UNKNOWN</td>
            <td>The functional status of the system. Systems must be in UP status to be used.</td>
        </tr>
        <tr>
            <td>storage</td>
            <td>JSON Object</td>
            <td><b>Required:</b> Storage configuration describing the storage config defining how to connect to this system for data staging.</td>
        </tr>
        <tr>
            <td>type</td>
            <td>STORAGE, EXECUTION</td>
            <td><b>Required:</b> Must be STORAGE.</td>
        </tr>
    </tbody>
</table>

<h3 id="supported-data-and-authentication-protocols">Supported data and authentication protocols</h3>

<p>The example above described a system accessible by SFTP. Agave supports many different data and authentication protocols for interacting with your data. Sample configurations for many protocol combinations are given below.</p>

<p><select id="storage-config-selector" name="storage-config-selector" onChange="$('.storage-config').addClass('hidden'); $('#' + $(this).val()).removeClass('hidden');">
    <option value="sftp-password">SFTP</option>
    <option value="sftp-sshkeys">SFTP w/ SSH Keys</option>
    <option value="sftp-tunnel">SFTP w/ tunnel</option>
    <option value="irods">IRODSv3</option>
    <option value="irods-pam">IRODSv3 w/ PAM</option>
    <option value="irods-myproxy">IRODSv3 w/ MyProxy</option>
    <option value="irods4">IRODSv4</option>
    <option value="gridftp">GridFTP</option>
    <option value="gridftp-myproxy">GridFTP w/ MyProxy</option>
    <option value="gridftp-mpg">GridFTP w/ MyProxy Gateway</option>
    <option value="s3">Amazon S3</option>
    <option value="local">Local</option>
</select></p>

<blockquote>
<p>Sample storage system definition with each supported data protocol and authentication configuration.</p>
</blockquote>

<pre id="sftp-password" class="json storage-config">
<code>{
   "id":"sftp.storage.example.com",
   "name":"Example SFTP Storage System",
   "status":"UP",
   "type":"STORAGE",
   "description":"My example storage system using SFTP to store data for testing",
   "site":"example.com",
   "storage":{
      "host":"storage.example.com",
      "port":22,
      "protocol":"SFTP",
      "rootDir":"/",
      "homeDir":"/home/systest",
      "auth":{
         "username":"systest",
         "password":"changeit",
         "type":"PASSWORD"
      }
   }
}</code>
</pre>

<pre id="sftp-sshkeys" class="json storage-config hidden">
<code>{
   "id":"sftp.storage.example.com",
   "name":"Example SFTP Storage Host",
   "status":"UP",
   "type":"STORAGE",
   "description":"My example storage system using SFTP to store data for testing",
   "site":"example.com",
   "storage":{
      "host":"texas.rangers.mlb.com",
      "port":22,
      "protocol":"SFTP",
      "rootDir":"/",
      "homeDir":"/home/nryan",
      "auth":{
         "username":"nryan",
         "publicKey": "ssh-rsa AAAAB3NzaC1yc2EBBAADAQABMQPRgQChJ6bzejqSuJdTi+VwMif8qotuSSlYwrVt0EWVduKZHpzOnS1zlknAyYXmQQFcaJ+vNAQayVMTqv+A+1lzxppTdgZ0Dn42EOYWRa6B/IEMPzDuKb7F0qNFiH9m+OZJDYdIWS1rlN1oK32jHUi0xV8kM3KOLf2TIjDBUyZRpMGyQ== Generated by Nova",
         "privateKey": "-----BEGIN RSA PRIVATE KEY-----nMIVCXAIBAAKBgQRhJ6bzejqSuJdTi+VwMif8qoyuSSlYwrVt0EWVduKZHpzOnSManlknAyYXmQQFcaJ+vNAQayVqTqv+A+1lzxppTdgZ0Dn42EOYWRa6B/IEMPzDuKb7Fn0uNFiH9x+OZJDYdIWS1rN1oK4DjHUi0xV8kMN3OPSIU23asx1UyZRpMGyQIDAQABnAoGATrW4NAkJ3Kltt6+HQ1Ir95sxFNrE6AZJaLYllke3iwPJpCX1dDdpDcXa8AGbVnjFXJUGA+dPrJqbyGCHA7E3H342837k/twSRGkcCNpRx/MMdWnw3asea/K5L4XVeunXAn79vo/e28D4Uue62dSwIvDJKIFWMSAgUoD53ImushqlLUCQQDPkObaowzkboLCnv3Nyj16KFZ5Lp7r5q5MYfRxO7t53Z7AWoflr++KrAT3UbSKtqmC68CqbPzxSd6qHnbnkWaD0HAkEAxsJZh7xorwAtdYznMFOsO0w5HDHOB7MuAnjwUvYZVaM0wA7HkE4rnH5SFAwEMlwx82OJxv83CnkRdlXOexn95rwJBALd8cnboGCd/AZzCvX2R+5K5lZtvnhLvczkWho3qrcoG/aUw4l1K78h4VFOFKMJOwv53BXQisF9kW6+qY3/XM49UCQHqDn4AYQOALvPBZCdVtPqFGg6W8csCAE7a5ud8zbj8A+6swcEB0+YcyEkvzID8en1ekmno/ET1wwRnhH6g/tdJlcCQM55QS4Z7rR4psgFDkFvA+wmxlqTGsXJD32sw15g4A0bmzSXnbfFg8TBAjGTDW7l0P8prFrtQ8Wml14390b29l1ptAyE=n-----END RSA PRIVATE KEY-----",
         "type": "SSHKEYS"
      }
   }
}
</code></pre>

<pre id="sftp-tunnel" class="json storage-config hidden">
<code>{
   "id":"sftp.storage.example.com",
   "name":"Example SFTP Tunnel Storage Host",
   "status":"UP",
   "type":"STORAGE",
   "description":"My example storage system using SFTP via an ssh tunnel to store data for testing",
   "site":"example.com",
   "storage":{
      "host":"storage.example.com",
      "port":22,
      "protocol":"SFTP",
      "rootDir":"/",
      "homeDir":"/home/nryan",
      "auth":{
         "username":"systest",
         "password":"changeit",
         "type":"PASSWORD"
      },
      "proxy":{
         "name":"My gateway proxy server",
         "host":"proxy.example.com",
         "port":22
      }
   }
}
</code></pre>

<pre id="irods" class="json storage-config hidden">
<code>{
   "id":"irods.storage.example.com",
   "name":"Example IRODS Storage Host",
   "status":"UP",
   "type":"STORAGE",
   "description":"My example storage system using IRODS to store data for testing",
   "site":"example.com",
   "storage":{
      "host":"storage.example.com",
      "port":1247,
      "protocol":"IRODS",
      "homeDir":"/systest",
      "rootDir":"/demoZone/home",
      "auth":{
         "username":"systest",
         "password":"changeit",
         "type":"PASSWORD"
      },
      "resource":"demoResc",
      "zone":"demoZone"
   }
}
</code></pre>

<pre id="irods-pam" class="json storage-config hidden">
<code>{
   "id":"irods.storage.example.com",
   "name":"Example IRODS Storage Host",
   "status":"UP",
   "type":"STORAGE",
   "description":"My example storage system using IRODS with PAM authentication to store data for testing",
   "site":"example.com",
   "storage":{
      "host":"storage.example.com",
      "port":1247,
      "protocol":"IRODS",
      "homeDir":"/systest",
      "rootDir":"/demoZone/home",
      "auth":{
         "username":"systest",
         "password":"changeit",
         "type":"PAM"
      },
      "resource":"demoResc",
      "zone":"demoZone"
   }
}
</code></pre>

<pre id="irods-myproxy" class="json storage-config hidden">
<code>{
   "id":"irods.storage.example.com",
   "name":"Example IRODS Storage Host",
   "status":"UP",
   "type":"STORAGE",
   "description":"My example storage system using IRODS to store data for testing",
   "site":"example.com",
   "storage":{
      "host":"storage.example.com",
      "port":1247,
      "protocol":"IRODS",
      "homeDir":"/systest",
      "rootDir":"/demoZone/home",
      "auth":{
         "username":"systest",
         "password":"changeit",
         "type":"X509",
         "server":{
            "name":"IRODS MyProxy Server",
            "endpoint":"myproxy.example.com",
            "port":7512,
            "protocol":"MYPROXY"
         }
      },
      "resource":"demoResc",
      "zone":"demoZone"
   }
}
</code></pre>

<pre id="irods4" class="json storage-config hidden">
<code>{
   "id":"irods.storage.example.com",
   "name":"Example IRODS Storage Host",
   "status":"UP",
   "type":"STORAGE",
   "description":"My example storage system using IRODS to store data for testing",
   "site":"example.com",
   "storage":{
      "host":"storage.example.com",
      "port":1247,
      "protocol":"IRODS4",
      "homeDir":"/systest",
      "rootDir":"/demoZone/home",
      "auth":{
         "username":"systest",
         "password":"changeit",
         "type":"PASSWORD"
      },
      "resource":"demoResc",
      "zone":"demoZone"
   }
}
</code></pre>

<pre id="gridftp" class="json storage-config hidden">
<code>{
  "id": "demo.storage.example.com",
  "name": "Demo GRIDFTP demo vm",
  "status": "UP",
  "type": "STORAGE",
  "description": "My example storage system using GridFTP to store data for testing",
  "site": "example.com",
  "storage": {
    "host": "gridftp.example.com",
    "port": 2811,
    "protocol": "GRIDFTP",
    "rootDir": "/",
    "homeDir": "/home/systest",
    "auth": {
      "credential": "-----BEGIN CERTIFICATE-----nMIIDqjCCApKgAwIBAgIDJSFGMA0GCSqGSIb3DQEBBQUAMHsxCzAJBgNVBAYTAlVTnMTgwNgYDVQQKEy9OYXRpb25hbCBDZW50ZXIgZm9yIFN1cGVyY29tcHV0aW5nIEFwncGxpY2F0aW9uczEgMB4GA1UECxMXQ2VydGlmaWNhdGUgQXV0aG9yaXRpZXMxEDAOnBgNVBAMTB015UHJveHkwHhcNMTMxMDE0MDcyMjE4WhcNMTMxMDE0MTkyNzE4WjBnnMQswCQYDVQQGEwJVUzE4MDYGA1UEChMvTmF0aW9uYWwgQ2VudGVyIGZvciBTdXBlncmNvbXB1dGluZyBBcHBsaWNhdGlvbnMxHjAcBgNVBAMTFWlwbGFudCBDb21tdW5pndHkgVXNlcjCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAwfHbmtmJ1OUVwgDdn5oA8EsqihwRAi2xhZJYG/FFmOs38+0y7wTfORhVX/79XQMD3NqRJN8xhHQpmuoRynH9l9sbA9gbKaQsrpIYyExygrJ+qaZY0PccD+VAyPDjdLD86316AzWltEdV2E9b+OnCVioz62esJWSqOho8wya4Vo5svUCAwEAAaOBzjCByzAOBgNVHQ8BAf8EBAMCBLAwnHQYDVR0OBBYEFIJXT/jYmxaRywDbZudb1EXbxla5MB8GA1UdIwQYMBaAFNf8pQJ2nOvYT+iuh4OZQNccjx3tRMAwGA1UdEwEB/wQCMAAwNAYDVR0gBC0wKzAMBgorBgEEnAaQ+ZAIFMAwGCiqGSIb3TAUCAgMwDQYLKoZIhvdMBQIDAgEwNQYDVR0fBC4wLDAqnoCigJoYkaHR0cDovL2NhLm5jc2EudWl1Yy5lZHUvZjJlODlmZTMuY3JsMA0GCSqGnSIb3DQEBBQUAA4IBAQBDyW3FJ0xEIXEqk2NtiMqOM99MgufDPL0bxrR8CvPY5GRNn58EXU8RnSSJIuxL95PKclRPPOhGdB48eeF2H1MusOEUEEnHwzrZ1OUFUEpwKuqG6n0h411l3niRRx9wdJL4YITzAWZwpadzwj3d8aO9O/ttVJjGRc8A93I/d3fFAvHyvKnmlEaDrQZNBp1EtClW8xuxsfeUmyXkFlkRiKwqjkJGB8xBuzr8DfLomWq/mXaOkHznCo9nQxAs3gntszLOh+8U9aMxaeCsychRWxG3Y6Z33hrE0yz4AaVonVXu3Z7M+EN+nKbSVRblAzeKfQYYDOgsoFrugYbR9klv1so3Dt+n6n-----END CERTIFICATE-----n-----BEGIN RSA PRIVATE KEY-----nMIICWwIBAAKBgQDB8dua2YnU5RXCAN3mgDwSyqKHBECLbGFklgb8UWY6zfz7TLvBnN85GFVf/v1dAwPc2pEk3zGEdCma6hHIf2X2xsD2BsppCyukhjITHKCsn6ppljQ9xnwP5UDI8ON0sPzrfXoDNaW0R1XYT1v44JWKjPrZ6wlZKo6GjzDJrhWjmy9QIDAQABnAoGAcjrJZYMLM2FaV1G7YK/Wshq3b16JxZSoKF5U7vfihnAcuMaRL1R3IcAgfHlunIq2E7aIFnd+6sygVKXYo4alv5denekiucvKAyXK9F/VTTtLtajUnrvekLvSycKiEnbN9IgQ0ABCnlWyjgQMf64UUYBQtvU+lbRCs4jbuHxuyn5WECQQD8fJhlBHgA49hjnZBKnU9Xb+LEKhWDCEyIiOMMGY+2XhrGVvGF5KqJVusZEv8lbXNjzgSQFgLohEXVzn9v8tDFMzAkEAxKS5qCYHsTfgPlw3l1DLJRmG3SXrpevXSccBGpXQiUne9gfc9mlgnVTr5QQCXvvI673Y2LnNcnd94KEgvSrzhNwJACeS38/1g1mgXKo3ZTUUztBLinQ7sn463sQHsI6U8xGCbm/n8LMrxA8CsJadg6A6J3vdLpnm2U3YbZm1mqVhGNkQJAdsxxnoUVAdm8kWWhK6W6VG9e9I1OqdrXxfY/tecsyjg6D1a1Qb8mfuj4DoaKjCme69To8nZ3moZXRBWkypzYQopwJAB/zr1UpFz6vY4sIm3Gw3ll/ruNGCr2dzjTyLSGglCOf0nUljJ1FGLyW647JzGPMLcfdb0iEexzCEii9YUFUN1Ow==n-----END RSA PRIVATE KEY-----",
      "type": "X509"
    }
  }
}
</code></pre>

<pre id="gridftp-myproxy" class="json storage-config hidden">
<code>{
  "id": "demo.storage.example.com",
  "name": "Demo GRIDFTP + MyProxy Storage System",
  "status": "UP",
  "type": "STORAGE",
  "description": "My example storage system using GridFTP with MyProxy to store data for testing",
  "site": "example.com",
  "storage": {
    "host": "gridftp.example.com",
    "port": 2811,
    "protocol": "GRIDFTP",
    "rootDir": "/",
    "homeDir": "/home/systest",
    "auth": {
      "username": "systest",
      "password": "changeit",
      "type": "X509",
      "server": {
        "name": "XSEDE MyProxy Server",
        "endpoint": "myproxy.example.com",
        "port": 7512,
        "protocol": "MYPROXY"
      }
    }
  }
}
</code></pre>

<pre id="gridftp-mpg" class="json storage-config hidden">
<code>{
  "id": "demo.storage.example.com",
  "name": "Demo GRIDFTP + MyProxy Storage System",
  "status": "UP",
  "type": "STORAGE",
  "description": "My example storage system using GridFTP with MyProxy to store data for testing",
  "site": "example.com",
  "storage": {
    "host": "gridftp.example.com",
    "port": 2811,
    "protocol": "GRIDFTP",
    "rootDir": "/",
    "homeDir": "/home/systest",
    "auth": {
      "type": "X509",
      "server": {
        "name": "My Trusted MPG Server",
        "endpoint": "https://api.example.com/myproxy/v2/",
        "port": 443,
        "protocol": "MPG"
      }
    }
  }
}
</code></pre>

<pre id="s3" class="json storage-config hidden">
<code>{
   "id":"demo.storage.example.com",
   "name":"Example Amazon S3 Storage System",
   "status":"UP",
   "type":"STORAGE",
   "description":"My example storage system using Amazon S3 to store data for testing",
   "site":"aws.amazon.com",
   "storage":{
      "host": "s3-website-us-east-1.amazonaws.com",
      "port": 443,
      "protocol": "S3",
      "homeDir": "/",
      "rootDir": "/",
      "container": "mybucket",
      "auth": {
          "publicKey": "AKCA...1RCF",
          "privateKey": "8xj3...g/4+",
          "type": "APIKEYS"
      }
   }
}
</code></pre>

<pre id="local" class="json storage-config hidden">
<code>{
   "id":"local.storage.example.com",
   "name":"Example LOCAL Storage Host",
   "status":"UP",
   "type":"STORAGE",
   "description":"My example storage system using the local file system to store data for testing",
   "site":"example.com",
   "storage":{
      "host":"localhost",
      "protocol":"LOCAL",
      "rootDir":"/",
      "homeDir":"/home/systest"
   }
}
</code></pre>

<p>In each of the examples above, the <code class="prettyprint">storage</code> objects were slightly different, each unique to the protocol used. Descriptions of every attribute in the <code class="prettyprint">storage</code>> object and its children are given in the following tables.</p>

<p><code class="prettyprint">storage</code> attributes give basic connectivity information describing things like how to connect to the system and on what port.</p>

<table>
    <thead>
        <tr>
            <th>Attribute</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>auth</td>
            <td>JSON object</td>
            <td><b>Required:</b> A JSON object describing the default authentication credential for this system.</td>
        </tr>
        <tr>
            <td>container</td>
            <td>string</td>
            <td>The container to use when interacting with an object store. Specifying a container provides isolation when exposing your cloud storage accounts so users do not have access to your entire storage account. This should be used in combination with delegated cloud credentials such as an AWS IAM user credential.</td>
        </tr>
        <tr>
            <td>homeDir</td>
            <td>string</td>
            <td>The path on the remote system, relative to <code>rootDir</code> to use as the virtual home directory for all API requests. This will be the base of any requested paths that do not being with a &rsquo;/&rsquo;. Defaults to &rsquo;/&rsquo;, thus being equivalent to <code>rootDir</code>.</td>
        </tr>
        <tr>
            <td>host</td>
            <td>string</td>
            <td><b>Required:</b> The hostname or ip address of the storage server</td>
        </tr>
        <tr>
            <td>port</td>
            <td>int</td>
            <td><b>Required:</b> The port number of the storage server.</td>
        </tr>
        <tr>
            <td>mirror</td>
            <td>boolean</td>
            <td>Whether the permissions set on the server should be pushed to the storage system itself. Currently, this only applies to IRODS systems.</td>
        </tr>
        <tr>
            <td>protocol</td>
            <td>FTP, GRIDFTP, IRODS, IRODS4, LOCAL, S3, SFTP</td>
            <td><b>Required:</b> The protocol used to authenticate to the storage server.</td>
        </tr>
        <tr>
            <td>publicAppsDir</td>
            <td>string</td>
            <td>The path on the remote system where apps will be stored if this system is used as the default public storage system.</td>
        </tr>
        <tr>
            <td>proxy</td>
            <td>JSON Object</td>
            <td>The proxy server through with Agave will tunnel when submitting jobs. Currently proxy servers will use the same authentication mechanism as the target server.</td>
        </tr>
        <tr>
            <td>resource</td>
            <td>string</td>
            <td>The name of the default resource to use when defining an IRODS system.</td>
        </tr>
        <tr>
            <td>rootDir</td>
            <td>string</td>
            <td>The path on the remote system to use as the virtual root directory for all API requests. Defaults to &rsquo;/&rsquo;.</td>
        </tr>
        <tr>
            <td>zone</td>
            <td>string</td>
            <td>The name of the default zone to use when defining an IRODS system.</td>
        </tr>
    </tbody>
</table>

<p><p><code class="prettyprint">storage.auth</code> attributes give authentication information describing how to authenticate to the system specified in the <code class="prettyprint">storage</code> config above.</p>

<table>
    <thead>
        <tr>
            <th>Attribute</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>credential</td>
            <td>string</td>
            <td>The credential used to authenticate to the remote system. Depending on the authentication protocol of the remote system, this could be an OAuth Token, X.509 certificate.</td>
        </tr>
        <tr>
            <td>internalUsername</td>
            <td>string</td>
            <td>The username of the internal user associated with this credential.</td>
        </tr>
        <tr>
            <td>password</td>
            <td>string</td>
            <td>The password on the remote system used to authenticate.</td>
        </tr>
        <tr>
            <td>privateKey</td>
            <td>string</td>
            <td>The private ssh key used to authenticate to the remote system.</td>
        </tr>
        <tr>
            <td>publicKey</td>
            <td>string</td>
            <td>The public ssh key used to authenticate to the remote system.</td>
        </tr>
        <tr>
            <td>server</td>
            <td>JSON object</td>
            <td>A JSON object describing the authentication server from which a valid credential may be obtained. Currently only  auth type X509 supports this attribute.</td>
        </tr>
        <tr>
            <td>type</td>
            <td>APIKEYS, LOCAL, PAM, PASSWORD, SSHKEYS, or X509</td>
            <td><b>Required:</b> The path on the remote system where apps will be stored if this system is used as the default public storage system.</td>
        </tr>
        <tr>
            <td>username</td>
            <td>string</td>
            <td>The remote username used to authenticate.</td>
        </tr>
    </tbody>
</table>

<p><p><code class="prettyprint">storage.auth.server</code> attributes give information about how to obtain a credential that can be used in the authentication process. Currently only systems using the X509 authentication can leverage this feature to communicate with <a href="http://grid.ncsa.illinois.edu/myproxy/" title="MyProxy Server" target="_blank">MyProxy</a> and <a href="https://bitbucket.org/taccaci/myproxy-gateway" title="MyProxy Gateway" target="_blank">MyProxy Gateway</a> servers.</p>

<table>
    <thead>
        <tr>
            <th>Attribute</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>name</td>
            <td>string</td>
            <td>A descriptive name given to the credential server</td>
        </tr>
        <tr>
            <td>endpoint</td>
            <td>string</td>
            <td><b>Required:</b> The endpoint of the authentication server.</td>
        </tr>
        <tr>
            <td>port</td>
            <td>integer</td>
            <td><b>Required:</b> The port on which to connect to the server.</td>
        </tr>
        <tr>
            <td>protocol</td>
            <td>MPG, MYPROXY</td>
            <td><b>Required:</b> The protocol with which to obtain an authentication credential.</td>
        </tr>
    </tbody>
</table>

<p><p><code class="prettyprint">system.proxy</code> configuration attributes give information about how to connect to a remote system through a proxy server. This often happens when the target system is behind a firewall or resides on a NAT. Currently proxy servers can only reuse the authentication configuration provided by the target system.</p>

<table>
    <thead>
        <tr>
            <th>Attribute</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>name</td>
            <td>string</td>
            <td><b>Required:</b> A descriptive name given to the proxy server.</td>
        </tr>
        <tr>
            <td>host</td>
            <td>string</td>
            <td><b>Required:</b> The hostname of the proxy server.</td>
        </tr>
        <tr>
            <td>port</td>
            <td>integer</td>
            <td><b>Required:</b> The port on which to connect to the proxy server. If null, the port in the parent storage config is used.</td>
        </tr>
    </tbody>
</table>

<aside class="notice">If you have not yet set up a system of your own, now is a good time to grab a sandbox system to use while you follow along with the rest of this tutorial.</aside>

<h4 id="creating-a-new-storage-system">Creating a new storage system</h4>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -F <span class="s2">"fileToUpload=@sftp-password.json"</span> https://public.tenants.agaveapi.co/systems/v2
</code></pre>
<pre class="highlight plaintext"><code>systems-addupdate -v -F sftp-password.json
</code></pre>

<blockquote>
<p>The response from the service will be similar to the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"site"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sftp.storage.example.com"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"revision"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nt">"default"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"lastModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-06T17:46:42.621-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My example storage system using SFTP to store data for testing"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example SFTP Storage System"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"globalDefault"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"available"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4036169328045649434-242ac117-0001-006"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"public"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STORAGE"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"storage"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"mirror"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w">
    </span><span class="nt">"homeDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/home/systest"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SFTP"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storage.example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"publicAppsDir"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"proxy"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rootDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"auth"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASSWORD"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"roles"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/sftp.storage.example.com/roles"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/sftp.storage.example.com/credentials"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/sftp.storage.example.com"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/data/?q=%7B%22associationIds%22%3A%224036169328045649434-242ac117-0001-006%22%7D"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Congratulations, you just added your first system. This storage system can now be used by the <a title="File Management" href="#files">Files service</a> to manage data, the Transfer service as a source or destination of data movement, the Apps service as a application repository, and the <a title="Job Submission" href="http://agaveapi.co/documentation/tutorials/job-managment/">Jobs Service</a> as both a staging and archiving destination.</p>

<p>Notice that the JSON returned from the Systems service is different than what was submitted. Several fields have been added, and several other have been removed. On line 3, the UUID of the system has been added. This is the same UUID that is used in notifications and metadata references. On line 5, the <code class="prettyprint">status</code> value was added in and assigned a default value since we did not specify it. Ditto for the <code class="prettyprint">site</code> attribute on line 8.</p>

<p>Three new fields were added on lines 9-11. <code class="prettyprint">revision</code> is the number of times this system has been updated. This being our first time registering the system, it is set to <em>1</em>. <code class="prettyprint">public</code> tells whether this system is published as a shared resource for all users. We will cover this more in the section on System scope. <code class="prettyprint">lastModified</code> is a timestamp of the last time the system was updated.</p>

<p>In the <code class="prettyprint">storage</code> object, the <code class="prettyprint">publicAppsDir</code> and <code class="prettyprint">mirror</code> fields were both added and set to their default values. In this example we are not using a <code class="prettyprint">proxy</code> server, so it was defaulted to <em>null</em>. Last, and most important, all authentication information has been omitted from the response object. Regardless of the authentication type, no user credential information will ever be returned once they are stored.</p>

              <h3 id="execution-systems">Execution Systems</h3>

<p>In contrast to storage systems, execution systems specify compute resources where application binaries can be run. In addition to the <code class="prettyprint">storage</code> attribute found in storage systems, execution systems also have a <code class="prettyprint">login</code> attribute describing how to connect to the remote system to submit jobs as well as several other attributes that allow Agave to determine how to stage data and run software on the system. The full list of execution system attributes is given in the following tables.</p>

<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>available</td>
            <td>boolean</td>
            <td>Whether the system is currently available for use in the API. Unavailable systems will not be visible to anyone but the owner. This differs from the <code>status</code> attribute in that a system may be UP, but not available for use in Agave. Defaults to true</td>
        </tr>
        <tr>
            <td>description</td>
            <td>string</td>
            <td>Verbose description of this system.</td>
        </tr>
        <tr>
            <td>environment</td>
            <td>String</td>
            <td>List of key-value pairs that will be added to the environment prior to execution of any command.</td>
        </tr>
        <tr>
            <td>executionType</td>
            <td>HPC, Condor, CLI</td>
            <td><b>Required:</b> Specifies how jobs should go into the system. HPC and Condor will leverage a batch scheduler. CLI will fork processes. </td>
        </tr>
        <tr>
            <td>id</td>
            <td>string</td>
            <td><b>Required:</b> A unique identifier you assign to the system. A system id must be globally unique across a tenant and cannot be reused once deleted. </td>
        </tr>
        <tr>
            <td>maxSystemJobs</td>
            <td>integer</td>
            <td>Maximum number of jobs that can be queued or running on a system across all queues at a given time. Defaults to unlimited.</td>
        </tr>
        <tr>
            <td>maxSystemJobsPerUser</td>
            <td>integer</td>
            <td>Maximum number of jobs that can be queued or running on a system for an individual user across all queues at a given time. Defaults to unlimited.</td>
        </tr>
        <tr>
            <td>name</td>
            <td>string</td>
            <td><b>Required:</b> Common display name for this system.</td>
        </tr>
        <tr>
            <td>queues</td>
            <td>JSON Array</td>
            <td>An array of batch queue definitions providing descriptive and quota information about the queues you want to expose on your system. If not specified, no other system queues will be available to jobs submitted using this system.</td>
        </tr>
        <tr>
            <td>scheduler</td>
            <td>LSF, LOADLEVELER, PBS, SGE, CONDOR, FORK, COBALT, TORQUE, MOAB, SLURM, UNKNOWN</td>
            <td><b>Required:</b> The type of batch scheduler available on the system. This only applies to systems with executionType HPC and CONDOR.</td>
        </tr>
        <tr>
            <td>scratchDir</td>
            <td>string</td>
            <td>Path to use for a job scratch directory. This value is the first choice for creating a job&rsquo;s working directory at runtime. The path will be resolved relative to the <code>rootDir</code> value in the storage config if it begins with a &ldquo;/&rdquo;, and relative to the system <code>homeDir</code> otherwise.</td>
        </tr>
        <tr>
            <td>site</td>
            <td>string</td>
            <td>The site associated with this system. Primarily for logical grouping.</td>
        </tr>
        <tr>
            <td>startupScript</td>
            <td>String</td>
            <td>Path to a script that will be run prior to execution of any command on this system. The path will be resolved relative to the <code>rootDir</code> value in the storage config if it begins with a &ldquo;/&rdquo;, and relative to the system <code>homeDir</code> otherwise. Any environment variables defined in the system description will be set before this script is called. If this script fails, the job will fail. </td>
        </tr>
        <tr>
            <td>status</td>
            <td>UP, DOWN, MAINTENANCE, UNKNOWN</td>
            <td>The functional status of the system. Systems must be in UP status to be used.</td>
        </tr>
        <tr>
            <td>storage</td>
            <td>JSON Object</td>
            <td><b>Required:</b> Storage configuration describing the storage config defining how to connect to this system for data staging.</td>
        </tr>
        <tr>
            <td>type</td>
            <td>STORAGE, EXECUTION</td>
            <td><b>Required:</b> Must be EXECUTION.</td>
        </tr>
        <tr>
            <td>workDir</td>
            <td>string</td>
            <td>Path to use for a job working directory. This value will be used if no <code>scratchDir</code> is given. The path will be resolved relative to the <code>rootDir</code> value in the storage config if it begins with a &ldquo;/&rdquo;, and relative to the system <code>homeDir</code> otherwise.</td>
        </tr>
    </tbody>
</table>

<h4 id="schedulers-and-system-execution-types">Schedulers and system execution types</h4>

<p>Agave supports job execution both interactively and through <a href="http://en.wikipedia.org/wiki/Job_scheduler" title="Job Scheduler" target="_blank">batch queueing systems</a> (aka schedulers). We cover the mechanics of job submission in the Job Management tutorial. Here we just point out that regardless of how your job is actually run on the underlying system, the process of submitting, monitoring, sharing, and otherwise interacting with your job through Agave is identical. Describing the scheduler and execution types for your system is really just a matter of picking the most efficient and/or available mechanism for running jobs on your system.</p>

<p>As you saw in the table above, <code class="prettyprint">executionType</code> refers to the classification of jobs going into the system and <code class="prettyprint">scheduler</code> refers to the type of batch scheduler used on a system. These two fields help limit the range of job submission options used on a specific system. For example, it is not uncommon for a HPC system to accept jobs from both a Condor scheduler and a batch scheduler. It is also possible, though generally discouraged, to fork jobs directly on the command line. With so many options, how would users publishing apps on such a system know what mechanism to use? Specifying the execution type and scheduler help narrow down the options to a single execution mechanism.</p>

<p>Thankfully, picking the right combination is pretty simple. The following table illustrates the available combinations.</p>

<table>
    <thead>
        <tr>
            <th><code>executionType</code></th>
            <th><code>scheduler</code></th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>HPC</td>
            <td>LSF, LOADLEVELER, PBS, SGE, COBALT, TORQUE, MOAB, SLURM</td>
            <td>Jobs will be submitted to the local scheduler using the appropriate scheduler commands. Systems with this execution type will not allow forked jobs.</td>
        </tr>
        <tr>
            <td>CONDOR</td>
            <td>CONDOR</td>
            <td>Jobs will be submitted to the condor scheduler running locally on the remote system. Agave will not do any installation for you, so the setup and administration of the Condor server is up to you.</td>
        </tr>
        <tr>
            <td>CLI</td>
            <td>FORK</td>
            <td>Jobs will be started as a forked process and monitored using the system process id.</td>
        </tr>
    </tbody>
</table>

<aside class="notice">When you are describing your system, consider the policies put in place by your system administrators. If the system you are defining has a scheduler, chances are they want you to use it.</aside>

<h4 id="defining-batch-queues-nbsp">Defining batch queues <a name="defining-batch-queues">&nbsp;</a></h4>

<p>Agave supports the notion of multiple submit queues. On HPC systems, queues should map to actual batch scheduler queues on the target server. Additionally, queues are used by Agave as a mechanism for implementing quotas on job throughput in a given queue or across an entire system. Queues are defined as a JSON array of objects assigned to the <code class="prettyprint">queues</code> attribute. The following table summarizes all supported queue parameters.</p>

<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>name</td>
            <td>string</td>
            <td>Arbitrary name for the queue. This will be used in the job submission process, so it should line up with the name of an actual queue on the execution system.</td>
        </tr>
        <tr>
            <td>maxJobs</td>
            <td>integer</td>
            <td>Maximum number of jobs that can be queued or running within this queue at a given time. Defaults to 10. -1 for no limit</td>
        </tr>
        <tr>
            <td>maxUserJobs</td>
            <td>integer</td>
            <td>Maximum number of jobs that can be queued or running by any single user within this queue at a given time. Defaults to 10. -1 for no limit</td>
        </tr>
        <tr>
            <td>maxNodes</td>
            <td>integer</td>
            <td>Maximum number of nodes that can be requested for any job in this queue. -1 for no limit</td>
        </tr>
        <tr>
            <td>maxProcessorsPerNode</td>
            <td>integer</td>
            <td>Maximum number of processors per node that can be requested for any job in this queue. -1 for no limit</td>
        </tr>
        <tr>
            <td>maxMemoryPerNode</td>
            <td>string</td>
            <td>Maximum memory per node for jobs submitted to this queue in ###.#[E|P|T|G]B format.</td>
        </tr>
        <tr>
            <td>maxRequestedTime</td>
            <td>string</td>
            <td>Maximum run time for any job in this queue given in hh:mm:ss format.</td>
        </tr>
        <tr>
            <td>customDirectives</td>
            <td>string</td>
            <td>Arbitrary text that will be appended to the end of the scheduler directives in a batch submit script. This could include a project number, system-specific directives, etc.</td>
        </tr>
        <tr>
            <td>default</td>
            <td>boolean</td>
            <td>True if this is the default queue for the system, false otherwise.</td>
        </tr>
    </tbody>
</table>

<h4 id="configuring-quotas">Configuring quotas</h4>

<p>In the batch queues table above, several attributes exist to specify limits on the number of total jobs and user jobs in a given queue. Corresponding attributes exist in the execution system to specify limits on the number of total and user jobs across an entire system. These attributes, when used appropriately, can be used to tell Agave how to enforce limits on the concurrent activity of any given user. They can also ensure that Agave will not unfairly monopolize your systems as your application usage grows.</p>

<p>If you have ever used a shared HPC system before, you should be familiar with batch queue quotas. If not, the important thing to understand is that they are a critical tool to ensure fair usage of any shared resource. As the owner/administrator for your registered system, you can use the batch queues you define to enforce whatever usage policy you deem appropriate.</p>

<p>Consider one example where you are using a VM to run image analysis routines on demand through Agave, your server will become memory bound and experience performance degradation if too many processes are running at once. To avoid this, you can set a limit using a batch queue configuration that limits the number of simultaneous tasks that can run at once on your server.</p>

<p>Another example where quotas can be helpful is to help you properly partitioning your system resources. Consider a user analyzing unstructured data. The problem is computationally and memory intensive. To preserve resources, you could create one queue with a moderate value of <code class="prettyprint">maxJobs</code> and conservative <code class="prettyprint">maxMemoryPerNode</code>, <code class="prettyprint">maxProcessorsPerNode</code>, and <code class="prettyprint">maxNodes</code> values to allow good throughput of small job. You could then create another queue with large <code class="prettyprint">maxMemoryPerNode</code>, <code class="prettyprint">maxProcessorsPerNode</code>, and <code class="prettyprint">maxNodes</code> values while only allowing a single job to run at a time. This gives you both high throughput and high capacity on a single system.</p>

<p>The following sample queue definitions illustrate some other interesting use cases.</p>

<p>
    <select id="queue-config-selector" name="queue-config-selector" onChange="$('.queue-config').addClass('hidden'); $('#' + $(this).val()).removeClass('hidden');">
        <option value="queue-short-job">Short Jobs</option>
        <option value="queue-small-queues">Restrited Usage</option>
        <option value="queue-single-node">Single Node Jobs</option>
        <option value="queue-dedicated">Dedicated Usage</option>
    </select>
</p>

<pre id="queue-short-job" class="json queue-config">
<code>{
    "name":"short_job",
    "maxJobs":100,
    "maxUserJobs":10,
    "maxNodes":32,
    "maxMemoryPerNode":"64GB",
    "maxProcessorsPerNode":12,
    "maxRequestedTime":"00:15:00",
    "customDirectives":null,
    "default":true
}
</code></pre>


<pre id="queue-small-queues" class="json queue-config hidden">
<code># Restrict the queue to having at most 10 total jobs in it at once. Jobs may run for no more than an hour.
{
    "name":"small_q",
    "maxJobs":10,
    "maxUserJobs":1,
    "maxNodes":32,
    "maxMemoryPerNode":"64GB",
    "maxProcessorsPerNode":12,
    "maxRequestedTime":"01:00:00",
    "customDirectives":null,
    "default":true
}
</code></pre>


<pre id="queue-single-node" class="json queue-config hidden">
<code># Restrict the queue to only running single node jobs.
{
    "name":"short_job",
    "maxJobs":100,
    "maxUserJobs":10,
    "maxNodes":1,
    "maxMemoryPerNode":"64GB",
    "maxProcessorsPerNode":12,
    "maxRequestedTime":"24:00:00",
    "customDirectives":null,
    "default":true
}
</code></pre>


<pre id="queue-dedicated" class="json queue-config hidden">
<code># Create two queues.
# - "big_mem" allows single node jobs with memory up to 1TB.
# - "big_compute" allows jobs with up to 256 nodes, and 16GB of memory per node.
[
  {
    "name":"big_mem",
    "maxJobs":10,
    "maxUserJobs":1,
    "maxNodes":1,
    "maxMemoryPerNode":"1TB",
    "maxProcessorsPerNode":12,
    "maxRequestedTime":"12:00:00",
    "customDirectives":null,
    "default":true
  },
  {
    "name":"big_compute",
    "maxJobs":10,
    "maxUserJobs":10,
    "maxNodes":256,
    "maxMemoryPerNode":"16GB",
    "maxProcessorsPerNode":12,
    "maxRequestedTime":"24:00:00",
    "customDirectives":null,
    "default":true
  }
]
</code></pre>

#### System login protocols

As with storage systems, Agave supports several different protocols and mechanisms for job submission. We already covered scheduler and queue support. Here we illustrate the different login configurations possible. For brevity, only the value of the `login` JSON object is shown.

<p>
    <select id="login-config-selector" name="login-config-selector" onChange="$('.login-config').addClass('hidden'); $('#' + $(this).val()).removeClass('hidden');">
        <option value="login-ssh-password">SSH</option>
        <option value="login-ssh-sshkeys">SSH w/ SSH Keys</option>
        <option value="login-ssh-tunnel">SSH w/ tunnel</option>
        <option value="login-gsissh">GSI OpenSSH</option>
        <option value="login-gsissh-myproxy">GSI OpenSSH w/ MyProxy</option>
        <option value="login-gsissh-mpg">GSI OpenSSH w/ MyProxy Gateway</option>
        <option value="login-local">Local</option>
    </select>
</p>


<pre id="login-ssh-password" class="json login-config">
<code>{
  "host": "execute.example.com",
  "port": 22,
  "protocol": "SSH",
  "auth": {
    "username": "systest",
    "password": "changeit",
    "type": "PASSWORD"
  }
}</code>
</pre>

<pre id="login-ssh-sshkeys" class="json login-config hidden">
<code>{
  "host": "execute.example.com",
  "port": 22,
  "protocol": "SSH",
  "auth": {
    "username":"nryan",
     "publicKey": "ssh-rsa AAAAB3NzaC1yc2EBBAADAQABMQPRgQChJ6bzejqSuJdTi+VwMif8qotuSSlYwrVt0EWVduKZHpzOnS1zlknAyYXmQQFcaJ+vNAQayVMTqv+A+1lzxppTdgZ0Dn42EOYWRa6B/IEMPzDuKb7F0qNFiH9m+OZJDYdIWS1rlN1oK32jHUi0xV8kM3KOLf2TIjDBUyZRpMGyQ== Generated by Nova",
     "privateKey": "-----BEGIN RSA PRIVATE KEY-----nMIVCXAIBAAKBgQRhJ6bzejqSuJdTi+VwMif8qoyuSSlYwrVt0EWVduKZHpzOnSManlknAyYXmQQFcaJ+vNAQayVqTqv+A+1lzxppTdgZ0Dn42EOYWRa6B/IEMPzDuKb7Fn0uNFiH9x+OZJDYdIWS1rN1oK4DjHUi0xV8kMN3OPSIU23asx1UyZRpMGyQIDAQABnAoGATrW4NAkJ3Kltt6+HQ1Ir95sxFNrE6AZJaLYllke3iwPJpCX1dDdpDcXa8AGbVnjFXJUGA+dPrJqbyGCHA7E3H342837k/twSRGkcCNpRx/MMdWnw3asea/K5L4XVeunXAn79vo/e28D4Uue62dSwIvDJKIFWMSAgUoD53ImushqlLUCQQDPkObaowzkboLCnv3Nyj16KFZ5Lp7r5q5MYfRxO7t53Z7AWoflr++KrAT3UbSKtqmC68CqbPzxSd6qHnbnkWaD0HAkEAxsJZh7xorwAtdYznMFOsO0w5HDHOB7MuAnjwUvYZVaM0wA7HkE4rnH5SFAwEMlwx82OJxv83CnkRdlXOexn95rwJBALd8cnboGCd/AZzCvX2R+5K5lZtvnhLvczkWho3qrcoG/aUw4l1K78h4VFOFKMJOwv53BXQisF9kW6+qY3/XM49UCQHqDn4AYQOALvPBZCdVtPqFGg6W8csCAE7a5ud8zbj8A+6swcEB0+YcyEkvzID8en1ekmno/ET1wwRnhH6g/tdJlcCQM55QS4Z7rR4psgFDkFvA+wmxlqTGsXJD32sw15g4A0bmzSXnbfFg8TBAjGTDW7l0P8prFrtQ8Wml14390b29l1ptAyE=n-----END RSA PRIVATE KEY-----",
     "type": "SSHKEYS"
  }
}</code>
</pre>

<pre id="login-ssh-tunnel" class="json login-config hidden">
<code>{
  "host":"execute.example.com",
  "port":22,
  "protocol":"SSH",
  "auth":{
    "username":"systest",
    "password":"changeit",
    "type":"PASSWORD"
  },
  "proxy":{
    "name":"My gateway proxy server",
    "host":"proxy.example.com",
    "port":"22"
  }
}</code>
</pre>

<pre id="login-local" class="json login-config hidden">
<code>{
{
  "host": "localhost",
  "protocol": "LOCAL",
  "auth": {
    "type": "LOCAL"
  }
}</code>
</pre>

<pre id="login-gsissh" class="json login-config hidden">
<code>{
   "host":"execute.example.com",
   "port":2222,
   "protocol":"GSISSH",
   "auth":{
      "credential": "-----BEGIN CERTIFICATE-----nMIIDqjCCApKgAwIBAgIDJSFGMA0GCSqGSIb3DQEBBQUAMHsxCzAJBgNVBAYTAlVTnMTgwNgYDVQQKEy9OYXRpb25hbCBDZW50ZXIgZm9yIFN1cGVyY29tcHV0aW5nIEFwncGxpY2F0aW9uczEgMB4GA1UECxMXQ2VydGlmaWNhdGUgQXV0aG9yaXRpZXMxEDAOnBgNVBAMTB015UHJveHkwHhcNMTMxMDE0MDcyMjE4WhcNMTMxMDE0MTkyNzE4WjBnnMQswCQYDVQQGEwJVUzE4MDYGA1UEChMvTmF0aW9uYWwgQ2VudGVyIGZvciBTdXBlncmNvbXB1dGluZyBBcHBsaWNhdGlvbnMxHjAcBgNVBAMTFWlwbGFudCBDb21tdW5pndHkgVXNlcjCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAwfHbmtmJ1OUVwgDdn5oA8EsqihwRAi2xhZJYG/FFmOs38+0y7wTfORhVX/79XQMD3NqRJN8xhHQpmuoRynH9l9sbA9gbKaQsrpIYyExygrJ+qaZY0PccD+VAyPDjdLD86316AzWltEdV2E9b+OnCVioz62esJWSqOho8wya4Vo5svUCAwEAAaOBzjCByzAOBgNVHQ8BAf8EBAMCBLAwnHQYDVR0OBBYEFIJXT/jYmxaRywDbZudb1EXbxla5MB8GA1UdIwQYMBaAFNf8pQJ2nOvYT+iuh4OZQNccjx3tRMAwGA1UdEwEB/wQCMAAwNAYDVR0gBC0wKzAMBgorBgEEnAaQ+ZAIFMAwGCiqGSIb3TAUCAgMwDQYLKoZIhvdMBQIDAgEwNQYDVR0fBC4wLDAqnoCigJoYkaHR0cDovL2NhLm5jc2EudWl1Yy5lZHUvZjJlODlmZTMuY3JsMA0GCSqGnSIb3DQEBBQUAA4IBAQBDyW3FJ0xEIXEqk2NtiMqOM99MgufDPL0bxrR8CvPY5GRNn58EXU8RnSSJIuxL95PKclRPPOhGdB48eeF2H1MusOEUEEnHwzrZ1OUFUEpwKuqG6n0h411l3niRRx9wdJL4YITzAWZwpadzwj3d8aO9O/ttVJjGRc8A93I/d3fFAvHyvKnmlEaDrQZNBp1EtClW8xuxsfeUmyXkFlkRiKwqjkJGB8xBuzr8DfLomWq/mXaOkHznCo9nQxAs3gntszLOh+8U9aMxaeCsychRWxG3Y6Z33hrE0yz4AaVonVXu3Z7M+EN+nKbSVRblAzeKfQYYDOgsoFrugYbR9klv1so3Dt+n6n-----END CERTIFICATE-----n-----BEGIN RSA PRIVATE KEY-----nMIICWwIBAAKBgQDB8dua2YnU5RXCAN3mgDwSyqKHBECLbGFklgb8UWY6zfz7TLvBnN85GFVf/v1dAwPc2pEk3zGEdCma6hHIf2X2xsD2BsppCyukhjITHKCsn6ppljQ9xnwP5UDI8ON0sPzrfXoDNaW0R1XYT1v44JWKjPrZ6wlZKo6GjzDJrhWjmy9QIDAQABnAoGAcjrJZYMLM2FaV1G7YK/Wshq3b16JxZSoKF5U7vfihnAcuMaRL1R3IcAgfHlunIq2E7aIFnd+6sygVKXYo4alv5denekiucvKAyXK9F/VTTtLtajUnrvekLvSycKiEnbN9IgQ0ABCnlWyjgQMf64UUYBQtvU+lbRCs4jbuHxuyn5WECQQD8fJhlBHgA49hjnZBKnU9Xb+LEKhWDCEyIiOMMGY+2XhrGVvGF5KqJVusZEv8lbXNjzgSQFgLohEXVzn9v8tDFMzAkEAxKS5qCYHsTfgPlw3l1DLJRmG3SXrpevXSccBGpXQiUne9gfc9mlgnVTr5QQCXvvI673Y2LnNcnd94KEgvSrzhNwJACeS38/1g1mgXKo3ZTUUztBLinQ7sn463sQHsI6U8xGCbm/n8LMrxA8CsJadg6A6J3vdLpnm2U3YbZm1mqVhGNkQJAdsxxnoUVAdm8kWWhK6W6VG9e9I1OqdrXxfY/tecsyjg6D1a1Qb8mfuj4DoaKjCme69To8nZ3moZXRBWkypzYQopwJAB/zr1UpFz6vY4sIm3Gw3ll/ruNGCr2dzjTyLSGglCOf0nUljJ1FGLyW647JzGPMLcfdb0iEexzCEii9YUFUN1Ow==n-----END RSA PRIVATE KEY-----",
      "type": "X509"
   }
}</code>
</pre>

<pre id="login-gsissh-myproxy" class="json login-config hidden">
<code>{
   "host":"execute.example.com",
   "port":2222,
   "protocol":"GSISSH",
   "auth":{
      "username":"systest",
      "password":"changeit",
      "credential":"",
      "type":"X509",
      "server":{
        "name":"IRODS MyProxy Server",
        "endpoint":"myproxy.example.com",
        "port":7512,
        "protocol":"MYPROXY"
      }
   }
}</code>
</pre>

<pre id="login-gsissh-mpg" class="json login-config hidden">
<code>{
   "host":"execute.example.com",
   "port":2222,
   "protocol":"GSISSH",
   "auth":{
      "username":"systest",
      "type":"X509",
      "server": {
        "name": "My Trusted MPG Server",
        "endpoint": "https://api.example.com/myproxy/v2/",
        "port": 443,
        "protocol": "MPG"
      }
   }
}</code>
</pre>

<p>The full list of login configuration options is given in the following table. We omit the <code class="prettyprint">login.auth</code> and <code class="prettyprint">login.proxy</code> attributes as they are identical to those used in the storage config.</p>

<table>
    <thead>
        <tr>
            <th>Attribute</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>auth</td>
            <td>JSON object</td>
            <td><b>Required:</b> A JSON object describing the default login authentication credential for this system.</td>
        </tr>
        <tr>
            <td>host</td>
            <td>string</td>
            <td><b>Required:</b> The hostname or ip address of the server where the job will be submitted.</td>
        </tr>
        <tr>
            <td>port</td>
            <td>int</td>
            <td>The port number of the server where the job will be submitted. Defaults to the default port of the protocol used.</td>
        </tr>
        <tr>
            <td>protocol</td>
            <td>SSH, GSISSH, LOCAL</td>
            <td><b>Required:</b> The protocol used to submit jobs for execution.</td>
        </tr>
        <tr>
            <td>proxy</td>
            <td>JSON Object</td>
            <td>The proxy server through with Agave will tunnel when submitting jobs. Currently proxy servers will use the same authentication mechanism as the target server.</td>
        </tr>
    </tbody>
</table>

<h4 id="scratch-and-work-directories">Scratch and work directories</h4>

<p>In the Job Management tutorial we will dive into how Agave manages the end-to-end lifecycle of running a job. Here we point out two relevant attributes that control where data is staged and where your job will physically run. The <code class="prettyprint">scratchDir</code> and <code class="prettyprint">workDir</code> attributes control where the working directories for each job will be created on an execution system. The following table summarizes the decision making process Agave uses to determine where the working directories should be created.</p>

<table>
    <thead>
        <tr>
            <th><code>rootDir</code> value</th>
            <th><code>homeDir</code> value</th>
            <th><code>scratchDir</code> value</th>
            <th>Effective system path for job working directories</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>/</td>
            <td>/</td>
            <td>&mdash;</td>
            <td>/</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/</td>
            <td>/</td>
            <td>/</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/</td>
            <td>/scratch</td>
            <td>/scratch</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/home/nryan</td>
            <td>&mdash;</td>
            <td>/home/nryan</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/home/nryan</td>
            <td>/</td>
            <td>/</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/home/nryan</td>
            <td>/scratch</td>
            <td>/scratch</td>
        </tr>
        <tr>
            <td>/home/nryan</td>
            <td>/</td>
            <td>&mdash;</td>
            <td>/home/nryan</td>
        </tr>
        <tr>
            <td>/home/nryan</td>
            <td>/</td>
            <td>/</td>
            <td>/home/nryan</td>
        </tr>
        <tr>
            <td>/home/nryan</td>
            <td>/</td>
            <td>/scratch</td>
            <td>/home/nryan/scratch</td>
        </tr>
        <tr>
            <td>/home/nryan</td>
            <td>/home</td>
            <td>&mdash;</td>
            <td>/home/nryan/home</td>
        </tr>
        <tr>
            <td>/home/nryan</td>
            <td>/home</td>
            <td>/</td>
            <td>/home/nryan</td>
        </tr>
        <tr>
            <td>/home/nryan</td>
            <td>/home</td>
            <td>/scratch</td>
            <td>/home/nryan/scratch</td>
        </tr>
    </tbody>
</table>

<p>While it is not required, it is a best practice to always specify <code class="prettyprint">scratchDir</code> and <code class="prettyprint">workDir</code> values for your execution systems and, whenever possible, place them outside of the system <code class="prettyprint">homeDir</code> to ensure data privacy. The reason for this is that the file system available on many servers is actually made up of a combination of physically attached storage, mounted volumes, and network mounts. Often times, your home directory will have a very conservative quota while the mounted storage will essentially be quota free. As the above table shows, when you do not specify a <code class="prettyprint">scratchDir</code> or <code class="prettyprint">workDir</code>, Agave will attempt to create your job work directories in your system <code class="prettyprint">homeDir</code>. It is very likely that, in the course of running simulations, you will reach the quota on your home directory, thereby causing that job and all future jobs to fail on the system until you clear up more space. To avoid this, we recommend specifying a location with sufficient available space to handle the work you want to do.</p>

<p>Another common error that arises from not specifying thoughtful <code class="prettyprint">scratchDir</code> and <code class="prettyprint">workDir</code> values for your execution systems is jobs failing due to &ldquo;permission denied&rdquo; errors. This often happens when your <code class="prettyprint">scratchDir</code> and/or <code class="prettyprint">workDir</code> resolve to the actual system root. Usually the account you are using to access the system will not have permission to write to <code class="prettyprint">/</code>, so all attempts to create a job working directory fail, accurately, due to a &ldquo;permission denied&rdquo; error.</p>

<aside class="notice">While it is not required, it is a best practice to always specify `scratchDir` and `workDir` values for your execution systems and, whenever possible, place them outside of the system `homeDir` to ensure data privacy.</aside>

<h4 id="creating-a-new-execution-system">Creating a new execution system</h4>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -F <span class="s2">"fileToUpload=@ssh-password.json"</span> https://public.tenants.agaveapi.co/systems/v2
</code></pre>
<pre class="highlight plaintext"><code>systems-addupdate -v -F ssh-password.json
</code></pre>

<blockquote>
<p>The response from the server will be similar to the following.</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
   </span><span class="nt">"id"</span><span class="p">:</span><span class="s2">"demo.execute.example.com"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"uuid"</span><span class="p">:</span><span class="s2">"0001323106792914-5056a550b8-0001-006"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"Example SSH Execution Host"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"EXECUTION"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"My example system using ssh to submit jobs used for testing."</span><span class="p">,</span><span class="w">
   </span><span class="nt">"site"</span><span class="p">:</span><span class="s2">"example.com"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"revision"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
   </span><span class="nt">"public"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
   </span><span class="nt">"lastModified"</span><span class="p">:</span><span class="s2">"2013-07-02T10:16:11.000-05:00"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"executionType"</span><span class="p">:</span><span class="s2">"HPC"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"scheduler"</span><span class="p">:</span><span class="s2">"SGE"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"environment"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
   </span><span class="nt">"startupScript"</span><span class="p">:</span><span class="s2">"./bashrc"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"maxSystemJobs"</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="w">
   </span><span class="nt">"maxSystemJobsPerUser"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="w">
   </span><span class="nt">"workDir"</span><span class="p">:</span><span class="s2">"/work"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"scratchDir"</span><span class="p">:</span><span class="s2">"/scratch"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"queues"</span><span class="p">:[</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"normal"</span><span class="p">,</span><span class="w">
         </span><span class="nt">"maxJobs"</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="w">
         </span><span class="nt">"maxUserJobs"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="w">
         </span><span class="nt">"maxNodes"</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span><span class="w">
         </span><span class="nt">"maxMemoryPerNode"</span><span class="p">:</span><span class="s2">"64GB"</span><span class="p">,</span><span class="w">
         </span><span class="nt">"maxProcessorsPerNode"</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="w">
         </span><span class="nt">"maxRequestedTime"</span><span class="p">:</span><span class="s2">"48:00:00"</span><span class="p">,</span><span class="w">
         </span><span class="nt">"customDirectives"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
         </span><span class="nt">"default"</span><span class="p">:</span><span class="kc">true</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"largemem"</span><span class="p">,</span><span class="w">
         </span><span class="nt">"maxJobs"</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span><span class="w">
         </span><span class="nt">"maxUserJobs"</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="w">
         </span><span class="nt">"maxNodes"</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="w">
         </span><span class="nt">"maxMemoryPerNode"</span><span class="p">:</span><span class="s2">"2TB"</span><span class="p">,</span><span class="w">
         </span><span class="nt">"maxProcessorsPerNode"</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="w">
         </span><span class="nt">"maxRequestedTime"</span><span class="p">:</span><span class="s2">"96:00:00"</span><span class="p">,</span><span class="w">
         </span><span class="nt">"customDirectives"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
         </span><span class="nt">"default"</span><span class="p">:</span><span class="kc">false</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">],</span><span class="w">
   </span><span class="nt">"login"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"host"</span><span class="p">:</span><span class="s2">"texas.rangers.mlb.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"port"</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span><span class="w">
      </span><span class="nt">"protocol"</span><span class="p">:</span><span class="s2">"SSH"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"proxy"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"auth"</span><span class="p">:{</span><span class="w">
         </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"PASSWORD"</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nt">"storage"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"host"</span><span class="p">:</span><span class="s2">"texas.rangers.mlb.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"port"</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span><span class="w">
      </span><span class="nt">"protocol"</span><span class="p">:</span><span class="s2">"SFTP"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"rootDir"</span><span class="p">:</span><span class="s2">"/home/nryan"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"homeDir"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="nt">"proxy"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"auth"</span><span class="p">:{</span><span class="w">
         </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"PASSWORD"</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

              <h3 id="disabling">Disabling</h3>

<blockquote>
<p>Disable a system</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span>
    -H <span class="s2">"Content-Type: application/json"</span>
    -X PUT --data-binary <span class="s1">'{"action": "disable"}'</span>
    https://public.agaveapi.co/systems/v2/<span class="nv">$SYSTEM_ID</span>
</code></pre>
<pre class="highlight plaintext"><code>systems-disable $SYSTEM_ID
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"site"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sftp.storage.example.com"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"revision"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nt">"default"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"lastModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-06T17:46:42.621-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My example storage system using SFTP to store data for testing"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example SFTP Storage System"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"globalDefault"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"available"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4036169328045649434-242ac117-0001-006"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"public"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STORAGE"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"storage"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"mirror"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w">
    </span><span class="nt">"homeDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/home/systest"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SFTP"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storage.example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"publicAppsDir"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"proxy"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rootDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"auth"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASSWORD"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"roles"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/sftp.storage.example.com/roles"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/sftp.storage.example.com/credentials"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/sftp.storage.example.com"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/data/?q=%7B%22associationIds%22%3A%224036169328045649434-242ac117-0001-006%22%7D"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>There may be times when you need to disable a system. If your system has scheduled maintenance periods, you may want to disable the system until the maintenance period ends. You can do this by making a PUT request on a monitor with the a field name <code class="prettyprint">action</code> set to &ldquo;disabled&rdquo;, or simply updating the status to &ldquo;MAINTENANCE&rdquo;. While disabled, all apps and jobs will be disabled. All file operations will be rejected during system downtimes as well. Once restored, all operations will pick back up.</p>

<h3 id="enabling-a-system">Enabling a system</h3>

<blockquote>
<p>Enable a system</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span>
    -H <span class="s2">"Content-Type: application/json"</span>
    -X PUT --data-binary <span class="s1">'{"action": "enable"}'</span>
    https://public.agaveapi.co/systems/v2/<span class="nv">$SYSTEM_ID</span>
</code></pre>
<pre class="highlight plaintext"><code>systems-enable $SYSTEM_ID
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"site"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sftp.storage.example.com"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"revision"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nt">"default"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"lastModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-06T17:46:42.621-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My example storage system using SFTP to store data for testing"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example SFTP Storage System"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"globalDefault"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"available"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4036169328045649434-242ac117-0001-006"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"public"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STORAGE"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"storage"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"mirror"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w">
    </span><span class="nt">"homeDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/home/systest"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SFTP"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storage.example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"publicAppsDir"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"proxy"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rootDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"auth"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASSWORD"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"roles"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/sftp.storage.example.com/roles"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/sftp.storage.example.com/credentials"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/sftp.storage.example.com"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/data/?q=%7B%22associationIds%22%3A%224036169328045649434-242ac117-0001-006%22%7D"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Similarly, to enable a monitor, make a PUT request with the a field name <code class="prettyprint">action</code> set to &ldquo;enabled&rdquo;. Once reenabled, the monitor will resume its previous check schedule as specified in the <code class="prettyprint">nextUpdate</code> field, or immediately if that time has already expired.</p>

<h3 id="deleting-systems">Deleting systems</h3>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X DELETE https://public.tenants.agaveapi.co/systems/v2/<span class="nv">$SYSTEM_ID</span>
</code></pre>
<pre class="highlight plaintext"><code>systems-delete $SYSTEM_ID
</code></pre>

<blockquote>
<p>The call will return an empty result.</p>
</blockquote>

<p>In the event you wish to delete a system, you can make a DELETE request on the system URL. Deleting a system will disable the system and all applications published on that system from use. Any running jobs will be continue to run, but all pending, archiving, paused, and staged jobs will be killed, and any data archived on that system will no longer be available. Restoring a deleted system requires intervention from your tenant admin. Once deleted, the system id cannot be reused at a later time. Use this operation with care.</p>

<aside class="notice">If you simply wish to remove a system from service, you can update the system <span class="highlight">status</span> or <span class="highlight">available</span> attributes depending on whether you want to disable user or visibility.</aside>

<h3 id="multi-user-environments">Multi-user environments</h3>

<p>If your application supports a multi-user environment and those users do not have API accounts, then you may run into a situation where you are juggling multiple user credentials for a single system. Agave has a solution for this problem in the for of its Internal User feature. You can map your application users into a private user store Agave provides you and assign those users credentials on your systems. This allows you to move seamlessly from community users to private users and back without having to alter your application code. For a deep discussion on the mechanics and implications of credential management with internal users, see the <a href="#internal-user-credential-management/" title="Internal User Credential Management">Internal User Credential Management</a> guide.</p>

              <h3 id="system-roles">System roles</h3>

<p>Systems you register are private to you and you alone. You can, however, allow other Agave clients to utilize the system you define by granting them a role on the system using the systems roles services. The available roles are given in the table below.</p>

<table>
    <thead>
        <tr>
            <th>Role</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>GUEST</td>
            <td>Gives any authenticated user readonly access to the system. No file operations or job executions are allowed for users with GUEST access.</td>
        </tr>
        <tr>
            <td>USER</td>
            <td>Gives a user the ability to run jobs and access data on the system.</td>
        </tr>
        <tr>
            <td>PUBLISHER</td>
            <td>All the rights of USER as well as the ability to publish applications listing the system as an execution host.</td>
        </tr>
        <tr>
            <td>ADMIN</td>
            <td>All the rights of PUBLISHER as well as the ability to edit and grant roles on the system details. Admins may use the system to access data and run jobs using the default credential assigned to the system, but they may not view or update any of the credentials stored by the system owner. It is not possible for anyone but the system owner to assign or leverage internal user credentials on a system.</td>
        </tr>
        <tr>
            <td>OWNER</td>
            <td>Reserved for the user that originally created the system. This role is non-revokable.</td>
        </tr>
    </tbody>
</table>

<aside class="notice">Please see the Systems Roles tutorial for a deep discussion of system roles and how they are used.</aside>

              <h3 id="system-scope">System scope</h3>

<p>Throughout these tutorials and <a href="http://agaveapi.co/documentation/beginners-guides/" title="Beginner’s Guides">Beginner&rsquo;s Guides</a>, we have referred to both public and private systems. In addition to roles, systems have a concept of scope associated with them. Not to be confused with OAuth scope mentioned in the <a href="http://agaveapi.co/documentation/authorization/" title="Authorization Guide">Authentication Guide</a>, system scope refers to the availability of a system to the general user community. The following table lists the available scopes and their meanings.</p>

<table>
    <thead>
        <tr>
            <th>Scope</th>
            <th>Required role</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>private</td>
            <td>Admin</td>
            <td>System is visible and available for use to the owner and to anyone whom they grant a role.</td>
        </tr>
        <tr>
            <td>read only</td>
            <td>Tenant admin</td>
            <td>Storage system is visible and available for data browsing and download by any API user. Write access is restricted unless explicitly granted to a specific user.</td>
        </tr>
        <tr>
            <td>public</td>
            <td>Tenant admin</td>
            <td>System is visible and available to all users for reading and writing. Virtual user home directories are enforced and write access outside of a user&rsquo;s home directory is restricted unless explicitly granted by a system admin.</td>
        </tr>
    </tbody>
</table>

<h4 id="private-systems">Private systems</h4>

<p>All systems are private by default. This means that no one can use a system you register without you or another user with &ldquo;admin&rdquo; permissions granting them a role on that system. Most of the time, unless you are configuring a tenant for your organization, all the systems you register will stay private. Do not mistake the term private for isolated. Private simply means not public. Another way to think of private systems is as &ldquo;invitation only.&rdquo; You are free to share your system as many or as few people as you want and it will still remain a private system.</p>

<h4 id="readonly-systems">Readonly systems</h4>

<p>Readonly systems are systems who have granted a GUEST role to the <code class="prettyprint">world</code> group. Once this grant is made, any user will be able to browse the system&rsquo;s entire file system regardless of individual permissions. Be careful when making a system readonly. Usually, the only reason you would do this is because you have configured the system <code class="prettyprint">rootDir</code> to point to a dataset or volume that you want to publish for others to use. Carelessly making systems readonly can expose personal data stored on the system to every other API user. While your intentions may be pure, theirs may not be, so think through the implications of this action before you take it.</p>

<h4 id="public-systems">Public systems</h4>

<p>Public systems are available for use by every API user within your tenant. Once public, systems inherit specific behavior unique to their <code class="prettyprint">type</code>. We will cover each system type in turn.</p>

<h4 id="public-storage-systems">Public Storage Systems</h4>

<p>Public storage systems enforce a virtual user home directory with implied user permissions. The following table gives a brief summary of the permission implications. You can read more about data permissions in the <a href="http://agaveapi.co/documentation/tutorials/data-management-tutorial/data-permissions-tutorial/" title="Data Permissions Tutorial">Data Permissions</a> tutorial.</p>

<table>
    <thead>
        <tr>
            <th><code>rootDir</code></th>
            <th><code>homeDir</code></th>
            <th>URL path</th>
            <th>User permission</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>/</td>
            <td>/home</td>
            <td>&mdash;</td>
            <td>READ</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/home</td>
            <td>/</td>
            <td>READ</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/home</td>
            <td>/var</td>
            <td>READ</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/home</td>
            <td>systest</td>
            <td>ALL</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/home</td>
            <td>systest/some/subdir</td>
            <td>ALL</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/home</td>
            <td>rjohnson</td>
            <td>NONE</td>
        </tr>
    </tbody>
</table>

<p>Notice in the above example that on public systems, users will have implied ownership of a folder matching their username in the system&rsquo;s <code class="prettyprint">homeDir</code>. In the table, this means that user &ldquo;systest&rdquo; will have ownership of the physical home directory <code class="prettyprint">/home/systest</code> on the system after it&rsquo;s public. It is important that, before publishing a system, you make sure that the account used to access the system can actually write to these folders. Otherwise, users will not be able to access their data on the system you make public.</p>

<aside class="notice">Before making a system public, make sure that you have a strategy for mapping API users to directories on the system you want to expose. If mapping to the `/home` folder on a Unix system, make sure the account used to access the system has write access to all user directories.</aside>

<h4 id="public-execution-systems">Public Execution Systems</h4>

<p>Public execution systems do not share the same behavior as public storage systems. Unless explicit permission has been given, public execution systems are not accessible for data access by non-privileged users. This is because public systems allow all users to run applications on them and granting public access to the file system would expose user job data to all users. If you do need to expose the data on a public execution system, either register it again as a storage system (using an appropriate <code class="prettyprint">rootDir</code> outside of the system <code class="prettyprint">scratchDir</code> and <code class="prettyprint">workDir</code> paths), or grant specific users a role on the system.</p>

<h4 id="publishing-a-system">Publishing a system</h4>

<p>To publish a system and make it public, you make a PUT request on the system&rsquo;s url.</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
     -H <span class="s2">"Content-Type: application/json"</span>
     -X PUT
     --data-binary <span class="s1">'{"action":"publish"}'</span>
     https://public.tenants.agaveapi.co/systems/v2/<span class="nv">$SYSTEM_ID</span>
</code></pre>
<pre class="highlight plaintext"><code>systems-publish -v $SYSTEM_ID
</code></pre>

<blockquote>
<p>The response from the service will be the same system description we saw before, this time with the public attribute set to <em>true</em>.</p>
</blockquote>

<h4 id="unpublishing-a-system">Unpublishing a system</h4>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
     -H <span class="s2">"Content-Type: application/json"</span>
     -X PUT
     --data-binary <span class="s1">'{"action":"unpublish"}'</span>
     https://public.tenants.agaveapi.co/systems/v2/<span class="nv">$SYSTEM_ID</span>
</code></pre>
<pre class="highlight plaintext"><code>systems-unpublish -v $SYSTEM_ID
</code></pre>

<blockquote>
<p>The response from the service will be the same system description we saw before, this time with the public attribute set to <em>false</em>.</p>
</blockquote>

<p>To unpublish a system, make the same request with the <code class="prettyprint">action</code> attribute set to <em>unpublish</em>.</p>

<h3 id="default-systems">Default systems</h3>

<p>As you continue to use Agave over time, it will not be uncommon for you to accumulate additional storage and execution systems through both self-registration and other people sharing their systems with you. It may even be the case that you have multiple public systems available to you. In this situation, it is helpful for both you and your users to specify what the default systems should be.</p>

<p>Default systems are the systems that are used when the user does not specify a system to use when performing a remote action in Agave. For example, specifying an <code class="prettyprint">archivePath</code> in a job request, but no <code class="prettyprint">archiveSystem</code>, or specifying a <code class="prettyprint">deploymentPath</code> in an app description, but no <code class="prettyprint">deploymentSystem</code>. In these situations, Agave will use the user&rsquo;s default storage system.</p>

<p>Four types of default systems are possible. The following table describes them.</p>

<table>
    <thead>
        <tr>
            <th>Type</th>
            <th>Scope</th>
            <th>Role needed to set</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>storage</td>
            <td>user default</td>
            <td>USER</td>
            <td>Default storage system for an individual user. This takes priority over any global defaults and will be used in all data operations in leu of a system being specified for this user.</td>
        </tr>
        <tr>
            <td>storage</td>
            <td>global default</td>
            <td>Tenant admin</td>
            <td>Default storage system for an entire tenant. This will be used as the default storage system whenever a user has not explicitly specified another. Only public systems may be made the global default.</td>
        </tr>
        <tr>
            <td>execution</td>
            <td>user default</td>
            <td>USER</td>
            <td>Default execution system for an individual user. This takes priority over any global defaults and will be used in all app and job operations in leu of an execution system being specified for this user. In the case of app registration, normal user role requirements apply.</td>
        </tr>
        <tr>
            <td>execution</td>
            <td>global default</td>
            <td>Tenant admin</td>
            <td>Default execution system for an entire tenant. This will be used as the default execution system whenever a user has not explicitly specified another. Only public systems may be made the global default.</td>
        </tr>
    </tbody>
</table>

<aside class="notice">As a best practice, it is recommended to always specify the system you intend to use when interacting with Agave. This will eliminate ambiguity in each request and make your actions more repeatable over time as the availability and configuration of the global and user default systems may change.</aside>

<h4 id="setting-user-default-system">Setting user default system</h4>

<p>To set a system as the user&rsquo;s default, you make a PUT request on the system&rsquo;s url. Only systems the user has access to may be used as their default.</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
     -H <span class="s2">"Content-Type: application/json"</span>
     -X PUT
     --data-binary <span class="s1">'{"action":"setDefault"}'</span>
     https://public.tenants.agaveapi.co/systems/v2/<span class="nv">$SYSTEM_ID</span>
</code></pre>
<pre class="highlight plaintext"><code>systems-setdefault -v $SYSTEM_ID
</code></pre>

<blockquote>
<p>The response from the service will be the same system description we saw before, this time with the <code class="prettyprint">default</code> attribute set to <em>true</em>.</p>
</blockquote>

<h4 id="unsetting-user-default-system">Unsetting user default system</h4>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
     -H <span class="s2">"Content-Type: application/json"</span>
     -X PUT
     --data-binary <span class="s1">'{"action":"unsetDefault"}'</span>
     https://public.tenants.agaveapi.co/systems/v2/<span class="nv">$SYSTEM_ID</span>
</code></pre>
<pre class="highlight plaintext"><code>systems-unsetdefault -v $SYSTEM_ID
</code></pre>

<blockquote>
<p>The response from the service will be the same system description we saw before, this time with the <code class="prettyprint">default</code> attribute set to <em>false</em>.</p>
</blockquote>

<p>To remove a system as the user&rsquo;s default, make the same request with the <code class="prettyprint">action</code> attribute set to <em>unsetDefault</em>. Keep in mind that you cannot remove the global default system from being the user&rsquo;s default. You can only set a different one to replace it.</p>

<h4 id="setting-global-default-system">Setting global default system</h4>

<p>Tenant administrators may wish to set default storage and execution systems for an entire tenant. These are called global default systems. There may be at most one system of each type set as a global default. To set a global default system, first make sure that the system is public. Only public systems may be set as a global default. Next, make sure you have administrator permissions for your tenant. Only tenant admins may publish systems and manage the global defaults. Lastly, make a PUT request on the system&rsquo;s url with an <code class="prettyprint">action</code> attribute in the body set to <em>unsetGlobalDefault</em>.</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
     -H <span class="s2">"Content-Type: application/json"</span>
     -X PUT
     --data-binary <span class="s1">'{"action":"setGlobalDefault"}'</span>
     https://public.tenants.agaveapi.co/systems/v2/<span class="nv">$SYSTEM_ID</span>
</code></pre>
<pre class="highlight plaintext"><code>systems-setdefault -v -G $SYSTEM_ID
</code></pre>

<blockquote>
<p>The response from the service will be the same system description we saw before, this time with both the <code class="prettyprint">default</code> and <code class="prettyprint">public</code> attributes set to <em>true</em>.</p>
</blockquote>

<aside class="notice">Setting global default systems does not preclude users from manually setting their own default systems. Any user-defined default systems will trump the global default system setting for that user.</aside>

<p>To remove a system from being the global default, make the same request with the <code class="prettyprint">action</code> attribute set to <em>unsetGlobalDefault</em>.</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
     -H <span class="s2">"Content-Type: application/json"</span>
     -X PUT
     --data-binary <span class="s1">'{"action":"unsetGlobalDefault"}'</span>
     https://public.tenants.agaveapi.co/systems/v2/<span class="nv">$SYSTEM_ID</span>
</code></pre>
<pre class="highlight plaintext"><code>systems-unsetdefault -v -G $SYSTEM_ID
</code></pre>

<blockquote>
<p>This time the response from the service will have <code class="prettyprint">default</code> set to <em>false</em> and <code class="prettyprint">public</code> set to <em>true</em>.</p>
</blockquote>

              <h2 id="files">Files</h2>
<pre class="highlight json"><code><span class="w"> </span><span class="err">/$$$$$$$$</span><span class="w"> </span><span class="err">/$$</span><span class="w"> </span><span class="err">/$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$_____/|__/|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">       </span><span class="err">/$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">   </span><span class="err">/$$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$$$$</span><span class="w">   </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$_____/</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$__/</span><span class="w">   </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$$$$$$$|</span><span class="w">  </span><span class="err">$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">      </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$_____/</span><span class="w"> </span><span class="err">\____</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">      </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$|</span><span class="w">  </span><span class="err">$$$$$$$</span><span class="w"> </span><span class="err">/$$$$$$$/</span><span class="w">
</span><span class="err">|__/</span><span class="w">      </span><span class="err">|__/|__/</span><span class="w"> </span><span class="err">\_______/|_______/</span><span class="w">
</span></code></pre>

<p>The Agave Files service allows you to manage data across multiple storage systems using multiple protocols. It supports traditional file operations such as directory listing, renaming, copying, deleting, and upload/download that are traditional to most file services. It also supports file importing from arbitrary locations, metadata assignment, and a full access control layer allowing you to keep your data private, share it with your colleagues, or make it publicly available.</p>

<h3 id="files-service-url-structure">Files service URL structure</h3>

<blockquote>
<p>Canonical URL for all file items accessible in the Platform</p>
</blockquote>
<pre class="highlight http"><code><span class="err">https://public.tenants.agaveapi.co/files/v2/media/system/$SYSTEM_ID/$PATH
</span></code></pre>

<p>Every file and directory referenced through the Files service has a canonical URL show in the first example. The following table defines each component:</p>

<table>
    <thead>
        <tr>
            <th>Token</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>$SYSTEM_ID</td>
            <td>The id of the system where the file or directory lives. The correspond to the ids returned from the Systems service.</td>
        </tr>
        <tr>
            <td>$PATH</td>
            <td>(<i>Optional:</i>) The path on the remote system. By default, all paths are relative to the home directory defined in the system description. To specify an absolute path, prefix the path with a `/`. For more on path resolution, see the next section.</td>
        </tr>
    </tbody>
</table>

<p>Agave also supports the concept of <em>default systems</em>. Excluding the <code class="prettyprint">/system/$SYSTEM_ID</code> segments from the above URL, the Files service will automatically assume you are referencing your default storage system. Thus, if your default system was <code class="prettyprint">data.agaveapi.co</code>, the following two examples would be identical.</p>

<blockquote>
<p>If <code class="prettyprint">data.agaveapi.co</code> is your default storage system then</p>
</blockquote>
<pre class="highlight http"><code><span class="err">https://public.tenants.agaveapi.co/files/v2/media/shared
</span></code></pre>

<blockquote>
<p>is equivalent to this:</p>
</blockquote>
<pre class="highlight http"><code><span class="err">https://public.tenants.agaveapi.co/files/v2/media/system/data.agaveapi.co/shared
</span></code></pre>

<p>This comes in especially handy when referencing your default system paths in other contexts such as job requests and when interacting with the Agave CLI. A good example of this situation is when you have a global default storage system accessible to all your users. In this case, most users will use that for all of their data staging and archiving needs. These users may find it easier not to even think about the system they are using. The default system support in the Files service allows them to do just that.</p>

<aside class="notice">When building applications against the Files service, it is considered a best practice to always specify the intended system ID when constructing URL paths to avoid situations where users change their default systems. This will also provide long-term stability to your data references and make debugging much easier. You can read more about default systems in the <a href="#systems" title="System Management">Systems Guide</a>.</aside>

<h3 id="understanding-file-paths">Understanding file paths</h3>

<p>One powerful, but potentially confusing feature of Agave is its support for virtualizing systems paths. Every registered system specifies both a root directory, <code class="prettyprint">rootDir</code>, and a home directory, <code class="prettyprint">homeDir</code> attribute in its storage configuration. <code class="prettyprint">rootDir</code> tells Agave the absolute path on the remote system that it should treat as <code class="prettyprint">/</code>. Similar to the Linux <code class="prettyprint">chroot</code> command; no requests made to Agave will ever be resolved to locations outside of <code class="prettyprint">rootDir</code>.</p>

<table>
    <thead>
        <tr>
            <th>Type of storage system</th>
            <th>Examples of rootDir values</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Linux</td>
            <td><ul><li>Actual system root directory, `/`</li><li>RAID array physically attached to the system</li><li>NSF mount you want to share</li><li>An arbitrary file path, such as your `$HOME` directory from which you want to server application data.</li></ul></td>
        </tr>
        <tr>
            <td>Cloud</td>
            <td><ul><li>A bucket on S3</li><li>A folder/marker file in your object store
</li></ul></td>
        </tr>
        <tr>
            <td>iRODS</td>
            <td><ul><li>A specific resource or zone you want to expose.</li><li>A collection you want to publish for use</li><li>Your personal home folder</li></ul></td>
        </tr>
    </tbody>
</table>

<p><code class="prettyprint">homeDir</code> specifies the path, relative to <code class="prettyprint">rootDir</code>, that Agave should use for relative paths. Since Agave is stateless, there is no concept of a current working directory. Thus, when you specify a path to Agave that does not begin with a <code class="prettyprint">/</code>, Agave will always prefix the path with the value of <code class="prettyprint">homeDir</code>. The following table gives several examples of how different combinations of <code class="prettyprint">rootDir</code>, <code class="prettyprint">homeDir</code>, and URL paths will be resolved by Agave. For a deeper dive into this subject, please see the <a href="#understanding-agave-file-paths" title="Understanding Agave File Paths">Understanding Agave File Paths</a> section.</p>

<table>
    <thead>
        <tr>
            <th>&ldquo;rootDir&rdquo; value</th>
            <th>&ldquo;homeDir&rdquo; value</th>
            <th>Agave URL path</th>
            <th>Resolved path on system</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>/</td>
            <td>/</td>
            <td>&ndash;</td>
            <td>/</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/</td>
            <td>..</td>
            <td>/</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/</td>
            <td>home</td>
            <td>/home</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/</td>
            <td>/home</td>
            <td>/home</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/home/nryan</td>
            <td>&ndash;</td>
            <td>/home/nryan</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/home/nryan</td>
            <td>/</td>
            <td>/</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/home/nryan</td>
            <td>..</td>
            <td>/home</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/home/nryan</td>
            <td>nryan</td>
            <td>/home/nryan/nryan</td>
        </tr>
        <tr>
            <td>/</td>
            <td>/home/nryan</td>
            <td>/nryan</td>
            <td>/nryan</td>
        </tr>
        <tr>
            <td>/home/nryan</td>
            <td>/</td>
            <td>&ndash;</td>
            <td>/home/nryan</td>
        </tr>
        <tr>
            <td>/home/nryan</td>
            <td>/</td>
            <td>..</td>
            <td>/home/nryan</td>
        </tr>
        <tr>
            <td>/home/nryan</td>
            <td>/home</td>
            <td>/</td>
            <td>/home/nryan</td>
        </tr>
        <tr>
            <td>/home/nryan</td>
            <td>/home</td>
            <td>..</td>
            <td>/home/nryan</td>
        </tr>
        <tr>
            <td>/home/nryan</td>
            <td>/home</td>
            <td>home</td>
            <td>/home/nryan/home/home</td>
        </tr>
        <tr>
            <td>/home/nryan</td>
            <td>/home</td>
            <td>/bgibson</td>
            <td>/home/nryan/bgibson</td>
        </tr>
    </tbody>
</table>

<h3 id="transfering-data">Transfering data</h3>

<p>Before we talk about how to do basic operations on your data, let&rsquo;s first talk about how you can move your data around. You already have a storage system available to you, so we will start with the &ldquo;hello world&rdquo; of data movement, uploading a file.</p>

<h3 id="uploading-data">Uploading data</h3>

<blockquote>
<p>Uploading a file  </p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -X POST <span class="se">\</span>
    -F <span class="s2">"fileToUpload=@files/picksumipsum.txt"</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/files/v2/media/data.agaveapi.co/nryan
</code></pre>
<pre class="highlight plaintext"><code>files-upload -v -F files/picksumipsum.txt -S data.agaveapi.co nryan
</code></pre>

<blockquote>
<p>The response will look something like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-09-03T10:28:09.943-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"picksumipsum.txt"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"nativeFormat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"raw"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/home/nryan/picksumipsum.txt"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://127.0.0.1/picksumipsum.txt"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STAGING_QUEUED"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"systemId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data.agaveapi.co"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0001409758089943-5056a550b8-0001-002"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"history"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/history/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/media/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/data.agaveapi.co"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>You may upload data to a remote systems by performing a multipart POST on the FILES service. If you are using the Agave CLI, you can perform recursive directory uploads. If you are manually calling curl or building an app with the Agave SDK, you will need to implement the recursion yourself. You can take a look in the <code class="prettyprint">files-upload</code> script to see how this is done. The following is an example of how to upload a file that we will use in the remainder of this tutorial.</p>

<p>You will see a progress bar while the file uploads, followed by a response from the server with a description of the uploaded file. Agave does not block during data movement operations, so it may be just a moment before the file physically shows up on the remote system.</p>

<h3 id="importing-data">Importing data</h3>

<p>You can also have Agave download data from an external URL. Rather than making a multipart file upload request, you can pass in a JSON object with the URL and an optional target file name, type, and array of notifications subscriptions. Agave supports several protocols for ingestion listed in the next table.</p>

<table>
    <thead>
        <tr>
            <th>Schema</th>
            <th>Details</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>http</td>
            <td>Supported with and without user info</td>
        </tr>
        <tr>
            <td>https</td>
            <td>Supported with and without user info</td>
        </tr>
        <tr>
            <td>ftp</td>
            <td>Anonymous FTP only</td>
        </tr>
        <tr>
            <td>sftp</td>
            <td>User info required in URL</td>
        </tr>
        <tr>
            <td>agave</td>
            <td>No user info supported.</td>
        </tr>
    </tbody>
</table>

<p>To demonstrate how this works, we will import a README.md file from the <a href="https://bitbucket.org/agaveapi/science-api-samples" title="Agave Samples" target="_blank">Agave Samples</a> git repository in Bitbucket.</p>

<blockquote>
<p>Download a file from a web accessible URL  </p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X POST
    -- data &amp;#039;<span class="o">{</span> <span class="s2">"url"</span>:<span class="s2">"https://bitbucket.org/agaveapi/science-api-samples/raw/master/README.md"</span><span class="o">}</span>&amp;#039;
    https://public.tenants.agaveapi.co/files/v2/media/data.agaveapi.co/nryan
</code></pre>
<pre class="highlight plaintext"><code>files-import -v -U "https://bitbucket.org/agaveapi/science-api-samples/raw/master/README.md"
    -S data.agaveapi.co nryan
</code></pre>

<blockquote>
<p>The response will look something like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"README.md"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"uuid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0001409758713912-5056a550b8-0001-002"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastModified"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-09-10T20:00:55.266-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"source"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://bitbucket.org/agaveapi/science-api-samples/raw/master/README.md"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"path"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"/home/nryan/README.md"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"STAGING_QUEUED"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"systemId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"data.agaveapi.co"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"nativeFormat"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"raw"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/media/system/data.agaveapi.co/nryan/README.md"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"system"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/data.agaveapi.co"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"history"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/history/system/data.agaveapi.co/nryan/README.md"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Downloading data from a third party is done offline as an asynchronous activity, so the response from the server will come right away. One thing worth noting is that the file length given in the response will always be -1. This is because, generally speaking, Agave does not know what the actual source file size is until after the repsonse is send back. The file size will be updated as the download progresses. You can track the progress by querying the destination file item&rsquo;s history. An entry will be present showing the progress of the download.</p>

<p>For this exercise, the file we just downloaded is just a few KB, so you should see it appear in your home folder on <code class="prettyprint">data.agaveapi.co</code> almost immediately. If you were importing larger datasets, the transfer could take significantly longer depending on the network quality between Agave and the source location. In this case, you would see the file size continue to increase until it completed. In the event of a failed transfer, Agave will retry several times before canceling the transfer.</p>

<aside class="notice">Agave attempts to make smart decisions about how and when to transfer data. This includes leveraging third-party transfers whenever possible, scaling directory copies out horizontally, and taking advantage of chunked or parallel uploads. As a result, data may arrive in a non-deterministic way on the target system. This is normal and should be expected.</aside>

<h3 id="transferring-data">Transferring data</h3>

<blockquote>
<p>Transferring data between systems</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -X POST <span class="se">\</span>
    --data-binary <span class="s1">'{"url":"agave://stampede.tacc.utexas.edu//etc/motd"}'</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/files/v2/media/data.agaveapi.co/nryan
</code></pre>
<pre class="highlight plaintext"><code>files-import -v -U "agave://stampede.tacc.utexas.edu//etc/motd" -S data.agaveapi.co nryan
</code></pre>

<blockquote>
<p>The response from the service will be the same as the one we received importing a file.</p>
</blockquote>

<p>Much like downloading data, Agave can manage the transfer of data between registered systems. This is, in fact, how data is staged prior to running a simulation. Data transfers are carried out asynchronously, so you can simply start a transfer and go about your business. Agave will ensure it completes. If you would like a notification when the transfer completes or reaches a certain stage, you can subscribe for one or more emails, <a href="http://webhooks.org" title="Webhooks" target="_blank">webhooks</a>, and/or <a href="#reatime-notifications" title="Realtime Notifications">realtime</a> notifications, and Agave will alert them when as the transfer progresses. The following table lists the available file events. For more information about the events and notifications systems, please see the <a href="#notifications" title="Notifications Guide" target="_blank">Notifications Guide</a> and <a href="#event-reference" title="Event Reference" target="_blank">Event Reference</a>.</p>

<p>In the example below, we will transfer a file from <code class="prettyprint">stampede.tacc.utexas.edu</code> to <code class="prettyprint">data.agaveapi.co</code>. While the request looks pretty basic, there is a lot going on behind the scenes. Agave will authenticate to both systems, check permissions, stream data out of Stampede using GridFTP and proxy it into <code class="prettyprint">data.agaveapi.co</code> using the SFTP protocol, adjusting the transfer buffer size along the way to optimize throughput. Doing this by hand is both painful and error prone. Doing it with Agave is nearly identical to copying a file from one directory to another on your local system.</p>

<p>One of the benefits of the Files service is that it frees you up to work in parallel and scale with your application demands. In the next example we will use the Files service to create redundant archives of a shared project directory.</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -X POST <span class="se">\</span>
    --data-binary <span class="s1">'{"url":"agave://data.agaveapi.co/nryan/foo_project"}'</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/files/v2/media/system/nryan.storage1/

curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -X POST <span class="se">\</span>
    --data-binary <span class="s1">'{"url":"agave://data.agaveapi.co/nryan/foo_project"}'</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/files/v2/media/system/nryan.storage2/
</code></pre>
<pre class="highlight plaintext"><code>files-import -v -U "agave://data.agaveapi.co/nryan/foo_project" -S nryan.storage1

files-import -v -U "agave://data.agaveapi.co/nryan/foo_project" -S nryan.storage2
</code></pre>

<aside class="notice">Notice in the above examples that the Files services works identically regardless of whether the source is a file or directory. If the source is a file, it will copy the file. If the source is a directory, it will recursively process the contents until everything has been copied.</aside>

<h3 id="basic-data-operations">Basic data operations</h3>

<p>Now that we understand how to move data into, out of, and between systems, we will look at how to perform file operations on the data. Again, remember that the Files service gives you a common REST interface to all your storage and execution systems regardless of the authentication mechanism or protocol they use. The examples below will use your default public storage system, but they would work identically with any storage system you have access to.</p>

<h4 id="directory-listing">Directory listing</h4>

<blockquote>
<p>Listing a file or directory</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/files/v2/listings/data.agaveapi.co/nryan
</code></pre>
<pre class="highlight plaintext"><code>files-list -v -S data.agaveapi.co nryan
</code></pre>

<blockquote>
<p>The response would look something like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"folder"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"lastModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-08-03T06:30:12.000-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"length"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nt">"mimeType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text/directory"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"."</span><span class="p">,</span><span class="w">
        </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"permisssions"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ALL"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data.agaveapi.co"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dir"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/media/system/data.agaveapi.co/nryan"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/data.agaveapi.co"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
    </span><span class="nt">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"raw"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-09-10T19:47:44.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"length"</span><span class="p">:</span><span class="w"> </span><span class="mi">3235</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mimeType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text/plain"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"picksumipsum.txt"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan/picksumipsum.txt"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ALL"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data.agaveapi.co"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"file"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/media/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/data.agaveapi.co"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>Obtaining a directory listing, or information about a specific file is done by making a GET request on the <code class="prettyprint">/files/v2/listings/</code> resource.</p>

<p>The response to this contains a summary listing of the contents of your home directory on  <code class="prettyprint">data.agaveapi.co</code>. Appending a file path to your commands above would give information on a specific file.</p>

<h4 id="move-copy-rename-delete">Move, copy, rename, delete</h4>

<p>Basic file operations are available by sending a POST request the the <code class="prettyprint">/files/v2/media/</code> collection with the following parameters.</p>

<table>
    <thead>
        <tr>
            <th>Attribute</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>action</td>
            <td>The action you want to perform. Select one of &ldquo;move&rdquo;, &ldquo;copy&rdquo;, &ldquo;rename&rdquo;, &ldquo;mkdir&rdquo;.</td>
        </tr>
        <tr>
            <td>path</td>
            <td>Full path to the destination file or folder. This may be the name of a new directory or renamed file, or an absolute or relative Agave path where the file or directory should be copied/moved.</td>
        </tr>
    </tbody>
</table>

<h4 id="copying-files-and-directories">Copying files and directories</h4>

<blockquote>
<p>Copy a file item within the same system.</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -X POST <span class="se">\</span>
    --data-binary <span class="s1">'{"action":"copy","path":"$DESTPATH"}'</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/files/v2/media/system/data.agaveapi.co/<span class="nv">$PATH</span>
</code></pre>
<pre class="highlight plaintext"><code>files-copy -D $DESTPATH -S data.agaveapi.co $PATH
</code></pre>

<blockquote>
<p>The response from a copy operation will be a JSON object describing the new file or folder.</p>
</blockquote>
<pre class="highlight json"><code><span class="w">
</span></code></pre>

<p>Copying can be performed on any remote system. Unlike the Unix <code class="prettyprint">cp</code> command, all copy invocations in Agave will overwrite the destination target if it exists. In the event of a directory collision, the contents of the two directory trees will be merged with the source overwriting the destination. Any overwritten files will maintain their provenance records and have an additional entry added to record the copy operation.</p>

<h4 id="moving-files-and-directories">Moving files and directories</h4>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -X POST <span class="se">\</span>
    --data-binary <span class="s1">'{"action":"move","path":"$DESTPATH"}'</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/files/v2/media/system/data.agaveapi.co/<span class="nv">$PATH</span>
</code></pre>
<pre class="highlight plaintext"><code>files-move -D $DESTPATH -S data.agaveapi.co $PATH
</code></pre>

<blockquote>
<p>The response will reflect the new file item</p>
</blockquote>
<pre class="highlight json"><code></code></pre>

<p>Moving can be performed on any remote system. Moving a file or directory will overwrite the destination target if it exists. Unlike copy operations, the destination will be completely replaced by the source in the event of a collision. No merge will take place. Further, the provenance of the source will replace that of the target.</p>

<h4 id="renaming-files-and-directories">Renaming files and directories</h4>

<blockquote>
<p>Renaming a file item</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
   -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
   -X POST <span class="se">\</span>
   --data-binary <span class="s1">'{"action":"rename","path":"$NEWNAME"}'</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/files/v2/media/system/<span class="nv">$SYSTEM_ID</span>/<span class="nv">$PATH</span>
</code></pre>
<pre class="highlight plaintext"><code>files-rename -N $NEWNAME -S $SYSTEM_ID $PATH
</code></pre>

<blockquote>
<p>The response will reflect the renamed file item  </p>
</blockquote>
<pre class="highlight json"><code></code></pre>

<p>Renaming, like copying and moving, is only applicable within the context of a single system. Unlike on Unix systems, renaming and moving are not synonymous. When specifying a new name for a file or directory, the new name is relative to the parent directory of the original file or directory. Also, If a file or directory already exists with that name, the operation will fail and an error message will be returned. All provenance information will follow the renamed file or directory.</p>

<h4 id="creating-a-new-directory">Creating a new directory</h4>

<blockquote>
<p>Creating a new directory</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -X POST <span class="se">\</span>
    --data-binary <span class="s1">'{"action":"mkdir","path":"$NEWDIR"}'</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/files/v2/media/system/data.agaveapi.co/<span class="nv">$PATH</span>
</code></pre>
<pre class="highlight plaintext"><code>files-mkdir -N $NEWDIR -S $SYSTEM_ID $PATH
</code></pre>

<blockquote>
<p>The response will reflect the new directory</p>
</blockquote>
<pre class="highlight json"><code></code></pre>

<p>Creating a new directory is a recursive action in Agave. If the parent directories do not exist, they will be created on the fly. If a file or directory already exists with that name, the operation will fail and an error message will be returned.</p>

<h4 id="deleting-a-file-item">Deleting a file item</h4>

<blockquote>
<p>Deleting a file item</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -X DELETE <span class="se">\</span>
    https://public.tenants.agaveapi.co/files/v2/media/system/<span class="nv">$SYSTEM_ID</span>/<span class="nv">$PATH</span>
</code></pre>
<pre class="highlight plaintext"><code>files-delete -S $SYSTEM_ID $PATH
</code></pre>

<blockquote>
<p>A standard Agave response with an empty result value will be returned.</p>
</blockquote>

<p>As with creating a directory, deleting a file or directory is a recursive action in Agave. No prompt or warning will be given once the request is sent. It is up to you to implement such checks in your application logic and/or user interface.</p>

              <h3 id="file-history">File history</h3>

<p>A full history of changes, permissions changes, and access events made through the Files API is recorded for every file and folder on registered <a href="#systems">Agave systems</a>. The recorded history events represent a subset of the events thrown by the Files API. Generally speaking, the events saved in a file item&rsquo;s history represent mutations on the physical file item or its metadata.</p>

<h4 id="direct-vs-indirect-events">Direct vs indirect events</h4>

<p>Agave will record both direct and indirect events made on a file item. Examples of direct events are transferring a directory from one system to another or renaming a file. Examples of indirect events are a user manually deleting a file from the command line. The table below contains a list of all the provenance actions recorded.</p>

<table>
    <thead>
        <tr>
            <th>Event</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>CREATED</td>
            <td>File or directory was created</td>
        </tr>
        <tr>
            <td>DELETED</td>
            <td>The file was deleted</td>
        </tr>
        <tr>
            <td>RENAME</td>
            <td>The file was renamed</td>
        </tr>
        <tr>
            <td>MOVED</td>
            <td>The file was moved to another path</td>
        </tr>
        <tr>
            <td>OVERWRITTEN</td>
            <td>The file was overwritten</td>
        </tr>
        <tr>
            <td>PERMISSION_GRANT</td>
            <td>A user permission was added</td>
        </tr>
        <tr>
            <td>PERMISSION_REVOKE</td>
            <td>A user permission was deleted</td>
        </tr>
        <tr>
            <td>STAGING_QUEUED</td>
            <td>File/folder queued for staging</td>
        </tr>
        <tr>
            <td>STAGING</td>
            <td>File or directory is currently in flight</td>
        </tr>
        <tr>
            <td>STAGING_FAILED</td>
            <td>Staging failed</td>
        </tr>
        <tr>
            <td>STAGING_COMPLETED</td>
            <td>Staging completed successfully</td>
        </tr>
        <tr>
            <td>PREPROCESSING</td>
            <td>Prepairing file for processing
        </td>
        </tr>
        <tr>
            <td>TRANSFORMING_QUEUED</td>
            <td>File/folder queued for transform</td>
        </tr>
        <tr>
            <td>TRANSFORMING</td>
            <td>Transforming file/folder</td>
        </tr>
        <tr>
            <td>TRANSFORMING_FAILED</td>
            <td>Transform failed</td>
        </tr>
        <tr>
            <td>TRANSFORMING_COMPLETED</td>
            <td>Transform completed successfully</td>
        </tr>
        <tr>
            <td>UPLOADED</td>
            <td>New content was uploaded to the file.</td>
        </tr>
        <tr>
            <td>CONTENT_CHANGED</td>
            <td>Content changed within this file/folder. If a folder, this event will be thrown whenever content changes in any file within this folder at most one level deep.</td>
        </tr>
    </tbody>
</table>

<h4 id="out-of-band-file-system-changes">Out of band file system changes</h4>

<p>Agave does not own the storage and execution systems you access through the Science APIs, so it cannot guarantee that everything that every possible change made to the file system is recorded. Thus, Agave takes a best-effort approach to provenance allowing you to choose, through your own use of best practices, how thorough you want the provenance trail of your data to be.</p>

<h4 id="listing-file-history">Listing file history</h4>

<blockquote>
<p>List the history of a file item</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    https://public.agaveapi.co/files/v2/history/nryan/picksumipsum.txt
</code></pre>
<pre class="highlight plaintext"><code>files-history -v nryan/picksumipsum.txt
</code></pre>

<blockquote>
<p>The response to this contains a summary listing all permissions on the</p>
</blockquote>
<pre class="highlight json"><code><span class="err">$</span><span class="w"> </span><span class="err">files-history</span><span class="w"> </span><span class="err">-v</span><span class="w"> </span><span class="err">nryan/picksumipsum.txt</span><span class="w">
</span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DOWNLOAD"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-20T19:47:56.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"public"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"File was downloaded"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STAGING_QUEUED"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-20T19:48:12.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"File/folder queued for staging"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STAGING_COMPLETED"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-20T19:48:16.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Staging completed successfully"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"TRANSFORMING_COMPLETED"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-20T19:48:17.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Your scheduled transfer of http://129.114.97.92/picksumipsum.txt completed staging. You can access the raw file on iPlant Data Store at /home/nryan/picksumipsum.txt or via the API at https://public.agaveapi.co/files/v2/media/system/data.agaveapi.co//nryan/picksumipsum.txt."</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>Basic paginated listing of file item history events is available as shown in the example. Currently, the file history service is readonly. The only way to erase the history on a file item is to delete the file item through the API.</p>

<h4 id="searching-file-history">Searching file history</h4>

<blockquote>
<p>Search a file item&rsquo;s history</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    https://public.agaveapi.co/files/v2/history/nryan/picksumipsum.txt?limit<span class="o">=</span>2&amp;offset<span class="o">=</span>1&amp;createdBy.like<span class="o">=</span><span class="k">*</span>ryan
</code></pre>
<pre class="highlight plaintext"><code>files-history-search -v -l 2 -o 1 -S data.agaveapi.co nryan/picksumipsum.txt createdBy.like=*ryan
</code></pre>

<blockquote>
<p>The response is a JSON array of every action performed on the file by users with a username ending in <code class="prettyprint">ryan</code>.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"STAGING_QUEUED"</span><span class="p">,</span>
    <span class="s2">"created"</span><span class="p">:</span> <span class="s2">"2016-09-20T19:48:12.000-05:00"</span><span class="p">,</span>
    <span class="s2">"createdBy"</span><span class="p">:</span> <span class="s2">"nryan"</span><span class="p">,</span>
    <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"File/folder queued for staging"</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"STAGING_COMPLETED"</span><span class="p">,</span>
    <span class="s2">"created"</span><span class="p">:</span> <span class="s2">"2016-09-20T19:48:16.000-05:00"</span><span class="p">,</span>
    <span class="s2">"createdBy"</span><span class="p">:</span> <span class="s2">"nryan"</span><span class="p">,</span>
    <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"Staging completed successfully"</span>
  <span class="p">}</span>
<span class="p">]</span>
</code></pre>

<p>File histories can get rather lengthy over time. Full text search is available on the file history service using the standard <a href="#search">search syntax</a>.</p>

              <h3 id="file-metadata-management">File metadata management</h3>

<p>In many systems, the concept of metadata is directly tied to the notion of a file system. Agave takes a broader view of metadata and supports it as its own first class resource in the REST API. For more information on how to leverage metadata in Agave, please consult the <a href="#metadata" title="Metadata Tutorial">Metadata Guide</a>. In there we cover all aspects of how to manage, search, validate, and associate metadata across your entire digital lab.</p>

              <h3 id="file-permissions">File permissions</h3>

<p>Agave has a fine-grained permission model supporting use cases from creating and exposing readonly storage systems to sharing individual files and folders with one or more users. The permissions available for files items are listed in the following table. Please note that a user must have WRITE permissions to grant or revoke permissions on a file item.</p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>READ</td>
<td>User can view, but not edit or execute the resource</td>
</tr>
<tr>
<td>WRITE</td>
<td>User can edit, but not view or execute the resource</td>
</tr>
<tr>
<td>EXECUTE</td>
<td>User can execute, but not view or edit the resource</td>
</tr>
<tr>
<td>READ_WRITE</td>
<td>User can view and write the resource, but not execute</td>
</tr>
<tr>
<td>READ_EXECUTE</td>
<td>User can view and execute the resource, but not edit it</td>
</tr>
<tr>
<td>WRITE_EXECUTE</td>
<td>User can edit and execute the resource, but not view it</td>
</tr>
<tr>
<td>ALL</td>
<td>User has full control over the resource</td>
</tr>
<tr>
<td>NONE</td>
<td>User has all permissions revoked on the given resource</td>
</tr>
</tbody></table>

<h4 id="listing-all-permissions">Listing all permissions</h4>

<blockquote>
<p>List the permissions on a file item</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    <span class="s1">'https://public.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt?pretty=true''
</span></code></pre>
<pre class="highlight plaintext"><code>files-pems-list \
    -S data.agaveapi.co \
    nryan/picksumipsum.txt
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"permission"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"execute"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"recursive"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt?username.eq=nryan"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"file"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/files/v2/media/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>To list all permissions for a file item, make a GET request on the file item&rsquo;s permission collection</p>

<h4 id="list-permissions-for-a-specific-user">List permissions for a specific user</h4>

<blockquote>
<p>List the permissions on a file item for a given user</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
    https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt?username<span class="o">=</span>rclemens
</code></pre>
<pre class="highlight plaintext"><code>files-pems-list \
    -u rclemens \
    -S data.agaveapi.co \
    nryan/picksumipsum.txt
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"username"</span><span class="p">:</span><span class="s2">"rclemens"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"permission"</span><span class="p">:{</span><span class="w">
    </span><span class="nt">"read"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"write"</span><span class="p">:</span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:{</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt?username=rclemens"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"parent"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"profile"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.agaveapi.co/profiles/v2/rclemens"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Checking permissions for a single user is done using agave URL query search syntax.</p>

<h4 id="grant-permissions">Grant permissions</h4>

<blockquote>
<p>Grant read access to a file item</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -X POST <span class="se">\</span>
    --data <span class="s1">'{"username":"rclemens", "permission":"READ"}'</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt
</code></pre>
<pre class="highlight plaintext"><code>files-pems-update 
    -u rclemens \
    -p READ \
    -S data.agaveapi.co \
    nryan/picksumipsum.txt
</code></pre>

<blockquote>
<p>Grant read and write access to a file item</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -X POST <span class="se">\</span>
    --data <span class="s1">'{"username","rclemens", "permission":"READ_WRITE"}'</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt
</code></pre>
<pre class="highlight plaintext"><code>files-pems-addupdate 
    -u rclemens \
    -p READ_WRITE \
    -S data.agaveapi.co \
    nryan/picksumipsum.txt
</code></pre>

<blockquote>
<p>The response will look something like the following</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rclemens"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"permission"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"execute"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"recursive"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt?username.eq=rclemens"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"file"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/files/v2/media/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/rclemens"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>To grant another user read access to your metadata item, assign them <code class="prettyprint">READ</code> permission. To enable another user to update a file item, grant them <code class="prettyprint">READ_WRITE</code> or <code class="prettyprint">ALL</code> access.</p>

<h4 id="delete-single-user-permissions">Delete single user permissions</h4>

<blockquote>
<p>Delete permission for single user on a file item</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
     -X POST <span class="se">\</span>
     --data <span class="s1">'{"username","rclemens", "permission":"NONE"}'</span> <span class="se">\</span>
     https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt
</code></pre>
<pre class="highlight plaintext"><code>files-pems-update  \
    -u rclemens \
    -p 'NONE' \
    -S data.agaveapi.co \
    nryan/picksumipsum.txt
</code></pre>

<blockquote>
<p>A response similiar to the following will be returned</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rclemens"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"permission"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nt">"execute"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"recursive"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt?username.eq=rclemens"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"file"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/files/v2/media/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/rclemens"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>Permissions may be deleted for a single user by making a DELETE request on the metadata user permission resource. This will immediately revoke all permissions to the file item for that user.</p>

<aside class="info">Please note that ownership cannot be revoked or reassigned. The user who created the metadata item will always have ownership of that item.</aside>

<h4 id="deleting-all-permissions">Deleting all permissions</h4>

<blockquote>
<p>Delete all permissions on a file item</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
     -X POST <span class="se">\</span>
     --data <span class="s1">'{"username","*", "permission":"NONE"}'</span> <span class="se">\</span>
     https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt

curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -X DELETE <span class="se">\</span>
     https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt
</code></pre>
<pre class="highlight plaintext"><code>files-pems-delete \
    -S data.agaveapi.co \
    nryan/picksumipsum.txt
</code></pre>

<blockquote>
<p>An empty response will be returned from the service.</p>
</blockquote>

<p>Permissions may be cleared for all users on a file item by making a DELETE request on the file item permission collection. In </p>

<aside class="info">The above operation will delete all permissions for a file item, such that only the owner will be able to access it. Use with care.</aside>

<h4 id="recursive-operations">Recursive operations</h4>

<blockquote>
<p>Recursively delete all permissions on a directory</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
     -X POST <span class="se">\</span>
     --data <span class="s1">'{"username","*", "permission":"READ_WRITE", "recursive": true}'</span> <span class="se">\</span>
     https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt

curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -X DELETE <span class="se">\</span>
     https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt?recursive<span class="o">=</span><span class="nb">true</span>
</code></pre>
<pre class="highlight plaintext"><code>files-pems-delete \
    --recursive \
    -S data.agaveapi.co \
    nryan/picksumipsum.txt
</code></pre>

<blockquote>
<p>An empty response will be returned from the service on delete. Update will return something like the following.</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"permission"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"execute"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"recursive"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt?username.eq=nryan"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"file"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/files/v2/media/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>When dealing with directories, the permission operations you perform will apply onto to the directory item itself. Permissions will not automatically propagate to the directory contents. In cases where you want to recursively apply permissions to the entire directory tree, you can do so by including the <code class="prettyprint">recursive</code> attribute in your permission objects or to your URL query parameters when making a DELETE request.</p>

              <h3 id="publishing-data">Publishing data</h3>

<p>Agave provides multiple ways to share your data with your colleagues and the general public. In addition to the standard permission model enabling you to share your data with one or more authenticated users within the Platform, you also have the ability to publish your data and make it available via an unauthenticated public URL. Unlike traditional web and cloud hosting, your data remains in its original location and is served in situ by Agave upon user request.</p>

<aside class="info">See the <a href="#postits">PostIts Guide</a> for other ways to securely share your data with others.</aside>

<h4 id="publishing-individual-files">Publishing individual files</h4>

<blockquote>
<p>Publish file item for public access</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -X POST <span class="se">\</span>
    --data <span class="s1">'{"username","public", "permission":"READ"}'</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt
</code></pre>
<pre class="highlight plaintext"><code>files-pems-addupdate \
    -u public \
    -p READ \
    -S data.agaveapi.co \
    nryan/picksumipsum.txt
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"public"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"permission"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"execute"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"recursive"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt?username.eq=$SHARE_USERNAME"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"file"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/$SHARE_USERNAME"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="publishing-directories">Publishing directories</h4>

<blockquote>
<p>Publish directory for public access</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -X POST <span class="se">\</span>
    --data <span class="s1">'{"username","public", "permission":"READ", "recursive": true}'</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/public
</code></pre>
<pre class="highlight plaintext"><code>files-pems-addupdate \
    --recursive \
    -u public \
    -p READ \
    -S data.agaveapi.co \
    nryan/public
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"public"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"permission"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"execute"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"recursive"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/public?username.eq=public"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"file"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/pems/system/data.agaveapi.co/nryan/public"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Publishing an entire directory is similar to publishing a single file item. Simply include a <code class="prettyprint">recursive</code> field to your request with a value of <code class="prettyprint">true</code>. Once published, the directory will be available through Agave&rsquo;s public download URLS. The structure of the directory&rsquo;s url is predictable. Each user has a unique namespace for their published data.</p>

<p><code class="prettyprint">https://public.agaveapi.co/files/v2/download/&lt;username&gt;/system/&lt;system_id&gt;/&lt;path&gt;</code>. </p>

<h4 id="publishing-considerations">Publishing considerations</h4>

<p>Publishing data through Agave can be a great way to share and access data. There are situations in which it may not be an ideal choice. We list several of the pitfalls user run into when publishing their data.</p>

<h5 id="large-file-publishing">Large file publishing</h5>

<p>Before publishing your large datasets, take a step back and consider how you might leverage the Files or Transfers API to reliable serve up your data. HTTP is not the fastest way to serve up the data, and it may not be the best usage pattern for applications hoping to consume it. Thinking through your use case is well worth the time, even if publishing ends up being the best approach.  </p>

<h5 id="static-website-hosting">Static website hosting</h5>

<p>Website hosting is a fairly common use case for data publishing. The challenge is that your assets are still hosted remotely from our API servers and fetched on demand. This can create some heavy latency when serving up lots of assets. Depending on the nature of your backend storage solution, it may not easily handle access patterns common to the web. In those situations, you may see some files fail to load from time to time. If your site has many files, even a small failure rate can keep your site from reliably loading. </p>

<p>If you are going to use the file publishing service for web hosting, the following tips can help improve your overall experience.</p>

<ol>
<li>Whenever possible, reference versions of your css, fonts, and javascript dependencies hosted on public CDN. CloudFlare, Google, and Amazon all host public mirrors of the most popular javascript libraries and frameworks. Linking to those can greatly speed up your load time.</li>
<li>Use a technology like <code class="prettyprint">Webpack</code> to reduce the number of files needed to serve your application.<br></li>
<li>Lazy load your assets with <code class="prettyprint">oclazyload</code>, <code class="prettyprint">requirejs</code> or including <code class="prettyprint">async</code> attributes on your <code class="prettyprint">&lt;script&gt;</code> elements.<br></li>
<li>Store your assets on a storage system with as little connection and protocol overhead as possible. That means avoiding tape archives, gridftp, overprovisioned shared resources, and systems only accessible through a proxied connection. While the service will still work in all of these situations, it is common for the overhead involved in establishing a connection and authenticating to take longer than the actual file transfer when the file is small. Simply avoiding slower storage protocols can greating speed up your application&rsquo;s load time.</li>
</ol>

              <h2 id="apps">Apps</h2>
<pre class="highlight json"><code><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">
 </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$$$$$</span><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">  </span><span class="err">/$$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$$$$$$$/$$__</span><span class="w">  </span><span class="err">$$/$$__</span><span class="w">  </span><span class="err">$$/$$_____/</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$|</span><span class="w">  </span><span class="err">$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$\____</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$$$$$$|</span><span class="w"> </span><span class="err">$$$$$$$//$$$$$$$/</span><span class="w">
</span><span class="err">|__/</span><span class="w">  </span><span class="err">|__|</span><span class="w"> </span><span class="err">$$____/|</span><span class="w"> </span><span class="err">$$____/|_______/</span><span class="w">
         </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
         </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
         </span><span class="err">|__/</span><span class="w">     </span><span class="err">|__/</span><span class="w">
</span></code></pre>

<p>An app, in the context of Agave, is an executable code available for invocation through Agave&rsquo;s Jobs service on a specific execution system. Put another way, an app is a piece of code that you can run on a specific system. If a single code needs to be run on multiple systems, each combination of app and system needs to be defined as an app.</p>

<p>Apps are language agnostic and may or may not carry with them their own dependencies. (More on bundling your app in a moment.) Any code that can be forked at the command line or submitted to a batch scheduler can be registered as an Agave app and run through the Jobs service.</p>

<p>The Apps service is the central registry for all Agave apps. The Apps service provides permissions, validation, archiving, and revision information about each app in addition to the usual discovery capability. The rest of this tutorial explains in detail how to register an app to the Apps service, how to manage and share apps, and what the different application scopes mean.</p>

              <h3 id="app-history">App History</h3>

              <h3 id="inputs-and-parameters">Inputs and Parameters</h3>

<p>In this section we take a detailed look at the <code class="prettyprint">inputs</code> and <code class="prettyprint">parameters</code> sections of your app descriptions. Each of these sections takes an array of JSON objects. Each JSON object represents either a data source that needs staging in prior to job execution or a primary value passed into your app as a parameter. In either case, the JSON object only requires an <code class="prettyprint">id</code> by which to reference the object in a job request, and a <code class="prettyprint">type</code> field indicating primary type if the object represents a parameter.</p>

<p>In practice, you will want to add some descriptive information, constraints, and runtime validation checks to reduce the amount of error users can run into when attempting to run your app. The full lists of app input and parameter attributes are provided in their respective sections below. However, before we dive deeper into the next section on app inputs, let&rsquo;s first get a big picture view of what we are doing when we define our app&rsquo;s input and parameters.</p>

<p><img src="/images/2014/10/App-Job-Information-Flow-1.png" alt="Input and Parameter Information Flow" width="960" height="720" class="aligncenter size-full wp-image-1661" /></p>

<p>When a user submits a job request in step 1, they specify the inputs and parameters needed to run that job. Those attributes are defined in your app description. The Jobs service will use your app description to validate the values in the job request and either reject it with a descriptive error message as in step 2, or accept it as in step 4. Once the job request is accepted, the values provided for the inputs and parameters given in the job request are used to replace their corresponding template placeholder values in the wrapper script. For example, the job request assigned a value of <em>foo</em> for the input with id equal to <em>input1</em>. Before submitting the job request to the remote system, the Jobs service will replace all occurrences of <code class="prettyprint">${input1}</code> in the app wrapper script with <em>foo</em>. The same will happen with <em>param1</em> and <em>param2</em>. All occurrences of <code class="prettyprint">${param1}</code> will be replaced with <em>bar</em> and all occurrences of <code class="prettyprint">${param2}</code> will be replaced with <em>2</em>, just as specified in the job request.</p>

<aside class="notice">Notice that Agave will not handle variable quoting for you. It is up to you to handle any type casting, escaping, and quoting of template values necessary for your app&rsquo;s logic.</aside>

<p>As we look at how to define inputs and parameters for your app, keep this big picture in mind. The purpose of inputs is to specify data that need to be staged prior to your job running and to tell your wrapper script about them. The purpose of parameters is to specify variables that need to be passed to your wrapper script. To do this, we only need a simple id by which to reference the values in a job request. The rest of what we will discuss in this tutorial is the mechanism that Agave provides for you to validate, describe, discover, and restrict application inputs and parameters to provider better user and developer experiences using your app.</p>

<h4 id="inputs">Inputs</h4>

<p>The <code class="prettyprint">inputs</code> attribute of your app description contains a JSON array of input objects. An input represents one or more pieces of data that your app will use at runtime. That data can be a single file, a directory, or a response from a web service. It can reside on a system that Agave knows about, or at a publicly accessible URL. Regardless of where it lives and what it is, Agave will grab the data (recursively if need be) and copy it to your job&rsquo;s working directory just before execution.</p>

<aside class="notice">In the Job management tutorial, we talk in detail about the job lifecycle. Here we simply point out that Agave will handle the staging of your app&rsquo;s <span class="code">deploymentPath</span> separately from the staging of your assets. Thus, as a best practice, it is preferable to include all of the assets your app needs to run in your <span class="code">deploymentPath</span> rather than defining them as inputs. This will allow Agave to make better caching decisions and reduce the overall throughput when running a job.</aside>

<p>A minimal input object contains a single <code class="prettyprint">inputs.[].id</code> attribute that uniquely identifies it within the context of your app. Any alphanumeric value under 64 characters can be an identifier, but it must be unique among all the inputs and parameters in that app.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"input1"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Most of the time, such a minimal definition is not helpful. At the very least, you would want some descriptive information, a restriction on the cardinality, and potentially a default value. This can be achieved with the <code class="prettyprint">details</code>, <code class="prettyprint">semantics</code>, and <code class="prettyprint">value</code> objects. The full list of input attributes is shown in the following table. We cover each attribute in the corresponding section below.</p>

<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>id</td>
            <td>String</td>
            <td><em>Required</em>: The textual id of this input. This value must be unique within all inputs and inputs for an app description.</td>
        </tr>
        <tr>
            <td>details</td>
            <td>JSON object</td>
            <td></td>
        </tr>
        <tr>
            <td>details.argument</td>
            <td>string</td>
            <td>A command line argument or flag to be prepended before the input value.</td>
        </tr>
        <tr>
            <td>details.description</td>
            <td>string</td>
            <td>Human-readable description of the input. Often used to create contextual help in automatically generated UI.</td>
        </tr>
        <tr>
            <td>details.label</td>
            <td>string</td>
            <td>Human-readable label for the input. Often implemented as text label next to the field in automatically generated UI.</td>
        </tr>
        <tr>
            <td>details.showArgument</td>
            <td>boolean</td>
            <td>Whether to include the argument value for this input when performing the template variable replacement during job submission. If true, the <code>details.argument</code> value will be prepended, without spaces, to the actual input value(s).</td>
        </tr>
        <tr>
            <td>details.repeatArgument</td>
            <td>boolean</td>
            <td>When multiple values are provided for this input, this attribute determines whether to include the argument value  before each user-supplied value when performing the template variable replacement during job submission. The <code>details.showArgument</code> value must be <i>true</i> for this value to be applied.</td>
        </tr>
        <tr>
            <td>semantics</td>
            <td>JSON object</td>
            <td>Describes the semantic definition of this inputs and the filetypes it represents. Multiple ontologies and values are supported.</td>
        </tr>
        <tr>
            <td>semantics.fileTypes</td>
            <td>JSON array</td>
            <td>Array of string values describing the file types represented by this input. The types correspond to values from the Transforms service. Use &ldquo;raw-0&rdquo; for the time being</td>
        </tr>
        <tr>
            <td>semantics.minCardinality</td>
            <td>integer</td>
            <td>Minimum number of values this input must have. </td>
        </tr>
        <tr>
            <td>semantics.maxCardinality</td>
            <td>integer</td>
            <td>Maximum number of values this input can have. A null value or value of -1 indicates no limit.</td>
        </tr>
        <tr>
            <td>semantics.ontology</td>
            <td>JSON array</td>
            <td>List of ontology terms (or URIs pointing to ontology terms) applicable to the input. We recommend at least specifying an <a href="http://www.schemacentral.com/sc/xsd/s-datatypes.xsd.html">XSL Schema Simple Type</a>.</td>
        </tr>
        <tr>
            <td>value</td>
            <td>JSON object</td>
            <td>A description of the anticipated value and the situations when it is required.</td>
        </tr>
        <tr>
            <td>value.default</td>
            <td>string, JSON array</td>
            <td>The default value for this input. This value is optional except when <code>value.required</code> is <i>true</i> and <code>value.visible</code> is <i>false</i>. Values may be absolute or relative paths on the user&rsquo;s default storage sytem, an agave URI, or any valid URL with a supported schema.</td>
        </tr>
        <tr>
            <td>value.order</td>
            <td>integer</td>
            <td>The order in which this input should appear when auto-generating a command line invocation.</td>
        </tr>
        <tr>
            <td>value.required</td>
            <td>boolean</td>
            <td><em>Required</em>: Is specification of this input mandatory to run a job?</td>
        </tr>
        <tr>
            <td>value.validator</td>
            <td>string</td>
            <td><a href="Perl-formatted regular expression to restrict valid values">Perl-formatted regular expression</a> to restrict valid values.</td>
        </tr>
        <tr>
            <td>value.visible</td>
            <td>boolean</td>
            <td>When automatically generated a UI, should this field be visible to end users? If <i>false</i>, users will not be able to set this value in their job request.</td>
        </tr>
        <tr>
            <td>value.enquote</td>
            <td>boolean</td>
            <td>Should the value be surrounded in quotation marks prior to injecting into the wrapper template at job runtime.</td>
        </tr>
    </tbody>
</table>

<h4 id="input-details-section">Input details section</h4>

<p>The <code class="prettyprint">inputs.[].details</code> object contains information specifying how to describe an input in different contexts. The <code class="prettyprint">description</code> and <code class="prettyprint">label</code> values provide human readable information appropriate for a tool tip and form label respectively. Neither of these attributes are required, however they dramatically improve the readability of your app description if you include them.</p>

<p>Often times you will need to translate your input value into actual command line arguments. By default, Agave will replace all occurrences of your attribute <code class="prettyprint">inputs.[].id</code> in your wrapper script with the value of that attribute in your job description. That means that you are responsible for inserting any command line flags or arguments into the wrapper script yourself. This is a pretty straightforward process, however in situations where an input is optional, the resulting command line could be broken if the user does not specify an input value in their job request. One way to work around this is to add a conditional check to the variable assignment and exclude the command line flag or argument if it does not have a value set. Another is to use the <code class="prettyprint">inputs.[].details.argument</code> attribute.</p>

<p>The <code class="prettyprint">inputs.[].details.argument</code> value describes the command line argument that corresponds to this input, and the <code class="prettyprint">inputs.[].details.showArgument</code> attribute specifies whether the <code class="prettyprint">inputs.[].details.argument</code> value should be injected into the wrapper template in front of the actual runtime value. The following table illustrates the result of these attributes in different scenarios.</p>

<table>
    <thead>
        <tr>
            <th><code>argument</code></th>
            <th><code>showArgument</code></th>
            <th>Input value from job request</th>
            <th>Value injected into wrapper template</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td></td>
            <td>true</td>
            <td>/etc/motd</td>
            <td>/etc/motd</td>
        </tr>
        <tr>
            <td>-f</td>
            <td>true</td>
            <td>/etc/motd</td>
            <td>-f/etc/motd</td>
        </tr>
        <tr>
            <td>-f (trailing space)</td>
            <td>true</td>
            <td>/etc/motd</td>
            <td>-f /etc/motd</td>
        </tr>
        <tr>
            <td>-f</td>
            <td>false</td>
            <td>/etc/motd</td>
            <td>/etc/motd</td>
        </tr>
        <tr>
            <td>&ndash;filename</td>
            <td>true</td>
            <td>/etc/motd</td>
            <td>&ndash;filename/etc/motd</td>
        </tr>
        <tr>
            <td>&ndash;filename=</td>
            <td>true</td>
            <td>/etc/motd</td>
            <td>&ndash;filename=/etc/motd</td>
        </tr>
        <tr>
            <td>&ndash;filename</td>
            <td>false</td>
            <td>/etc/motd</td>
            <td>/etc/motd</td>
        </tr>
    </tbody>
</table>

<h4 id="input-semantics-section">Input semantics section</h4>

<p>The <code class="prettyprint">inputs.[].semantics</code> object contains semantic information about the input. The <code class="prettyprint">minCardinality</code> attribute specifies the minimum number of data sources that can be specified for the input. This attribute is used to validate the value(s) provided for the input in a job request. The <code class="prettyprint">ontology</code> attribute specifies a JSON array of URLs pointing to the ontology definitions of this file type. (We recommend at least specifying an <a href="http://www.schemacentral.com/sc/xsd/s-datatypes.xsd.html" title="XSL Schema Simple Type" target="_blank">XSL Schema Simple Type</a>.) Finally, the <code class="prettyprint">fileTypes</code> attribute contains a JSON array of file type strings as specified in the transforms service. (In most situations you will leave the fileTypes attribute null or specify <em>RAW-0</em> as the single file type in the array.)</p>

<h4 id="input-value-section">Input value section</h4>

<p>The <code class="prettyprint">inputs.[].value</code> object contains the information needed to validate user-supplied input values in a job request. The <code class="prettyprint">validator</code> attribute accepts a Perl regular expression which will be applied to the input value(s). Any submissions that do not match the <code class="prettyprint">validator</code> expression will be rejected.</p>

<aside class="notice">If <span class="code">inputs[].semantics.minCardinality</span> is greater than 1, multiple values will be accepted for input. These values may be provided in a semicolon delimited list or in a JSON array. The values may be relative paths to the user&rsquo;s default storage system, or URLs. Whatever value(s) the user provides, the validator will be applied independently to the entire value, not just the name.</aside>

<p>The <code class="prettyprint">default</code> attribute allows you to specify a default value for the input. This will be used in leu of a user-supplied value if the input is <code class="prettyprint">required</code>, but not <code class="prettyprint">visible</code>. All default values must match the <code class="prettyprint">validator</code> expression, if provided.</p>

<p>The <code class="prettyprint">required</code> attribute specifies whether the input must be specified during a job submission.</p>

<p>The <code class="prettyprint">visible</code> attribute takes a boolean value specifying whether the input should be accepted as as a user-supplied value in a job requests. If false, the value will be ignored at job submission and the <code class="prettyprint">default</code> value will be used instead. Whenever <code class="prettyprint">visible</code> is set to false, <code class="prettyprint">required</code> must be true.</p>

<p>The <code class="prettyprint">order</code> attribute is used to specify the order in which inputs should be listed in the response from the API and in command-line generation. By default, <code class="prettyprint">order</code> is set to zero. Thus, providing a value greater than zero is sufficient to force any single input to be listed last.</p>

<h4 id="validating-inputs">Validating inputs</h4>

<p>The previous section covered different ways you can specify for Agave to validate and restrict the data inputs to your app. When a user submits an job request, the order in which they are applied is as follows.</p>

<ol>
<li>visible</li>
<li>required</li>
<li>minCardinality</li>
<li>maxCardinality</li>
<li>validator</li>
</ol>

<p>Once an input passes these tests, Agave will check that it exists and that the user has permission to access the data. Assuming everything passes, the input is accepted and scheduled for staging.</p>

<h4 id="parameters">Parameters</h4>

<p>The <code class="prettyprint">parameters</code> attribute of your app description contains a JSON array of parameter objects. A parameter represents one or more arguments that your app will use at runtime. Those arguments can be more or less anything you want them to be. If, for some reason, your app handles data staging on its own and you do not want Agave to move the data on your behalf, but you do need a data reference passed in, you can define it as a parameter rather than an input.</p>

<p>A minimal parameter object contains a single <code class="prettyprint">id</code> attribute that uniquely identifies it within the context of your app and a <code class="prettyprint">value.type</code> attribute specifying the primary type of the parameter. Any alphanumeric value under 64 characters can be an identifier, but it must be unique among all the inputs and parameters in that app. The parameter type is restricted to a handful of primary types listed in the table below.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"parameter1"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>In most situations you will want some descriptive information and validation of the user-supplied values for this parameter. As with your app inputs, app parameters have <code class="prettyprint">details</code>, <code class="prettyprint">semantics</code>, and <code class="prettyprint">value</code> objects that allow you to do just that. The full list of parameter attributes is shown in the following table. We cover each attribute in the corresponding section below.</p>

<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>id</td>
            <td>String</td>
            <td><em>Required</em>: The textual id of this parameter. This value must be unique within all parameters and parameters for an app description.</td>
        </tr>
        <tr>
            <td>details</td>
            <td>JSON object</td>
            <td></td>
        </tr>
        <tr>
            <td>details.argument</td>
            <td>string</td>
            <td>A command line argument or flag to be prepended before the parameter value.</td>
        </tr>
        <tr>
            <td>details.description</td>
            <td>string</td>
            <td>Human-readable description of the parameter. Often used to create contextual help in automatically generated UI.</td>
        </tr>
        <tr>
            <td>details.label</td>
            <td>string</td>
            <td>Human-readable label for the parameter. Often implemented as text label next to the field in automatically generated UI.</td>
        </tr>
        <tr>
            <td>details.showArgument</td>
            <td>boolean</td>
            <td>Whether to include the argument value for this parameter when performing the template variable replacement during job submission. If true, the <code>details.argument</code> value will be prepended, without spaces, to the actual parameter value(s).</td>
        </tr>
        <tr>
            <td>details.repeatArgument</td>
            <td>boolean</td>
            <td>When multiple values are provided for this input, this attribute determines whether to include the argument value  before each user-supplied value when performing the template variable replacement during job submission. The <code>details.showArgument</code> value must be <i>true</i> for this value to be applied.</td>
        </tr>
        <tr>
            <td>semantics</td>
            <td>JSON object</td>
            <td>Describes the semantic definition of this parameters and the filetypes it represents. Multiple ontologies and values are supported.</td>
        </tr>
        <tr>
            <td>semantics.minCardinality</td>
            <td>integer</td>
            <td>Minimum number of values this parameter must have. </td>
        </tr>
        <tr>
            <td>semantics.maxCardinality</td>
            <td>integer</td>
            <td>Maximum number of values this parameter can have. A null value or value of -1 indicates no limit.</td>
        </tr>
        <tr>
            <td>semantics.ontology</td>
            <td>JSON array</td>
            <td>List of ontology terms (or URIs pointing to ontology terms) applicable to the parameter. We recommend at least specifying an <a href="http://www.schemacentral.com/sc/xsd/s-datatypes.xsd.html">XSL Schema Simple Type</a>.</td>
        </tr>
        <tr>
            <td>value</td>
            <td>JSON object</td>
            <td>A description of the anticipated value and the situations when it is required.</td>
        </tr>
        <tr>
            <td>value.default</td>
            <td>string, JSON array</td>
            <td>The default value for this parameter. This value is optional except when <code>value.required</code> is <i>true</i> and <code>value.visible</code> is <i>false</i>. If the <code>value.type</code> is of this parameter is <i>enumeration</i>, this value must be one of the specified <code>value.enumValues</code>. If the <code>value.type</code> is of this parameter is <i>bool</i> or <i>flag</i>, then only boolean values are accepted here.</td>
        </tr>
        <tr>
            <td>value.enumValues</td>
            <td>JSON array</td>
            <td>An array of values specifying the possible values this parameter may have when <code>value.type</code> is <i>enumeration</i>. Both JSON Objects and strings are supported in the array. If a JSON Object is given, the object must be a single value attribute. The key will be the value passed into the wrapper template. The value will be the display value shown when auto-generating the option element in the select box representing this input.</td>
        </tr>
        <tr>
            <td>value.order</td>
            <td>integer</td>
            <td>The order in which this parameter should appear when auto-generating a command line invocation.</td>
        </tr>
        <tr>
            <td>value.required</td>
            <td>boolean</td>
            <td><em>Required</em>: Is specification of this parameter mandatory to run a job?</td>
        </tr>
        <tr>
            <td>value.type</td>
            <td>string, number, enumeration, bool, flag</td>
            <td>JSON type for this parameter (used to generate and validate UI).</td>
        </tr>
        <tr>
            <td>value.validator</td>
            <td>string</td>
            <td><a href="Perl-formatted regular expression to restrict valid values">Perl-formatted regular expression</a> to restrict valid values.</td>
        </tr>
        <tr>
            <td>value.visible</td>
            <td>boolean</td>
            <td>When automatically generated a UI, should this field be visible to end users? If <i>false</i>, users will not be able to set this value in their job request.</td>
        </tr>
        <tr>
            <td>value.enquote</td>
            <td>boolean</td>
            <td>Should the value be surrounded in quotation marks prior to injecting into the wrapper template at job runtime.</td>
        </tr>
    </tbody>
</table>

<h4 id="parameter-details-section">Parameter details section</h4>

<p>The <code class="prettyprint">parameters.[].details</code> object contains information specifying how to describe a parameter in different contexts and is identical to the <code class="prettyprint">inputs.[].details</code> object.</p>

<h4 id="parameter-semantics-section">Parameter semantics section</h4>

<p>The <code class="prettyprint">parameters.[].semantics</code> object contains semantic information about the parameter. Unlike the <code class="prettyprint">inputs.[].semantics</code> object, it only has a single attribute, <code class="prettyprint">ontology</code>. The <code class="prettyprint">ontology</code> attribute specifies a JSON array of URLs pointing to the ontology definitions of this parameter type. (We recommend at least specifying an <a href="http://www.schemacentral.com/sc/xsd/s-datatypes.xsd.html" title="XSL Schema Simple Type" target="_blank">XSL Schema Simple Type</a>.)</p>

<h4 id="parameter-value-section">Parameter value section</h4>

<p>The <code class="prettyprint">parameters.[].value</code> object contains the information needed to validate user-supplied parameter values in a job request. The <code class="prettyprint">type</code> attribute defines the primary type of this parameter&rsquo;s values. The available types are:</p>

<ul>
<li><em>number</em>: any real number </li>
<li><em>string</em>: any json-escaped alphanumeric string. </li>
<li><em>bool</em>: true or false</li>
<li><em>flag</em>: true or false. Identical to boolean, but only the `argument` value will be inserted into the wrapper template.</li>
<li><em>enumeration</em>: a JSON array of strings values or JSON objects representing the acceptable values for this parameter. If an array of JSON objects is given, each object should have a single attribute with the key being a desired enumeration value, and the value being a human readable descriptive name for the enumerated value. The value of using objects vs strings is that object values provide a way to create more descriptive user interfaces by customizing both the content and value of a HTML select box&rsquo;s option elements. An example of both is given below.</li>
</ul>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="s2">"red"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"white"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"green"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"black"</span><span class="w">
</span><span class="p">]</span><span class="w">

</span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nt">"red"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deep Cherry Red"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nt">"white"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bright White"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nt">"green"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Black Forest Green"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nt">"black"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Brilliant Black Crystal Pearl"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>The <code class="prettyprint">validator</code> attribute accepts a Perl regular expression which will be applied to the input value(s). Any submissions that do not match the <code class="prettyprint">validator</code> expression will be rejected. This attribute is available both to parameters of type <em>number</em> and <em>string</em>. It is not available to <em>bool</em> or <em>flag</em> parameter types, or to <em>enumeration</em> parameters as they require the <code class="prettyprint">enumValues</code> attribute instead.</p>

<p>The <code class="prettyprint">default</code> attribute allows you to specify a default value for the parameter. This will be used in leu of a user-supplied value if the parameter is <code class="prettyprint">required</code>, but not <code class="prettyprint">visible</code>. All default values must match the appropriate <code class="prettyprint">validator</code> if <code class="prettyprint">type</code> is <em>number</em> or <em>string</em>, or be one of the values in the <code class="prettyprint">enumValues</code> array if <code class="prettyprint">type</code> is <em>enumeration</em>.</p>

<p>The <code class="prettyprint">enumValues</code> attribute is a JSON array of alphanumeric values specifying the acceptable values for this input. This attribute only exists for <em>enumeration</em> parameter types.</p>

<p>The <code class="prettyprint">required</code> attribute specifies whether the parameter must be specified during a job submission.</p>

<p>The <code class="prettyprint">visible</code> attribute takes a boolean value specifying whether the parameter should be accepted as as a user-supplied value in a job requests. If false, the value will be ignored at job submission and the <code class="prettyprint">default</code> value will be used instead. Whenever <code class="prettyprint">visible</code> is set to false, <code class="prettyprint">required</code> must be true.</p>

<p>The <code class="prettyprint">order</code> attribute is used to specify the order in which parameters should be listed in the response from the API and in command-line generation. By default, <code class="prettyprint">order</code> is set to 0. Thus, providing a value greater than zero is sufficient to force any single parameter to be listed last.</p>

<h4 id="validating-inputs">Validating inputs</h4>

<p>The previous section covered different ways you can tell for Agave to validate and restrict the parameters to your app. When a user submits an job request, the order in which they are applied is as follows.</p>

<ol>
<li>visible</li>
<li>required</li>
<li>type</li>
<li>validator / enumValues</li>
</ol>

              <h3 id="wrapper-templates">Wrapper Templates</h3>

<p>In order to run your application, you will need to create a wrapper template that calls your executable code. The wrapper template is a simple script that Agave will filter and execute to start your app. The filtering Agave applies to your wrapper script is to inject runtime values from a job request into the script to replace the template variables representing the inputs and parameters of your app.</p>

<p>The order in which wrapper templates are processed in HPC and Condor apps is as follows.</p>

<p>1. <code class="prettyprint">environment</code> variables injected.
    2. <code class="prettyprint">startupScript</code> run.
    3. Scheduler directives prepended to the wrapper template.
    4. <code class="prettyprint">additionalDirectives</code> concatenated after the scheduler directives.
    5. Custom <code class="prettyprint">modules</code> concatenated after the additionalDirectives.
    6. <code class="prettyprint">inputs</code> and <code class="prettyprint">parameters</code> template variables replaced with values from the job request.
    7. Blacklist commands, if present, are disabled in the scripts.
    8. Resulting script is written to the remote job execution folder and executed.</p>

<p>The order in which wrapper templates are processed in CLI apps is as follows.</p>

<p>1. Shell environment sourced
    2. <code class="prettyprint">environment</code> variables injected
    3. <code class="prettyprint">startupScript</code> run
    4. Custom <code class="prettyprint">modules</code></span><code class="prettyprint">prepended to the top of the wrapper
    5.</code>inputs<code class="prettyprint">and</code>parameters` template variables replaced with values from the  job request
    6. Blacklist commands, if present, are disabled in the scripts.
    7. Resulting script is forked into the background immediately.</p>

<h4 id="environment">Environment</h4>

<p>Comes from the system definition. Handle in your script if you cannot change the system definition to suite your needs. Ship whatever you need with your app&rsquo;s assets.</p>

<h4 id="modules">Modules</h4>

<p>See more about <a href="http://modules.sourceforge.net/" title="The Environment Modules Project" target="_blank">Modules</a> and <a href="https://github.com/TACC/Lmod" title="Lmod: An Environment Module System based on Lua" target="_blank">Lmod</a>. Can be used to customize your environment, locate your application, and improve portability between systems. Agave does not install or manage the module installation on a particular system, however it does know how to interact with it. Specifying the modules needed to run your app either in your wrapper template or in your system definition can greatly help you during the development process.</p>

<h4 id="input-data">Input data</h4>

<p>Agave will stage the files and folders you specify as inputs to your app. These will be available in the top level of your job directory at runtime. Additionally, the names of each of the inputs will be injected into your wrapper template for you to use in your application logic. Please be aware that Agave will not attempt to resolve namespace conflicts between your app inputs. That means that if a job specifies two inputs with the same name, one will overwrite the other during the input staging phase of the job and, though the variable names will be correctly injected to the wrapper script, your job will most likely fail due to missing data.</p>

<h4 id="variable-injection">Variable injection</h4>

<p>If you refer back to the app definition we used in the App Management Tutorial, you will see there are multiple inputs and parameters defined for that app. Each input and parameter object had an <code class="prettyprint">id</code> attribute. That <code class="prettyprint">id</code> value is the attribute name you use to associate runtime values with app inputs and parameters. When a job is submitted to Agave, prior to physically running the wrapper template, all instances of that <code class="prettyprint">id</code> are replaced with the actual value from the job request. For example, the following example shows our app description, a job request, and the resulting wrapper template at run time.</p>

<h4 id="type-declarations">Type declarations</h4>

<p>During the jobs submission process, Agave will store your inputs and parameters as serialized JSON. At the point that variable injection occurs, Agave will</p>

<h4 id="boolean-values">Boolean values</h4>

<h4 id="cardinality">Cardinality</h4>

<h4 id="validation">Validation</h4>

<h4 id="parameter-flags">Parameter Flags</h4>

<h3 id="app-packaging">App packaging</h3>

<p>Agave API apps have a generalized structure that allows them to carry dependencies around with them. In the case below, <em>package-name-version.dot.dot</em> is a folder that you build on your local system, then store in your Agave Cloud Storage in a designated location (we recommend /home/<username>/applications/<app folder name>). It contains binaries, support scripts, test data, etc. all in one package. Agave basically uses a very rough form of containerized applications (more on this later). We suggest you set your apps up to look something like the following:</p>
<pre class="highlight plaintext"><code>package-name-version.dot.dot
|--system_name
|----bin.tgz (optional)
|----lib.tgz (optional)
|----include.tgz (optional)
|----test.sh
|----script.template
|----test_data (optional)
|----app.json
</code></pre>

<p>Agave runs a job by first transferring a copy of this directory into temporary directory on the target executionSystem. Then, the input data files (we&rsquo;ll show you how to specify those are later) are staged into place automatically. Next, Agave writes a scheduler submit script (using a template you provide i.e. script.template) and puts it in the queue on the target system. The Agave service then monitors progress of the job and, assuming it completes, copies all newly-created files to the location specified when the job was submitted. Along the way, critical milestones and metadata are recorded in the job&rsquo;s history.</p>

<p><em>Agave app development proceeds via the following steps:</em></p>

<ol>
<li>Build the application locally on the executionSystem</li>
<li>Ensure that you are able to run it directly on the executionSystem</li>
<li>Describe the application using an Agave app description</li>
<li>Create a shell template for running the app</li>
<li>Upload the application directory to a storageSystem</li>
<li>Post the app description to the Agave apps service</li>
<li>Debug your app by running jobs and updating the app until it works as intended</li>
<li>(Optional) Share the app with some friends to let them test it</li>
</ol>

<h3 id="build-a-samtools-application-bundle">Build a samtools application bundle</h3>
<pre class="highlight shell"><code><span class="c"># Log into Stampede</span>
ssh stampede.tacc.utexas.edu

<span class="c"># Unload system&amp;#039;s samtools module if it happens to be loaded by default</span>
module unload samtools

<span class="c"># All TACC systems have a directory than can be accessed as $WORK</span>
<span class="nb">cd</span> <span class="nv">$WORK</span>

<span class="c"># Set up a project directory</span>
mkdir iPlant
mkdir iPlant/src
mkdir -p iPlant/samtools-0.1.19/stampede/bin
mkdir -p iPlant/samtools-0.1.19/stampede/test

<span class="c"># Build samtools using the Intel C Compiler</span>
<span class="c"># If you don&amp;#039;t have icc, gcc will work but icc usually gives more efficient binaries</span>
<span class="nb">cd </span>iPlant/src
wget <span class="s2">"http://downloads.sourceforge.net/project/samtools/samtools/0.1.19/samtools-0.1.19.tar.bz2"</span>
tar -jxvf samtools-0.1.19.tar.bz2
<span class="nb">cd </span>samtools-0.1.19
make <span class="nv">CC</span><span class="o">=</span>icc

<span class="c"># Copy the samtools binary and support scripts to the project bin directory</span>
cp -R samtools bcftools misc ../../samtools-0.1.19/stampede/bin/
<span class="nb">cd</span> ../../samtools-0.1.19/stampede

<span class="c"># Test that samtools will launch</span>
bin/samtools

  Program: samtools <span class="o">(</span>Tools <span class="k">for </span>alignments <span class="k">in </span>the SAM format<span class="o">)</span>
  Version: 0.1.19-44428cd

  Usage:   samtools &amp;lt;command&amp;gt; <span class="o">[</span>options]

  Command: view        SAM&amp;lt;-&amp;gt;BAM conversion
           sort        sort alignment file
           mpileup     multi-way pileup...

<span class="c"># Package up the bin directory as an compressed archive</span>
<span class="c"># and remove the original. This preserves the execute bit</span>
<span class="c"># and other permissions and consolidates movement of all</span>
<span class="c"># bundled dependencies in bin to a single operation. You</span>
<span class="c"># can adopt a similar approach with lib and include.</span>
tar -czf bin.tgz bin &amp;amp;&amp;amp; rm -rf bin
</code></pre>

<h3 id="run-samtools-sort-locally">Run samtools sort locally</h3>

<p>Your first objective is to create a script that you know will run to completion under the Stampede scheduler and environment (or whatever executionSystem you&rsquo;re working on). It will serve as a model for the template file you create later. In our case, we need to write a script that can be submitted to the Slurm scheduler. The standard is to use Bash for such scripts. You have five main objectives in your script:
* Unpack binaries from bin.tgz
* Extend your PATH to contain bin
* Craft some option-handling logic to accept parameters from Agave
* Craft a command line invocation of the application you will run
* Clean up when you&rsquo;re done</p>

<p>First, you will need some test data in your current directory (i.e., $WORK/iPlant/samtools-0.1.19/stampede/ ). You can use this test file</p>
<pre class="highlight shell"><code>files-get -S data.agaveapi.co /shared/datasets/example_data/Samtools_mpileup/ex1.bam
</code></pre>

<p>or you can any other BAM file for your testing purposes. Make sure if you use another file to change the filename in your test script accordingly!</p>

<p>Now, author your script. You can paste the following code into a file called <em>test-sort.sh</em> or you can copy it from $IPLANT_SDK_HOME/examples/samtools-0.1.19/stampede/test-sort.sh</p>
<pre class="highlight shell"><code><span class="c">#!/bin/bash</span>

<span class="c"># Agave automatically writes these scheduler</span>
<span class="c"># directives when you submit a job but we have to</span>
<span class="c"># do it by hand when writing our test</span>

<span class="c">#SBATCH -p development</span>
<span class="c">#SBATCH -t 00:30:00</span>
<span class="c">#SBATCH -n 16</span>
<span class="c">#SBATCH -A iPlant-Collabs</span>
<span class="c">#SBATCH -J test-samtools</span>
<span class="c">#SBATCH -o test-samtools.o%j</span>

<span class="c"># Set up inputs and parameters</span>
<span class="c"># We&amp;#039;re emulating passing these in from Agave</span>
<span class="c"># inputBam is the name of the file to be sorted</span>
<span class="nv">inputBam</span><span class="o">=</span><span class="s2">"ex1.bam"</span>
<span class="c"># outputPrefix is a parameter that establishes</span>
<span class="c"># the prefix for the final sorted file</span>
<span class="nv">outputPrefix</span><span class="o">=</span><span class="s2">"sorted"</span>
<span class="c"># Parameter for memory used in sort operation, in bytes</span>
<span class="nv">maxMemSort</span><span class="o">=</span>500000000
<span class="c"># Boolean: Sort by name instead of coordinate</span>
<span class="nv">nameSort</span><span class="o">=</span>0

<span class="c"># Unpack the bin.tgz file containing samtools binaries</span>
<span class="c"># If you are relying entirely on system-supplied binaries</span>
<span class="c"># you don&amp;#039;t need this bit</span>
tar -xvf bin.tgz
<span class="c"># Extend PATH to include binaries in bin</span>
<span class="c"># If you need to extend lib, include, etc</span>
<span class="c"># the same approach is applicable</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="s2">"</span><span class="nv">$PWD</span><span class="s2">/bin"</span>

<span class="c"># Dynamically construct a command line</span>
<span class="c"># by building an ARGS string then</span>
<span class="c"># adding the command, file specifications, etc</span>
<span class="c">#</span>
<span class="c"># We&amp;#039;re doing this in a way familar to Agave V1 users</span>
<span class="c"># first. Later, we&amp;#039;ll illustrate how to make use of</span>
<span class="c"># Agave V2&amp;#039;s new parameter passing functions</span>
<span class="c">#</span>
<span class="c"># Start with empty ARGS...</span>
<span class="nv">ARGS</span><span class="o">=</span><span class="s2">""</span>
<span class="c"># Add -m flag if maxMemSort was specified</span>
<span class="c"># You might want to add a constraint for how large maxMemSort</span>
<span class="c"># can be based on the available memory on your executionSystem</span>
<span class="k">if</span> <span class="o">[</span> <span class="k">${</span><span class="nv">maxMemSort</span><span class="k">}</span> -gt 0 <span class="o">]</span>; <span class="k">then </span><span class="nv">ARGS</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">ARGS</span><span class="k">}</span><span class="s2"> -m </span><span class="nv">$maxMemSort</span><span class="s2">"</span>; <span class="k">fi</span>

<span class="c"># Boolean handler for -named sort</span>
<span class="k">if</span> <span class="o">[</span> <span class="k">${</span><span class="nv">nameSort</span><span class="k">}</span> -eq 1 <span class="o">]</span>; <span class="k">then </span><span class="nv">ARGS</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">ARGS</span><span class="k">}</span><span class="s2"> -n "</span>; <span class="k">fi</span>

<span class="c"># Run the actual program</span>
samtools sort <span class="k">${</span><span class="nv">ARGS</span><span class="k">}</span> <span class="k">${</span><span class="nv">inputBam</span><span class="k">}</span> <span class="k">${</span><span class="nv">outputPrefix</span><span class="k">}</span>

<span class="c"># Now, delete the bin/ directory</span>
rm -rf bin
</code></pre>

<h3 id="submit-the-job-to-the-queue-on-stampede">Submit the job to the queue on Stampede&hellip;</h3>
<pre class="highlight shell"><code>chmod 700 <span class="nb">test</span>-sort.sh
sbatch <span class="nb">test</span>-sort.sh
</code></pre>

<p>You can monitor your jobs in the queue using</p>
<pre class="highlight shell"><code>showq -u your_tacc_username
</code></pre>

<p>Assuming all goes according to plan, you&rsquo;ll end up with a sorted BAM called <em>sorted.bam</em>, and your bin directory (but not the bin.tgz file) should be erased. Congratulations, you&rsquo;re in the home stretch: it&rsquo;s time to turn the test script into an Agave app.</p>

<h3 id="craft-an-agave-app-description">Craft an Agave app description</h3>

<p>In order for Agave to know how to run an instance of the application, we need to provide quite a bit of metadata about the application. This includes a unique name and version, the location of the application bundle, the identities of the execution system and destination system for results, whether its an HPC or other kind of job, the default number of processors and memory it needs to run, and of course, all the inputs and parameters for the actual program. It seems a bit over-complicated, but only because you&rsquo;re comfortable with the command line already. Your goal here is to allow your applications to be portable across systems and present a web-enabled, rationalized interface for your code to consumers.</p>

<p>Rather than have you write a description for &ldquo;samtools sort&rdquo; from scratch, let&rsquo;s systematically dissect an existing file provided with the SDK. Go ahead and copy the file into place and open it in your text editor of choice. If you don&rsquo;t have the SDK installed, you can <a href="../examples/samtools-0.1.19/stampede/samtools-sort.json">grab it here</a>.</p>
<pre class="highlight shell"><code><span class="nb">cd</span> <span class="nv">$WORK</span>/iPlant/samtools-0.1.19/stampede/
cp <span class="nv">$IPLANT_SDK_HOME</span>/examples/samtools-0.1.19/stampede/samtools-sort.json .
</code></pre>

<p>Open up samtools-sort.json in a text editor or <a href="../examples/samtools-0.1.19/stampede/samtools-sort.json">in your web browser</a> and follow along below.</p>

<h3 id="overview">Overview</h3>

<p>Your file <em>samtools-sort.json</em> is written in <a href="http://www.json.org/">JSON</a>, and conforms to an Agave-specific data model. You can find fully fleshed out details about all fields under <em>Parameters -&gt; Data Type -&gt; Model</em> at the <a href="http://agaveapi.co/live-docs/#!/apps/add_post_1">Agave API live docs on the /apps service</a>. We will dive into key elements here:</p>

<p>To make this file work for you, you will be, at a minimum, editting:</p>

<ol>
<li>Its <em>executionSystem</em> to match your private instance of Stampede.</li>
<li>Its <em>deploymentPath</em> to match your iPlant applications path</li>
<li>The <em>name</em> of the app to something besides &ldquo;samtools-sort&rdquo;. We recommend &ldquo;$IPLANTUSERNAME-samtools-sort&rdquo;.</li>
</ol>

<p>Instructions for making these changes will follow.</p>

<p>All Agave application descriptions have the following structure:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">   </span><span class="nt">"application_metadata"</span><span class="p">:</span><span class="s2">"value"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"inputs"</span><span class="p">:[],</span><span class="w">
  </span><span class="nt">"parameters"</span><span class="p">:[],</span><span class="w">
  </span><span class="nt">"outputs"</span><span class="p">:[]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>There is a defined list of application metadata fields, some of which are mandatory. Inputs, parameters, and outputs are specified as an array of simple data structures, which will be described below.</p>

<h3 id="application-metadata">Application metadata</h3>

<table>
<thead>
<tr>
  <th>Field</th>
  <th>Mandatory</th>
  <th>Type</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>checkpointable</td>
  <td>X</td>
  <td>boolean</td>
  <td>Application supports checkpointing</td>
</tr>
<tr>
  <td>defaultMemoryPerNode</td>
  <td></td>
  <td>integer</td>
  <td>Default RAM (GB) to request per compute node</td>
</tr>
<tr>
  <td>defaultProcessorsPerNode</td>
  <td></td>
  <td>integer</td>
  <td>Default processor count to request per compute node</td>
</tr>
<tr>
  <td>defaultMaxRunTime</td>
  <td></td>
  <td>integer</td>
  <td>Default maximum run time (hours:minutes:seconds) to request per compute node</td>
</tr>
<tr>
  <td>defaultNodeCount</td>
  <td></td>
  <td>integer</td>
  <td>Default number of compute nodes per job</td>
</tr>
<tr>
  <td>defaultQueue</td>
  <td></td>
  <td>string</td>
  <td>On HPC systems, default batch queue for jobs</td>
</tr>
<tr>
  <td>deploymentPath</td>
  <td>X</td>
  <td>string</td>
  <td>Path relative to homeDir on deploymentSystem where application bundle will reside</td>
</tr>
<tr>
  <td>deployementSystem</td>
  <td>X</td>
  <td>string</td>
  <td>The Agave-registered STORAGE system upon which you have write permissions where the app bundle resides</td>
</tr>
<tr>
  <td>executionSystem</td>
  <td>X</td>
  <td>string</td>
  <td>An Agave-registered EXECUTION system upon which you have execute and app registration permissions where jobs will run</td>
</tr>
<tr>
  <td>helpURI</td>
  <td>X</td>
  <td>string</td>
  <td>A URL pointing to help or description for the app you are deploying</td>
</tr>
<tr>
  <td>label</td>
  <td>X</td>
  <td>string</td>
  <td>Human-readable title for the app</td>
</tr>
<tr>
  <td>longDescription</td>
  <td></td>
  <td>string</td>
  <td>A short paragraph describing the functionality of the app</td>
</tr>
<tr>
  <td>modules</td>
  <td></td>
  <td>array[string]</td>
  <td>Ordered list of modules on systems that use lmod or modules</td>
</tr>
<tr>
  <td>name</td>
  <td>X</td>
  <td>string</td>
  <td>unique, URL-compatible (no special chars or spaces) name for the app</td>
</tr>
<tr>
  <td>ontology</td>
  <td>X</td>
  <td>array[string]</td>
  <td>List of ontology terms (or URIs pointing to ontology terms) associated with the app</td>
</tr>
<tr>
  <td>parallelism</td>
  <td>X</td>
  <td>string</td>
  <td>Is your application capable of using more than a single compute node? (SERIAL or PARALLEL)</td>
</tr>
<tr>
  <td>shortDescription</td>
  <td>X</td>
  <td>string</td>
  <td>Brief description of the app</td>
</tr>
<tr>
  <td>storageSystem</td>
  <td>X</td>
  <td>string</td>
  <td>The Agave-registered STORAGE system upon which you have write permissions. Default source of and destination for data consumed and emitted by the app</td>
</tr>
<tr>
  <td>tags</td>
  <td></td>
  <td>array[string]</td>
  <td>List of human-readable tags for the app</td>
</tr>
<tr>
  <td>templatePath</td>
  <td>X</td>
  <td>string</td>
  <td>Path to the shell template file, relative to deploymentPath</td>
</tr>
<tr>
  <td>testPath</td>
  <td>X</td>
  <td>string</td>
  <td>Path to the shell test file, relative to deploymentPath</td>
</tr>
<tr>
  <td>version</td>
  <td>X</td>
  <td>string</td>
  <td>Preferred format: Major.minor.point integer values for app</td>
</tr>
</tbody>
</table>

<aside class="alert">Note *: The combination of <em>name</em> and <em>version</em> must be unique the entire iPlant API namespace.</aside>

<h3 id="inputs">Inputs</h3>

<p>To tell Agave what files to stage into place before job execution, you need to define the app&rsquo;s inputs in a JSON array. To implement the SAMtools sort app, you need to tell Agave that a BAM file is needed to act as the subject of our sort:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">  
  </span><span class="nt">"id"</span><span class="p">:</span><span class="s2">"inputBam"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"value"</span><span class="p">:{</span><span class="w">  
    </span><span class="nt">"default"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nt">"order"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"required"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"validator"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nt">"visible"</span><span class="p">:</span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"semantics"</span><span class="p">:{</span><span class="w">  
    </span><span class="nt">"ontology"</span><span class="p">:[</span><span class="w">  
      </span><span class="s2">"http://sswapmeet.sswap.info/mime/application/X-bam"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"minCardinality"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"fileTypes"</span><span class="p">:[</span><span class="w">  
      </span><span class="s2">"raw-0"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"details"</span><span class="p">:{</span><span class="w">  
    </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nt">"label"</span><span class="p">:</span><span class="s2">"The BAM file to sort"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"argument"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"showArgument"</span><span class="p">:</span><span class="kc">false</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Here&rsquo;s a walkthrough of what these fields mean:</p>

<table>
<thead>
<tr>
  <th>Field</th>
  <th>Mandatory</th>
  <th>Type</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>id</td>
  <td>X</td>
  <td>string</td>
  <td>This is the &ldquo;name&rdquo; of the file. You will use this in your wrapper script later whenever you need to refer to the BAM file being sorted</td>
</tr>
<tr>
  <td>value.default</td>
  <td></td>
  <td>string</td>
  <td>The path, relative to X, of the default value for the input</td>
</tr>
<tr>
  <td>value.order</td>
  <td></td>
  <td>integer</td>
  <td>Ignore for now</td>
</tr>
<tr>
  <td>value.required</td>
  <td>X</td>
  <td>boolean</td>
  <td>Is specification of this input mandatory to run a job?</td>
</tr>
<tr>
  <td>value.validator</td>
  <td></td>
  <td>string</td>
  <td><a href="https://www.cs.tut.fi/~jkorpela/perl/regexp.html">Perl-format regular expression</a> to restrict valid values</td>
</tr>
<tr>
  <td>value.visible</td>
  <td></td>
  <td>boolean</td>
  <td>When automatically generated a UI, should this field be visible to end users?</td>
</tr>
<tr>
  <td>semantics.ontology</td>
  <td></td>
  <td>array[string]</td>
  <td>List of ontology terms (or URIs pointing to ontology terms) applicable to the input format</td>
</tr>
<tr>
  <td>semantics.minCardinality</td>
  <td></td>
  <td>integer</td>
  <td>Minimum number of values accepted for this input</td>
</tr>
<tr>
  <td>semantics.maxCardinality</td>
  <td></td>
  <td>integer</td>
  <td>Maximum number of values accepted for this input</td>
</tr>
<tr>
  <td>semantics.fileTypes</td>
  <td>X</td>
  <td>array[string]</td>
  <td>List of Agave file types accepted. Always use &ldquo;raw-0&rdquo; for the time being</td>
</tr>
<tr>
  <td>details.description</td>
  <td></td>
  <td>string</td>
  <td>Human-readable description of the input. Often implemented as contextual help in automatically generated UI</td>
</tr>
<tr>
  <td>details.label</td>
  <td></td>
  <td>string</td>
  <td>Human-readable label for the input. Often implemented as text label next to the field in automatically generated UI</td>
</tr>
<tr>
  <td>details.argument</td>
  <td></td>
  <td>string</td>
  <td>The command-line argument associated with specifying this input at run time</td>
</tr>
<tr>
  <td>details.showArgument</td>
  <td></td>
  <td>boolean</td>
  <td>Include the argument in the substitution done by Agave when a run script is generated</td>
</tr>
</tbody>
</table>

<p><em>A note on paths</em>: In this iPlant-oriented tutorial, we assume you will stage data to and from &ldquo;data.agaveapi.co&rdquo;, the default storage system for iPlant users. In this case, you can use relative paths relative to homeDir on that system (i.e. vaughn/analyses/foobar). To add portability, marshal data from other storageSystems, or import from public servers, you can also specify fully qualified URIs as follows:
* storageSystem namespace: agave://storage-system-name/path/to/file
* public URI namespace: https://www.cnn.com/index.html</p>

<h3 id="parameters">Parameters</h3>

<p>Parameters are specified in a JSON array, and are broadly similar to inputs. Here&rsquo;s an example of the parameter we will define allowing users to specify how much RAM to use in a &ldquo;samtools sort&rdquo; operation.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">  
  </span><span class="nt">"id"</span><span class="p">:</span><span class="s2">"maxMemSort"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"value"</span><span class="p">:{</span><span class="w">  
    </span><span class="nt">"default"</span><span class="p">:</span><span class="s2">"500000000"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"order"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"required"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"number"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"validator"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nt">"visible"</span><span class="p">:</span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"semantics"</span><span class="p">:{</span><span class="w">  
    </span><span class="nt">"ontology"</span><span class="p">:[</span><span class="w">  
      </span><span class="s2">"xs:integer"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"details"</span><span class="p">:{</span><span class="w">  
    </span><span class="nt">"description"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"label"</span><span class="p">:</span><span class="s2">"Maxiumum memory in bytes, used for sorting"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"argument"</span><span class="p">:</span><span class="s2">"-m"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"showArgument"</span><span class="p">:</span><span class="kc">false</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<table>
<thead>
<tr>
  <th>Field</th>
  <th>Mandatory</th>
  <th>Type</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>id</td>
  <td>X</td>
  <td>string</td>
  <td>This is the &ldquo;name&rdquo; of the parameter. At runtime, it will be replaced in your script template based on the value passed as part of the job specification</td>
</tr>
<tr>
  <td>value.default</td>
  <td></td>
  <td>string</td>
  <td>If your app has a fixed-name output, specify it here</td>
</tr>
<tr>
  <td>value.order</td>
  <td></td>
  <td>integer</td>
  <td>Ignore for now. Supports automatic generation of command lines.</td>
</tr>
<tr>
  <td>value.required</td>
  <td></td>
  <td>boolean</td>
  <td>Is specification of this parameter mandatory to run a job?</td>
</tr>
<tr>
  <td>value.type</td>
  <td></td>
  <td>string</td>
  <td>JSON type for this parameter (used to generate and validate UI). Valid values: &ldquo;string&rdquo;, &ldquo;number&rdquo;, &ldquo;enumeration&rdquo;, &ldquo;bool&rdquo;, &ldquo;flag&rdquo;</td>
</tr>
<tr>
  <td>value.validator</td>
  <td></td>
  <td>string</td>
  <td><a href="https://www.cs.tut.fi/~jkorpela/perl/regexp.html">Perl-formatted regular expression</a> to restrict valid values</td>
</tr>
<tr>
  <td>value.visible</td>
  <td></td>
  <td>boolean</td>
  <td>When automatically generated a UI, should this field be visible to end users?</td>
</tr>
<tr>
  <td>semantics.ontology</td>
  <td></td>
  <td>array[string]</td>
  <td>List of ontology terms (or URIs pointing to ontology terms) applicable to the parameter. We recommend at least specifying an <a href="http://www.schemacentral.com/sc/xsd/s-datatypes.xsd.html">XSL Schema Simple Type</a>.</td>
</tr>
<tr>
  <td>details.description</td>
  <td></td>
  <td>string</td>
  <td>Human-readable description of the parameter. Often used to create contextual help in automatically generated UI</td>
</tr>
<tr>
  <td>details.label</td>
  <td></td>
  <td>string</td>
  <td>Human-readable label for the parameter. Often implemented as text label next to the field in automatically generated UI</td>
</tr>
<tr>
  <td>details.argument</td>
  <td></td>
  <td>string</td>
  <td>The command-line argument associated with specifying this parameter at run time</td>
</tr>
<tr>
  <td>details.showArgument</td>
  <td></td>
  <td>boolean</td>
  <td>Include the argument in the substitution done by Agave when a run script is generated</td>
</tr>
</tbody>
</table>

<h3 id="outputs">Outputs</h3>

<p>While we don&rsquo;t support outputs 100% yet, Agave apps are designed to participate in workflows. Thus, just as we define the list of valid and required inputs to an app, we also must (when we know them) define a list of its outputs. This allows it to &ldquo;advertise&rdquo; to consumers of Agave services what it expects to emit, allowing apps to be chained together. Note that unlike inputs and parameters, output &ldquo;id&quot;s are NOT passed to the template file.  If you must specify an output filename in the application json, do it as a parameter!  Outputs are defined basically the same way as inputs:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">  
  </span><span class="nt">"id"</span><span class="p">:</span><span class="s2">"bam"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"value"</span><span class="p">:{</span><span class="w">  
    </span><span class="nt">"default"</span><span class="p">:</span><span class="s2">"sorted.bam"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"order"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"required"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"validator"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nt">"visible"</span><span class="p">:</span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"semantics"</span><span class="p">:{</span><span class="w">  
    </span><span class="nt">"ontology"</span><span class="p">:[</span><span class="w">  
      </span><span class="s2">"http://sswapmeet.sswap.info/mime/application/X-bam"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"minCardinality"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"fileTypes"</span><span class="p">:[</span><span class="w">  
      </span><span class="s2">"raw-0"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"details"</span><span class="p">:{</span><span class="w">  
    </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nt">"label"</span><span class="p">:</span><span class="s2">"Sorted BAM file"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"argument"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"showArgument"</span><span class="p">:</span><span class="kc">false</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Obligatory field walk-through:</p>

<table>
<thead>
<tr>
  <th>Field</th>
  <th>Mandatory</th>
  <th>Type</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>id</td>
  <td>X</td>
  <td>string</td>
  <td>This is the &quot;name&rdquo; of the output. It is not currently used by the wrapper script but may be in the future</td>
</tr>
<tr>
  <td>value.default</td>
  <td></td>
  <td>string</td>
  <td>If your app has a fixed-name output, specify it here</td>
</tr>
<tr>
  <td>value.order</td>
  <td></td>
  <td>integer</td>
  <td>Ignore for now</td>
</tr>
<tr>
  <td>value.required</td>
  <td>X</td>
  <td>boolean</td>
  <td>Is specification of this input mandatory to run a job?</td>
</tr>
<tr>
  <td>value.validator</td>
  <td></td>
  <td>string</td>
  <td><a href="https://www.cs.tut.fi/~jkorpela/perl/regexp.html">Perl-format regular expression</a> used to match output files</td>
</tr>
<tr>
  <td>value.visible</td>
  <td></td>
  <td>boolean</td>
  <td>When automatically generated a UI, should this field be visible to end users?</td>
</tr>
<tr>
  <td>semantics.ontology</td>
  <td></td>
  <td>array[string]</td>
  <td>List of ontology terms (or URIs pointing to ontology terms) applicable to the output format</td>
</tr>
<tr>
  <td>semantics.minCardinality</td>
  <td></td>
  <td>integer</td>
  <td>Minimum number of values expected for this output</td>
</tr>
<tr>
  <td>semantics.maxCardinality</td>
  <td></td>
  <td>integer</td>
  <td>Maximum number of values expected for this output</td>
</tr>
<tr>
  <td>semantics.fileTypes</td>
  <td>X</td>
  <td>array[string]</td>
  <td>List of Agave file types that may apply to the output. Always use &ldquo;raw-0&rdquo; for the time being</td>
</tr>
<tr>
  <td>details.description</td>
  <td></td>
  <td>string</td>
  <td>Human-readable description of the output</td>
</tr>
<tr>
  <td>details.label</td>
  <td></td>
  <td>string</td>
  <td>Human-readable label for the output</td>
</tr>
<tr>
  <td>details.argument</td>
  <td></td>
  <td>string</td>
  <td>The command-line argument associated with specifying this output at run time (not currently used)</td>
</tr>
<tr>
  <td>details.showArgument</td>
  <td></td>
  <td>boolean</td>
  <td>Include the argument in the substitution done by Agave when a run script is generated (not currently used)</td>
</tr>
</tbody>
</table>

<p><em>Note</em>: If the app you are working on doesn&rsquo;t natively produce output with a predictable name, one thing you can do is add extra logic to your script to take the existing output and rename it to something you can control or predict.</p>

<h3 id="tools-and-utilities">Tools and Utilities</h3>

<ol>
<li>Stumped for ontology terms to apply to your Agave app inputs, outputs, and parameters? SSWAPmeet has many URI-format terms for <a href="http://sswapmeet.sswap.info/mime/">MIME</a> types, and BioPortal can provide links to <a href="http://bioportal.bioontology.org/ontologies/EDAM">EDAM</a>.
<li>Need to validate JSON files? Try <a href="http://jsonlint.com/">JSONlint</a> or <a href="http://json.parser.online.fr/">JSONparser</a>
</ol>

<h4 id="craft-a-shell-script-template">Craft a shell script template</h4>

<p>Create sort.template using your test-sort.sh script as the starting point.</p>
<pre class="highlight shell"><code>cp <span class="nb">test</span>-sort.sh sort.template
</code></pre>

<p>Now, open sort.template in the text editor of your choice. Delete the bash shebang line and the SLURM pragmas. Replace the hard-coded values for inputs and parameters with variables defined by your app description.</p>
<pre class="highlight shell"><code><span class="c"># Set up inputs...</span>
<span class="c"># Since we don&amp;#039;t check these when constructing the</span>
<span class="c"># command line later, these will be marked as required</span>
<span class="nv">inputBam</span><span class="o">=</span><span class="k">${</span><span class="nv">inputBam</span><span class="k">}</span>
<span class="c"># and parameters</span>
<span class="nv">outputPrefix</span><span class="o">=</span><span class="k">${</span><span class="nv">outputPrefix</span><span class="k">}</span>
<span class="c"># Maximum memory for sort, in bytes</span>
<span class="c"># Be careful, Neither Agave nor scheduler will</span>
<span class="c"># check that this is a reasonable value. In production</span>
<span class="c"># you might want to code min/max for this value</span>
<span class="nv">maxMemSort</span><span class="o">=</span><span class="k">${</span><span class="nv">maxMemSort</span><span class="k">}</span>
<span class="c"># Boolean: Sort by name instead of coordinate</span>
<span class="nv">nameSort</span><span class="o">=</span><span class="k">${</span><span class="nv">nameSort</span><span class="k">}</span>

<span class="c"># Unpack the bin.tgz file containing samtools binaries</span>
tar -xvf bin.tgz
<span class="c"># Set the PATH to include binaries in bin</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="s2">"</span><span class="nv">$PWD</span><span class="s2">/bin"</span>

<span class="c"># Build up an ARGS string for the program</span>
<span class="c"># Start with empty ARGS...</span>
<span class="nv">ARGS</span><span class="o">=</span><span class="s2">""</span>
<span class="c"># Add -m flag if maxMemSort was specified</span>
<span class="k">if</span> <span class="o">[</span> <span class="k">${</span><span class="nv">maxMemSort</span><span class="k">}</span> -gt 0 <span class="o">]</span>; <span class="k">then </span><span class="nv">ARGS</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">ARGS</span><span class="k">}</span><span class="s2"> -m </span><span class="nv">$maxMemSort</span><span class="s2">"</span>; <span class="k">fi</span>

<span class="c"># Boolean handler for -named sort</span>
<span class="k">if</span> <span class="o">[</span> <span class="k">${</span><span class="nv">nameSort</span><span class="k">}</span> -eq 1 <span class="o">]</span>; <span class="k">then </span><span class="nv">ARGS</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">ARGS</span><span class="k">}</span><span class="s2"> -n "</span>; <span class="k">fi</span>

<span class="c"># Run the actual program</span>
samtools sort <span class="k">${</span><span class="nv">ARGS</span><span class="k">}</span> <span class="nv">$inputBam</span> <span class="k">${</span><span class="nv">outputPrefix</span><span class="k">}</span>

<span class="c"># Now, delete the bin/ directory</span>
rm -rf bin
</code></pre>

              <h3 id="permissions">Permissions</h3>

<p>Apps have fine grained permissions similar to those found in the <a title="Job Management" href="#permissions-and-sharing129">Jobs</a> and <a title="File Management" href="#data-permissions">Files</a> services. Using these, you can share your app other Agave users. App permissions are private by default, so when you first POST your app to the Apps service, you are the only one who can see it. You may share your app with other users by granting them varying degrees of permissions. The full list of app permission values are listed in the following table.</p>

<table>
    <thead>
        <tr>
            <th>Permission</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>READ</td>
            <td>Gives the ability to view the app description.</td>
        </tr>
        <tr>
            <td>WRITE</td>
            <td>Gives the ability to update the app.</td>
        </tr>
        <tr>
            <td>EXECUTE</td>
            <td>Gives the ability to submit jobs using the app</td>
        </tr>
        <tr>
            <td>ALL</td>
            <td>Gives full READ and WRITE and EXECUTE permissions to the user.</td>
        </tr>
        <tr>
            <td>READ_WRITE</td>
            <td>Gives full READ and WRITE permissions to the user</td>
        </tr>
        <tr>
            <td>READ_EXECUTE</td>
            <td>Gives full READ and EXECUTE permissions to the user</td>
        </tr>
        <tr>
            <td>WRITE_EXECUTE</td>
            <td>Gives full WRITE and EXECUTE permissions to the user</td>
        </tr>
    </tbody>
</table>

<p>App permissions are distinct from all other roles and permissions and do not have implications outside the Apps service. This means that if you want to allow someone to run a job using your app, it is not sufficient to grant them READ_EXECUTE permissions on your app. They must also have an appropriate user role on the execution system on which the app will run. Similarly, if you do not have the right to publish on the <code class="prettyprint">executionSystem</code> or access the <code class="prettyprint">deploymentPath</code> on the <code class="prettyprint">deploymentSystem</code> in your app description, you will not be able to publish your app.</p>

<h3 id="listing-permissions">Listing permissions</h3>

<p>App permissions are managed through a set of URLs consistent with the permission operations elsewhere in the API. To query for a user&rsquo;s permission for an app, perform a GET on the user&rsquo;s unique app permissions url.</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     https://public.tenants.agaveapi.co/apps/v2/<span class="nv">$APP_ID</span>/pems/<span class="nv">$USERNAME</span>
</code></pre>
<pre class="highlight plaintext"><code>apps-pems-list -v -u $USERNAME $APP_ID
</code></pre>

<p>The response from the service will be a JSON object representing the user permission. If the user does not have a permission for that app, the permission value will be NONE. By default, only you have permission to your private apps. Public apps will return a single permission for the <em>public</em> meta user rather than return a permissions for every user.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"app"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/apps/v2/$APP_ID"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/profiles/v2/systest"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/apps/v2/$APP_ID/pems/systest"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"permission"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"execute"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"systest"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>You can also query for all permissions granted on a specific app by making a GET request on the app&rsquo;s permission collection.</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://public.tenants.agaveapi.co/apps/v2/<span class="nv">$APP_ID</span>/pems
</code></pre>
<pre class="highlight plaintext"><code>apps-pems-list -v $APP_ID
</code></pre>

<p>This time the service will respond with a JSON array of permission objects.</p>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
   </span><span class="p">{</span><span class="w">
      </span><span class="nt">"_links"</span><span class="p">:{</span><span class="w">
         </span><span class="nt">"app"</span><span class="p">:{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/apps/v2/$APP_ID"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nt">"profile"</span><span class="p">:{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/profiles/v2/systest"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nt">"self"</span><span class="p">:{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/apps/v2/$APP_ID/pems/systest"</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"permission"</span><span class="p">:{</span><span class="w">
         </span><span class="nt">"execute"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
         </span><span class="nt">"read"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
         </span><span class="nt">"write"</span><span class="p">:</span><span class="kc">true</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"username"</span><span class="p">:</span><span class="s2">"systest"</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<h3 id="adding-and-updating-permissions">Adding and updating permissions</h3>

<p>Setting permissions is done by posting a JSON object containing a permission and username. Alternatively, you can POST just the permission and append the username to the URL.</p>
<pre class="highlight shell"><code><span class="c"># Standard syntax to grant permissions to a specific user</span>
curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X POST -d <span class="s2">"username=bgibson&amp;amp;permission=READ"</span> https://public.tenants.agaveapi.co/apps/v2/<span class="nv">$APP_ID</span>/pems

<span class="c"># Abbreviated POST data to grant permission to a single user</span>
curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X POST -d <span class="s2">"permission=READ"</span> https://public.tenants.agaveapi.co/apps/v2/<span class="nv">$APP_ID</span>/pems/bgibson
</code></pre>
<pre class="highlight plaintext"><code>apps-pems-update -v -u bgibson -p READ $APP_ID
</code></pre>

<p>The response will contain a JSON object representing the permission that was just created.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"app"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/apps/v2/$APP_ID"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/profiles/v2/bgibson"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/apps/v2/$APP_ID/pems/bgibson"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"permission"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"execute"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bgibson"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="deleting-permissions">Deleting permissions</h3>

<p>Permissions can be deleted on a user-by-user basis, or all at once. To delete an individual user permission, make a DELETE request on the user&rsquo;s app permission URL.</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X DELETE https://public.tenants.agaveapi.co/apps/v2/<span class="nv">$APP_ID</span>/bgibson
</code></pre>
<pre class="highlight plaintext"><code>apps-pems-delete -u bgibson $APP_ID
</code></pre>

<p>The response will be an empty result object.</p>

<p>You can accomplish the same thing by updating the user permission to an empty value.</p>
<pre class="highlight shell"><code><span class="c"># Delete permission for a single user by updating with an empty permission value</span>
curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>  <span class="se">\</span>
     -X POST -d <span class="s2">"username=bgibson"</span> -d <span class="s2">"permission=NONE"</span> <span class="se">\</span>
     https://public.tenants.agaveapi.co/apps/v2/<span class="nv">$APP_ID</span>/pems

<span class="c"># Delete permission for a single user by updating with an empty permission value</span>
curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -X POST -d <span class="s2">"permission="</span> <span class="se">\</span>
     https://public.tenants.agaveapi.co/apps/v2/<span class="nv">$APP_ID</span>/pems/bgibson
</code></pre>
<pre class="highlight plaintext"><code>apps-pems-update -v -u bgibson $APP_ID
</code></pre>

<p>Since this is an update operation, the resulting JSON permission object will be returned showing the user has no permissions to the app anymore.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"app"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/apps/v2/$APP_ID"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/profiles/v2/bgibson"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/apps/v2/$APP_ID/pems/bgibson"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"permission"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"execute"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bgibson"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>To delete all permissions for an app, make a DELETE request on the app&rsquo;s permissions collection.</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -X DELETE <span class="se">\</span>
     https://public.tenants.agaveapi.co/apps/v2/<span class="nv">$APP_ID</span>
</code></pre>
<pre class="highlight plaintext"><code>apps-pems-delete $APP_ID
</code></pre>

<p>The response will be an empty result object.</p>

              <h3 id="app-scope">App scope</h3>

<p>In addition to traditional permissions, apps also have a concept of scope. Unless otherwise configured, apps are private to the owner and the users they grant permission. Applications can, however move from the private space into the public space for use any anyone. Moving an app into the public space is called <em>publishing</em>. Publishing an app gives it much greater exposure and results in increased usage by the user community. It also comes with increased responsibilities for the original owner as well as the API administrators. Several of these are listed below:</p>

<ul>
<li>Public apps must run on public systems. This makes the app available to everyone.</li>
<li>Public apps must be vetted for performance, reliability, and security by the API administrators.</li>
<li>The original app author must remain available via email for ongoing support.</li>
<li>Public apps must be copied into a public repository and checksummed.</li>
<li>Updates to public apps must result in a snapshot of the original app being created and stored with its resulting checksum in a separate location.</li>
<li>API administrators must maintain and support the app throughout its lifetime.</li>
</ul>

<aside class="success">If you have an app you would like to see published, please contact your API administrators for more information.</aside>

<h4 id="publishing-an-app">Publishing an app</h4>

<blockquote>
<p>Publishing an app.</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
     -H <span class="s2">"Content-Type: application/json"</span>
     -X PUT
     --data-binary <span class="s1">'{"action":"publish","executionSystem":"condor.opensciencegrid.org"}'</span>
     https://public.tenants.agaveapi.co/apps/v2/wc-osg-1.00
</code></pre>
<pre class="highlight plaintext"><code>apps-publish -e condor.opensciencegrid.org wc-osg-1.00
</code></pre>

<blockquote>
<p>The response from the service will resemble the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"wc-osg-1.00u1"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"wc-osg"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"icon"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8734854070765284890-242ac116-0001-005"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"parallelism"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SERIAL"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"defaultProcessorsPerNode"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nt">"defaultMemoryPerNode"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nt">"defaultNodeCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nt">"defaultMaxRunTime"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"defaultQueue"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"revision"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nt">"isPublic"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"helpURI"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.gnu.org/s/coreutils/manual/html_node/wc-invocation.html"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"wc condor"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"shortDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Count words in a file"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"longDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nt">"tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"gnu"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"textutils"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"ontology"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"http://sswapmeet.sswap.info/algorithms/wc"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"executionType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CONDOR"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"executionSystem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"condor.opensciencegrid.org"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"deploymentPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/agave/apps/wc-1.00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"deploymentSystem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"public.storage.agave"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"templatePath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/wrapper.sh"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"testPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/wrapper.sh"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"checkpointable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"lastModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-15T04:48:17.000-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"modules"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"load TACC"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"purge"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"available"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"inputs"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"query1"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"validator"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="nt">"visible"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nt">"enquote"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"default"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"read1.fq"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"File to count words in: "</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="nt">"argument"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nt">"showArgument"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"repeatArgument"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"semantics"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"minCardinality"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"maxCardinality"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"ontology"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"http://sswapmeet.sswap.info/util/TextDocument"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"fileTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"text-0"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nt">"outputs"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"outputWC"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"validator"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="nt">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nt">"default"</span><span class="p">:</span><span class="w"> </span><span class="s2">"wc_out.txt"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Text file"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Results of WC"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"semantics"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"minCardinality"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"maxCardinality"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"ontology"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"http://sswapmeet.sswap.info/util/TextDocument"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"fileTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/apps/v2/wc-osg-1.00u1"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"executionSystem"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/condor.opensciencegrid.org"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"storageSystem"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/public.storage.agave"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"history"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/apps/v2/wc-osg-1.00u1/history"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/data/?q=%7B%22associationIds%22%3A%228734854070765284890-242ac116-0001-005%22%7D"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/apps/v2/wc-osg-1.00u1/pems"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>To publish an app, make a PUT request on the app resource. In this example, we publish the <code class="prettyprint">wc-osg-1.00</code> app. Notice a few things about the response.</p>

<ol>
<li>Both the <code class="prettyprint">executionSystem</code> and <code class="prettyprint">deploymentSystem</code> have changed. <strong>Public apps must run and store their assets on public systems.</strong></li>
<li>We did not specify the <code class="prettyprint">deploymentSystem</code> where the public app assets should be stored, so Agave placed them on the default public storage system, <code class="prettyprint">public.storage.agave</code>.</li>
<li>We did not specify the <code class="prettyprint">deploymentPath</code> where the public app assets should be stored, so Agave placed them in the <code class="prettyprint">publicAppsDir</code> of the <code class="prettyprint">deploymentPath</code>.</li>
<li>The <code class="prettyprint">deploymentPath</code> is now a zip archive rather than a folder. Agave does this because once, published, the app can no longer be updated, so the assets are frozen and stored in a separate location, removed from user access.</li>
<li>The <code class="prettyprint">id</code> of the app has changed. It now has a <code class="prettyprint">u1</code> appended to the original app id. This indicates that it is a public app and that it has been updated a single time. If we were to publish the app again, the resulting <code class="prettyprint">id</code> would be <code class="prettyprint">wc-osg-1.00u2</code>. This differs from unpublished apps whose revision number increments without impacting the app id. <strong>Every time you publish an app, the id of the resulting public app will change.</strong></li>
</ol>

<h4 id="unpublishing-an-app">Unpublishing an app</h4>

<blockquote>
<p>Unpublishing a public system is equivalent to disabling it.</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
     -H <span class="s2">"Content-Type: application/json"</span>
     -X PUT
     --data-binary <span class="s1">'{"action":"disable"}'</span>
     https://public.tenants.agaveapi.co/apps/v2/wc-osg-1.00u1
</code></pre>
<pre class="highlight plaintext"><code>apps-disable -v wc-osg-1.00u1
</code></pre>

<blockquote>
<p>The response will look identical to before, but with <code class="prettyprint">available</code> set to <em>false</em></p>
</blockquote>

<p>Unlike systems, it is not possible to unpublish an app. Once published, a deep copy of the app is store in an external location with its own provenance trail. If you would like to remove a published app from further use, simply disable it.</p>

              <h3 id="cloning-an-app">Cloning an app</h3>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span><span class="se">\</span>
     -X POST -d <span class="s2">"action=clone"</span> <span class="se">\</span>
     -d <span class="s2">"name=my-pyplot-demo"</span> <span class="se">\</span>
     -d <span class="s2">"version=0.1.0"</span> <span class="se">\</span>
     -d <span class="s2">"executionSystem=sftp.storage.example.com"</span> <span class="se">\</span>
     -d <span class="s2">"deploymentSystem=2.2"</span> <span class="se">\</span>
     -d <span class="s2">"deploymentPath=/apps/"</span> <span class="se">\</span>
     https://public.tenants.agaveapi.co/apps/v2/demo-pyplot-demo-advanced-0.1.0?pretty<span class="o">=</span><span class="nb">true</span>
</code></pre>
<pre class="highlight plaintext"><code>apps-clone -N my-pyplot-demo -V 2.2 demo-pyplot-demo-advanced-0.1.0
</code></pre>

<p>Often times you will want to copy an existing app for use on another system, or simply to obtain a private copy of the app for your own use. This can be done using the clone functionality in the Apps service. The following tabs show how to do this using the unix <code class="prettyprint">curl</code> command as well as with the Agave CLI.</p>

<aside class="notice">When cloning public apps, the entire app bundle will be recreated on the `deploymentSystem` you specify or your default storage system. The same is not true for private apps. Cloning a private app will copy the job description, but not the app bundle. This is to honor the original ownership of the assets and prevent them from leaking out to the public space without the owner&rsquo;s permission. If you need direct access to the app&rsquo;s assets, request that the owner give you read access to the folder listed as the deploymentPath in the app description.</aside>

              <h2 id="jobs">Jobs</h2>
<pre class="highlight json"><code><span class="w">    </span><span class="err">/$$$$$</span><span class="w">         </span><span class="err">/$$</span><span class="w">
   </span><span class="err">|__</span><span class="w">  </span><span class="err">$$</span><span class="w">        </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
      </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$$$$$|</span><span class="w"> </span><span class="err">$$$$$$$</span><span class="w">  </span><span class="err">/$$$$$$$</span><span class="w">
      </span><span class="err">|</span><span class="w"> </span><span class="err">$$/$$__</span><span class="w">  </span><span class="err">$|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$$/$$_____/</span><span class="w">
 </span><span class="err">/$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$|</span><span class="w">  </span><span class="err">$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$\____</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w"> </span><span class="err">$$$$$$$//$$$$$$$/</span><span class="w">
 </span><span class="err">\______/</span><span class="w"> </span><span class="err">\______/|_______/|_______/</span><span class="w">
</span></code></pre>

<p>The Jobs service is a basic execution service that allows you to run applications registered with the Apps service across multiple, distributed, heterogeneous systems through a common REST interface. The service manages all aspects of execution and job management from data staging, job submission, monitoring, output archiving, event logging, sharing, and notifications. The Jobs service also provides a persistent reference to your job&rsquo;s output data and a mechanism for sharing all aspects of your job with others. Each feature will be described in more detail below.</p>

<aside class="notice">If you are not familiar with batch computing and why we refer to a simulation run as a &ldquo;job,&rdquo; we wrote a good blog post on the topic, <a href="http://agaveapi.co/what-is-a-job2/" title="What is a Job">What is a &ldquo;Job&rdquo;</a> that will help give you some context and background on the subject and terminology.</aside>

              <h3 id="job-submission">Job submission</h3>

<p>Job submission is a term recycled from shared batch computing environments where a user would submit a request for a unit of computational work (called a Job) to the batch scheduler, then go head home for dinner while waiting for the computer to complete the job they gave it.</p>

<p>Originally the batch scheduler was a person and the term batch came from their ability to process several submissions together. Later on, as human schedulers were replaced by software, the term stuck even though the process remained unchanged. Today the term job submission is essentially unchanged.</p>

<p>A user submits a request for a unit of work to be done. The primary difference is that today, often times, the wait time between submission and execution is considerably less. On shared systems, such as many of the HPC systems originally targeted by Agave, waiting for your job to start is the price you pay for the incredible performance you get once your job starts.</p>

<p>Agave, too, adopts the concept of job submission, though it is not in and of itself a scheduler. In the context of Agave&rsquo;s Job service, the process of running an application registered with the Apps service is referred to as submitting a job.</p>

<p>Unlike in the batch scheduling world where each scheduler has its own job submission syntax and its own idiosyncrasies, the mechanism for submitting a job to Agave is consistent regardless of the application or system on which you run. A HTML form or JSON object are posted to the Jobs service. The submission is validated, and the job is forwarded to the scheduling and execution services for processing.</p>

<p>Because Agave takes an app-centric view of science, execution does not require knowing about the underlying systems on which an application runs. Simply knowing how the parameters and inputs you want to use when running an app is sufficient to define a job. Agave will handle the rest.</p>

<p>As mentioned previously, jobs are submitted by making a HTTP POST request either a HTML form or a JSON object to the Jobs service. All job submissions must include a few mandatory values that are used to define a basic unit of work. Table 1 lists the optional and required attributes of all job submissions.</p>

<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Value(s)</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>name</td>
            <td>string</td>
            <td>Descriptive name of the job. This will be slugified and used as one component of directory names in certain situations.</td>
        </tr>
        <tr>
            <td>appId</td>
            <td>string</td>
            <td>The unique name of the application being run by this job. This must be a valid application that the calling user has permission to run.</td>
        </tr>
        <tr>
            <td>batchQueue</td>
            <td>string</td>
            <td>The batch queue on the execution system to which this job is submitted. Defaults to the app&rsquo;s defaultQueue property if specified. Otherwise a best-fit algorithm is used to match the job parameters to a queue on the execution system with sufficient capabilities to run the job.</td>
        </tr>
        <tr>
            <td>nodeCount</td>
            <td>integer</td>
            <td>The number of nodes to use when running this job. Defaults to the app&rsquo;s defaultNodes property or 1 if no default is specified.</td>
        </tr>
        <tr>
            <td>processorsPerNode</td>
            <td>integer</td>
            <td>The number of processors this application should utilize while running. Defaults to the app&rsquo;s defaultProcessorsPerNode property or 1 if no default is specified. If the application is not of executionType PARALLEL, this should be 1.</td>
        </tr>
        <tr>
            <td>memoryPerNode</td>
            <td>string</td>
            <td>The maximum amount of memory needed per node for this application to run given in ####.#[E|P|T|G]B format. Defaults to the app&rsquo;s defaultMemoryPerNode property if it exists. GB are assumed if no magnitude is specified.</td>
        </tr>
        <tr>
            <td>maxRunTime</td>
            <td>string</td>
            <td>The estimated compute time needed for this application to complete given in hh:mm:ss format. This value must be less than or equal to the max run time of the queue to which this job is assigned. </td>
        </tr>
        <tr>
            <td>notifications*</td>
            <td>JSON array</td>
            <td>An array of one or more JSON objects describing an event and url which the service will POST to when the given event occurs. For more on Notifications, see the section on webhooks below.</td>
        </tr>
        <tr>
            <td>archive*</td>
            <td>boolean</td>
            <td>Whether the output from this job should be archived. If true, all new files created by this application&rsquo;s execution will be archived to the archivePath in the user&rsquo;s default storage system.</td>
        </tr>
        <tr>
            <td>archiveSystem*</td>
            <td>string</td>
            <td>System to which the job output should be archived. Defaults to the user&rsquo;s default storage system if not specified.</td>
        </tr>
        <tr>
            <td>archivePath*</td>
            <td>string</td>
            <td>Location where the job output should be archived. A relative path or absolute path may be specified. If not specified, a unique folder will be created in the user&rsquo;s home directory of the archiveSystem at &lsquo;archive/jobs/job-$JOB_ID&rsquo;</td>
        </tr>
    </tbody>
</table>

<p class="table-caption">Table 1. The optional and required attributes common to all job submissions. Optional fields are marked with an astericks.</p>

<aside class="notice">In this tutorial we will use JSON for our examples, however, one could replace the JSON object with a HTML form mapping JSON attribute and values to HTML form attributes and values one for one and get the same results, with the exception of the `notifications` attribute which is not accepted using HTML form submission and would need to be added after submitting the job request by sending each of the notification objects with the returned job id to the <a href="http://agaveapi.co/documentation/tutorials/notification-management-tutorial/" title="Notification Management Tutorial">Notifications API</a>.</aside>

<p>In addition to the standard fields for all jobs, the application you specify in the <code class="prettyprint">appId</code> field will also have its own set of inputs and parameters specified during registration that are unique to that app. (For more information about app registration and descriptions, see the <a href="http://agaveapi.co/documentation/tutorials/app-management-tutorial/" title="App Management Tutorial">App Management Tutorial</a>).</p>

<p>The following snippet shows a sample JSON job request that could be submitted to the Jobs service to run the <code class="prettyprint">pyplot-0.1.0</code> app from the <a href="http://agaveapi.co/documentation/tutorials/app-management-tutorial/advanced-app-example/" title="Advanced App Example">Advanced App Example</a> tutorial.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"pyplot-demo test"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"appId"</span><span class="p">:</span><span class="s2">"demo-pyplot-demo-advanced-0.1.0"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"inputs"</span><span class="p">:{</span><span class="w">
    </span><span class="nt">"dataset"</span><span class="p">:[</span><span class="w">
      </span><span class="s2">"agave://$PUBLIC_STORAGE_SYSTEM/$API_USERNAME/inputs/pyplot/testdata.csv"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"agave://$PUBLIC_STORAGE_SYSTEM/$API_USERNAME/inputs/pyplot/testdata2.csv"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"archive"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"parameters"</span><span class="p">:{</span><span class="w">
    </span><span class="nt">"unpackInputs"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"chartType"</span><span class="p">:[</span><span class="w">
      </span><span class="s2">"bar"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"line"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"width"</span><span class="p">:</span><span class="mi">1024</span><span class="p">,</span><span class="w">
    </span><span class="nt">"height"</span><span class="p">:</span><span class="mi">512</span><span class="p">,</span><span class="w">
    </span><span class="nt">"background"</span><span class="p">:</span><span class="s2">"#d96727"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"showYLabel"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"ylabel"</span><span class="p">:</span><span class="s2">"The Y Axis Label"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"showXLabel"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"xlabel"</span><span class="p">:</span><span class="s2">"The X Axis Label"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"showLegend"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"separateCharts"</span><span class="p">:</span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"notifications"</span><span class="p">:[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"url"</span><span class="p">:</span><span class="s2">"$API_EMAIL"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"event"</span><span class="p">:</span><span class="s2">"RUNNING"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"url"</span><span class="p">:</span><span class="s2">"$API_EMAIL"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"event"</span><span class="p">:</span><span class="s2">"FINISHED"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"url"</span><span class="p">:</span><span class="s2">"http://http://requestbin.agaveapi.co/o1aiawo1?job_id=${JOB_ID}&amp;amp;status=${JOB_STATUS}"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"event"</span><span class="p">:</span><span class="s2">"*"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"persistent"</span><span class="p">:</span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Notice that this example specifies a single input attribute, <code class="prettyprint">dataset</code>. The <code class="prettyprint">pyplot-0.1.0</code> app definition specified that the <code class="prettyprint">dataset</code> input attribute could accept more than one value (maxCardinality = 2). In the job request object, that translates to an array of string values. Each string represents a piece of data that Agave will transfer into the job work directory prior to job execution. Any value accepted by the Files service when <a href="http://agaveapi.co/documentation/tutorials/data-management-tutorial/#importing-data">importing data</a> is accepted here. Some examples of valid values are given in the following table.</p>

<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>inputs/pyplot/testdata.csv</td>
            <td>A relative path on the user&rsquo;s default storage system.</td>
        </tr>
        <tr>
            <td>/home/apiuser/inputs/pyplot/testdata.csv</td>
            <td>An absolute path on the user&rsquo;s default storage system.</td>
        </tr>
        <tr>
            <td>agave://$PUBLIC_STORAGE_SYSTEM/$API_USERNAME/inputs/pyplot/testdata.csv</td>
            <td>An Agave URL explicitly specifying a source system and relative path.</td>
        </tr>
        <tr>
            <td>agave://$PUBLIC_STORAGE_SYSTEM//home/apiuser/$API_USERNAME/inputs/pyplot/testdata.csv</td>
            <td>An Agave URL explicitly specifying a source system and absolute path.</td>
        </tr>
        <tr>
            <td>http://example.com/inputs/pyplot/testdata.csv</td>
            <td>Standard url with any <a href="http://agaveapi.co/documentation/tutorials/data-management-tutorial/#importing-data">supported transfer protocol</a>.</td>
        </tr>
    </tbody>
</table>

<p class="table-caption">Table 2. Examples of different syntaxes that input values can be specified in the job request object. Here we assume that the validator for the input field is such that these would pass.</p>

<p>The example job request also specifies <code class="prettyprint">parameters</code> object with the parameters defined in the <code class="prettyprint">pyplot-0.1.0</code> app description. Notice that the parameter <code class="prettyprint">type</code> value specified in the app description is reflected here. Numbers are given as numbers, not strings. Boolean and flag attributes are given as boolean true and false values. As with the input section, there is also a parameter <code class="prettyprint">chartType</code> that accepts multiple values. In this case that translates to an array of string value. Had the parameter type required another primary type, that would be used in the array instead.</p>

<p>Finally, we see a <code class="prettyprint">notifications</code> array specifying that we want Agave send three notifications related to this job. The first is a one-time email when the job starts running. The second is a one-time email when the job reaches a terminal state. The third is a webhook to the url we specified. More on notifications in the section on monitoring below.</p>

<h4 id="job-submission-validation">Job submission validation</h4>

<p>If everything went well, you will receive a response that looks something like the following JSON object.</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X POST -F <span class="s2">"fileToUpload=@job.json"</span> https://public.tenants.agaveapi.co/jobs/v2?pretty<span class="o">=</span><span class="nb">true</span>
</code></pre>
<pre class="highlight plaintext"><code>jobs-submit -F job.json
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2.1.0-r6d11c"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"result"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0001414144065563-5056a550b8-0001-007"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"demo-pyplot-demo-advanced test-1414139896"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"$API_USERNAME"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"appId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"demo-pyplot-demo-advanced-0.1.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"executionSystem"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"$PUBLIC_EXECUTION_SYSTEM"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"batchQueue"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"debug"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"nodeCount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"processorsPerNode"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"memoryPerNode"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"maxRunTime"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"01:00:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"archive"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"retries"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"localId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"10321"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"outputPath"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"FINISHED"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"submitTime"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-24T04:48:11.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"startTime"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-24T04:48:08.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"endTime"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-24T04:48:15.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"inputs"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"dataset"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"agave://$PUBLIC_STORAGE_SYSTEM/$API_USERNAME/inputs/pyplot/testdata.csv"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"chartType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"height"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"512"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"showLegend"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"false"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"xlabel"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Time"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"background"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"#FFF"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"width"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1024"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"showXLabel"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"separateCharts"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"false"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"unpackInputs"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"false"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"ylabel"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Magnitude"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"showYLabel"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"app"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/apps/v2/demo-pyplot-demo-advanced-0.1.0"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"executionSystem"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/$PUBLIC_EXECUTION_SYSTEM"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"archiveData"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/outputs/listings"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"owner"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/profiles/v2/$API_USERNAME"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"permissions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/pems"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"history"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/history"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"metadata"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/meta/v2/data/?q={"</span><span class="err">associationIds</span><span class="s2">":"</span><span class="mi">0001414144065563-5056</span><span class="err">a</span><span class="mi">550</span><span class="err">b</span><span class="mi">8-0001-007</span><span class="s2">"}"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"notifications"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/notifications/v2/?associatedUuid=0001414144065563-5056a550b8-0001-007"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

              <h3 id="job-monitoring">Job monitoring</h3>

<p>Once you submit your job request, the job will be handed off to Agave&rsquo;s back end execution service. Your job may run right away, or it may wait in a batch queue on the execution system until the required resources are available. Either way, the execution process occurs completely asynchronous to the submission process. To monitor the status of your job, Agave supports two different mechanisms: polling and webhooks.</p>

<aside class="notice">For the sake of brevity, we placed a detailed explanation of the job lifecycle in a separate, aptly title post, <a href="http://agaveapi.co/documentation/tutorials/job-management-tutorial/the-job-lifecycle" title="The Job Lifecycle">The Job Lifecycle</a>. There you will find detailed information about how, when, and why everything moves from place to place and how you can peek behind the curtains.</aside>

<h4 id="polling">Polling</h4>

<p>If you have ever taken a long road trip with children, you are probably painfully aware of how polling works. Starting several minutes from the time you leave the house, a child asks, <a href="https://www.youtube.com/watch?v=4vUBsTJYK28&amp;w=640&amp;h=385" title="Are we there yet Shrek?" target="_blank">&ldquo;Are we there yet?&rdquo;</a> You reply, &ldquo;No.&rdquo; Several minutes later the child again asks, &ldquo;Are we there yet?&rdquo; You again reply, &ldquo;No.&rdquo; This process continues until you finally arrive at your destination. <strong>This is called polling and polling is bad</strong></p>

<p>Polling for your job status works the same way. After submitting your job, you start a while loop that queries the Jobs service for your job status until it detects that the job is in a terminal state. The following two URLs both return the status of your job. The first will result in a list of abbreviated job descriptions, the second will result in a full description of the job with the given $JOB_ID, exactly like that returned when submitting the job. The third will result in a much smaller response object that contains only the $JOB_ID and status being returned.</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://public.tenants.agaveapi.co/jobs/v2
curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007
curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/status
</code></pre>

<p>Sample response snippet</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2.1.0-r6d11c"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"result"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0001414144065563-5056a550b8-0001-007"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"FINISHED"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"$API_BASE_URL/jobs/v2/0001414144065563-5056a550b8-0001-007"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The list of all possible job statuses is given in table 2.</p>

<table>
    <thead>
        <tr>
            <th>Event</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>CREATED</td>
            <td>The job was updated</td>
        </tr>
        <tr>
            <td>UPDATED</td>
            <td>The job was updated</td>
        </tr>
        <tr>
            <td>DELETED</td>
            <td>The job was deleted</td>
        </tr>
        <tr>
            <td>PERMISSION_GRANT</td>
            <td>User permission was granted</td>
        </tr>
        <tr>
            <td>PERMISSION_REVOKE</td>
            <td>Permission was removed for a user on this job</td>
        </tr>
        <tr>
            <td>PENDING</td>
            <td>Job accepted and queued for submission.</td>
        </tr>
        <tr>
            <td>STAGING_INPUTS</td>
            <td>Transferring job input data to execution system</td>
        </tr>
        <tr>
            <td>CLEANING_UP</td>
            <td>Job completed execution</td>
        </tr>
        <tr>
            <td>ARCHIVING</td>
            <td>Transferring job output to archive system</td>
        </tr>
        <tr>
            <td>STAGING_JOB</td>
            <td>Job inputs staged to execution system</td>
        </tr>
        <tr>
            <td>FINISHED</td>
            <td>Job complete</td>
        </tr>
        <tr>
            <td>KILLED</td>
            <td>Job execution killed at user request</td>
        </tr>
        <tr>
            <td>FAILED</td>
            <td>Job failed</td>
        </tr>
        <tr>
            <td>STOPPED</td>
            <td>Job execution intentionally stopped</td>
        </tr>
        <tr>
            <td>RUNNING</td>
            <td>Job started running</td>
        </tr>
        <tr>
            <td>PAUSED</td>
            <td>Job execution paused by user</td>
        </tr>
        <tr>
            <td>QUEUED</td>
            <td>Job successfully placed into queue</td>
        </tr>
        <tr>
            <td>SUBMITTING</td>
            <td>Preparing job for execution and staging binaries to execution system</td>
        </tr>
        <tr>
            <td>STAGED</td>
            <td>Job inputs staged to execution system</td>
        </tr>
        <tr>
            <td>PROCESSING_INPUTS</td>
            <td>Identifying input files for staging</td>
        </tr>
        <tr>
            <td>ARCHIVING_FINISHED</td>
            <td>Job archiving complete</td>
        </tr>
        <tr>
            <td>ARCHIVING_FAILED</td>
            <td>Job archiving failed</td>
        </tr>
        <tr>
            <td>HEARTBEAT</td>
            <td>Job heartbeat received</td>
        </tr>
    </tbody>
</table>

<p class="table-caption">Table 2. Job statuses listed in progressive order from job submission to completion.</p>

<p>Polling is an incredibly effective approach, but it is bad practice for two reasons. First, it does not scale well. Querying for one job status every few seconds does not take much effort, but querying for 100 takes quite a bit of time and puts unnecessary load on Agave&rsquo;s servers. Second, polling provides what is effectively a binary response. It tells you whether a job is done or not done, it does not give you any information on what is actually going on with the job or where it is in the overall execution process.</p>

<p>The job history URL provides much more detailed information on the various state changes, system messages, and progress information associated with data staging. The syntax of the job history URL is as follows</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/history
</code></pre>

<p>Sample response snippet</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"success"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"message"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"version"</span><span class="p">:</span><span class="s2">"2.1.0-r6d11c"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"result"</span><span class="p">:[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:47:45.000-05:00"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"PENDING"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"Job accepted and queued for submission."</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:47:47.000-05:00"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"PROCESSING_INPUTS"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"Attempt 1 to stage job inputs"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:47:47.000-05:00"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"PROCESSING_INPUTS"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"Identifying input files for staging"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:47:48.000-05:00"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"STAGING_INPUTS"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"Staging agave://$PUBLIC_STORAGE_SYSTEM/$API_USERNAME/inputs/pyplot/testdata.csv to remote job directory"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"progress"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"averageRate"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nt">"totalFiles"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"source"</span><span class="p">:</span><span class="s2">"agave://$PUBLIC_STORAGE_SYSTEM/$API_USERNAME/inputs/pyplot/testdata.csv"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"totalActiveTransfers"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nt">"totalBytes"</span><span class="p">:</span><span class="mi">3212</span><span class="p">,</span><span class="w">
        </span><span class="nt">"totalBytesTransferred"</span><span class="p">:</span><span class="mi">3212</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:47:48.000-05:00"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"STAGING_INPUTS"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"Copy in progress"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:47:50.000-05:00"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"STAGED"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"Job inputs staged to execution system"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:47:55.000-05:00"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"SUBMITTING"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"Preparing job for submission."</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:47:55.000-05:00"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"SUBMITTING"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"Attempt 1 to submit job"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:48:08.000-05:00"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"RUNNING"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"Job started running"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:48:12.000-05:00"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"CLEANING_UP"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:48:15.000-05:00"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"FINISHED"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"Job completed. Skipping archiving at user request."</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Depending on the nature of your job and the reliability of the underlying systems, the response from this service can grow rather large, so it is important to be aware that this query can be an expensive call for your client application to make. Everything we said before about polling job status applies to polling job history with the additional caveat that you can chew through quite a bit of bandwidth polling this service, so keep that in mind if your application is bandwidth starved.</p>

<p>Often times, however, polling is unavoidable. In these situations, we recommend using an <a href="http://en.wikipedia.org/wiki/Exponential_backoff" title="Exponential Backoff" target="_blank">exponential backoff</a> to check job status. An exponential backoff is an alogrithm that increases the time between retries as the number of failures increases.</p>

<h4 id="webhooks">Webhooks</h4>

<p>Webhooks are the alternative, preferred way for your application to monitor the status of asynchronous actions in Agave. If you are a <a href="http://en.wikipedia.org/wiki/Design_Patterns_(book)" title="Gang of Four" target="_blank">Gang of Four</a> disciple, webhooks are a mechanism for implementing the <a href="http://en.wikipedia.org/wiki/Observer%5Fpattern" title="Observer Pattern" target="_blank">Observer Pattern</a>. They are widely used across the web and chances are that something you&rsquo;re using right now is leveraging them. In the context of Agave, a webhook is a URL that you give to Agave in advance of an event which it later POSTs a response to when that event occurs. A webhook can be any web accessible URL.</p>

<aside class="notice">For more information about webhooks, events, and notifications in Agave, please see the <a href="http://agaveapi.co/notifications-and-events/" title="Notifications and Events">Notifications and Events</a> page.</aside>

<p>The Jobs service provides several template variables for constructing dynamic URLs. Template variables can be included anywhere in your URL by surrounding the variable name in the following manner <code class="prettyprint">${VARIABLE_NAME}</code>. When an event of interest occurs, the variables will be resolved and the resulting URL called. Several example urls are given below.</p>
<pre class="highlight json"><code><span class="err">http://example.com/?job_id=$</span><span class="p">{</span><span class="err">JOB_ID</span><span class="p">}</span><span class="err">&amp;amp;job_status=$</span><span class="p">{</span><span class="err">EVENT</span><span class="p">}</span><span class="w">

</span><span class="err">http://example.com/trigger/job/$</span><span class="p">{</span><span class="err">JOB_NAME</span><span class="p">}</span><span class="err">/$</span><span class="p">{</span><span class="err">EVENT</span><span class="p">}</span><span class="w">

</span><span class="err">http://example.com/webhooks/?nonce=sdfkajerouiwe</span><span class="mi">234289</span><span class="err">fahlkqr&amp;amp;id=$</span><span class="p">{</span><span class="err">JOB_ID</span><span class="p">}</span><span class="err">&amp;amp;status=$</span><span class="p">{</span><span class="err">EVENT</span><span class="p">}</span><span class="err">&amp;amp;start=$</span><span class="p">{</span><span class="err">JOB_START_TIME</span><span class="p">}</span><span class="err">&amp;amp;end=$</span><span class="p">{</span><span class="err">JOB_END_TIME</span><span class="p">}</span><span class="err">&amp;amp;url=$</span><span class="p">{</span><span class="err">JOB_ARCHIVE_URL</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The full list of template variables are listed in the following table.</p>

<table id="notification-macros-jobs" class="notification-macros hidden">
    <thead>
        <tr>
            <th>Variable</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>UUID</td>
            <td>The UUID of the job</td>
        </tr>
        <tr>
            <td>EVENT</td>
            <td>The event which occurred</td>
        </tr>
        <tr>
            <td>JOB_STATUS</td>
            <td>The status of the job at the time the event occurs</td>
        </tr>
        <tr>
            <td>JOB_URL</td>
            <td>The url of the job within the API</td>
        </tr>
        <tr>
            <td>JOB_ID</td>
            <td>The unique id used to reference the job within Agave.</td>
        </tr>
        <tr>
            <td>JOB_SYSTEM</td>
            <td>ID of the job execution system (ex. ssh.execute.example.com)</td>
        </tr>
        <tr>
            <td>JOB_NAME</td>
            <td>The user-supplied name of the job</td>
        </tr>
        <tr>
            <td>JOB_START_TIME</td>
            <td>The time when the job started running in ISO8601 format.</td>
        </tr>
        <tr>
            <td>JOB_END_TIME</td>
            <td>The time when the job stopped running in ISO8601 format.</td>
        </tr>
        <tr>
            <td>JOB_SUBMIT_TIME</td>
            <td>The time when the job was submitted to Agave for execution by the user in ISO8601 format.</td>
        </tr>
        <tr>
            <td>JOB_ARCHIVE_PATH</td>
            <td>The path on the archive system where the job output will be staged.</td>
        </tr>
        <tr>
            <td>JOB_ARCHIVE_URL</td>
            <td>The Agave URL for the archived data.</td>
        </tr>
        <tr>
            <td>JOB_ERROR</td>
            <td>The error message explaining why a job failed. Null if completed successfully.</td>
        </tr>
    </tbody>
</table>

<p class="table-caption">Table 3. Template variables available for use when defining webhooks for your job.</p>

<h4 id="email">Email</h4>

<p>In situations where you do not have a persistent web address, or access to a backend service, you may find it more convenient to subscribe for email notifications rather then providing a webhook. Agave supports email notifications support as well. Simply specify a valid email address in the <code class="prettyprint">url</code> field in your job submission notification object and an email will be sent to that address when a relevant event occurs. A sample email message is given below.</p>
<pre class="highlight json"><code><span class="err">The</span><span class="w"> </span><span class="err">status</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">job</span><span class="w"> </span><span class="mi">0001414144065563-5056</span><span class="err">a</span><span class="mi">550</span><span class="err">b</span><span class="mi">8-0001-007</span><span class="err">,</span><span class="w"> </span><span class="s2">"demo-pyplot-demo-advanced test-1414139896,"</span><span class="w"> </span><span class="err">has</span><span class="w"> </span><span class="err">changed</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">FINISHED.</span><span class="w">

</span><span class="err">Name:</span><span class="w"> </span><span class="err">demo-pyplot-demo-advanced</span><span class="w"> </span><span class="err">test</span><span class="mi">-1414139896</span><span class="w">
</span><span class="err">URL:</span><span class="w"> </span><span class="err">https://public.tenants.agaveapi.co/jobs/v</span><span class="mi">2</span><span class="err">/</span><span class="mi">0001414144065563-5056</span><span class="err">a</span><span class="mi">550</span><span class="err">b</span><span class="mi">8-0001-007</span><span class="w">
</span><span class="err">Message:</span><span class="w"> </span><span class="err">Job</span><span class="w"> </span><span class="err">completed</span><span class="w"> </span><span class="err">successfully.</span><span class="w">
</span><span class="err">Submit</span><span class="w"> </span><span class="err">Time:</span><span class="w"> </span><span class="mi">2014-10-24</span><span class="err">T</span><span class="mi">04</span><span class="err">:</span><span class="mi">48</span><span class="err">:</span><span class="mf">11.000</span><span class="mi">-05</span><span class="err">:</span><span class="mi">00</span><span class="w">
</span><span class="err">Start</span><span class="w"> </span><span class="err">Time:</span><span class="w"> </span><span class="mi">2014-10-24</span><span class="err">T</span><span class="mi">04</span><span class="err">:</span><span class="mi">48</span><span class="err">:</span><span class="mi">0</span><span class="mf">8.000</span><span class="mi">-05</span><span class="err">:</span><span class="mi">0</span><span class="w">
</span><span class="err">End</span><span class="w"> </span><span class="err">Time:</span><span class="w"> </span><span class="mi">2014-10-24</span><span class="err">T</span><span class="mi">04</span><span class="err">:</span><span class="mi">48</span><span class="err">:</span><span class="mf">15.000</span><span class="mi">-05</span><span class="err">:</span><span class="mi">00</span><span class="w">
</span><span class="err">Output</span><span class="w"> </span><span class="err">Path:</span><span class="w"> </span><span class="err">$API_USERNAME/archive/jobs/job</span><span class="mi">-0001414144065563-5056</span><span class="err">a</span><span class="mi">550</span><span class="err">b</span><span class="mi">8-0001-007</span><span class="w">
</span><span class="err">Output</span><span class="w"> </span><span class="err">URL:</span><span class="w"> </span><span class="err">https://public.tenants.agaveapi.co/jobs/v</span><span class="mi">2</span><span class="err">/</span><span class="mi">0001414144065563-5056</span><span class="err">a</span><span class="mi">550</span><span class="err">b</span><span class="mi">8-0001-007</span><span class="err">/outputs</span><span class="w">
</span></code></pre>

<h4 id="websockets">Websockets</h4>

<p>Websockets are a realtime approach to monitoring where your client application listens on a dedicated channel for notification messages from Agave. Simply subscribe to Agave&rsquo;s websocket server (<a href="https://realtime.agaveapi.co">https://realtime.agaveapi.co</a> and listen for a channel matching the job id.</p>
<pre class="highlight json"><code><span class="err">/agave.prod/$API_USERNAME/$JOB_ID</span><span class="w">
</span></code></pre>

              <h3 id="stopping">Stopping</h3>

<p>Once your job is submitted, you have the ability to stop the job. This will kill the job on the system on which it is running.</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X POST -d <span class="s2">"action=kill"</span> https://public.tenants.agaveapi.co/jobs/v2/<span class="nv">$JOB_ID</span>
</code></pre>
<pre class="highlight plaintext"><code>jobs-stop $JOB_ID
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"$JOB_ID"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"demo-pyplot-demo-advanced test-1414139896"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"owner"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"$API_USERNAME"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"appId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"demo-pyplot-demo-advanced-0.1.0"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"executionSystem"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"$PUBLIC_EXECUTION_SYSTEM"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"batchQueue"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"debug"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"nodeCount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nt">"processorsPerNode"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nt">"memoryPerNode"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
  </span><span class="nt">"maxRunTime"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"01:00:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"archive"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"retries"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nt">"localId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"10321"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"outputPath"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"STOPPED"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"submitTime"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-24T04:48:11.000-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"startTime"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-10-24T04:48:08.000-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"endTime"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"inputs"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"dataset"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"agave://$PUBLIC_STORAGE_SYSTEM/$API_USERNAME/inputs/pyplot/testdata.csv"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"parameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"chartType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"height"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"512"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"showLegend"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"false"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"xlabel"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Time"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"background"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"#FFF"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"width"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1024"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"showXLabel"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"separateCharts"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"false"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"unpackInputs"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"false"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"ylabel"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Magnitude"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"showYLabel"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"app"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/apps/v2/demo-pyplot-demo-advanced-0.1.0"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"executionSystem"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/$PUBLIC_EXECUTION_SYSTEM"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"archiveData"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/outputs/listings"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"owner"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/profiles/v2/$API_USERNAME"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"permissions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/pems"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"history"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/history"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"metadata"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/meta/v2/data/?q={"</span><span class="err">associationIds</span><span class="s2">":"</span><span class="mi">0001414144065563-5056</span><span class="err">a</span><span class="mi">550</span><span class="err">b</span><span class="mi">8-0001-007</span><span class="s2">"}"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"notifications"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/notifications/v2/?associatedUuid=0001414144065563-5056a550b8-0001-007"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="deleting">Deleting</h3>

<blockquote>
<p>Deleting a job  </p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X DELETE https://public.tenants.agaveapi.co/jobs/v2/<span class="nv">$JOB_ID</span>
</code></pre>
<pre class="highlight plaintext"><code>jobs-delete $JOB_ID
</code></pre>

<p>Over time the number of jobs you have run can grow rather large. You can delete jobs to remove them from your listing results.</p>

<aside class="info">Deleting a job will hide it from view, not permanently delete the record.</aside>

<h3 id="resubmitting">Resubmitting</h3>

<blockquote>
<p>Resubmitting a job  </p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X POST -d <span class="s2">"action=resubmit"</span> https://public.tenants.agaveapi.co/jobs/v2/<span class="nv">$JOB_ID</span>
</code></pre>
<pre class="highlight plaintext"><code>jobs-resubmit $JOB_ID
</code></pre>

<p>Often times you will want to rerun a previous job as part of a pipeline, automation, or validation that the results were valid. In this situation, it is convenient to use the <code class="prettyprint">resubmit</code> feature of the Jobs service.</p>

<p>Resubmission provides you the options to enforce as much or as little rigor as you desire with respect to reproducibility in the job submission process. The following options are available to you for configuring a resubmission according to your requirements.</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>ignoreInputConflicts</td>
<td>boolean</td>
<td>Whether to ignore discrepencies in the previous app inputs for the resubmitted job. If true, the resubmitted job will make a best fit attempt and migrating the inputs.</td>
</tr>
<tr>
<td>ignoreParameterConflicts</td>
<td>boolean</td>
<td>Whether to ignore discrepencies in the previous app parameters for the resubmitted job. If true, the resubmitted job will make a best fit attempt and migrating the parameters.</td>
</tr>
<tr>
<td>preserveNotifications</td>
<td>boolean</td>
<td>Whether to recreate the notification of the original job for the resubmitted job.</td>
</tr>
</tbody></table>

              <h3 id="outputs">Outputs</h3>

<p>Throughout the lifecycle of a job, your inputs, application assets, and outputs are copied from and shuffled between several different locations. Though it is possible in many instances to explicitly locate and view all the moving pieces of your job through the Files service, resolving where those pieces are given the status, execution system, storage systems, data protocols, login protocols, and execution mechanisms of your job at a given time is&hellip;challenging. It is important, however, that you have the ability to monitor your job&rsquo;s output throughout the lifetime of the job.</p>

<p>To make tracking the output of a specific job easier to do, the Jobs service provides a special URL for referencing individual job outputs</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://public.tenants.agaveapi.co/jobs/v2/<span class="nv">$JOB_ID</span>/outputs/listings/<span class="nv">$PATH</span>
</code></pre>

<p>The syntax of this service is consistent with the Files service syntax, as is the JSON response from the service. The response would be similar to the following:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2.1.0-r6d11c"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"result"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"output"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"path"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"/output"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastModified"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-11-06T13:34:35.000-06:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"length"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"permission"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"NONE"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mimeType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"text/directory"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"folder"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dir"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/outputs/media/output"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"system"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/data.agaveapi.co"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"parent"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"demo-pyplot-demo-advanced-test-1414139896.err"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"path"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"/demo-pyplot-demo-advanced-test-1414139896.err"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastModified"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-11-06T13:34:27.000-06:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"length"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">442</span><span class="p">,</span><span class="w">
    </span><span class="nt">"permission"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"NONE"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mimeType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"application/octet-stream"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"unknown"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"file"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/outputs/media/demo-pyplot-demo-advanced-test-1414139896.err"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"system"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/data.agaveapi.co"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"parent"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"demo-pyplot-demo-advanced-test-1414139896.out"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"path"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"/demo-pyplot-demo-advanced-test-1414139896.out"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastModified"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-11-06T13:34:30.000-06:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"length"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1396</span><span class="p">,</span><span class="w">
    </span><span class="nt">"permission"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"NONE"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mimeType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"application/octet-stream"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"unknown"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"file"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/outputs/media/demo-pyplot-demo-advanced-test-1414139896.out"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"system"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/data.agaveapi.co"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"parent"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"demo-pyplot-demo-advanced-test-1414139896.pid"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"path"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"/demo-pyplot-demo-advanced-test-1414139896.pid"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastModified"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-11-06T13:34:33.000-06:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"length"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
    </span><span class="nt">"permission"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"NONE"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mimeType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"application/octet-stream"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"unknown"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"file"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/outputs/media/demo-pyplot-demo-advanced-test-1414139896.pid"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"system"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/data.agaveapi.co"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"parent"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"testdata.csv"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"path"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"/testdata.csv"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastModified"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-11-06T13:34:42.000-06:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"length"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">3212</span><span class="p">,</span><span class="w">
    </span><span class="nt">"permission"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"NONE"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mimeType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"application/octet-stream"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"unknown"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"file"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/outputs/media/testdata.csv"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"system"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/data.agaveapi.co"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"parent"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>To download a file you would use the following syntax</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://public.tenants.agaveapi.co/jobs/v2/<span class="nv">$JOB_ID</span>/outputs/media/<span class="nv">$PATH</span>
</code></pre>

<aside class="notice">The Jobs output service follows the same conventions of the Files service. Thus, you may specify a range header to retrieve a specific byte range. This is particularly helpful when tracking job progress since it gives you a mechanism to tail the output and error log files.</aside>

<p>Regardless of job status, the above services will always point to the most recent location of the job data. If you choose for the Jobs service to archive your job after completion, the URL will point to the archive folder of the job. If you do not choose to archive your data, or if archiving fails, the URL will point to the execution folder created for your job at runtime. Because Agave does not own any of the underlying hardware, it cannot guarantee that those locations will always exist. If, for example, the execution system enforces a purge policy, the output data may be deleted by the system administrators. Agave will let you know if the data is no longer present, however, it cannot prevent it from being deleted. This is another reason that it is important to archive data you feel will be needed in the future.</p>

              <h3 id="job-lifecycle-management">Job Lifecycle Management</h3>

<p>Agave handles all of the end-to-end details involved with managing a job lifecycle for you. This can seem like black magic at times, so here we detail the overall lifecycle process every job goes through.</p>

<ol>
<li>Job request is made, validated, and saved.</li>
<li>Job is queued up for execution. Job stays in a pending state until there are resources to run the job. This means that the target execution system is online, the storage system with the app assets is online, and neither the user nor the system are over quota.
a. Resource do not become available with 7 days, the job is killed.
b. Resources are available, the job moves on.</li>
<li>When resources are available to run the job on the execution system, a work directory is created on the execution system. The job work directory is created based on the following logic:

[code lang=plain]
if (executionSystem.scratchDir exists) 
then
    $jobDir = executionSystem.scratchDir
else if (executionSystem.workDir exists)
then
    $jobDir = system.workDir  
else 
    $jobDir = system.storage.homeDir
endif

$jobDir = $jobDir + &ldquo;/&rdquo; + job.owner + &ldquo;/job-&rdquo; + job.uuid
&ldquo;`</li>
<li>The job inputs are staged to the job work directory, job status is updated to &quot;INPUTS_STAGING&rdquo;
a. All inputs succeed and the job is updated to &ldquo;STAGED&rdquo;
b. One or more inputs fail to transfer. Job status is set back to &ldquo;PENDING&rdquo; and staging will be attempted up to 2 more times.
c. User does not have permission to access one or more inputs. The job is set to &ldquo;FAILED&rdquo; and exists.</p></li>
<li>The job again waits until the resources are available to run the job. Usually this is immediately after the inputs finish staging.
a. Resource do not become available with 7 days, the job is killed.
b. Resources are available, the job moves on.</li>
<li>The app deploymentPath is copied from the app.deploymentSystem to a temp dir on the API server. The jobs API then processes the app.deploymentDir + &ldquo;/&rdquo; + app.templatePath file to create the .ipcexe file. The process goes as follows:

<ol>
<li>Script headers are written. This includes scheduler directives if a batch system, shbang if a forked app. </li>
<li>Additional executionSystem[job.batchQueue].customDirectives are written</li>
<li>&ldquo;RUNNING&rdquo; callback written</li>
<li>Module commands are written</li>
<li>executionSystem.environment is written</li>
<li>wrapper script is filtered

<ol>
<li>blacklisted commands are removed</li>
<li>app parameter template variables are resolved against job parameter values.</li>
<li>app input template variables are resolved against job input values</li>
<li>blacklisted commands are removed again</li>
</ol></li>
<li>&ldquo;CLEANING_UP&rdquo; callback written</li>
<li>All template macros are resolved.</li>
<li>job.name.slugify + &ldquo;.ipcexe&rdquo; file written to temp directory</li>
</ol></li>
<li>App assets with wrapper template are copied to remote job work directory.</li>
<li>Directory listing of job work directory is written to a .agave.archive manifest file in the remote job work directory.</li>
<li>Command line is generated to invoke the *.ipcexe file by the appropriate method for the execution system.</li>
<li>Command line is run on the remote system.
a. The command succeeds and the scheduler/process/job id is captured and stored with the job record.
b. The command fails, return the job to &ldquo;STAGED&rdquo; status and try up to 2 more times.</li>
<li>Job is updated to &ldquo;QUEUED&rdquo;</li>
<li>Job waits for a &ldquo;RUNNING&rdquo; callback and adds a background process to monitor the job in case the callback never comes. </li>
<li><p>Callback checks the job status  according the the following schedule

[code lang=plain]
* every 30 seconds for the first 5 minutes
* every minute for the next 30 minutes
* every 5 minutes for the next hour
* every 15 minutes for the next 12 hours
* every 30 minutes for the next 24 hours
* every hour for the next 14 days 
&ldquo;`</li>
<li><p>Job either calls back with a &quot;CLEANING_UP&rdquo; status update or the monitoring process discovers the job no longer exists on the remote system.</p></li>
<li>If job.archive is true, send job to archiving queue to stage outputs to job.archiveSystem

<ol>
<li>Resource do not become available with 7 days, the job is killed.</li>
<li>Resources are available, the job moves on.

<ol>
<li>Read the .agave.archive manifest file from the job work directory</li>
<li>Begin a breadth first directory traversal of the job work directory</li>
<li>If a file/folder is not in the .agave.archive manifest, copy it to the job.archivePath on the job.archiveSystem</li>
<li>Delete the job work directory</li>
</ol></li>
</ol></li>
<li>Update job status to &ldquo;FINISHED&rdquo;</li>
</ol>

<!-- 
### Introduction 

### Submission

#### Validation
#### Permissions
#### Availability
#### Common failures
#### Handling uncertainty
#### Drop dead dates

### Queues, queues, and queues

#### Quotas
#### Capacity
#### Scheduling
#### Common failures
#### Handling uncertainty
#### Drop dead dates


### Data staging

#### Remote working directory
#### Scheduling
#### Validation
#### Availability
#### Permissions
#### Retry policy
#### Common failures
#### Handling uncertainty
#### Drop dead dates

### App staging

#### App asset staging 
#### Wrapper template creation 
##### Runtime variables 
##### Input values 
##### Parameter values 
#### Shell portability 
#### Environment setup 
#### Input data 
#### .agave.archive manifest 
#### Common failures

### App submission

#### Remote job ownership
#### Remote working directory
#### Runtime security considerations
#### Remote system quotas

#### Batch scheduler submission
##### Batch submit script
##### Custom directives
##### Remote job ids
##### Batch queue selection
##### Batch queue policy

#### Condor scheduler submission
##### Condor submit script
##### Job working directory vs condor working directory
##### Unpacking the app bundle
##### Local execution vs. gliding
##### Secondary data stage in
##### Monitoring condord
##### Condor log files
##### Secondary data stage out
##### Network performance

#### Fork submission
##### Submit script
##### Modules and environment
##### Remote process ids
##### Redirecting output
##### Job logs
##### Ghost processes

#### Handling uncertainty
#### Drop dead dates

### Monitoring status

#### Heartbeat callbacks
#### Job callbacks
#### Background checks
##### Exponential backoff
##### Batch scheduler queries
##### condor_q queries
##### Process checks
#### Common failures
#### Handling uncertainty
#### Drop dead dates

### Post-execution

#### Finishing housekeeping tasks
#### Data preservation
#### Common failures
#### Handling uncertainty
#### Drop dead dates

### Archiving outputs

#### Raw transfer
#### Filetype detection
#### Metadata creation
#### Data permissions
#### Determining archive path
#### Performance considerations
#### Common failures
#### Handling uncertainty
#### Drop dead dates

### Job completion

#### Canonical job output references
#### Data preservation
#### Data sharing
#### Log files
#### Resubmission
#### Common failures
#### Handling uncertainty
#### Drop dead dates
-->

              <h3 id="permissions-and-sharing">Permissions and sharing</h3>

<p>As with the <a title="System Registration" href="http://agaveapi.co/system-registration/">Systems</a>, <a title="Application Management" href="http://agaveapi.co/application-management/">Apps</a>, and <a title="File Management" href="http://agaveapi.co/file-management/">Files</a> services, your jobs have their own set of access controls. Using these, you can share your job and its data with other Agave users. Job permissions are private by default. The permissions you give a job apply both to the job, its outputs, its metadata, and the permissions themselves. Thus, by sharing a job with another user, you share all aspects of that job.</p>

<p>Job permissions are managed through a set of URLs consistent with the permissions URL elsewhere in the API.</p>

<h4 id="granting">Granting</h4>
<pre class="highlight shell"><code><span class="c"># General grant</span>
curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
     -X POST --data-binary <span class="s1">'{"permission":"READ","username":"$USERNAME"}'</span> <span class="se">\</span>
     https://public.tenants.agaveapi.co/jobs/v2/<span class="nv">$JOB_ID</span>/pems

<span class="c"># Custom url grant</span>
curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
     -X POST --data-binary <span class="s1">'{"permission":"READ"}'</span> <span class="se">\</span>
     https://public.tenants.agaveapi.co/jobs/v2/<span class="nv">$JOB_ID</span>/pems/<span class="nv">$USERNAME</span>
</code></pre>
<pre class="highlight plaintext"><code>jobs-pems-update -u $USERNAME $JOB_ID
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$USERNAME"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"permission"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/jobs/v2/$JOB_ID/pems/$USERNAME"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"parent"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/jobs/v2/$JOB_ID"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/$USERNAME"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Granting permissions is simply a matter of issuing a <code class="prettyprint">POST</code> with the desired permission object to the job&rsquo;s <code class="prettyprint">pems</code> collection.</p>

<p>The available permission values are listed in Table 2.</p>

<table>
    <thead>
        <tr>
            <th>Permission</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>READ</td>
            <td>Gives the ability to view the job status, and output data.</td>
        </tr>
        <tr>
            <td>WRITE</td>
            <td>Gives the ability to perform actions, manage metadata, and set permissions.</td>
        </tr>
        <tr>
            <td>ALL</td>
            <td>Gives full READ and WRITE permissions to the user.</td>
        </tr>
        <tr>
            <td>READ_WRITE</td>
            <td>Synonymous to ALL. Gives full READ and WRITE permissions to the user</td>
        </tr>
    </tbody>
</table>

<p class="table-caption">Table 2. Supported job permission values.</p>

<p><alert class="alert-warning">Job permissions are distinct from file permissions. In many instances, your job output will be accessible via the Files and Jobs services simultaneously. Granting a user permissions a job output file through the Files services does not alter the accessibility of that file through the Jobs service. It is important, then, that you consider to whom you grant permissions, and the implications of that decision in all areas of your application.</alert></p>

<h4 id="listing">Listing</h4>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    <span class="s1">'https://public.agaveapi.co/jobs/v2/$JOB_ID/pems/'</span>
</code></pre>
<pre class="highlight plaintext"><code>jobs-pems-list -V $JOB_ID
</code></pre>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$API_USERNAME"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"permission"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/jobs/v2/6608339759546166810-242ac114-0001-007/pems/$API_USERNAME"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"parent"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/jobs/v2/6608339759546166810-242ac114-0001-007"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/$API_USERNAME"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$USERNAME"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"permission"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/jobs/v2/$JOB_ID/pems/$USERNAME"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"parent"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/jobs/v2/$JOB_ID"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/$USERNAME"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>To find the permissions for a given job, make a GET on the job&rsquo;s <code class="prettyprint">pems</code> collection. Here we see that both the job owner and the user we just granted permission to appear in the response.</p>

<h4 id="updating">Updating</h4>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
     -X POST --data-binary <span class="o">{</span><span class="s2">"permission"</span>:<span class="s2">"READ_WRITE}"</span> <span class="se">\</span>
     https://public.tenants.agaveapi.co/jobs/v2/<span class="nv">$JOB_ID</span>/<span class="nv">$USERNAME</span>
</code></pre>
<pre class="highlight plaintext"><code>jobs-pems-update -u $USERNAME -p READ_WRITE $JOB_ID
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$USERNAME"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"permission"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/jobs/v2/$JOB_ID/pems/$USERNAME"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"parent"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/jobs/v2/$JOB_ID"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/$USERNAME"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Updating is exactly like granting permissions. Just POST to the same job&rsquo;s <code class="prettyprint">pems</code> collection.</p>

<h4 id="deleting">Deleting</h4>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -X DELETE <span class="se">\</span>
     https://public.tenants.agaveapi.co/jobs/v2/<span class="nv">$JOB_ID</span>/<span class="nv">$USERNAME</span>
</code></pre>
<pre class="highlight plaintext"><code>jobs-pems-update -u $USERNAME -p '' $JOB_ID
</code></pre>

<p>To delete a permission, you can issue a DELETE request on the user permission resource we&rsquo;ve been using, or update with an empty permission value.</p>

              <h2 id="notifications">Notifications</h2>
<pre class="highlight json"><code><span class="w"> </span><span class="err">/$$$$$$$</span><span class="w">          </span><span class="err">/$$</span><span class="w">       </span><span class="err">/$$$$$$</span><span class="w">          </span><span class="err">/$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">        </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">      </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">        </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$/$$</span><span class="w">   </span><span class="err">/$|</span><span class="w"> </span><span class="err">$$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\__//$$</span><span class="w">   </span><span class="err">/$|</span><span class="w"> </span><span class="err">$$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$____/|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$\____</span><span class="w">  </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$/$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w"> </span><span class="err">$$$$$$$|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w"> </span><span class="err">$$$$$$$/</span><span class="w">
</span><span class="err">|__/</span><span class="w">      </span><span class="err">\______/|_______/</span><span class="w"> </span><span class="err">\______/</span><span class="w"> </span><span class="err">\______/|_______/</span><span class="w">
</span></code></pre>

<p>Under the covers, the Agave API is an event-driven distributed system implemented on top of a reliable, cloud-based messaging system. This means that every action either observed or taken by Agave is tied to an event. The changing of a job from one status to another is an event. The granting of permissions on a file is an event. Editing a piece of metadata is an event, and to be sure, the moment you created an account with Agave was an event. You get the idea.</p>

<p>Having such a fine-grain event system is helpful for the same reason that having a fine-grain permission model is helpful. It affords you the highest degree of flexibility and control possible to achieve the behavior you desire. With Agave&rsquo;s event system, you have the ability to alert your users (or yourself) the instant something occurs. You can be proactive rather than reactive, and you can begin orchestrating your complex tasks in a loosely coupled, asynchronous way.</p>

<h3 id="subscriptions">Subscriptions</h3>

<blockquote>
<p>Example notification subscription request</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"associatedUuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0001409758089943-5056a550b8-0001-002"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OVERWRITTEN"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"persistent"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan@rangers.mlb.com"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>As consumers of Agave, you have the ability to subscribe to events occurring on any resource to which you have access. By that we mean, for example, you could subscribe to events on your job and a job that someone shared with you, but you could not subscribe to events on a job submitted by someone else who has not shared the job with you. Basically, if you can see a resource, you can subscribe to its events.</p>

<p>The Notifications service is the primary mechanism by which you create and manage your event subscriptions. A typical use case is a user subscribing for an email alert when her job completes. The following JSON object represents a request for such a notification.</p>

<p>The <code class="prettyprint">associatedUuid</code> value is the UUID of her job. Here, we given the UUID of the <code class="prettyprint">picsumipsum.txt</code> file we uploaded in the <a href="#files" title="Data Management Guide">Files API</a> guide. The <code class="prettyprint">event</code> value is the name of the event to which she wants to be notified. This example is asking for an email to be sent whenever the file is overwritten. She could have just as easily specified a status of DELETED or RENAME to be notified when the file was deleted or renamed.</p>

<p>The <code class="prettyprint">persistent</code> value specifies whether the notification should fire more than once. By default, all event subscriptions are transient. This is because the events themselves are transient. An event occurs, then it is over. There are, however, many situations where events could occur over and over again. Permission events, changes to metadata and data, application registrations on a system, job submissions to a system or queue, etc., all are transient events that can potentially occur many, many times. In these cases it is either not possible or highly undesirable to constantly resubscribe for the same event. The persistent attribute tells the notification service to keep a subscription alive until it is explicitly deleted.</p>

<aside class="notice">In certain situations you may wish to subscribe to multiple events. You are free to add as many subscriptions as you wish, however in the event that you want to subscribe to all possible events for a given resource, use the wildcard value, `*`, as the event. This tells the Notifications service that you wanted to be notified of every event for that resource.</aside>

<aside class="info">A listing of all Agave&rsquo;s resource-level events, grouped by resource, can be found in the <a href="#events">Events</a> section.</aside>

<p>Continuing to work through the example, the <code class="prettyprint">url</code> value specifies where the notification should be sent. In this example, our example user specified that she would like to be notified via email. Agave supports both email and webhook notifications. If you are unfamiliar with webhooks, take a moment to glance at the <a href="http://webhooks.org" target="_blank">webhooks.org</a> page for a brief overview. If you are a <a href="http://en.wikipedia.org/wiki/Design_Patterns_(book)" title="Gang of Four" target="_blank">Gang of Four</a> disciple, webhooks are a mechanism for implementing the <a href="http://en.wikipedia.org/wiki/Observer%5Fpattern" title="Observer Pattern" target="_blank">Observer Pattern</a>. Webhooks are widely used across the web and chances are that something you&rsquo;re using right now is leveraging them.</p>

              <h3 id="url-macros">URL Macros</h3>

<blockquote>
<p>Receive a callback when a new user is created that includes the new user&rsquo;s information</p>
</blockquote>
<pre class="highlight html"><code>https://example.com/sendWelcome.php?username=${USERNAME}<span class="err">&amp;</span>email=${EMAIL}<span class="err">&amp;</span>firstName=${FIRST_NAME}<span class="err">&amp;</span>lastName=${LAST_NAME}<span class="err">&amp;</span>src=agaveapi.co<span class="err">&amp;</span>nonce=1234567
</code></pre>

<blockquote>
<p>Receive self-describing job status updates</p>
</blockquote>
<pre class="highlight html"><code>http://example.com/job/${JOB_ID}?status=${STATUS}<span class="err">&amp;</span>lastUpdated=${LAST_UPDATED}
</code></pre>

<blockquote>
<p>Get notified on all jobs going into and out of queues</p>
</blockquote>
<pre class="highlight html"><code>http://example.com/system/${EXECUTION_SYSTEM}/queue/${QUEUE}?action=add
http://example.com/system/${EXECUTION_SYSTEM}/queue/${QUEUE}?action=subtract
</code></pre>

<blockquote>
<p>Rerun an analysis when a files finishes staging</p>
</blockquote>
<pre class="highlight html"><code>https://$AGAVE_BASE_URL/jobs/v2/a32487q98wasdfa9-09090b0b-007?action=resubmit
</code></pre>

<blockquote>
<p>Use plus mailing to route job notifications to different folders</p>
</blockquote>
<pre class="highlight html"><code>nryan+${EXECUTION_SYSTEM}+${JOB_ID}@gmail.com
</code></pre>

<p>In the context of Agave, a webhook is a URL to which Agave will send a POST request when that event occurs. A webhook can be any web accessible URL. While you cannot customize the POST content that Agave sends (it is unique to the event), you can take advantage of the many template variables that Agave provides to customize the URL at run time. The following tables show the webhook template variables available for each resource. Use the select box to view the macros for different resources.</p>

<p>
    <select id="notification-macros-selector" name="notification-macros-selector" onChange="$('.notification-macros').addClass('hidden'); $('#' + $(this).val()).removeClass('hidden');">
        <option value="notification-macros-apps">Apps</option>
        <option value="notification-macros-jobs">Jobs</option>
        <option value="notification-macros-files">Files</option>
        <option value="notification-macros-metadata">Metadata</option>
        <option value="notification-macros-metadata-schema">Metadata Schema</option>
        <option value="notification-macros-monitors">Monitors</option>
        <option value="notification-macros-notifications">Notifications</option>
        <option value="notification-macros-postits">PostIts</option>
        <option value="notification-macros-profiles">Profiles</option>
        <option value="notification-macros-systems">Systems</option>
        <option value="notification-macros-transforms">Transforms</option>
    </select>
</p>

<p><table id="notification-macros-apps" class="notification-macros">
    <thead>
        <tr>
            <th>Variable</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>UUID</td>
            <td>The UUID of the app.</td>
        </tr>
        <tr>
            <td>EVENT</td>
            <td>The event which occurred</td>
        </tr>
        <tr>
            <td>APP_ID</td>
            <td>The application id (ex. sabermetrics-2.1)</td>
        </tr>
    </tbody>
</table></p>

<p><table id="notification-macros-jobs" class="notification-macros hidden">
    <thead>
        <tr>
            <th>Variable</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>UUID</td>
            <td>The UUID of the job</td>
        </tr>
        <tr>
            <td>EVENT</td>
            <td>The event which occurred</td>
        </tr>
        <tr>
            <td>JOB_STATUS</td>
            <td>The status of the job at the time the event occurs</td>
        </tr>
        <tr>
            <td>JOB_URL</td>
            <td>The url of the job within the API</td>
        </tr>
        <tr>
            <td>JOB_ID</td>
            <td>The unique id used to reference the job within Agave.</td>
        </tr>
        <tr>
            <td>JOB_SYSTEM</td>
            <td>ID of the job execution system (ex. ssh.execute.example.com)</td>
        </tr>
        <tr>
            <td>JOB_NAME</td>
            <td>The user-supplied name of the job</td>
        </tr>
        <tr>
            <td>JOB_START_TIME</td>
            <td>The time when the job started running in ISO8601 format.</td>
        </tr>
        <tr>
            <td>JOB_END_TIME</td>
            <td>The time when the job stopped running in ISO8601 format.</td>
        </tr>
        <tr>
            <td>JOB_SUBMIT_TIME</td>
            <td>The time when the job was submitted to Agave for execution by the user in ISO8601 format.</td>
        </tr>
        <tr>
            <td>JOB_ARCHIVE_PATH</td>
            <td>The path on the archive system where the job output will be staged.</td>
        </tr>
        <tr>
            <td>JOB_ARCHIVE_URL</td>
            <td>The Agave URL for the archived data.</td>
        </tr>
        <tr>
            <td>JOB_ERROR</td>
            <td>The error message explaining why a job failed. Null if completed successfully.</td>
        </tr>
    </tbody>
</table></p>

<p><table id="notification-macros-files" class="notification-macros hidden">
    <thead>
        <tr>
            <th>Variable</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>UUID</td>
            <td>The UUID of the file</td>
        </tr>
        <tr>
            <td>EVENT</td>
            <td>The event which occurred</td>
        </tr>
        <tr>
            <td>TYPE</td>
            <td>The application id (ex. sabermetrics-2.1)</td>
        </tr>
        <tr>
            <td>FORMAT</td>
            <td>The data format of the file/folder.</td>
        </tr>
        <tr>
            <td>PATH</td>
            <td>Path to the file/folder on the remote system</td>
        </tr>
        <tr>
            <td>SYSTEM</td>
            <td>ID of the system on which the file/folder exists (ex. ssh.execute.example.com)</td>
        </tr>
    </tbody>
</table></p>

<p><table id="notification-macros-metadata" class="notification-macros hidden">
    <thead>
        <tr>
            <th>Variable</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>UUID</td>
            <td>The UUID of the metadata object</td>
        </tr>
        <tr>
            <td>EVENT</td>
            <td>The event which occurred</td>
        </tr>
    </tbody>
</table></p>

<p><table id="notification-macros-metadata-schema" class="notification-macros hidden">
    <thead>
        <tr>
            <th>Variable</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>UUID</td>
            <td>The UUID of the schemata object</td>
        </tr>
        <tr>
            <td>EVENT</td>
            <td>The event which occurred</td>
        </tr>
    </tbody>
</table></p>

<p><table id="notification-macros-monitors" class="notification-macros hidden">
    <thead>
        <tr>
            <th>Variable</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>UUID</td>
            <td>The UUID of the monitor</td>
        </tr>
        <tr>
            <td>EVENT</td>
            <td>The event which occurred</td>
        </tr>
        <tr>
            <td>OWNER</td>
            <td>The owner of the monitor</td>
        </tr>
        <tr>
            <td>TARGET</td>
            <td>The system to which the monitor applies</td>
        </tr>
        <tr>
            <td>ACTIVE</td>
            <td>Whether the monitor is active or inactive</td>
        </tr>
        <tr>
            <td>UPDATE_SYSTEM_STATUS</td>
            <td>Whether the system status will be updated with the check results</td>
        </tr>
        <tr>
            <td>INTERNAL_USERNAME</td>
            <td>The internal user associated with the status check</td>
        </tr>
        <tr>
            <td>CREATED</td>
            <td>The time the monitor was created in ISO8601 format</td>
        </tr>
        <tr>
            <td>LAST_SUCCESS</td>
            <td>The time the monitor last successfully ran in ISO8601 format</td>
        </tr>
        <tr>
            <td>LAST_UPDATED</td>
            <td>The time the monitor last ran in ISO8601 format</td>
        </tr>
        <tr>
            <td>NEXT_CHECK</td>
            <td>The time the monitor will run in ISO8601 format</td>
        </tr>
        <tr>
            <td>FREQUENCY</td>
            <td>The frequency in minutes that the monitor runs</td>
        </tr>
    </tbody>
</table></p>

<p><table id="notification-macros-notification" class="notification-macros hidden">
    <thead>
        <tr>
            <th>Variable</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>UUID</td>
            <td>The UUID of the notification object</td>
        </tr>
        <tr>
            <td>EVENT</td>
            <td>The event which caused the notification for this notification resource to be sent.</td>
        </tr>
        <tr>
            <td>URL</td>
            <td>The URL to which this notification will be published.</td>
        </tr>
        <tr>
            <td>ATTEMPTS</td>
            <td>Maximum retry attempts that will be made for this notification.</td>
        </tr>
        <tr>
            <td>RESPONSE_CODE</td>
            <td>The last response code for a delivery attempt for this notification</td>
        </tr>
        <tr>
            <td>LAST_UPDATED</td>
            <td>The timestamp of the last time this notification was updated in ISO8601 format</td>
        </tr>
        <tr>
            <td>ASSOCIATED_ID</td>
            <td>The resource whose events this notification is subscribed</td>
        </tr>
        <tr>
            <td>CREATED</td>
            <td>The timestamp when the notification was created in ISO8601 format</td>
        </tr>
        <tr>
            <td>STATUS</td>
            <td>The current status of this notification. eg. ACTIVE, INACTIVE, FAILED, COMPLETE.</td>
        </tr></p>

<p></tbody>
</table></p>

<p><table id="notification-macros-postits" class="notification-macros hidden">
    <thead>
        <tr>
            <th>Variable</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>UUID</td>
            <td>The UUID of the PostIt</td>
        </tr>
        <tr>
            <td>EVENT</td>
            <td>The event which occurred</td>
        </tr>
        <tr>
            <td>NONCE</td>
            <td>Nonce specified in the POSTIT url</td>
        </tr>
        <tr>
            <td>CREATED</td>
            <td>Time the PostIt was created ISO8601 format</td>
        </tr>
        <tr>
            <td>RENEWED</td>
            <td>Last time the PostIt was renewed in ISO8601 format</td>
        </tr>
        <tr>
            <td>EXPIRES</td>
            <td>Time the PostIt expires in ISO8601 format</td>
        </tr>
        <tr>
            <td>TARGET_URL</td>
            <td>Remote URL which will be called when the PostIt is redeemed</td>
        </tr>
        <tr>
            <td>TARGET_METHOD</td>
            <td>HTTP method that will be called on the TARGET_URL</td>
        </tr>
        <tr>
            <td>REMAINING_USES</td>
            <td>Number of invocations remaining for this PostIt</td>
        </tr>
        <tr>
            <td>POSTIT</td>
            <td>Full PostIt URL</td>
        </tr>
    </tbody>
</table></p>

<p><table id="notification-macros-profiles" class="notification-macros hidden">
    <thead>
        <tr>
            <th>Variable</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>UUID</td>
            <td>The UUID of the profile</td>
        </tr>
        <tr>
            <td>EVENT</td>
            <td>The event which occurred</td>
        </tr>
        <tr>
            <td>USERNAME</td>
            <td>Username of the user</td>
        </tr>
        <tr>
            <td>EMAIL</td>
            <td>Email address of the user</td>
        </tr>
        <tr>
            <td>FIRST_NAME</td>
            <td>First name of the user</td>
        </tr>
        <tr>
            <td>LAST_NAME</td>
            <td>Last name of the user</td>
        </tr>
        <tr>
            <td>POSITION</td>
            <td>Formal job position</td>
        </tr>
        <tr>
            <td>INSTITUTION</td>
            <td>Institution in which they work</td>
        </tr>
        <tr>
            <td>PHONE</td>
            <td>Phone number</td>
        </tr>
        <tr>
            <td>FAX</td>
            <td>Fax number</td>
        </tr>
        <tr>
            <td>RESEARCH_AREA</td>
            <td>Domain of science</td>
        </tr>
        <tr>
            <td>DEPARTMENT</td>
            <td>Department in which they work</td>
        </tr>
        <tr>
            <td>CITY</td>
            <td>City of residence</td>
        </tr>
        <tr>
            <td>STATE</td>
            <td>State of residence</td>
        </tr>
        <tr>
            <td>COUNTRY</td>
            <td>Country of residence</td>
        </tr>
        <tr>
            <td>GENDER</td>
            <td>Male, female or null if unknown</td>
        </tr>
        <tr>
            <td>ACTIVE</td>
            <td>True if the user is active. False otherwise</td>
        </tr>
        <tr>
            <td>LAST_UPDATED</td>
            <td>The last time this user was updated in ISO8601 format</td>
        </tr>
    </tbody>
</table></p>

<p><table id="notification-macros-systems" class="notification-macros hidden">
    <thead>
        <tr>
            <th>Variable</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>UUID</td>
            <td>The UUID of the system</td>
        </tr>
        <tr>
            <td>EVENT</td>
            <td>The event which occurred</td>
        </tr>
        <tr>
            <td>SYSTEM_ID</td>
            <td>ID of the system (ex. ssh.execute.example.com)</td>
        </tr>
        <tr>
            <td>STATUS</td>
            <td>Current status of the system: UP, DOWN, UNKNOWN</td>
        </tr>
        <tr>
            <td>PUBLIC</td>
            <td>True if the system is publicly available, false otherwise</td>
        </tr>
        <tr>
            <td>GLOBAL_DEFAULT</td>
            <td>True if the system is one of the two default publicly available systems, false otherwise</td>
        </tr>
        <tr>
            <td>LAST_UPDATED</td>
            <td>The last time this system was updated in ISO8601 format</td>
        </tr>
        <tr>
            <td>STORAGE_PROTOCOL</td>
            <td>The protocol used to move data to and from this system</td>
        </tr>
        <tr>
            <td>STORAGE_HOST</td>
            <td>The storage host for this sytem</td>
        </tr>
        <tr>
            <td>STORAGE_POST</td>
            <td>The storage port for this system</td>
        </tr>
        <tr>
            <td>STORAGE_RESOURCE</td>
            <td>The system resource for iRODS systems</td>
        </tr>
        <tr>
            <td>STORAGE_ZONE</td>
            <td>The system zone for iRODS systems</td>
        </tr>
        <tr>
            <td>STORAGE_ROOT_DIR</td>
            <td>The virtual root directory exposed on this system</td>
        </tr>
        <tr>
            <td>STORAGE_HOME_DIR</td>
            <td>The home directory on this system relative to the STORAGE_ROOT_DIR</td>
        </tr>
        <tr>
            <td>STORAGE_AUTH_TYPE</td>
            <td>The storage authentication method for this system</td>
        </tr>
        <tr>
            <td>LOGIN_PROTOCOL</td>
            <td>The protocol used to establish a session with this system (eg SSH, GSISSH, etc)</td>
        </tr>
        <tr>
            <td>LOGIN_HOST</td>
            <td>The login host for this system</td>
        </tr>
        <tr>
            <td>LOGIN_PORT</td>
            <td>The login port for this system</td>
        </tr>
        <tr>
            <td>LOGIN_AUTH_TYPE</td>
            <td>The login authentication method for this system</td>
        </tr>
    </tbody>
</table></p>

<p><table id="notification-macros-transforms" class="notification-macros hidden">
    <thead>
        <tr>
            <th>Variable</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>UUID</td>
            <td>The UUID of the transfer</td>
        </tr>
        <tr>
            <td>EVENT</td>
            <td>The event which occurred</td>
        </tr>
        <tr>
            <td>SOURCE</td>
            <td>The source URL of this transfer</td>
        </tr>
        <tr>
            <td>DESTINATION</td>
            <td>The destination URL of this transfer</td>
        </tr>
        <tr>
            <td>STATUS</td>
            <td>The current status of this transfer in ISO8601 format</td>
        </tr>
        <tr>
            <td>CREATED</td>
            <td>The time the transfer was submitted to Agave in ISO8601 format</td>
        </tr>
        <tr>
            <td>START_TIME</td>
            <td>The time the transfer started in ISO8601 format</td>
        </tr>
        <tr>
            <td>END_TIME</td>
            <td>The time the transfer ended in ISO8601 format</td>
        </tr>
        <tr>
            <td>TOTAL_SIZE</td>
            <td>Total data size to be transferred</td>
        </tr>
        <tr>
            <td>TOTAL_TRANSFER</td>
            <td>Total bytes transferred</td>
        </tr>
        <tr>
            <td>TRANSFER_RATE</td>
            <td>Average transfer rate of all data moved in this transfer given in Gbps</td>
        </tr>
        <tr>
            <td>ATTEMPTS</td>
            <td>Number of attempts made to transfer the SOURCE data</td>
        </tr>
    </tbody>
</table></p>

<p>The value of webhook template variables is that they allow you to build custom callbacks using the values of the resource variable at run time. Several commonly used webhooks are shown in the tables above.</p>

              <h3 id="creating">Creating</h3>

<blockquote>
<p>Create a new notification subscription</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X POST <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    --data-binary <span class="s1">'{"associatedUuid": "7554973644402463206-242ac114-0001-007", "event": "FINISHED", "url": "http://requestbin.agaveapi.co/zyiomxzy?path=${PATH}&amp;system=${SYSTEM}&amp;event=${EVENT}" }'</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/notifications/v2?pretty<span class="o">=</span><span class="nb">true</span>
</code></pre>
<pre class="highlight plaintext"><code>notifications-addupdate -F notification.json
</code></pre>

<blockquote>
<p>Which will result in output similar to this</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7612526206168863206-242ac114-0001-011"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://requestbin.agaveapi.co/zyiomxzy?path=${PATH}&amp;system=${SYSTEM}&amp;event=${EVENT}"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"associatedUuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7554973644402463206-242ac114-0001-007"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FINISHED"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"responseCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"attempts"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nt">"lastSent"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"persistent"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ACTIVE"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"lastUpdated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-24T10:07:03.000-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-24T10:07:03.000-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"policy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"retryLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"retryRate"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"retryDelay"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"saveOnFailure"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"retryStrategy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NONE"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/notifications/v2/7612526206168863206-242ac114-0001-011"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"history"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/notifications/v2/7612526206168863206-242ac114-0001-011/history"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"attempts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/notifications/v2/7612526206168863206-242ac114-0001-011/attempts"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"job"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/jobs/v2/7554973644402463206-242ac114-0001-007"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Subscribing to an event is done by posting a form or JSON object to the Notifications service. An example of doing this using curl as well as the CLI is given below.</p>

<h3 id="updating">Updating</h3>

<blockquote>
<p>The updated notification subscription object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"associatedUuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7554973644402463206-242ac114-0001-007"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://requestbin.agaveapi.co/zyiomxzy?path=${PATH}&amp;system=${SYSTEM}&amp;event=${EVENT}"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>The JSON used to update the subscription is shown above</p>
</blockquote>

<p>Updating a subscription is done identically to creation except that the form or JSON is POSTed to the existing subscription URL. An example of doing this using curl as well as the CLI is given below.</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X POST <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -F <span class="s2">"fileToUpload=@notification.json"</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/notifications/v2/2699130208276770330-242ac114-0001-011
</code></pre>
<pre class="highlight plaintext"><code>notifications-addupdate -F notification.json 2699130208276770330-242ac114-0001-011
</code></pre>

<blockquote>
<p>Which will result in output similar to this</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7612526206168863206-242ac114-0001-011"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://requestbin.agaveapi.co/zyiomxzy?path=${PATH}&amp;system=${SYSTEM}&amp;event=${EVENT}"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"associatedUuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7554973644402463206-242ac114-0001-007"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"responseCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"attempts"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nt">"lastSent"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"persistent"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ACTIVE"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"lastUpdated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-24T10:07:03.000-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-24T10:07:03.000-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"policy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"retryLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"retryRate"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"retryDelay"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"saveOnFailure"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"retryStrategy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NONE"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/notifications/v2/7612526206168863206-242ac114-0001-011"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"history"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/notifications/v2/7612526206168863206-242ac114-0001-011/history"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"attempts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/notifications/v2/7612526206168863206-242ac114-0001-011/attempts"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"job"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/jobs/v2/7554973644402463206-242ac114-0001-007"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="listing">Listing</h3>

<blockquote>
<p>Listing notification subscriptions</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/notifications/v2/2699130208276770330-242ac114-0001-011
</code></pre>
<pre class="highlight plaintext"><code>notifications-list -V
</code></pre>

<blockquote>
<p>Which will result in output similar to this</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7612526206168863206-242ac114-0001-011"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://requestbin.agaveapi.co/zyiomxzy?path=${PATH}&amp;system=${SYSTEM}&amp;event=${EVENT}"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"associatedUuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7554973644402463206-242ac114-0001-007"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/notifications/v2/7612526206168863206-242ac114-0001-011"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"job"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/jobs/v2/7554973644402463206-242ac114-0001-007"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7404907487080223206-242ac114-0001-011"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan@rangers.texas.mlb.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"associatedUuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6904887394479903206-242ac114-0001-007"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FINISHED"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/notifications/v2/7404907487080223206-242ac114-0001-011"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"job"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/jobs/v2/6904887394479903206-242ac114-0001-007"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3676815741209931290-242ac114-0001-011"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan@rangers.texas.mlb.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"associatedUuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3717016635100491290-242ac114-0001-007"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FINISHED"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/notifications/v2/3676815741209931290-242ac114-0001-011"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"job"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/jobs/v2/3717016635100491290-242ac114-0001-007"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>You can get a list of your current notification subscriptions by performing a GET operation on the base /notifications collection. Adding the UUID of a notification will return just that notification. You can also query for all notifications assigned to a specific UUID by adding <code class="prettyprint">associatedUuid=$uuid</code>. An example of querying all notifications using curl as well as the CLI is given below.</p>

<h3 id="unsubscribing">Unsubscribing</h3>

<blockquote>
<p>Unsubscribing from a notification subscription</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -X DELETE <span class="se">\</span>
     https://public.tenants.agaveapi.co/notifications/v2/2699130208276770330-242ac114-0001-011
</code></pre>
<pre class="highlight plaintext"><code>notifications-delete -V
</code></pre>

<blockquote>
<p>An standard Agave response with an empty result will be returned.</p>
</blockquote>

<p>To unsubscribe from an event, perform a DELETE on the notification URL. Once deleted, you can not restore a subscription. You can, however create a new one. Keep in mind that if you do this, the UUID of the new notification will be different that that of the deleted one. An example of deleting a notification using curl as well as the CLI is given below.</p>

              <h3 id="retry-policies">Retry Policies</h3>

<blockquote>
<p>Sample notification subscription object with custom retry policy.</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"$REQUEST_BIN?path=${PATH}&amp;system=${SYSTEM}&amp;event=${EVENT}"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"event"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"persistent"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"policy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"retryStrategy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"IMMEDIATE"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"retryLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w">
      </span><span class="nt">"retryRate"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
      </span><span class="nt">"retryDelay"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nt">"saveOnFailure"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>In some situations, Agave may be unable to publish a specific notification. When this happens, Agave will immediately retry the notification 5 times in an attempt to deliver it successfully. When delivery fails for a 5th time, the notification is abandoned. If your application requires a more tenacious or methodical approach to retry delivery, you may provide a notification policy.</p>

<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>retryStrategy</td>
            <td>NONE, IMMEDIATE, DELAYED, EXPONENTIAL</td>
            <td>The retry strategy to employ. Default is IMMEDIATE</td>
        </tr>
        <tr>
            <td>retryRate</td>
            <td>int; 0:86400</td>
            <td>The frequency with which attempts should be made to deliver the message.</td>
        </tr>
        <tr>
            <td>retryLimit</td>
            <td>int; 0:1440</td>
            <td>The maximum attempts that should be made to delivery the message. </td>
        </tr>
        <tr>
            <td>retryDelay</td>
            <td>int; 0:86400</td>
            <td>The initial delay between the initial delivery attempt and the first retry.</td>
        </tr>
        <tr>
            <td>saveOnFailure</td>
            <td>boolean</td>
            <td>Whether the failed message should be persisted if unable to be delivered within the retryLimit</td>
        </tr>
    </tbody>
</table>

<p>Notification retry policies describe the strategy, frequency, delay, limit, and persistence to be applied when publishing an individual event for a given notification. The example above is our previous example with a notification policy included.</p>

<h3 id="failed-deliveries">Failed deliveries</h3>

<blockquote>
<p>Query failed attempts for a specific notification</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     https://<span class="nv">$API_BASE_URL</span>/notifications/<span class="nv">$API_VERSION</span>/229681451607921126-8e1831906a8e-0001-042<span class="s2">"/attempts
</span></code></pre>
<pre class="highlight plaintext"><code>notifications-list-failures 229681451607921126-8e1831906a8e-0001-042"
</code></pre>

<blockquote>
<p>A list of notification attempts will be returned.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">"id"</span> <span class="p">:</span> <span class="s2">"229681451607921126-8e1831906a8e-0001-042"</span><span class="p">,</span>
    <span class="s2">"url"</span> <span class="p">:</span> <span class="s2">"https://httpbin.org/status/500"</span><span class="p">,</span>
    <span class="s2">"event"</span> <span class="p">:</span> <span class="s2">"SENT"</span><span class="p">,</span>
    <span class="s2">"associatedUuid"</span> <span class="p">:</span> <span class="s2">"5833036796741676570-b0b0b0bb0b-0001-011"</span><span class="p">,</span>
    <span class="s2">"startTime"</span> <span class="p">:</span> <span class="s2">"2016-06-19T22:21:02.266-05:00"</span><span class="p">,</span>
    <span class="s2">"endTime"</span> <span class="p">:</span> <span class="s2">"2016-06-19T22:21:03.268-05:00"</span><span class="p">,</span>
    <span class="s2">"response"</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">"code"</span> <span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
      <span class="s2">"message"</span> <span class="p">:</span> <span class="s2">""</span>
    <span class="p">},</span>
    <span class="s2">"_links"</span> <span class="err">:</span> <span class="p">{</span>
      <span class="s2">"self"</span> <span class="err">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="err">:</span> <span class="s2">"https://$API_BASE_URL/notifications/$API_VERSION/229123105859441126-8e1831906a8e-0001-011/attempts/229681451607921126-8e1831906a8e-0001-042"</span>
      <span class="p">},</span>
      <span class="s2">"notification"</span> <span class="err">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="err">:</span> <span class="s2">"https://$API_BASE_URL/notifications/$API_VERSION/5833036796741676570-b0b0b0bb0b-0001-011"</span>
      <span class="p">},</span>
      <span class="s2">"profile"</span> <span class="err">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="err">:</span> <span class="s2">"https://$API_BASE_URL/profiles/$API_VERSION/ipcservices"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</code></pre>

<p>By providing a retry policy where <code class="prettyprint">saveOnFailure</code> is true, failed messages will be persisted and made available for querying at a later time. This is a great way to handled missed work due to a server failure, maintenance downtime, etc. To query for for failed messages</p>

<div class="warning">Note: There is no way to save successful notification deliveries.</div>

              <h2 id="postits">PostIts</h2>
<pre class="highlight json"><code><span class="w"> </span><span class="err">/$$$$$$$</span><span class="w">                       </span><span class="err">/$$</span><span class="w">    </span><span class="err">/$$$$$$</span><span class="w"> </span><span class="err">/$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">                     </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">   </span><span class="err">|_</span><span class="w">  </span><span class="err">$$_/|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$$$$$</span><span class="w">   </span><span class="err">/$$$$$$$</span><span class="w"> </span><span class="err">/$$$$$$</span><span class="w">   </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$$$$$$//$$__</span><span class="w">  </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$_____/|_</span><span class="w">  </span><span class="err">$$_/</span><span class="w">   </span><span class="err">|</span><span class="w"> </span><span class="err">$$|_</span><span class="w">  </span><span class="err">$$_/</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$____/|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$|</span><span class="w">  </span><span class="err">$$$$$$</span><span class="w">   </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">\____</span><span class="w">  </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$/</span><span class="w"> </span><span class="err">/$$$$$$$/</span><span class="w">  </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$//$$$$$$|</span><span class="w">  </span><span class="err">$$$$/</span><span class="w">
</span><span class="err">|__/</span><span class="w">      </span><span class="err">\______/</span><span class="w"> </span><span class="err">|_______/</span><span class="w">    </span><span class="err">\___/</span><span class="w"> </span><span class="err">|______/</span><span class="w"> </span><span class="err">\___/</span><span class="w">
</span></code></pre>

<p>The PostIts service is a URL shortening service similar to <a href="https://bit.ly">bit.ly</a>, <a href="https://goo.gl/">goo.gl</a>, and <a href="http://t.co">t.co</a>. It allows you to create pre-authenticated, disposable URLs to any resource in the Agave Platform. You have control over the lifetime and number of times the URL can be redeemed, and you can expire a PostIt at any time. As with all Science API resources, a full set of events is available for you to track usage and integrate the lifecycle of a PostIt into external applications as needed.</p>

<p>The most common use of PostIts is to create URLs to files and folders you can share with others without having to upload them to a third-party service. For example, using the PostIts service, you can share the output(s) of an experimental run, distribute materials for a class, submit data to a third-party service, and serve up assets for a static website like <a href="https://togo.agaveapi.co/">Agave ToGo</a>.</p>

<p>Other uses cases for the PostIts service include creating &ldquo;drop&rdquo; folders to which anyone with the link can upload data, allowing a job to be reproducibly rerun for peer review, publishing metadata for public consumption, publishing a canonical reference to your user profile. The possibilities go on and on. Anytime you need to share your science with your world, PostIts can help you.</p>

<h3 id="creating-postits">Creating PostIts</h3>

<blockquote>
<p>Creating a PostIt</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -X POST <span class="se">\</span>
    -d <span class="s2">"lifetime=3600"</span> <span class="se">\</span>
    -d <span class="s2">"maxUses=10"</span> <span class="se">\</span>
    -d <span class="s2">"method=GET"</span> <span class="se">\</span>
    -d <span class="s2">"url=https://public.agaveapi.co/files/v2/media/system/data.agaveapi.co/nryan/picksumipsum.txt"</span> <span class="se">\</span>
    <span class="s1">'https://public.agaveapi.co/postits/v2/?pretty=true'</span>
</code></pre>
<pre class="highlight plaintext"><code>postits-create \
    -m 10 \
    -l 86400 \
    https://public.agaveapi.co/files/v2/media/system/data.agaveapi.co/nryan/picksumipsum.txt
</code></pre>

<blockquote>
<p>Should result in something similar to the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"creator"</span><span class="p">:</span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"authenticated"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"created"</span><span class="p">:</span><span class="s2">"2016-09-30T21:51:31-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"expires"</span><span class="p">:</span><span class="s2">"2016-10-01T00:14:51-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"remainingUses"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="nt">"postit"</span><span class="p">:</span><span class="s2">"f61256c53bf3744185de4ac6c0c839b4"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"noauth"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"url"</span><span class="p">:</span><span class="s2">"https://public.agaveapi.co/files/v2/media/system/data.agaveapi.co//home/nryan/picksumipsum.txt"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"method"</span><span class="p">:</span><span class="s2">"GET"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:{</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.agaveapi.co/postits/v2/f61256c53bf3744185de4ac6c0c839b4"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"profile"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"file"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.agaveapi.co/files/v2/media/system/data.agaveapi.co//home/nryan/picksumipsum.txt"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>To create a PostIt, send a POST request to the PostIts service with the target url you want to share. In this example, we are sharing a file we have in Agave&rsquo;s cloud storage account.</p>

<p>In the response you see standard fields such as <code class="prettyprint">created</code> timestamp and the <code class="prettyprint">postit</code> token. You also see several fields that lead into the discussion of another aspect of PosIts, the ability to restrict usage and expire them on demand.</p>

<h3 id="restricting-postit-usage">Restricting PostIt usage</h3>

<p>When creating a PostIt, you have the ability to limit the lifespan, number of uses, and HTTP method used to connect to the target resource. The following table shows the fields available for this purpose. Not specifying any of these fields results in a single-use PostIt that remains valid for 1 calendar month.</p>

<table>
    <thead>
        <tr>
            <th>Attribute</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>maxUses</td>
            <td>JSON object</td>
            <td>The maximum number of times the postit may be redeemed. Defaults to 1.</td>
        </tr>
        <tr>
            <td>maxLifetime</td>
            <td>string</td>
            <td>The maximum lifetime in seconds over which the postit may be redeemed. Defaults to 1 month.</td>
        </tr>
        <tr>
            <td>method</td>
            <td>GET,POST,PUT,DELETE</td>
            <td>The HTTP method to be used to request the target resource when redeeming a postit. Defaults to GET</td>
        </tr>
        <tr>
            <td>noauth</td>
            <td>boolean</td>
            <td>Whether the request to the target resource should be authenticated. Defaults to true.</td>
        </tr>
    </tbody>
 </table>

<aside class="warning">If you intend and using a PostIt as a link in a web page or a messaging service like Slack, HipChat, Facebook, Twitter, etc, which unfurl URL for display, then you should set the maximum uses greater than 4 due to the number of preflight requests made to the URL for display. Failing to do so will result in the URL showing up in the feed, but failing to resolve when clicked to download.</aside>

<h3 id="listing-active-postits">Listing Active PostIts</h3>

<blockquote>
<p>Listing active PostIts</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    <span class="s1">'https://public.agaveapi.co/postits/v2/?pretty=true'</span>
</code></pre>
<pre class="highlight plaintext"><code>postits-list -v 
</code></pre>

<blockquote>
<p>Should result in something similar to the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"creator"</span><span class="p">:</span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"authenticated"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"created"</span><span class="p">:</span><span class="s2">"2016-09-30T21:51:31-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"expires"</span><span class="p">:</span><span class="s2">"2016-10-01T00:14:51-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"remainingUses"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="w">
    </span><span class="nt">"postit"</span><span class="p">:</span><span class="s2">"f61256c53bf3744185de4ac6c0c839b4"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"noauth"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"url"</span><span class="p">:</span><span class="s2">"https://public.agaveapi.co/files/v2/media/system/data.agaveapi.co//home/nryan/picksumipsum.txt"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"method"</span><span class="p">:</span><span class="s2">"GET"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"self"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.agaveapi.co/postits/v2/f61256c53bf3744185de4ac6c0c839b4"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"profile"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"file"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.agaveapi.co/files/v2/media/system/data.agaveapi.co//home/nryan/picksumipsum.txt"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<h3 id="redeeming-postits">Redeeming PostIts</h3>

<blockquote>
<p>Redeeming a PostIt</p>
</blockquote>
<pre class="highlight shell"><code>curl -s -o picksumipsum.txt <span class="s1">'https://public.agaveapi.co/postits/v2/f61256c53bf3744185de4ac6c0c839b4'</span>
</code></pre>
<pre class="highlight plaintext"><code>curl -s -o picksumipsum.txt 'https://public.agaveapi.co/postits/v2/f61256c53bf3744185de4ac6c0c839b4'
</code></pre>

<blockquote>
<p>Which would download the <code class="prettyprint">picksumipsum.txt</code> file from your storage system.</p>
</blockquote>

<p>You redeem a postit by making a non-authenticated HTTP request on the PostIt URL. In the above example, that would be <code class="prettyprint">https://public.agaveapi.co/postits/v2/ead227bace394790e56beb07e7c3ff4d</code>. Every time you make a get request on the PostIt, the <code class="prettyprint">remainingUses</code> field decrements by 1. This continues until the value hits 0 or the PostIt outlives its <code class="prettyprint">expires</code> field.</p>

<h4 id="forcing-postit-browser-downloads">Forcing PostIt browser downloads</h4>

<p>If you are using PostIts in a browser environment, you can force a file download by adding <code class="prettyprint">force=true</code> to the PostIt URL query. If the target URL is a file item, the name of the file item will be included in the <code class="prettyprint">Content-Disposition</code> header so the downloaded file has the correct file name. You may also add the same query parameter to any target file item to force the <code class="prettyprint">Content-Disposition</code> header from the Files API.</p>

<h3 id="expiring-postits">Expiring PostIts</h3>

<blockquote>
<p>Manually expiring a PostIt</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -X DELETE
    <span class="s1">'https://public.agaveapi.co/postits/v2/f61566c53bf3744185de4ac6c0c839b4?pretty=true'</span>
</code></pre>
<pre class="highlight plaintext"><code>postits-delete f61566c53bf3744185de4ac6c0c839b4
</code></pre>

<blockquote>
<p>Which will result in an empty response from the server.</p>
</blockquote>

<p>In addition to setting expiration parameters when you create a PostIt, you can manually expire a PostIt at any time by making an authenticated DELETE request on the PostIt URL. This will instantly expire the PostIt from further use and remove it from your listing results.</p>

              <h2 id="metadata">Metadata</h2>
<pre class="highlight json"><code><span class="w"> </span><span class="err">/$$</span><span class="w">      </span><span class="err">/$$</span><span class="w">             </span><span class="err">/$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$$</span><span class="w">    </span><span class="err">/$$$</span><span class="w">            </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$$$</span><span class="w">  </span><span class="err">/$$$$</span><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">    </span><span class="err">/$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">$$/$$</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$|_</span><span class="w">  </span><span class="err">$$_/</span><span class="w">   </span><span class="err">|____</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">$$$|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$$$$$$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">      </span><span class="err">/$$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$\</span><span class="w">  </span><span class="err">$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$_____/</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$</span><span class="w"> </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">\/</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w">  </span><span class="err">$$$$$$$</span><span class="w">  </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$/|</span><span class="w">  </span><span class="err">$$$$$$$</span><span class="w">
</span><span class="err">|__/</span><span class="w">     </span><span class="err">|__/</span><span class="w"> </span><span class="err">\_______/</span><span class="w">   </span><span class="err">\___/</span><span class="w">   </span><span class="err">\_______/</span><span class="w">
</span></code></pre>

<p>The Agave Metadata service allows you to manage metadata and associate it with Agave entities via associated UUIDs. It supports JSON schema for structured JSON metadata; it also accepts any valid JSON-formatted metadata or plain text String when no schema is specified. As with other Agave services, a full access control layer is available, enabling you to keep your metadata private or share it with your colleagues.</p>

<h3 id="structure">Structure</h3>

<blockquote>
<p>Key-value metadata item</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"some metadata"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A model organism..."</span><span class="p">,</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Structured metadata item, metadata.json</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"some metadata"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"value"</span><span class="p">:{</span><span class="w">
    </span><span class="nt">"title"</span><span class="p">:</span><span class="s2">"Example Metadata"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"properties"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"species"</span><span class="p">:</span><span class="s2">"arabidopsis"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"A model organism..."</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Every metadata item has four fields shown in the following table.</p>

<table><thead>
<tr>
<th>Field name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string; 1-256</td>
<td><code class="prettyprint">required</code> A non-unique key you can use to reference and group your metadata.</td>
</tr>
<tr>
<td>value</td>
<td>json</td>
<td>string; 0-5M</td>
</tr>
<tr>
<td>associationIds</td>
<td>array;</td>
<td>An JSON array of zero or more UUID to which this metadata item should be associated.</td>
</tr>
<tr>
<td>schemaId</td>
<td>string;</td>
<td>The id of a valid Agave metadata schema object representing the JSON Schema definition used to validate this metadata item.</td>
</tr>
</tbody></table>

<p>The <code class="prettyprint">name</code> field is just that, a user-defined name you give to your metadata item. There is no uniqueness constraint put on the <code class="prettyprint">name</code> field, so it is up to you to the application to enforce whatever naming policy it sees fit.</p>

<p>Depending on your application needs, you may use the Metadata service as a key-value store, document store, or both. When using it as a key-value store, you provide text for the <code class="prettyprint">value</code> field. When you fetching data, you could search by exact value or full-text search as needed.</p>

<p>When using the Metadata service as a document store, you provide a JSON object or array for the <code class="prettyprint">value</code> field. In this use case you can leverage additional functionality such as structured queries, atomic updates, etc.</p>

<p>Either use case is acceptable and fully supported. Your application needs will determine the best approach for you to take.</p>

<h4 id="associations">Associations</h4>

<p>Each metadata item also has an optional <code class="prettyprint">associationIds</code> field. This field contains a JSON array of Agave UUID for which this metadata item applies. This provides a convenient grouping mechanism by which to organize logically-related resources. One common examples is creating a metadata item to represent a &ldquo;data collection&rdquo; and associating files and folders that may be geographically distributed under that &ldquo;data collection&rdquo;. Another is creating a metadata item to represent a &ldquo;project&rdquo;, then sharing the &ldquo;project&rdquo; with other users involved in the &ldquo;project&rdquo;.</p>

<p>Metadata items can also be associated with other metadata items to create hierarchical relationships. Building on the &ldquo;project&rdquo; example, additional metadata items could be created for &ldquo;links&rdquo;, &ldquo;videos&rdquo;, and &ldquo;experiments&rdquo; to hold references for categorized groups of postits, video file items, and jobs respectively. Such a model translates well to a user interface layer and eliminates a large amount of boilerplate code in your application.</p>

<aside class="notice">The <code class="highlight">associationIds</code> field does not carry with it any special permissions or behavior. It is simply a link between a metadata item and the resources it represents.</aside>

<h3 id="creating-metadata">Creating metadata</h3>

<blockquote>
<p>Create a new metadata item</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X POST  
    -H <span class="s1">'Content-Type: application/json'</span>
    --data-binary <span class="s1">'{"value": {"title": "Example Metadata", "properties": {"species": "arabidopsis", "description": "A model organism..."}}, "name": "some metadata"}'</span>
    https://public.tenants.agaveapi.co/meta/v2/data
</code></pre>
<pre class="highlight plaintext"><code>metadata-addupdate -v -F - &lt;&lt;&lt;'{"value": {"title": "Example Metadata", "properties": {"species": "arabidopsis", "description": "A model organism..."}}, "name": "some metadata"}'
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7341557475441971686-242ac11f-0001-012"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"schemaId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"associationIds"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nt">"lastUpdated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-29T04:49:34.532-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"some metadata"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Metadata"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"species"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arabidopsis"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A model organism..."</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-29T04:49:34.532-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/data/7341557475441971686-242ac11f-0001-012"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/data/7341557475441971686-242ac11f-0001-012/pems"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
    </span><span class="p">},</span><span class="w">
  </span><span class="err">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>New Metadata are created in the repository via a POST to their collection URLs. As we mentioned before, there is no uniqueness constraint placed on metadata items. Thus, repeatedly POSTing the same metadata item to the service will create duplicate entries, each with their own unique UUID assigned by the service.</p>

<h3 id="updating-metadata">Updating metadata</h3>

<blockquote>
<p>Update a metadata item</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X POST
    -H <span class="s1">'Content-Type: application/json'</span>
    --data-binary <span class="s1">'{"value": {"title": "Example Metadata", "properties": {"species": "arabidopsis", "description": "A model plant organism..."}}, "name": "some metadata", "associationIds":["179338873096442342-242ac113-0001-002","6608339759546166810-242ac114-0001-007"]}'</span>
    https://public.tenants.agaveapi.co/meta/v2/data/7341557475441971686-242ac11f-0001-012
</code></pre>
<pre class="highlight plaintext"><code>metadata-addupdate -v -F - 7341557475441971686-242ac11f-0001-012 &lt;&lt;&lt;'{"value": {"title": "Example Metadata", "properties": {"species": "arabidopsis", "description": "A model plant organism..."}}, "name": "some metadata", "associationIds":["179338873096442342-242ac113-0001-002","6608339759546166810-242ac114-0001-007"]}'
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7341557475441971686-242ac11f-0001-012"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"schemaId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"associationIds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"179338873096442342-242ac113-0001-002"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"6608339759546166810-242ac114-0001-007"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"lastUpdated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-29T05:51:39.908-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"some metadata"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Metadata"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"species"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arabidopsis"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A model plant organism..."</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-29T05:43:18.618-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/data/7341557475441971686-242ac11f-0001-012"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/data/7341557475441971686-242ac11f-0001-012/pems"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"associationIds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"rel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"179338873096442342-242ac113-0001-002"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/files/v2/media/system/storage.example.com//"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"file"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"rel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6608339759546166810-242ac114-0001-007"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/jobs/v2/6608339759546166810-242ac114-0001-007"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"job"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Updating metadata is done by POSTing an updated metadata object to the existing resource. When updating, it is important to note that it is not possible to change the metadata <code class="prettyprint">uuid</code>, <code class="prettyprint">owner</code>, <code class="prettyprint">lastUpdated</code> or <code class="prettyprint">created</code> fields. Those fields are managed by the service.</p>

<h3 id="deleting-metadata">Deleting metadata</h3>

<blockquote>
<p>Delete a metadata item</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
    -X DELETE
    https://public.tenants.agaveapi.co/meta/v2/data/7341557475441971686-242ac11f-0001-012
</code></pre>
<pre class="highlight plaintext"><code>metadata-delete 7341557475441971686-242ac11f-0001-012
</code></pre>

<blockquote>
<p>An empty response will be returned from the service.</p>
</blockquote>

<p>To delete a metadata item, simply make a DELETE request on the metadata resource.</p>

<aside class="notice"> Deleting a monitor will permanently delete the monitor and all its history, permissions, etc.</aside>

              <h3 id="validating-metadata">Validating metadata</h3>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X POST
    -H <span class="s1">'Content-Type: application/json'</span>
    --data-binary <span class="s1">'{"schemaId": "4736020169528054246-242ac11f-0001-013", "value": {"title": "Example Metadata", "properties": {"description": "A model organism..."}}, "name": "some metadata"}'</span>
    https://public.tenants.agaveapi.co/meta/v2/data
</code></pre>
<pre class="highlight plaintext"><code>metadata-addupdate -v -F - &lt;&lt;&lt;'{"schemaId": "4736020169528054246-242ac11f-0001-013", "value": {"title": "Example Metadata", "properties": {"description": "A model organism..."}}, "name": "some metadata"}'
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Metadata value does not conform to schema."</span><span class="p">,</span><span class="w">
  </span><span class="nt">"version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2.1.8-r8bb7e86"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Often times it is necessary to validate metadata for format or simple quality control. The Metadata service is capable of validating the <code class="prettyprint">value</code> of a metadata item against a predefined JSON Schema definition. In order to leverage this feature, you must first register your JSON Schema definition with the Metadata Schemata service, then reference the UUID of that metadata schema resource in the <code class="prettyprint">schemaId</code> field.</p>

<p>Given our previous example metadata schema object, the following request would fail due to a missing &ldquo;species&rdquo; value in the metadata item <code class="prettyprint">value</code> field.</p>

              <h3 id="searching">Searching</h3>

<blockquote>
<p>Searching metadata for all items with name like &ldquo;mustard plant&rdquo;</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
    --data-urlencode <span class="s1">'{"name": "mustard plant"}'</span>
    https://public.tenants.agaveapi.co/meta/v2/data
</code></pre>
<pre class="highlight plaintext"><code>metadata-list -i -v -Q '{"name":"mustard+plant"}'
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7341557475441971686-242ac11f-0001-012"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"schemaId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"associationIds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"179338873096442342-242ac113-0001-002"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"6608339759546166810-242ac114-0001-007"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"lastUpdated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-29T05:51:39.908-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"some metadata"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Metadata"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"species"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arabidopsis"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A model plant organism..."</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-29T05:43:18.618-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/schemas/4736020169528054246-242ac11f-0001-013"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/schemas/4736020169528054246-242ac11f-0001-013/pems"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"associationIds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"rel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"179338873096442342-242ac113-0001-002"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/files/v2/media/system/storage.example.com//"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"file"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"rel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6608339759546166810-242ac114-0001-007"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/jobs/v2/6608339759546166810-242ac114-0001-007"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"job"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>In addition to retrieving Metadata via its UUID, the Metadata service supports <a href="https://docs.mongodb.com/manual/tutorial/query-documents/">MongoDB query syntax</a>. Just add the <code class="prettyprint">q=&lt;value&gt;</code> to URL query portion of your GET request on the metadata collection. This differs from other APIs, but provides a richer syntax to query and filter responses.</p>

<p>If you wanted to look up Metadata corresponding to a specific value within its JSON Metadata value, you can specify this using a JSON object such as <code class="prettyprint">{&quot;name&quot;: &quot;mustard plant&quot;}</code>. Remember that, in order to send JSON in a URL query string, it must first be URL encoded. Luckily this is easily handled for us by <code class="prettyprint">curl</code> and the Agave CLI.</p>

<aside class="alert">In order to send JSON in a URL query string, it must first be URL encoded.</aside>

<p>The given query will return all metadata with name, &ldquo;mustard plant&rdquo; that you have permission to access.</p>

<h4 id="search-examples">Search Examples</h4>

<blockquote>
<p>metadata search by exact name</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mustard plant"</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>metadata search by field in value</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"value.type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a plant"</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>metadata search for values with any field matching an item in the given array</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w"> </span><span class="nt">"value.profile.status"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"$in"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w"> </span><span class="s2">"paused"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Some common search syntax examples. Consult the <a href="https://docs.mongodb.com/manual/tutorial/query-documents/">MongoDB Query Documentation</a> for more examples and full syntax documentation.</p>

              <h3 id="metadata-permissions">Metadata Permissions</h3>

<p>The Metadata service supports permissions for both Metadata and Schemata consistent with that of a number of other Agave services. If no permissions are explicitly set, only the owner of the Metadata and tenant administrators can access it.</p>

<p>The permissions available for Metadata and Metadata Schemata are listed in the following table. Please note that a user must have WRITE permissions to grant or revoke permissions on a metadata or schema item.</p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>READ</td>
<td>User can view the resource</td>
</tr>
<tr>
<td>WRITE</td>
<td>User can edit, but not view the resource</td>
</tr>
<tr>
<td>READ_WRITE</td>
<td>User can manage the resource</td>
</tr>
<tr>
<td>ALL</td>
<td>User can manage the resource</td>
</tr>
<tr>
<td>NONE</td>
<td>User can view the resource</td>
</tr>
</tbody></table>

<h4 id="listing-all-permissions">Listing all permissions</h4>

<blockquote>
<p>List the permissions on Metadata for a given user</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
    https://public.tenants.agaveapi.co/meta/v2/data/7341557475441971686-242ac11f-0001-012/pems/rclemens
</code></pre>
<pre class="highlight plaintext"><code>metadata-pems-list -u rclemens \
    7341557475441971686-242ac11f-0001-012
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"permission"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/7341557475441971686-242ac11f-0001-012/pems/nryan"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"parent"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/7341557475441971686-242ac11f-0001-012"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/nryan"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>To list all permissions for a metadata item, make a GET request on the metadata item&rsquo;s permission collection</p>

<h4 id="list-permissions-for-a-specific-user">List permissions for a specific user</h4>

<blockquote>
<p>List the permissions on Metadata for a given user</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
    https://public.tenants.agaveapi.co/meta/v2/data/7341557475441971686-242ac11f-0001-012/pems/nryan
</code></pre>
<pre class="highlight plaintext"><code>metadata-pems-list -u rclemens \
    7341557475441971686-242ac11f-0001-012
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"username"</span><span class="p">:</span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"permission"</span><span class="p">:{</span><span class="w">
    </span><span class="nt">"read"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"write"</span><span class="p">:</span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:{</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.agaveapi.co/meta/v2/7341557475441971686-242ac11f-0001-012/pems/nryan"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"parent"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.agaveapi.co/meta/v2/7341557475441971686-242ac11f-0001-012"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"profile"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.agaveapi.co/meta/v2/nryan"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Checking permissions for a single user is simply a matter of adding the username of the user in question to the end of the metadata permission collection.</p>

<h4 id="grant-permissions">Grant permissions</h4>

<blockquote>
<p>Grant read access to a metadata item</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X POST
    --data <span class="s1">'{"permission":"READ"}'</span>
    https://public.tenants.agaveapi.co/meta/v2/data/7341557475441971686-242ac11f-0001-012/pems/rclemens
</code></pre>
<pre class="highlight plaintext"><code>metadata-pems-addupdate -u rclemens \
    -p READ 7341557475441971686-242ac11f-0001-012
</code></pre>

<blockquote>
<p>Grant read and write access to a metadata item</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X POST
    --data <span class="s1">'{"permission":"READ_WRITE"}'</span>
    https://public.tenants.agaveapi.co/meta/v2/data/7341557475441971686-242ac11f-0001-012/pems/rclemens
</code></pre>
<pre class="highlight plaintext"><code>metadata-pems-addupdate -u rclemens \
    -p READ_WRITE 7341557475441971686-242ac11f-0001-012
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rclemens"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"permission"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/7341557475441971686-242ac11f-0001-012/pems/rclemens"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"parent"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/7341557475441971686-242ac11f-0001-012"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/jstubbs"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>To grant another user read access to your metadata item, assign them <code class="prettyprint">READ</code> permission. To enable another user to update a metadata item, grant them <code class="prettyprint">READ_WRITE</code> or <code class="prettyprint">ALL</code> access.</p>

<h4 id="delete-single-user-permissions">Delete single user permissions</h4>

<blockquote>
<p>Delete permission for single user on a Metadata item</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
    -X DELETE
    https://public.tenants.agaveapi.co/meta/v2/data/7341557475441971686-242ac11f-0001-012/pems/rclemens
</code></pre>
<pre class="highlight plaintext"><code>metadata-pems-delete -u rclemens 7341557475441971686-242ac11f-0001-012
</code></pre>

<blockquote>
<p>An empty response will come back from the API.</p>
</blockquote>

<p>Permissions may be deleted for a single user by making a DELETE request on the metadata user permission resource. This will immediately revoke all permissions to the metadata item for that user.</p>

<aside class="info">Please note that ownership cannot be revoked or reassigned. The user who created the metadata item will always have ownership of that item.</aside>

<h4 id="deleting-all-permissions">Deleting all permissions</h4>

<blockquote>
<p>Delete all permissions on a Metadata item</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
    -X DELETE
    https://public.tenants.agaveapi.co/meta/v2/data/7341557475441971686-242ac11f-0001-012/pems
</code></pre>
<pre class="highlight plaintext"><code>metadata-pems-delete 7341557475441971686-242ac11f-0001-012
</code></pre>

<blockquote>
<p>An empty response will be returned from the service.</p>
</blockquote>

<p>Permissions may be deleted for a single user by making a DELETE request on the metadata resource permission collection.</p>

<aside class="info">The above operation will delete all permissions for a Metadata item, such that only the owner will be able to access it. Use with care.</aside>

              <h2 id="metadata-schemata">Metadata Schemata</h2>
<pre class="highlight json"><code><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">          </span><span class="err">/$$</span><span class="w">
 </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">        </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\__/</span><span class="w"> </span><span class="err">/$$$$$$|</span><span class="w"> </span><span class="err">$$$$$$$</span><span class="w">  </span><span class="err">/$$$$$$</span><span class="w"> </span><span class="err">/$$$$$$/$$$$</span><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$</span><span class="w"> </span><span class="err">/$$_____|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$$/$$__</span><span class="w">  </span><span class="err">$|</span><span class="w"> </span><span class="err">$$_</span><span class="w">  </span><span class="err">$$_</span><span class="w">  </span><span class="err">$$|____</span><span class="w">  </span><span class="err">$$</span><span class="w">
 </span><span class="err">\____</span><span class="w">  </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$$$$$$</span><span class="w">
 </span><span class="err">/$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$_____|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$/$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w">  </span><span class="err">$$$$$$$</span><span class="w">
 </span><span class="err">\______/</span><span class="w"> </span><span class="err">\_______|__/</span><span class="w">  </span><span class="err">|__/\_______|__/</span><span class="w"> </span><span class="err">|__/</span><span class="w"> </span><span class="err">|__/\_______/</span><span class="w">
</span></code></pre>

<p>Schema can be provided in JSON Schema form. The service will validate that the schema is valid JSON and store it. To validate Metadata against it, the schema UUID should be given as a parameter, SchemaId, when uploading Metadata. If no SchemaId is provided, the Metadata service will accept any JSON Object or plain text string and store it accordingly. This flexible approach enabled Agave to handle different levels of structure of Metadata from completely unstructured, to highly structured with complex JSON schemata.</p>

<p>For more on JSON Schema please see <a title="JSON Schema" href="http://json-schema.org/">http://json-schema.org/</a></p>

<p>To add a metadata schema to the repository:</p>

<h3 id="creating-schemata">Creating schemata</h3>

<blockquote>
<p>Example JSON Schema document, schema.json</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Schema"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"species"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"species"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Creating a new metadata schema</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
    -X POST -H <span class="s2">"Content-Type: application/json"</span>
    --data-binary <span class="s1">'{ "title": "Example Schema", "type": "object", "properties": { "species": { "type": "string" } },"required": ["species"] }'</span>
    https://public.tenants.agaveapi.co/meta/v2/schemas/
</code></pre>
<pre class="highlight plaintext"><code>metadata-schema-addupdate -v -F schema.json
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4736020169528054246-242ac11f-0001-013"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"lastUpdated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-29T04:52:11.474-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"schema"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Schema"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"species"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"species"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-29T04:52:11.474-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/schemas/4736020169528054246-242ac11f-0001-013"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/schemas/4736020169528054246-242ac11f-0001-013/pems"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>To create a new metadata schema that can be used to validate metadata items upon addition or updating, POST a JSON Schema document to the service.</p>

<p>More JSON Schema examples can be found in the <a href="https://bitbucket.org/agaveapi/science-api-samples">Agave Samples</a> project.</p>

<h3 id="updating-schema">Updating schema</h3>

<blockquote>
<p>Update a metadata schema</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X POST
    -H <span class="s1">'Content-Type: application/json'</span>
    --data-binary <span class="s1">'{ "title": "Example Schema", "type": "object", "properties": { "species": { "type": "string" }, "description": {"type":"string"} },"required": ["species"] }'</span>
    https://public.tenants.agaveapi.co/meta/v2/data/4736020169528054246-242ac11f-0001-013
</code></pre>
<pre class="highlight plaintext"><code>metadata-addupdate -v -F - 4736020169528054246-242ac11f-0001-013 &lt;&lt;&lt; '{ "title": "Example Schema", "type": "object", "properties": { "species": { "type": "string" }, "description": {"type":"string"} },"required": ["species"] }'
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4736020169528054246-242ac11f-0001-013"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"lastUpdated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-29T04:52:11.474-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"schema"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Schema"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"species"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"species"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-29T04:52:11.474-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/schemas/4736020169528054246-242ac11f-0001-013"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/meta/v2/schemas/4736020169528054246-242ac11f-0001-013/pems"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Updating metadata schema is done by POSTing an updated schema object to the existing resource. When updating, it is important to note that it is not possible to change the schema <code class="prettyprint">uuid</code>, <code class="prettyprint">owner</code>, <code class="prettyprint">lastUpdated</code> or <code class="prettyprint">created</code> fields. Those fields are managed by the service.</p>

<h3 id="deleting-schema">Deleting schema</h3>

<blockquote>
<p>Delete a metadata schema</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span>
    -X DELETE
    https://public.tenants.agaveapi.co/meta/v2/data/4736020169528054246-242ac11f-0001-013
</code></pre>
<pre class="highlight plaintext"><code>metadata-schema-delete 4736020169528054246-242ac11f-0001-013
</code></pre>

<blockquote>
<p>An empty response will be returned from the service.</p>
</blockquote>

<p>To delete a metadata schema, simply make a DELETE request on the metadata schema resource.</p>

<aside class="alert"> Deleting a metadata schema will permanently delete the schema and all its history, permissions, etc. Once the schema is deleted, the remaining metadata items will not be automatically updated, thus it is important to know that updates to metadata items that still reference the schema will fail.</aside>

              <h2 id="monitors">Monitors</h2>
<pre class="highlight json"><code><span class="w"> </span><span class="err">/$$</span><span class="w">      </span><span class="err">/$$</span><span class="w">                  </span><span class="err">/$$</span><span class="w">  </span><span class="err">/$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$$</span><span class="w">    </span><span class="err">/$$$</span><span class="w">                 </span><span class="err">|__/</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$$$</span><span class="w">  </span><span class="err">/$$$$</span><span class="w"> </span><span class="err">/$$$$$$</span><span class="w"> </span><span class="err">/$$$$$$$</span><span class="w"> </span><span class="err">/$$/$$$$$$</span><span class="w">   </span><span class="err">/$$$$$$</span><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">$$/$$</span><span class="w"> </span><span class="err">$$/$$__</span><span class="w">  </span><span class="err">$|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$|</span><span class="w"> </span><span class="err">$|_</span><span class="w">  </span><span class="err">$$_/</span><span class="w">  </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$/$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">$$$|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">   </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\__/</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$\</span><span class="w">  </span><span class="err">$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">\/</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|__/</span><span class="w">     </span><span class="err">|__/\______/|__/</span><span class="w">  </span><span class="err">|__|__/</span><span class="w">  </span><span class="err">\___/</span><span class="w">  </span><span class="err">\______/|__/</span><span class="w">
</span></code></pre>

<p>The Agave Monitors API provides a familiar paradigm for monitoring the use ability and accessibility of storage and execution systems you registered with Agave. Similar to services like Pingdom, Pagerduty, and WebCron, the Monitors API allows you to to create regular health checks on a registered system. Unlike standard uptime services, Agave will check that your system is responsive and accessible by performing proactive tests on availability (ping), accessibility (authentication), and functionality (listing or echo). Each check result is persisted and the check history of a given monitor is queryable through the API. As with all resources in the Agave Platform, a full event model is available so you can subscribe to event you care about such as failed checks, restored system availability, and system disablement. </p>

<h3 id="creating-monitors">Creating Monitors</h3>

<blockquote>
<p>Create a new default monitor</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -H <span class="s2">"Content-Type: application-json"</span> <span class="se">\</span>
     -X POST --data-binary <span class="s1">'{"target": "storage.example.com"}'</span> <span class="se">\</span>
     https://public.agaveapi.co/monitors/v2/
</code></pre>
<pre class="highlight plaintext"><code>monitors-addupdate -S storage.example.com  
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:22:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5024717285821443610-242ac11f-0001-014"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastCheck"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastSuccess"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastUpdated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:22:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"nextUpdate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T18:22:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storage.example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"updateSystemStatus"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"checks"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014/checks"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"notifications"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/notifications/v2/?associatedUuid=5024717285821443610-242ac11f-0001-014"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/storage.example.com"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The only piece of information needed to monitor a system is the system ID. Sending a POST request to the Monitors API with a monitor definition containing just the <code class="prettyprint">systemId</code> field with a valid system ID or UUID will create a monitor that will run hourly health checks starting an hour from when you sent the request.  </p>

<aside class="notice">You cannot create monitors on systems for which you do not have a role.</aside>

<h3 id="custom-frequency-and-start-time">Custom frequency and start time</h3>

<blockquote>
<p>Create a monitor with a custom frequency</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -H <span class="s2">"Content-Type: application-json"</span> <span class="se">\</span>
     -X POST --data-binary <span class="s1">'{"target": "storage.example.com","frequency":15}'</span> <span class="se">\</span>
     https://public.agaveapi.co/monitors/v2/
</code></pre>
<pre class="highlight plaintext"><code>monitors-addupdate -S storage.example.com -I 15
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"checks"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014/checks"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"notifications"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/notifications/v2/?associatedUuid=5024717285821443610-242ac11f-0001-014"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/storage.example.com"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:22:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5024717285821443610-242ac11f-0001-014"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastCheck"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastSuccess"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastUpdated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:22:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"nextUpdate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:37:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storage.example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"updateSystemStatus"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>If you need the monitor to run more frequently, you can customize the frequency and time at which a monitor runs by including the <code class="prettyprint">interval</code> and <code class="prettyprint">startTime</code> fields in your monitor definition. By providing a time expression in the <code class="prettyprint">interval</code> field, you can control the frequency at which a monitor runs. The maximum interval you can set for a monitor is one month. The minimum interval varies from tenant to tenant, but is generally no less than 5 minutes. </p>

<aside class="notice">The minimum interval at which a monitor can run varies from tenant to tenant, but is generally not less than 5 minutes.</aside>

<p>The <code class="prettyprint">startTime</code> field allows you to schedule when you would like Agave to start the monitor on your system. Any date or time expression representing a moment between the current time and one month from then is acceptable. If you do not specify a value for <code class="prettyprint">startTime</code>, Agave will add the value of <code class="prettyprint">interval</code> to the current time and use that as the <code class="prettyprint">startTIme</code>. Setting stop times or &ldquo;off hours&rdquo; is not currently supported.</p>

<h3 id="automating-system-status-updates">Automating system status updates</h3>

<blockquote>
<p>Create a monitor that updates system status on change</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -H <span class="s2">"Content-Type: application-json"</span> <span class="se">\</span>
     -X POST <span class="se">\</span>
     --data-binary <span class="s1">'{"target": "storage.example.com","frequency":15,"updateSystemStatus"=true}'</span> <span class="se">\</span>
     https://public.agaveapi.co/monitors/v2/
</code></pre>
<pre class="highlight plaintext"><code>monitors-addupdate -S storage.example.com -I 15 -U true
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:22:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5024717285821443610-242ac11f-0001-014"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastCheck"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastSuccess"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastUpdated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:22:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"nextUpdate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:37:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storage.example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"updateSystemStatus"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"checks"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014/checks"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"notifications"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/notifications/v2/?associatedUuid=5024717285821443610-242ac11f-0001-014"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/storage.example.com"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>In the section on Events and notifications, we cover the ways in which you can get alerted about events pertaining to a monitor. Here we will simply point out that a convenience field, <code class="prettyprint">updateStatus</code>, is built into all monitors. Setting this field to <code class="prettyprint">true</code> will authorize Agave to update the status of the monitored system based on the result of the monitor checks. This is a convenient way to ensure that the status value in your system description matches the actual operational status of the system.</p>

<aside class="notice">To automatically update your system status when a monitor changes status, set <code class="highlight">updateStatus</code> to &ldquo;true&rdquo; in your monitor definition.</aside>

<h3 id="updating-an-existing-monitor">Updating an existing monitor</h3>

<blockquote>
<p>Update an existing monitor</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -H <span class="s2">"Content-Type: application-json"</span> <span class="se">\</span>
     -X POST <span class="se">\</span>
     --data-binary <span class="s1">'{"target": "storage.example.com","frequency":5,"updateSystemStatus"=false}'</span> <span class="se">\</span>
     https://public.agaveapi.co/monitors/v2/5024717285821443610-242ac11f-0001-014
</code></pre>
<pre class="highlight plaintext"><code>monitors-addupdate -S storage.example.com -I 5 -U false 5024717285821443610-242ac11f-0001-014
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:22:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5024717285821443610-242ac11f-0001-014"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastCheck"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastSuccess"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastUpdated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:24:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"nextUpdate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:29:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storage.example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"updateSystemStatus"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"checks"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014/checks"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"notifications"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/notifications/v2/?associatedUuid=5024717285821443610-242ac11f-0001-014"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/storage.example.com"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Monitors can be managed by making traditional GET, POST, and DELETE operations. When updating a monitor, pay attention to the response because the time of the next check will change. In fact, any change to a monitor will recalculate the time when the next health check will run. </p>

<h3 id="disabling-an-existing-monitor">Disabling an existing monitor</h3>

<blockquote>
<p>Disable an existing monitor</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span>
    -H <span class="s2">"Content-Type: application/json"</span>
    -X PUT --data-binary <span class="s1">'{"action": "disable"}'</span>
    https://public.agaveapi.co/monitors/v2/5024717285821443610-242ac11f-0001-014
</code></pre>
<pre class="highlight plaintext"><code>monitors-disable 5024717285821443610-242ac11f-0001-014
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:22:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5024717285821443610-242ac11f-0001-014"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastCheck"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastSuccess"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastUpdated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:24:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"nextUpdate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:29:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storage.example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"updateSystemStatus"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"checks"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014/checks"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"notifications"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/notifications/v2/?associatedUuid=5024717285821443610-242ac11f-0001-014"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/storage.example.com"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>There may be times when you need to pause a monitor. If your system has scheduled maintenance periods, you may want to disable the monitor until the maintenance period ends. You can do this by making a PUT request on a monitor with the a field name <code class="prettyprint">action</code> set to &ldquo;disabled&rdquo;. While disabled, all health checks will be skipped. </p>

<h3 id="enabling-an-existing-monitor">Enabling an existing monitor</h3>

<blockquote>
<p>Enable an existing monitor</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span>
    -H <span class="s2">"Content-Type: application/json"</span>
    -X PUT --data-binary <span class="s1">'{"action": "enable"}'</span>
    https://public.agaveapi.co/monitors/v2/5024717285821443610-242ac11f-0001-014
</code></pre>
<pre class="highlight plaintext"><code>monitors-enable 5024717285821443610-242ac11f-0001-014
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:22:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5024717285821443610-242ac11f-0001-014"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastCheck"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastSuccess"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastUpdated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:24:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"nextUpdate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:29:59.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storage.example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"updateSystemStatus"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"checks"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014/checks"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"notifications"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/notifications/v2/?associatedUuid=5024717285821443610-242ac11f-0001-014"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/profiles/v2/nryan"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/storage.example.com"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Similarly, to enable a monitor, make a PUT request with the a field name <code class="prettyprint">action</code> set to &ldquo;enabled&rdquo;. Once reenabled, the monitor will resume its previous check schedule as specified in the <code class="prettyprint">nextUpdate</code> field, or immediately if that time has already expired.</p>

<h3 id="deleting-a-monitor">Deleting a monitor</h3>

<blockquote>
<p>Deleting an existing monitor</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span>
    -H <span class="s2">"Content-Type: application/json"</span>
    -X DELETE
    https://public.agaveapi.co/monitors/v2/5024717285821443610-242ac11f-0001-014
</code></pre>
<pre class="highlight plaintext"><code>monitors-delete 5024717285821443610-242ac11f-0001-014
</code></pre>

<blockquote>
<p>An empty response will be returned</p>
</blockquote>

<p>To delete a monitor, simply make a DELETE request on the monitor.</p>

<aside class="notice"> Unlike systems, deleting a monitor will permanently delete the monitor and all its history, checks, etc.</aside>

<h3 id="monitor-checks">Monitor Checks</h3>

<blockquote>
<p>Listing past monitor checks</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span>
    <span class="s1">'https://public.agaveapi.co/monitors/v2/5024717285821443610-242ac11f-0001-014/checks?limit=1'</span>
</code></pre>
<pre class="highlight plaintext"><code>monitors-checks-list -v -l 1
    -M 5024717285821443610-242ac11f-0001-014
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:29:59.000-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4035070921477123610-242ac11f-0001-015"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASSED"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STORAGE"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"monitor"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014/checks/4035070921477123610-242ac11f-0001-015"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/storage.example.com"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>Each instance of a monitor testing a system is called a Check. Monitor Checks are persisted over time and query able as a collection of a monitor resource. Monitor checks can be queried by result, timeframe, and type. By default, the last check is injected into a monitor description as the <code class="prettyprint">lastCheck</code> field. </p>

<p>Each monitor check has a unique ID and represents a formal, addressable resource in the API. Here we see a typical successful monitor check. Checks will have one of two states: PASSED or FAILED. Successful monitors have a status of PASSED and no message. Unsuccessful monitors have a status of FAILED and a message describing why they failed.</p>

<h3 id="searching-check-history">Searching check history</h3>

<blockquote>
<p>Searching check history for a monitor</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span> <span class="se">\ </span>  
    <span class="s1">'https://public.agaveapi.co/monitors/v2/5024717285821443610-242ac11f-0001-014/checks?limit=1&amp;result.eq=PASSED'</span>
</code></pre>
<pre class="highlight plaintext"><code>monitors-checks-search -v -l 1 \
    -M 5024717285821443610-242ac11f-0001-014 \
    result.eq=PASSED
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-03T17:29:59.000-05:00"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4035070921477123610-242ac11f-0001-015"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASSED"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STORAGE"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"monitor"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014/checks/4035070921477123610-242ac11f-0001-015"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/storage.example.com"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>Long-running monitor checks can build up a large history which can become prohibitive to page through. When generating graphs and looking for specific incidents, you can search for specific checks based on <code class="prettyprint">result</code>, <code class="prettyprint">startTime</code>, <code class="prettyprint">endTime</code>, <code class="prettyprint">type</code>, and <code class="prettyprint">id</code>. The standard JSON SQL search syntax used across the rest of the Science APIs is supported for monitor checks as well.</p>

<h3 id="manually-running-a-check">Manually running a check</h3>

<blockquote>
<p>Forcing a monitor check to run</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -H <span class="s2">"Content-Type: application-json"</span> <span class="se">\</span>
     -X POST --data-binary <span class="s1">'{}'</span> <span class="se">\</span>
    https://public.agaveapi.co/monitors/v2/5024717285821443610-242ac11f-0001-014/checks
</code></pre>
<pre class="highlight plaintext"><code>monitors-fire -v 5024717285821443610-242ac11f-0001-014  
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-10T11:30:58.920-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5314048891498786330-242ac11f-0001-015"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASSED"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STORAGE"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"monitor"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014/checks/5314048891498786330-242ac11f-0001-015"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/systems/v2/storage.example.com"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>If you need to verify the accessibility of your system, or behavior of your monitor, you can force an existing monitor to run on demand by sending a POST request to the monitor checks collection. When doing this, you are still subject to the same minimum check interval configured for your tenant. </p>

<aside class="notice">When manually forcing a monitor to run, you are still subject to the same minimum check interval configured for your tenant.</aside>

<h3 id="permissions">Permissions</h3>

<p>At this time, monitors do not have permissions associated with them.</p>

<h3 id="history">History</h3>

<blockquote>
<p>List the change history of a monitor</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$AUTH_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     -H <span class="s2">"Content-Type: application-json"</span> <span class="se">\</span>
     -X POST --data-binary <span class="s1">'{}'</span> <span class="se">\</span>
    https://public.agaveapi.co/monitors/v2/5024717285821443610-242ac11f-0001-014/history
</code></pre>
<pre class="highlight plaintext"><code>monitors-history -v 5024717285821443610-242ac11f-0001-014
</code></pre>

<blockquote>
<p>The response will look something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"createdBy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-12T19:10:22Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CREATED"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This monitor was created by nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5705275956568068582-242ac11f-0001-035"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014/history/5705275956568068582-242ac11f-0001-035"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"monitor_event"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.agaveapi.co/monitor/v2/5024717285821443610-242ac11f-0001-014"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>A full history of the lifecycle of a monitor is available via the monitor history collection. Here you can list events that have occurred during the life of the monitor.</p>

<h3 id="events">Events</h3>

<p>The following events will be thrown by the Monitors API.</p>

<table><thead>
<tr>
<th>API       </th>
<th> Description</th>
</tr>
</thead><tbody>
<tr>
<td>CREATED</td>
<td>The monitor was created</td>
</tr>
<tr>
<td>UPDATED</td>
<td>The monitor was updated</td>
</tr>
<tr>
<td>DELETED</td>
<td>The monitor was deleted</td>
</tr>
<tr>
<td>ENABLED</td>
<td>The monitor was enabled</td>
</tr>
<tr>
<td>DISABLED</td>
<td>The monitor was disabled</td>
</tr>
<tr>
<td>PERMISSION_GRANT</td>
<td>A new user permission was granted on this monitor</td>
</tr>
<tr>
<td>PERMISSION_REVOKE</td>
<td>A user permission was revoked on this sytem</td>
</tr>
<tr>
<td>FORCED_CHECK_REQUESTED</td>
<td>A status check was requested by the user outside of the existing monitor schedule.</td>
</tr>
<tr>
<td>CHECK_PASSED</td>
<td>The status check passed</td>
</tr>
<tr>
<td>CHECK_FAILED</td>
<td>The status check failed</td>
</tr>
<tr>
<td>CHECK_UNKNOWN</td>
<td>The status check finished in an unknown state</td>
</tr>
<tr>
<td>STATUS_CHANGE</td>
<td>The status condition of the monitored resource changed since the last check</td>
</tr>
<tr>
<td>RESULT_CHANGE</td>
<td>The cumulative result of all checks performed on the monitored resource changed since the last suite of checks</td>
</tr>
</tbody></table>

              <h2 id="user-profiles">User Profiles</h2>
<pre class="highlight json"><code><span class="w"> </span><span class="err">/$$$$$$$</span><span class="w">                   </span><span class="err">/$$$$$$</span><span class="w"> </span><span class="err">/$$/$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">                 </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$|__|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$/$$$$$$</span><span class="w">  </span><span class="err">/$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\__//$|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$$$$$$</span><span class="w">  </span><span class="err">/$$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$$$$$$/$$__</span><span class="w">  </span><span class="err">$$/$$__</span><span class="w">  </span><span class="err">$|</span><span class="w"> </span><span class="err">$$$$</span><span class="w">   </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$/$$__</span><span class="w">  </span><span class="err">$$/$$_____/</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$____|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\__|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$_/</span><span class="w">   </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$$$$$$|</span><span class="w">  </span><span class="err">$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">    </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$_____/\____</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">    </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$|</span><span class="w">  </span><span class="err">$$$$$$$/$$$$$$$/</span><span class="w">
</span><span class="err">|__/</span><span class="w">    </span><span class="err">|__/</span><span class="w">      </span><span class="err">\______/|__/</span><span class="w">     </span><span class="err">|__|__/\_______|_______/</span><span class="w">
</span></code></pre>

<p>The Agave hosted identity service (profiles service) is a RESTful web service that gives organizations a way to create and manage the user accounts within their Agave tenant. The service is backed by a redundant LDAP instance hosted in multiple datacenters making it highly available. Additionally, passwords are stored using the openldap md5crypt algorithm.</p>

<p>Tenant administrators can manage only a basic set of fields on each user account within LDAP itself. For more complex profiles, we recommend combing the profiles service with the metadata service. See the section on Extending the Basic Profile with the Metadata Service below.</p>

<p>The service uses OAuth2 for authentication, and user&rsquo;s must have special privileges to create and update user accounts within the tenant. Please work with the Agave development team to make sure your admins have the user-account-manager role.</p>

<p>In addition to the web service, there is also a basic front-end web application providing user sign up. The web application will suffice for basic user profiles and can be used as a starting point for more advanced use cases.</p>

<aside class="notice">This service should **NOT** be used for authenticating users. For details on using OAuth for authentication, see the <a href="#authorization">Authorization Guide</a></aside>

<h3 id="creating">Creating</h3>

<p>Create a user account by sending a POST request to the profiles service, providing an access token of a user with the user-account-manager role. The fields username, password and email are required to create a new user.</p>

<aside class="notice">Creating and managing accounts requires a special <span class="code">user-account-manager</span> role. As a best practice, we recommend setting up a separate, dedicated, account to handle user management. Please work with the Agave developer team if this is of interest to your organization.</aside>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -X POST <span class="se">\</span>
    -d <span class="s2">"username=testuser"</span> <span class="se">\</span>
    -d <span class="s2">"password=abcd123"</span> <span class="se">\</span>
    -d <span class="s2">"email=testuser@test.com"</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/profiles/v2
</code></pre>
<pre class="highlight plaintext"><code>profiles-create -u testuser -p abcd123 -e testuser@test.com
</code></pre>

<p>The response to this call for our example user looks like this:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"message"</span><span class="p">:</span><span class="s2">"User created successfully."</span><span class="p">,</span><span class="w">
  </span><span class="nt">"result"</span><span class="p">:{</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="s2">"testuser@test.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"first_name"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nt">"full_name"</span><span class="p">:</span><span class="s2">"testuser"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"last_name"</span><span class="p">:</span><span class="s2">"testuser"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mobile_phone"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nt">"phone"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"Active"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"uid"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="s2">"testuser"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"success"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"version"</span><span class="p">:</span><span class="s2">"2.0.0-SNAPSHOT-rc3fad"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The complete list of available fields and their descriptions is provided in the table below.</p>

<table>
    <thead>
        <tr>
            <th>Field Name</th>
            <th>Description</th>
            <th>Required?</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>username</td>
            <td>The username for the user; must be unique across the tenant</td>
            <td>Yes</td>
        </tr>
        <tr>
            <td>email</td>
            <td>The email address for the user.</td>
            <td>Yes</td>
        </tr>
        <tr>
            <td>password</td>
            <td>The password for the user. </td>
            <td>Yes</td>
        </tr>
        <tr>
            <td>first_name</td>
            <td>First name of the user</td>
            <td>No</td>
        </tr>
        <tr>
            <td>last_name</td>
            <td>Last name of the user</td>
            <td>No</td>
        </tr>
        <tr>
            <td>phone</td>
            <td>User&rsquo;s phone number</td>
            <td>No</td>
        </tr>
        <tr>
            <td>mobile_phone</td>
            <td>User&rsquo;s mobile phone number.</td>
            <td>No</td>
        </tr>
    </tbody>
</table>

<p>Note that the service does not do any password strength enforcement or other password management policies. We leave it to each organization to implement the policies best suited for their use case.</p>

<h3 id="extending-with-metadata">Extending with Metadata</h3>

<blockquote>
<p>Sample metadata object extending a user profile</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"user_profile"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"value"</span><span class="p">:{</span><span class="w">
    </span><span class="nt">"firstName"</span><span class="p">:</span><span class="s2">"Test"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastName"</span><span class="p">:</span><span class="s2">"User"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="s2">"testuser@test.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"city"</span><span class="p">:</span><span class="s2">"Springfield"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"state"</span><span class="p">:</span><span class="s2">"IL"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"country"</span><span class="p">:</span><span class="s2">"USA"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"phone"</span><span class="p">:</span><span class="s2">"636-555-3226"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gravatar"</span><span class="p">:</span><span class="s2">"http://www.gravatar.com/avatar/ed53e691ee322e24d8cc843fff68ebc6"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Save the extended profile document to the metadata service</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    -X POST <span class="se">\</span>
    -F <span class="s2">"fileToUpload=@profile_ex"</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/meta/v2/data/?pretty<span class="o">=</span><span class="nb">true</span>
</code></pre>
<pre class="highlight plaintext"><code>metadata-addupdate -v -F profile_ex
</code></pre>

<blockquote>
<p>The response would resemble something like the following:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2.1.0-rc0c5a"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"result"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"uuid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0001429724043699-5056a550b8-0001-012"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"jstubbs"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"schemaId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"associationIds"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nt">"lastUpdated"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-04-22T12:34:03.698-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"user_profile"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"firstName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Test"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"lastName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"User"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"email"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"testuser@test.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"city"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Springfield"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"IL"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"country"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"USA"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"636-555-3226"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"gravatar"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.gravatar.com/avatar/ed53e691ee322e24d8cc843fff68ebc6"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"created"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-04-22T12:34:03.698-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://public.tenants.agaveapi.co/meta/v2/data/0001429724043699-5056a550b8-0001-012"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>We do not expect the fields above to provide full support for anything but the most basic profiles. The recommended strategy is to use the profiles service in combination with the metadata service the (see <a href="#metadata" title="Metadata Guide">Metadata Guide</a> for more details) to store additional information. The metadata service allows you to create custom types using JSON schema, making it more flexible than standard LDAP from within a self-service model. Additionally, the metadata service includes a rich query interface for retrieving users based on arbitrary JSON queries.</p>

<p>The general approach used by existing tenants has been to create a single entry per user where the entry contains all additional profile data for the user. Every metadata item representing a user profile can be identified using a fixed string for the &ldquo;name&rdquo; attribute (e.g., &ldquo;user_profile&rsquo;). The value of the metadata item contains a unique identifier for the user (e.g. username or email address) along with all the additional fields you wish to track on the profile. One benefit of this approach is that it cleanly delineates multiple classes of profiles, for example &quot;admin_profile&rdquo;, &ldquo;developer_profile&rdquo;, &ldquo;mathematician_profile&rdquo;, etc. When consuming this information in a web interface, such user-type grouping makes presentation significantly easier.</p>

<p>Another issue to consider when extending user profile information through the Metadata service is ownership. If you create the user&rsquo;s account, then prompt them to login before entering their extended data, it is possible to create the user&rsquo;s metadata record under their account. This has the advantage of giving the user full ownership over the information, however it also opens up the possibility that the user, or a third-party application, could modify or delete the record.</p>

<p>A better approach is to use a service account to create all extended profile metadata records and grant the user READ access on the record. This still allows third-party applications to access the user&rsquo;s information at their request, but prevents any malicious things from happening.</p>

<p>The example above represents a possible JSON document that could be used to store a metadata record representing a profile:</p>

<aside class="notice">For even quicker access, you can associate the metadata record with the UUID of the user through the associationIds attribute. See the <a href="#metadata" title="Metadata Management Guide">Metadata Guide</a> for more information about efficient storing and searching of metadata.</aside>

<h3 id="updating">Updating</h3>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X PUT -d <span class="s2">"password=abcd123&amp;amp;email=testuser@test.com&amp;amp;first_name=Test&amp;amp;last_name=User"</span> https://public.tenants.agaveapi.co/profiles/v2/testuser
</code></pre>
<pre class="highlight plaintext"><code>profiles-update -v -p abcd123 -e "testuser@test.com" -f Test -l User testuser
</code></pre>

<p>The response to this call looks like this:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"message"</span><span class="p">:</span><span class="s2">"User updated successfully."</span><span class="p">,</span><span class="w">
  </span><span class="nt">"result"</span><span class="p">:{</span><span class="w">
    </span><span class="nt">"create_time"</span><span class="p">:</span><span class="s2">"20150421153504Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="s2">"testuser@test.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"first_name"</span><span class="p">:</span><span class="s2">"Test"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"full_name"</span><span class="p">:</span><span class="s2">"Test User"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"last_name"</span><span class="p">:</span><span class="s2">"User"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mobile_phone"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nt">"phone"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"Active"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"uid"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="s2">"testuser"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"success"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"version"</span><span class="p">:</span><span class="s2">"2.0.0-SNAPSHOT-rc3fad"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Updates to existing users can be made by sending a PUT request to https://public.tenants.agaveapi.co/profiles/v2/ and passing the fields to update. For example, we can add a <code class="prettyprint">gravatar</code> attribute to the account we created above.</p>

<h3 id="deleting">Deleting</h3>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X DELETE https://public.tenants.agaveapi.co/profiles/v2/testuser
</code></pre>
<pre class="highlight plaintext"><code>profiles-delete -v testuser
</code></pre>

<p>The response to this call looks like this:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
</span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User deleted successfully."</span><span class="p">,</span><span class="w">
</span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
</span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
</span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0.0-SNAPSHOT-rc3fad"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>To delete an existing user, make a DELETE request on their profile resource.</p>

<aside class="notice">Deleting a user is a destructive action and cannot be undone. Consider the implications of user deletion and the impact on their existing metadata before doing so.</aside>

<h3 id="registration-web-application">Registration Web Application</h3>

<p>The account creation web app provides a simple form to enable user self-sign. Here is a screenshot of the sign up form:</p>

<p><img src="/images/2015/04/self-signup-screenshot.png" alt="Account creation web app form" /></p>

<p>The web application also provides an email loop for verification of new accounts. The code is open source and freely available from bitbucket: <a href="https://bitbucket.org/jstubbs/agave_id">Account Creation Web Application</a></p>

<p>Most likely you will want to customize the branding and other aspects of the application, but for simple use cases, the Agave team can deploy a stock instance of the application in your tenant. Work with the Agave developer team if this is of interest to your organization.</p>

              <h2 id="uuid">UUID</h2>
<pre class="highlight json"><code><span class="w"> </span><span class="err">/$$</span><span class="w">   </span><span class="err">/$$</span><span class="w"> </span><span class="err">/$$</span><span class="w">   </span><span class="err">/$$</span><span class="w"> </span><span class="err">/$$$$$$</span><span class="w"> </span><span class="err">/$$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$|_</span><span class="w">  </span><span class="err">$$_/|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$/|</span><span class="w">  </span><span class="err">$$$$$$/</span><span class="w"> </span><span class="err">/$$$$$$|</span><span class="w"> </span><span class="err">$$$$$$$/</span><span class="w">
 </span><span class="err">\______/</span><span class="w">  </span><span class="err">\______/</span><span class="w"> </span><span class="err">|______/|_______/</span><span class="w">
</span></code></pre>

<p>The Agave UUID service resolves the type and representation of one or more Agave UUID. This is helpful, for instance, when you need to expand the hypermedia response of another resource, get the URL corresponding to a UUID, or fetch the representations of multiple resources in a single request.</p>

<h3 id="resolving-a-single-uuid">Resolving a single UUID</h3>

<blockquote>
<p>Resolving a uuid</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/uuid/v2/0001409758089943-5056a550b8-0001-002
</code></pre>
<pre class="highlight plaintext"><code>uuid-lookup -v 0001409758089943-5056a550b8-0001-002
</code></pre>

<blockquote>
<p>The response will look something like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"uuid"</span><span class="p">:</span><span class="s2">"0001409758089943-5056a550b8-0001-002"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"FILE"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:{</span><span class="w">
    </span><span class="nt">"file"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/history/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>A single UUID can be resolved by making a GET request on the UUID resource. The response will include the UUID and the type of the resource to which it is associated. The canonical resource URL is available in the hypermedia response. All calls to the UUID API are authenticated, however no permission checks will be made when doing basic resolving.</p>

<h3 id="expanding-a-uuid-query">Expanding a UUID query</h3>

<blockquote>
<p>Resolving a uuid to a full resource representation</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/uuid/v2/0001409758089943-5056a550b8-0001-002?expand<span class="o">=</span><span class="nb">true</span>&amp;pretty<span class="o">=</span><span class="nb">true</span>
</code></pre>
<pre class="highlight plaintext"><code>uuid-lookup -v -e 0001409758089943-5056a550b8-0001-002
</code></pre>

<blockquote>
<p>The response will include the entire representation of the resource just as if you queried the Files API.</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"lastModified"</span><span class="p">:</span><span class="s2">"2014-09-03T10:28:09.943-05:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"picksumipsum.txt"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"nativeFormat"</span><span class="p">:</span><span class="s2">"raw"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"owner"</span><span class="p">:</span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"path"</span><span class="p">:</span><span class="s2">"/home/nryan/picksumipsum.txt"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"source"</span><span class="p">:</span><span class="s2">"http://127.0.0.1/picksumipsum.txt"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"STAGING_QUEUED"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"systemId"</span><span class="p">:</span><span class="s2">"data.agaveapi.co"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"uuid"</span><span class="p">:</span><span class="s2">"0001409758089943-5056a550b8-0001-002"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"_links"</span><span class="p">:{</span><span class="w">
    </span><span class="nt">"history"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/history/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/media/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"system"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/data.agaveapi.co"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Often times you need more information about the resource associated with the UUID. You can save yourself an API request by adding <code class="prettyprint">expand=true</code> to the URL query. The resulting response, if successful, will include the full resource representation of the resource associated with the UUID just as if you had called its URL directly. Filtering is also supported, so you can specify just the fields you want returned in the response.</p>

<aside class="warning">When requesting resource expansion, permission checks are made on each UUID prior to resolution. Thus, if you do not have permission to view a resource, you will receive a 403 rather than the expanded resource representation.</aside>

<h3 id="resolving-multiple-uuid">Resolving multiple UUID</h3>

<blockquote>
<p>Resolving multiple UUID.  </p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/uuid/v2/?uuids.eq<span class="o">=</span>0001409758089943-5056a550b8-0001-002,0001414144065563-5056a550b8-0001-007?expand<span class="o">=</span><span class="nb">true</span>&amp;pretty<span class="o">=</span><span class="nb">true</span>
</code></pre>
<pre class="highlight plaintext"><code>uuid-lookup -v -E 0001409758089943-5056a550b8-0001-002 0001414144065563-5056a550b8-0001-007
</code></pre>

<blockquote>
<p>The response will be similar to the following.  </p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"uuid"</span><span class="p">:</span><span class="s2">"0001409758089943-5056a550b8-0001-002"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"FILE"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"url"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/history/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"file"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/history/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"uuid"</span><span class="p">:</span><span class="s2">"0001414144065563-5056a550b8-0001-007"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"JOB"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"url"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"file"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>To resolve multiple UUID, make a GET request on the uuids collection and pass the UUID in as a comma-separated list to the <code class="prettyprint">uuids</code> query parameter. The response will contain a list of resolved resources in the same order that you requested them.</p>

<h3 id="expanding-multiple-uuid">Expanding multiple UUID</h3>

<blockquote>
<p>Resolving multiple UUID to their resource representations</p>
</blockquote>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
    https://public.tenants.agaveapi.co/uuid/v2/?uuids.eq<span class="o">=</span>0001409758089943-5056a550b8-0001-002,0001414144065563-5056a550b8-0001-007?expand<span class="o">=</span><span class="nb">true</span>&amp;pretty<span class="o">=</span><span class="nb">true</span>
</code></pre>
<pre class="highlight plaintext"><code>uuid-lookup -v -e 0001409758089943-5056a550b8-0001-002 0001414144065563-5056a550b8-0001-007
</code></pre>

<blockquote>
<p>The response will include an array of the expanded representations in the order they were requested in the URL query.</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="s2">"$JOB_ID"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"demo-pyplot-demo-advanced test-1414139896"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="s2">"$API_USERNAME"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"appId"</span><span class="p">:</span><span class="s2">"demo-pyplot-demo-advanced-0.1.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"executionSystem"</span><span class="p">:</span><span class="s2">"$PUBLIC_EXECUTION_SYSTEM"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"batchQueue"</span><span class="p">:</span><span class="s2">"debug"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"nodeCount"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"processorsPerNode"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"memoryPerNode"</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"maxRunTime"</span><span class="p">:</span><span class="s2">"01:00:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"archive"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"retries"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"localId"</span><span class="p">:</span><span class="s2">"10321"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"outputPath"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"STOPPED"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"submitTime"</span><span class="p">:</span><span class="s2">"2014-10-24T04:48:11.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"startTime"</span><span class="p">:</span><span class="s2">"2014-10-24T04:48:08.000-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"endTime"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"inputs"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"dataset"</span><span class="p">:</span><span class="s2">"agave://$PUBLIC_STORAGE_SYSTEM/$API_USERNAME/inputs/pyplot/testdata.csv"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"parameters"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"chartType"</span><span class="p">:</span><span class="s2">"bar"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"height"</span><span class="p">:</span><span class="s2">"512"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"showLegend"</span><span class="p">:</span><span class="s2">"false"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"xlabel"</span><span class="p">:</span><span class="s2">"Time"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"background"</span><span class="p">:</span><span class="s2">"#FFF"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"width"</span><span class="p">:</span><span class="s2">"1024"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"showXLabel"</span><span class="p">:</span><span class="s2">"true"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"separateCharts"</span><span class="p">:</span><span class="s2">"false"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"unpackInputs"</span><span class="p">:</span><span class="s2">"false"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"ylabel"</span><span class="p">:</span><span class="s2">"Magnitude"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"showYLabel"</span><span class="p">:</span><span class="s2">"true"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"self"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"app"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/apps/v2/demo-pyplot-demo-advanced-0.1.0"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"executionSystem"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/$PUBLIC_EXECUTION_SYSTEM"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"archiveData"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/outputs/listings"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"owner"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/profiles/v2/$API_USERNAME"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"permissions"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/pems"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"history"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/jobs/v2/0001414144065563-5056a550b8-0001-007/history"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"metadata"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/meta/v2/data/?q=%7b%22associationIds%22%3a%220001414144065563-5056a550b8-0001-007%22%7d"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"notifications"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/notifications/v2/?associatedUuid=0001414144065563-5056a550b8-0001-007"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"internalUsername"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lastModified"</span><span class="p">:</span><span class="s2">"2014-09-03T10:28:09.943-05:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"picksumipsum.txt"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"nativeFormat"</span><span class="p">:</span><span class="s2">"raw"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="s2">"nryan"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"path"</span><span class="p">:</span><span class="s2">"/home/nryan/picksumipsum.txt"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"source"</span><span class="p">:</span><span class="s2">"http://127.0.0.1/picksumipsum.txt"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="s2">"STAGING_QUEUED"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"systemId"</span><span class="p">:</span><span class="s2">"data.agaveapi.co"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"uuid"</span><span class="p">:</span><span class="s2">"0001409758089943-5056a550b8-0001-002"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"_links"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"history"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/history/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"self"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/files/v2/media/system/data.agaveapi.co/nryan/picksumipsum.txt"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"system"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="s2">"https://public.tenants.agaveapi.co/systems/v2/data.agaveapi.co"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>Expansion also works when querying UUID in bulk. Simply add <code class="prettyprint">expand=true</code> to the URL query in your request and the full resource representation of each UUID will be returned in an array with the original UUID request order maintained. If any of the resolutions fail due to permission violation or server error, the error response object will be provided rather than resource representation.</p>

              <h2 id="events">Events</h2>
<pre class="highlight json"><code><span class="w"> </span><span class="err">/$$$$$$$$</span><span class="w">                          </span><span class="err">/$$</span><span class="w">            
</span><span class="err">|</span><span class="w"> </span><span class="err">$$_____/</span><span class="w">                         </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">            
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">   </span><span class="err">/$$</span><span class="w">    </span><span class="err">/$$/$$$$$$</span><span class="w"> </span><span class="err">/$$$$$$$</span><span class="w"> </span><span class="err">/$$$$$$</span><span class="w">  </span><span class="err">/$$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$$$|</span><span class="w">  </span><span class="err">$$</span><span class="w">  </span><span class="err">/$$/$$__</span><span class="w">  </span><span class="err">$|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$|_</span><span class="w">  </span><span class="err">$$_/</span><span class="w"> </span><span class="err">/$$_____/</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$__/\</span><span class="w">  </span><span class="err">$$/$$|</span><span class="w"> </span><span class="err">$$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$</span><span class="w"> 
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">    </span><span class="err">\</span><span class="w">  </span><span class="err">$$$/|</span><span class="w"> </span><span class="err">$$_____|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">/$\____</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$$$$$$\</span><span class="w">  </span><span class="err">$/</span><span class="w"> </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w"> </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$/$$$$$$$/</span><span class="w">
</span><span class="err">|________/\_/</span><span class="w">   </span><span class="err">\_______|__/</span><span class="w">  </span><span class="err">|__/</span><span class="w">  </span><span class="err">\___/|_______/</span><span class="w"> 
</span></code></pre>

<p>Events underpin everything in the Agave Platform. This section covers the events available to each resource.</p>

              <h3 id="event-reference">Event Reference</h3>

<h4 id="apps">Apps</h4>

<table>
    <thead>
        <tr>
            <th>Event</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>UPDATED</td>
            <td>The app was updated</td>
        </tr>
        <tr>
            <td>DELETED</td>
            <td>The app was deleted</td>
        </tr>
        <tr>
            <td>PUBLISHED</td>
            <td>The app was made available for public use.</td>
        </tr>
        <tr>
            <td>CLONED</td>
            <td>The app was cloned as another app</td>
        </tr>
        <tr>
            <td>PERMISSION_GRANT</td>
            <td>A user permission was updated</td>
        </tr>
        <tr>
            <td>PERMISSION_REVOKE</td>
            <td>A user permission was deleted</td>
        </tr>
        <tr>
            <td>RESTORED</td>
            <td>App was restored from disabled status</td>
        </tr>
        <tr>
            <td>UNPUBLISHED</td>
            <td>App was unpublished. It will no longer be available for public use</td>
        </tr>
        <tr>
            <td>PUBLISHING_FAILED</td>
            <td>The app failed to complete publishing. The id given in the original request is not valid and the app will not be publicly available.</td>
        </tr>
        <tr>
            <td>DISABLED</td>
            <td>App was disabled and is not currently available for use.</td>
        </tr>
        <tr>
            <td>CLONING_FAILED</td>
            <td>The app failed to complete publishing. The id given in the original request is not valid and the app will not be available for use.</td>
        </tr>
        <tr>
            <td>REGISTERED</td>
            <td>A new app was registered</td>
        </tr>
    </tbody>
</table>

<h4 id="files">Files</h4>

<table>
    <thead>
        <tr>
            <th>Event</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>CREATED</td>
            <td>File or directory was created</td>
        </tr>
        <tr>
            <td>DELETED</td>
            <td>The file was deleted</td>
        </tr>
        <tr>
            <td>INDEX_START</td>
            <td>Indexing of file/folder started</td>
        </tr>
        <tr>
            <td>INDEX_COMPLETE</td>
            <td>Indexing of file/folder completed</td>
        </tr>
        <tr>
            <td>INDEX_FAILED</td>
            <td>Indexing of file/folder failed</td>
        </tr>
        <tr>
            <td>RENAME</td>
            <td>The file was renamed</td>
        </tr>
        <tr>
            <td>MOVED</td>
            <td>The file was moved to another path</td>
        </tr>
        <tr>
            <td>OVERWRITTEN</td>
            <td>The file was overwritten</td>
        </tr>
        <tr>
            <td>PERMISSION_GRANT</td>
            <td>A user permission was added</td>
        </tr>
        <tr>
            <td>PERMISSION_REVOKE</td>
            <td>A user permission was deleted</td>
        </tr>
        <tr>
            <td>STAGING_QUEUED</td>
            <td>File/folder queued for staging</td>
        </tr>
        <tr>
            <td>STAGING</td>
            <td>File or directory is currently in flight</td>
        </tr>
        <tr>
            <td>STAGING_FAILED</td>
            <td>Staging failed</td>
        </tr>
        <tr>
            <td>STAGING_COMPLETED</td>
            <td>Staging completed successfully</td>
        </tr>
        <tr>
            <td>PREPROCESSING</td>
            <td>Prepairing file for processing
        </td>
        </tr>
        <tr>
            <td>TRANSFORMING_QUEUED</td>
            <td>File/folder queued for transform</td>
        </tr>
        <tr>
            <td>TRANSFORMING</td>
            <td>Transforming file/folder</td>
        </tr>
        <tr>
            <td>TRANSFORMING_FAILED</td>
            <td>Transform failed</td>
        </tr>
        <tr>
            <td>TRANSFORMING_COMPLETED</td>
            <td>Transform completed successfully</td>
        </tr>
        <tr>
            <td>UPLOAD</td>
            <td>New content was uploaded to the file.</td>
        </tr>
        <tr>
            <td>CONTENT_CHANGED</td>
            <td>Content changed within this file/folder. If a folder, this event will be thrown whenever content changes in any file within this folder at most one level deep.</td>
        </tr>
        <tr>
            <td>DOWNLOAD</td>
            <td>The file item was downloaded.</td>
        </tr>
    </tbody>
</table>

<h4 id="internal-users">Internal Users</h4>

<table>
    <thead>
        <tr>
            <th>Event</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>CREATED</td>
            <td>The internal user was updated</td>
        </tr>
        <tr>
            <td>DELETED</td>
            <td>The internal user was deleted</td>
        </tr>
        <tr>
            <td>UPDATED</td>
            <td>The internal user was updated</td>
        </tr>
    </tbody>
</table>

<h4 id="jobs">Jobs</h4>

<table>
    <thead>
        <tr>
            <th>Event</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>CREATED</td>
            <td>The job was updated</td>
        </tr>
        <tr>
            <td>UPDATED</td>
            <td>The job was updated</td>
        </tr>
        <tr>
            <td>DELETED</td>
            <td>The job was deleted</td>
        </tr>
        <tr>
            <td>PERMISSION_GRANT</td>
            <td>User permission was granted</td>
        </tr>
        <tr>
            <td>PERMISSION_REVOKE</td>
            <td>Permission was removed for a user on this job</td>
        </tr>
        <tr>
            <td>PENDING</td>
            <td>Job accepted and queued for submission.</td>
        </tr>
        <tr>
            <td>STAGING_INPUTS</td>
            <td>Transferring job input data to execution system</td>
        </tr>
        <tr>
            <td>CLEANING_UP</td>
            <td>Job completed execution</td>
        </tr>
        <tr>
            <td>ARCHIVING</td>
            <td>Transferring job output to archive system</td>
        </tr>
        <tr>
            <td>STAGING_JOB</td>
            <td>Job inputs staged to execution system</td>
        </tr>
        <tr>
            <td>FINISHED</td>
            <td>Job complete</td>
        </tr>
        <tr>
            <td>KILLED</td>
            <td>Job execution killed at user request</td>
        </tr>
        <tr>
            <td>FAILED</td>
            <td>Job failed</td>
        </tr>
        <tr>
            <td>STOPPED</td>
            <td>Job execution intentionally stopped</td>
        </tr>
        <tr>
            <td>RUNNING</td>
            <td>Job started running</td>
        </tr>
        <tr>
            <td>PAUSED</td>
            <td>Job execution paused by user</td>
        </tr>
        <tr>
            <td>QUEUED</td>
            <td>Job successfully placed into queue</td>
        </tr>
        <tr>
            <td>SUBMITTING</td>
            <td>Preparing job for execution and staging binaries to execution system</td>
        </tr>
        <tr>
            <td>STAGED</td>
            <td>Job inputs staged to execution system</td>
        </tr>
        <tr>
            <td>PROCESSING_INPUTS</td>
            <td>Identifying input files for staging</td>
        </tr>
        <tr>
            <td>ARCHIVING_FINISHED</td>
            <td>Job archiving complete</td>
        </tr>
        <tr>
            <td>ARCHIVING_FAILED</td>
            <td>Job archiving failed</td>
        </tr>
        <tr>
            <td>HEARTBEAT</td>
            <td>Job heartbeat received</td>
        </tr>
        <tr>
            <td>JOB_RUNTIME_CALLBACK_EVENT</td>
            <td>This is the default event thrown when a job pushes out runtime information using the <span class="code">AGAVE_JOB_CALLBACK_NOTIFICATION</span> macro.</td>
        </tr>
        <tr>
            <td>EMPTY_STATUS_RESPONSE</td>
            <td>An empty response was received from the remote execution system when querying for job status</td>
        </tr>
        <tr>
            <td>REMOTE_STATUS_CHANGE</td>
            <td>The status of the job on the remote system was changed by an external process. The change does not reflect a change in Agave&rsquo;s understanding of the job&rsquo;s status.</td>
        </tr>
        <tr>
            <td>UNKNOWN_TERMINATION</td>
            <td>The job experienced an unknown termination event and is no longer running on the remote system. The job will be failed by Agave momentarily.</td>
        </tr>
    </tbody>
</table>

<h4 id="metadata">Metadata</h4>

<table>
    <thead>
        <tr>
            <th>Event</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>CREATED</td>
            <td>The metadata was updated</td>
        </tr>
        <tr>
            <td>UPDATED</td>
            <td>The metadata was updated</td>
        </tr>
        <tr>
            <td>DELETED</td>
            <td>The metadata was deleted</td>
        </tr>
        <tr>
            <td>PERMISSION_GRANT</td>
            <td>User permission was granted</td>
        </tr>
        <tr>
            <td>PERMISSION_REVOKE</td>
            <td></td>
        </tr>
    </tbody>
</table>

<h4 id="monitors">Monitors</h4>

<table><thead>
<tr>
<th>API       </th>
<th> Description</th>
</tr>
</thead><tbody>
<tr>
<td>CREATED</td>
<td>The monitor was created</td>
</tr>
<tr>
<td>UPDATED</td>
<td>The monitor was updated</td>
</tr>
<tr>
<td>DELETED</td>
<td>The monitor was deleted</td>
</tr>
<tr>
<td>ENABLED</td>
<td>The monitor was enabled</td>
</tr>
<tr>
<td>DISABLED</td>
<td>The monitor was disabled</td>
</tr>
<tr>
<td>PERMISSION_GRANT</td>
<td>A new user permission was granted on this monitor</td>
</tr>
<tr>
<td>PERMISSION_REVOKE</td>
<td>A user permission was revoked on this sytem</td>
</tr>
<tr>
<td>FORCED_CHECK_REQUESTED</td>
<td>A status check was requested by the user outside of the existing monitor schedule.</td>
</tr>
<tr>
<td>CHECK_PASSED</td>
<td>The status check passed</td>
</tr>
<tr>
<td>CHECK_FAILED</td>
<td>The status check failed</td>
</tr>
<tr>
<td>CHECK_UNKNOWN</td>
<td>The status check finished in an unknown state</td>
</tr>
<tr>
<td>STATUS_CHANGE</td>
<td>The status condition of the monitored resource changed since the last check</td>
</tr>
<tr>
<td>RESULT_CHANGE</td>
<td>The cumulative result of all checks performed on the monitored resource changed since the last suite of checks</td>
</tr>
</tbody></table>

<h4 id="schema">Schema</h4>

<table>
    <thead>
        <tr>
            <th>Event</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>CREATED</td>
            <td>The schema was updated</td>
        </tr>
        <tr>
            <td>UPDATED</td>
            <td>The schema was updated</td>
        </tr>
        <tr>
            <td>DELETED</td>
            <td>The schema was deleted</td>
        </tr>
        <tr>
            <td>PERMISSION_GRANT</td>
            <td>User permission was granted</td>
        </tr>
        <tr>
            <td>PERMISSION_REVOKE</td>
            <td></td>
        </tr>
    </tbody>
</table>

<h4 id="postits">PostIts</h4>

<table>
    <thead>
        <tr>
            <th>Event</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>CREATED</td>
            <td>The metadata was updated</td>
        </tr>
        <tr>
            <td>UPDATED</td>
            <td>The metadata was updated</td>
        </tr>
        <tr>
            <td>REFRESHED</td>
            <td>PostIt was refreshed back to its original quotas or extended for another day</td>
        </tr>
        <tr>
            <td>DELETED</td>
            <td>The metadata was deleted</td>
        </tr>
        <tr>
            <td>REDEEMED</td>
            <td>User permission was granted</td>
        </tr>
    </tbody>
</table>

<h4 id="profiles">Profiles</h4>

<table>
    <thead>
        <tr>
            <th>Event</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>CREATED</td>
            <td>A new user account was created.</td>
        </tr>
        <tr>
            <td>DELETED</td>
            <td>The user account was deleted.</td>
        </tr>
        <tr>
            <td>UPDATED</td>
            <td>The user account was updated.</td>
        </tr>
        <tr>
            <td>ACCOUNT_ACTIVATED</td>
            <td>The user&rsquo;s account was activated.</td>
        </tr>
        <tr>
            <td>ACCOUNT_DEACTIVATED</td>
            <td>The user&rsquo;s account was deactivated.</td>
        </tr>
        <tr>
            <td>ROLE_GRANTED</td>
            <td>The user had a role added.</td>
        </tr>
        <tr>
            <td>ROLE_REVOKED</td>
            <td>The user had a role revoked.</td>
        </tr>
        <tr>
            <td>QUOTA_EXCEEDED</td>
            <td>The user has exceeded one or more quotas.</td>
        </tr>
    </tbody>
</table>

<h4 id="systems">Systems</h4>

<table>
    <thead>
        <tr>
            <th>Event</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>CREATED</td>
            <td>The system was created</td>
        </tr>
        <tr>
            <td>UPDATED</td>
            <td>The system was updated</td>
        </tr>
        <tr>
            <td>DELETED</td>
            <td>The system was deleted</td>
        </tr>
        <tr>
            <td>ROLES_GRANT</td>
            <td>User permission was granted</td>
        </tr>
        <tr>
            <td>ROLES_REVOKE</td>
            <td>User role was removed from the system</td>
        </tr>
        <tr>
            <td>STATUS_CHANGE</td>
            <td>The system status changed</td>
        </tr>
    </tbody>
</table>

<h4 id="transfers">Transfers</h4>

<table>
    <thead>
        <tr>
            <th>Event</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>CREATED</td>
            <td>A new transfer was created</td>
        </tr>
        <tr>
            <td>CANCELLED</td>
            <td>The system was deleted</td>
        </tr>
        <tr>
            <td>QUEUED</td>
            <td>Transfer queued and waiting to start</td>
        </tr>
        <tr>
            <td>COMPLETED</td>
            <td>Transfer completed successfully</td>
        </tr>
        <tr>
            <td>FAILED</td>
            <td>Transfer failed while transferring</td>
        </tr>
        <tr>
            <td>PAUSED</td>
            <td>Transfer paused</td>
        </tr>
        <tr>
            <td>RETRYING</td>
            <td>Transfer failed, beginning to retry</td>
        </tr>
        <tr>
            <td>TRANSFERRING</td>
            <td>Transfer has started</td>
        </tr>
    </tbody>
</table>

              <h2 id="search">Search</h2>
<pre class="highlight json"><code><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">                                     </span><span class="err">/$$</span><span class="w">
 </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">                                   </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\__/</span><span class="w"> </span><span class="err">/$$$$$$</span><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">  </span><span class="err">/$$$$$$</span><span class="w">  </span><span class="err">/$$$$$$|</span><span class="w"> </span><span class="err">$$$$$$$</span><span class="w">
</span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$</span><span class="w"> </span><span class="err">/$$__</span><span class="w">  </span><span class="err">$$|____</span><span class="w">  </span><span class="err">$$/$$__</span><span class="w">  </span><span class="err">$$/$$_____|</span><span class="w"> </span><span class="err">$$__</span><span class="w">  </span><span class="err">$$</span><span class="w">
 </span><span class="err">\____</span><span class="w">  </span><span class="err">$|</span><span class="w"> </span><span class="err">$$$$$$$$</span><span class="w"> </span><span class="err">/$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\__|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$$</span><span class="w">
 </span><span class="err">/$$</span><span class="w">  </span><span class="err">\</span><span class="w"> </span><span class="err">$|</span><span class="w"> </span><span class="err">$$_____//$$__</span><span class="w">  </span><span class="err">$|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">     </span><span class="err">|</span><span class="w">  </span><span class="err">$$$$$$|</span><span class="w"> </span><span class="err">$$</span><span class="w">  </span><span class="err">|</span><span class="w"> </span><span class="err">$$</span><span class="w">
 </span><span class="err">\______/</span><span class="w"> </span><span class="err">\_______/\_______|__/</span><span class="w">      </span><span class="err">\_______|__/</span><span class="w">  </span><span class="err">|__/</span><span class="w">
</span></code></pre>

<p>Search is a fundamental feature of the Agave Platform. Most of the core science APIs support a mature, URL-based query mechanism allowing you to search using a sql-inspired json syntax. The two exceptions are the Files and Metadata APIs. The Files service does not index the directory or file contents of registered systems, so there is no way for it to performantly search the file system. The metadata service supports MongoDB query syntax, thus allowing more flexible, and slightly more complex, querying syntax.</p>

<h3 id="query-syntax">Query syntax</h3>

<p>By default, search is enabled on each collection endpoint allowing you to trim the response down to the results you care about most. The list of available search terms is identical to the attributes included in the JSON returned when requesting the full resource description.</p>

<aside class="info">To see a full listing of the JSON attributes for each resource in the core science APIs, please see the <a href="/live-docs/" title="Live Docs">Live Docs</a>.</aside>

<p>To search for a specific attribute, you simply append a search expression into the URL query of your request. For example:</p>
<pre class="highlight json"><code><span class="err">http://public.agaveapi.co/jobs/v</span><span class="mi">2</span><span class="err">?name=test%</span><span class="mi">20</span><span class="err">job</span><span class="w">  
</span></code></pre>

<blockquote>
<p>You can include as multiple search expressions to build a more restrictive query.</p>
</blockquote>
<pre class="highlight json"><code><span class="err">http://public.agaveapi.co/jobs/v</span><span class="mi">2</span><span class="err">?name=test%</span><span class="mi">20</span><span class="err">job&amp;executionSystem=aws-demo&amp;status=FAILED</span><span class="w">  
</span></code></pre>

<aside class="warning">Note that the values in your search expression must be URL encoded.</aside>

<h3 id="search-operators">Search operators</h3>

<p>By default, all search expressions are evaluated for equality. In order to perform more complex queries, you may append a search operator to the attribute in your search expression. The following examples should help clarify:</p>
<pre class="highlight shell"><code><span class="c"># systems with cloud in their name  </span>
systems/v2?name.like<span class="o">=</span><span class="k">*</span>cloud<span class="k">*</span>

<span class="c"># apps modified between October 1 and October 30 of this year  </span>
apps/v2?lastModified.between<span class="o">=</span>10/1,10/30

<span class="c"># jobs with status equal to PENDING or ARCHIVING  </span>
<span class="nb">jobs</span>/v2?id.in<span class="o">=</span>PENDING,ARCHIVING
</code></pre>
<pre class="highlight plaintext"><code># systems with cloud in their name  
systems-search 'name.like=*cloud*'

# apps modified between October 1 and October 30 of this year  
apps-search 'lastModified.between=10/1,10/30'

# jobs with status equal to PENDING or ARCHIVING  
jobs-search 'id.in=PENDING,ARCHIVING'
</code></pre>

<p>For resources with nested collections, you may use JSON dot notation to query the subresources in the collection.</p>
<pre class="highlight shell"><code><span class="c"># systems using Amazon S3 as the storage protocol  </span>
systems/v2?storage.protocol<span class="o">=</span><span class="s2">"S3"</span>

<span class="c"># systems with a batch queue allowing more than 10 concurrent user jobs  </span>
systems/v2?queues.maxUserJobs.gt<span class="o">=</span>10
</code></pre>
<pre class="highlight plaintext"><code># systems using Amazon S3 as the storage protocol  
systems-search 'storage.protocol=S3'

# systems with a batch queue allowing more than 10 concurrent user jobs  
systems-search 'queues.maxUserJobs.gt=10'
</code></pre>

<h3 id="multiple-operators">Multiple operators</h3>

<p>As before you can include multiple search expressions to narrow your results.</p>
<pre class="highlight shell"><code><span class="c"># jobs whos app has hadoop in the name, ran on a system with id aws-demo, and started</span>
<span class="c"># any time during the last business week</span>
<span class="nb">jobs</span>/v2?appId.like<span class="o">=</span><span class="k">*</span>hadoop<span class="k">*</span>&amp;executionSystem.eq<span class="o">=</span>aws-demo&amp;startTime.between<span class="o">=</span>last%20monday,last%20friday  

<span class="c"># users who profile has a last name ending in ross and an email address ending in texas.edu   </span>
profiles/v2?lastname.like<span class="o">=</span><span class="k">*</span>ross&amp;email.like<span class="o">=</span><span class="k">*</span>texas.edu  

<span class="c"># failed login checks on the a system with uuid 0001409867973952-5056a550b8-0001-014</span>
monitors/v2/?target.like<span class="o">=</span><span class="k">*</span>ec2<span class="k">*</span>&amp;result.eq<span class="o">=</span>FAILED&amp;type<span class="o">=</span>LOGIN  
</code></pre>
<pre class="highlight plaintext"><code># jobs whos app has hadoop in the name, ran on a system with id aws-demo, and started
# any time during the last business week
jobs-search 'appId.like=*hadoop*' \
            'executionSystem.eq=aws-demo' \
            'startTime.between=last%20monday,last%20friday'  

# users who profile has a last name ending in ross and an email address ending in texas.edu   
profiles-search 'lastname.like=*ross' 'email.like=*texas.edu'

# failed login monitor checks on systems with "ec2" in the name
monitors-checks-search -M target.like=*ec2* \
                      'result.eq=FAILED' \
                      'type=LOGIN'
</code></pre>

<p>The full list of search operators is given in the following table.</p>

<table>
    <thead>
        <tr>
            <th>Operator</th>
            <th>Values</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>eq</td>
            <td>mixed</td>
            <td>Matches values equal to the given search value. All comparisons are case sensitive. This cannot be used for complex object comparison.</td>
        </tr>
        <tr>
            <td>on</td>
            <td>datestring</td>
            <td>Matches dates falling on the given datestring. Regardless of the precision given in the datestring, the search will look for matches from midnight to midnight on the resovled date.</td>
        </tr>
        <tr>
            <td>neq</td>
            <td>mixed</td>
            <td>Matches values <b>not</b> equal to the given search value. All comparisons are case sensitive. This cannot be used for complex object comparison.</td>
        </tr>
        <tr>
            <td>lt</td>
            <td>mixed</td>
            <td>Matches values less than the given search value. </td>
        </tr>
        <tr>
            <td>before</td>
            <td>datestring</td>
            <td>Matches dates falling before the given datestring. Single second precision is supported.</td>
        </tr>
        <tr>
            <td>lte</td>
            <td>mixed</td>
            <td>Matches values less than or equal to the given search value. </td>
        </tr>
        <tr>
            <td>gt</td>
            <td>mixed</td>
            <td>Matches values greater than the given search value. </td>
        </tr>
        <tr>
            <td>after</td>
            <td>datestring</td>
            <td>Matches values after the given datestring. </td>
        </tr>
        <tr>
            <td>gte</td>
            <td>mixed</td>
            <td>Matches values greater than or equal to the given search value. </td>
        </tr>
        <tr>
            <td>in</td>
            <td>comma-separated list</td>
            <td>Matches values in the given comma-separated list. This is equivalent to applying the <span class="code">like</span> operator to each comma-separated value .</td>
        </tr>
        <tr>
            <td>nin</td>
            <td>comma-separated list</td>
            <td>Matches values <b>not</b> in the given comma-separated list. This is equivalent to applying the <span class="code">nlike</span> operator to each comma-separated value .</td>
        </tr>
        <tr>
            <td>like</td>
            <td>string</td>
            <td>Matches values similar to the given search term. Wildcards (*) may be used to perform partial matches.</td>
        </tr>
        <tr>
            <td>nlike</td>
            <td>string</td>
            <td>Matches values different from the given search term. Wildcards (*) may be used to perform partial matches.</td>
        </tr>
        <tr>
            <td>between</td>
            <td>comma-separated datestring </td>
            <td>Matches dates falling within the given range. Single second precision is supported at either end of the range.</td>
        </tr>
    </tbody>
</table>

<h3 id="date-support">Date support</h3>

<p>Dates returned from the Agave core science API are always formatted as ISO8601 dates. When searching, however, a much more flexible date syntax is supported. The following table lists supported expressions by example.</p>

<table>
    <thead>
        <tr>
            <th>Expression</th>
            <th>Equivalent Expression</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>08:00:00.000</td>
            <td></td>
        </tr>
        <tr>
            <td>4pm or 04:00pm or 16:00</td>
            <td>16:00:00.000</td>
        </tr>
        <tr>
            <td>430pm or 04:30pm or 16:30</td>
            <td>16:30:00.000</td>
        </tr>
        <tr>
            <td>4pm</td>
            <td>17:00:00.000</td>
        </tr>
        <tr>
            <td>+1 second|minute|hour|day|week|month|year</td>
            <td>now +1 second|minute|hour|day|week|month|year</td>
        </tr>
        <tr>
            <td>-1 second|minute|hour|day|week|month|year</td>
            <td>now -1 second|minute|hour|day|week|month|year</td>
        </tr>
        <tr>
            <td>next Tuesday</td>
            <td></td>
        </tr>
        <tr>
            <td>last Tuesday</td>
            <td></td>
        </tr>
        <tr>
            <td>now</td>
            <td>new Date()</td>
        </tr>
        <tr>
            <td>today</td>
            <td>00:00:00.000</td>
        </tr>
        <tr>
            <td>midnight</td>
            <td>00:00:00.000 +24 hours</td>
        </tr>
        <tr>
            <td>morning or this morning</td>
            <td>07:00:00.000</td>
        </tr>
        <tr>
            <td>noon</td>
            <td>12:00:00.000</td>
        </tr>
        <tr>
            <td>afternoon or this afternoon</td>
            <td>13:00:00.000</td>
        </tr>
        <tr>
            <td>evening or this evening</td>
            <td>17:00:00.000</td>
        </tr>
        <tr>
            <td>tonight</td>
            <td>20:00:00.000</td>
        </tr>
        <tr>
            <td>tomorrow</td>
            <td>now +24 hours</td>
        </tr>
        <tr>
            <td>tomorrow morning</td>
            <td>morning +24 hours</td>
        </tr>
        <tr>
            <td>noon tomorrow or tomorrow noon</td>
            <td>noon +24 hours</td>
        </tr>
        <tr>
            <td>tomorrow afternoon</td>
            <td>afternoon +24 hours</td>
        </tr>
        <tr>
            <td>yesterday</td>
            <td>now -24 hours</td>
        </tr>
        <tr>
            <td>all the permutations of yesterday and morning, noon, afternoon, and evening</td>
            <td>#colspan#</td>
        </tr>
        <tr>
            <td>2004</td>
            <td></td>
        </tr>
        <tr>
            <td>October or Oct</td>
            <td>10/1</td>
        </tr>
        <tr>
            <td>Tuesday or Tue</td>
            <td><i>Calendar date of the next Tuesday</i></td>
        </tr>
        <tr>
            <td>October 26, 1981 or Oct 26, 1981</td>
            <td>10/26/1981</td>
        </tr>
        <tr>
            <td>October 26 or Oct 26</td>
            <td>10/26</td>
        </tr>
        <tr>
            <td>26 October 1981</td>
            <td>10/26/1981</td>
        </tr>
        <tr>
            <td>26 Oct 1981</td>
            <td>10/26/1981</td>
        </tr>
        <tr>
            <td>26 Oct 81</td>
            <td>10/26/1981</td>
        </tr>
        <tr>
            <td>10/26/1981 or 10-26-1981</td>
            <td></td>
        </tr>
        <tr>
            <td>10/26/81 or 10-26-81</td>
            <td></td>
        </tr>
        <tr>
            <td>1981/10/26 or 1981-10-26</td>
            <td>10/26/1981</td>
        </tr>
        <tr>
            <td>10/26 or 10-26</td>
            <td></td>
        </tr>
    </tbody>
</table>

              <h1 id="tooling">Tooling</h1>

<p>Sometimes the hardest part of a new project is taking the first step. Agave Tooling helps make taking that first step a little easier through reference web applications, boilerplate integrations scripts, and integrations with popular CMS and frameworks through native plugins and modules.</p>

              <h2 id="agave-togo">Agave ToGo</h2>

<p>Get a head start on your next development sprint by leveraging the open source <a href="http://togo.agaveapi.co/">Agave ToGo</a> project. This AngularJS webapp can be reused in your existing project or used as-is for a clean, responsive, client-side web application that brings the full power of Agave to your browser.</p>

              <h2 id="jupyter-hub">Jupyter Hub</h2>

<p>Jupyter notebooks (formerly iPython notebooks) provide users with interactive computing documents that contain both computer code and a mix of rich text elements such as data visualizations, text paragraphs, hyperlinks, formatted equations, etc. The code cells in notebooks can be executed interactively, cell by cell, and the results of the executions are displayed in subsequent cells in the notebook. The notebooks can also be exported to a serialized JSON formatted file and executed like a traditional program.</p>

<p>JupyterHub is an open source project to provide multi-user hosted notebook servers as a service. When a user signs in to JupyterHub, a notebook server with pre-configured software is automatically launched for them. The Agave team integrated JupyterHub into its identity and access management stack and made several other additional enhancements and customizations to enable the use of Agave&rsquo;s language SDKs such as agavepy and the CLI, persistent storage, and multiple kernel support, directly from their notebooks with very minimal setup. Agave’s deployment of JupyterHub, which runs each user’s notebook server in a Docker container to further enhance reproducibility, is freely available for use in Agave&rsquo;s Public Tenant. </p>

<p>You can get started with JupyterHub today at <a href="https://jupyter.agaveapi.co">https://jupyter.agaveapi.co</a>.</p>

              <h2 id="command-line-interface">Command Line Interface</h2>

<p>The Agave command-line interface (CLI) is an complete interface to the Agave REST API. The scripts include support for creating persistent authentication sessions, creating/renaming apps, registering and sharing systems, uploading and managing data, creating PostIts, etc. For existing projects looking to leverage Agave for back-end processing, for users wishing to integrate Agave into their existing scripted solutions, or for those new to Agave who just want to kick the tires, the Agave CLI is a powerful tool for all of these things. The Agave CLI can be checked out from the Agave git repository.</p>
<pre class="highlight shell"><code>git clone https://bitbucket.org/agaveapi/cli
</code></pre>

<p>For more information on using the Agave CLI in common tasks, please consult the <a href="#tutorials" title="Tutorials">Tutorials Section</a> which reference it in all their examples, or check out the <a href="https://bitbucket.org/agaveapi/science-api-samples" title="Agave Tutorials Samples" target="_blank">Agave Samples project</a> for sample data and examples of how to use it to populate and interact with your tenant.</p>

          </div>
          <div class="dark-box">
              <div class="lang-selector">
                <a href="#" id="codeToggle"><span class="menu-left" aria-hidden="true">&lt;</span><span class="menu-right" aria-hidden="true">&gt;</span></a>
                    <a href="#" data-language-name="shell">cURL</a>
                    <a href="#" data-language-name="plaintext">CLI</a>
              </div>

          </div>
        </div>
    </div>
    <script type="text/javascript">
      document.getElementById("fouc").style.display="block";
    </script>
  </body>
</html>
