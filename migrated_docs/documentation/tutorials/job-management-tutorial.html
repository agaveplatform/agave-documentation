<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Agave Developer Docs</title>
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">


    <!-- <script src="https://use.typekit.net/squ8frf.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script> -->

    <link href="../../../stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="../../../stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <link rel="preload" href="fonts/slate.woff" as="font">
    <link rel="preload" href="fonts/agave.woff" as="font">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <!-- <script src="../../../javascripts/jquery.min.js" type="text/javascript"></script> -->

      <script src="../../../javascripts/all_nosearch.js" type="text/javascript"></script>
    <script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-43163231-12', 'auto');
ga('require', 'eventTracker');
ga('require', 'outboundLinkTracker');
ga('require', 'urlChangeTracker');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script src="../../../javascripts/autotrack.js" type="text/javascript" async="true"></script>

    <style>
    .js #fouc { display: none; }
    </style>
    <script type="text/javascript">
        document.documentElement.className = 'js';
    </script>
  </head>

  <body class="migrated_docs migrated_docs_documentation migrated_docs_documentation_tutorials migrated_docs_documentation_tutorials_job-management-tutorial">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../../../images/navbar.png" />
      </span>
    </a>
    <div id="fouc">
        <div class="tocify-wrapper">
          <img class="menu-logo" src="../../../images/agave-docs-logo.png" />
          
          <div id="toc">
          </div>
        </div>
        <div class="page-wrapper">
          <div class="dark-box"></div>
          <div class="content">
            <h3 id="overview">Overview</h3>

<p>The Jobs service is a basic execution service that allows you to run applications registered with the Apps service across multiple, distributed, heterogeneous systems through a common REST interface. The service manages all aspects of execution and job management from data staging, job submission, monitoring, output archiving, event logging, sharing, and notifications. The Jobs service also provides a persistent reference to your job&rsquo;s output data and a mechanism for sharing all aspects of your job with others. Each feature will be described in more detail below.</p>

<aside class="notice">If you are not familiar with batch computing and why we refer to a simulation run as a &ldquo;job,&rdquo; we wrote a good blog post on the topic, <a href="http://agaveapi.co/what-is-a-job2/" title="What is a Job">What is a &ldquo;Job&rdquo;</a> that will help give you some context and background on the subject and terminology.</aside>

<h3 id="job-submission">Job submission</h3>

<p>Job submission is a term recycled from shared batch computing environments where a user would submit a request for a unit of computational work (called a Job) to the batch scheduler, then go head home for dinner while waiting for the computer to complete the job they gave it.</p>

<p>Originally the batch scheduler was a person and the term batch came from their ability to process several submissions together. Later on, as human schedulers were replaced by software, the term stuck even though the process remained unchanged. Today the term job submission is essentially unchanged.</p>

<p>A user submits a request for a unit of work to be done. The primary difference is that today, often times, the wait time between submission and execution is considerably less. On shared systems, such as many of the HPC systems originally targeted by Agave, waiting for your job to start is the price you pay for the incredible performance you get once your job starts.</p>

<p>Agave, too, adopts the concept of job submission, though it is not in and of itself a scheduler. In the context of Agave&rsquo;s Job service, the process of running an application registered with the Apps service is referred to as submitting a job.</p>

<p>Unlike in the batch scheduling world where each scheduler has its own job submission syntax and its own idiosyncrasies, the mechanism for submitting a job to Agave is consistent regardless of the application or system on which you run. A HTML form or JSON object are posted to the Jobs service. The submission is validated, and the job is forwarded to the scheduling and execution services for processing.</p>

<p>Because Agave takes an app-centric view of science, execution does not require knowing about the underlying systems on which an application runs. Simply knowing how the parameters and inputs you want to use when running an app is sufficient to define a job. Agave will handle the rest.</p>

<p>As mentioned previously, jobs are submitted by making a HTTP POST request either a HTML form or a JSON object to the Jobs service. All job submissions must include a few mandatory values that are used to define a basic unit of work. Table 1 lists the optional and required attributes of all job submissions.</p>

<p>&lt;%= partial &ldquo;includes/tables/69&rdquo; %&gt;</p>

<p class="table-caption">Table 1. The optional and required attributes common to all job submissions. Optional fields are marked with an astericks.</p>

<aside class="notice">In this tutorial we will use JSON for our examples, however, one could replace the JSON object with a HTML form mapping JSON attribute and values to HTML form attributes and values one for one and get the same results, with the exception of the `notifications` attribute which is not accepted using HTML form submission and would need to be added after submitting the job request by sending each of the notification objects with the returned job id to the <a href="http://agaveapi.co/documentation/tutorials/notification-management-tutorial/" title="Notification Management Tutorial">Notifications API</a>.</aside>

<p>In addition to the standard fields for all jobs, the application you specify in the <code>appId</code> field will also have its own set of inputs and parameters specified during registration that are unique to that app. (For more information about app registration and descriptions, see the <a href="http://agaveapi.co/documentation/tutorials/app-management-tutorial/" title="App Management Tutorial">App Management Tutorial</a>).</p>

<p>The following snippet shows a sample JSON job request that could be submitted to the Jobs service to run the <code>pyplot-0.1.0</code> app from the <a href="http://agaveapi.co/documentation/tutorials/app-management-tutorial/advanced-app-example/" title="Advanced App Example">Advanced App Example</a> tutorial.</p>
<pre class="highlight javascript"><code><span class="p">{</span>  
  <span class="s2">"name"</span><span class="err">:</span><span class="s2">"pyplot-demo test"</span><span class="p">,</span>
  <span class="s2">"appId"</span><span class="err">:</span><span class="s2">"demo-pyplot-demo-advanced-0.1.0"</span><span class="p">,</span>
  <span class="s2">"inputs"</span><span class="err">:</span><span class="p">{</span>  
    <span class="s2">"dataset"</span><span class="err">:</span><span class="p">[</span>  
      <span class="s2">"agave://$PUBLIC_STORAGE_SYSTEM/$API_USERNAME/inputs/pyplot/testdata.csv"</span><span class="p">,</span>
      <span class="s2">"agave://$PUBLIC_STORAGE_SYSTEM/$API_USERNAME/inputs/pyplot/testdata2.csv"</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">"archive"</span><span class="err">:</span><span class="kc">false</span><span class="p">,</span>
  <span class="s2">"parameters"</span><span class="err">:</span><span class="p">{</span>  
    <span class="s2">"unpackInputs"</span><span class="err">:</span><span class="kc">false</span><span class="p">,</span>
    <span class="s2">"chartType"</span><span class="err">:</span><span class="p">[</span>  
      <span class="s2">"bar"</span><span class="p">,</span>
      <span class="s2">"line"</span>
    <span class="p">],</span>
    <span class="s2">"width"</span><span class="err">:</span><span class="mi">1024</span><span class="p">,</span>
    <span class="s2">"height"</span><span class="err">:</span><span class="mi">512</span><span class="p">,</span>
    <span class="s2">"background"</span><span class="err">:</span><span class="s2">"#d96727"</span><span class="p">,</span>
    <span class="s2">"showYLabel"</span><span class="err">:</span><span class="kc">true</span><span class="p">,</span>
    <span class="s2">"ylabel"</span><span class="err">:</span><span class="s2">"The Y Axis Label"</span><span class="p">,</span>
    <span class="s2">"showXLabel"</span><span class="err">:</span><span class="kc">true</span><span class="p">,</span>
    <span class="s2">"xlabel"</span><span class="err">:</span><span class="s2">"The X Axis Label"</span><span class="p">,</span>
    <span class="s2">"showLegend"</span><span class="err">:</span><span class="kc">true</span><span class="p">,</span>
    <span class="s2">"separateCharts"</span><span class="err">:</span><span class="kc">false</span>
  <span class="p">},</span>
  <span class="s2">"notifications"</span><span class="err">:</span><span class="p">[</span>  
    <span class="p">{</span>  
      <span class="s2">"url"</span><span class="p">:</span><span class="s2">"$API_EMAIL"</span><span class="p">,</span>
      <span class="s2">"event"</span><span class="p">:</span><span class="s2">"RUNNING"</span>
    <span class="p">},</span>
    <span class="p">{</span>  
      <span class="s2">"url"</span><span class="p">:</span><span class="s2">"$API_EMAIL"</span><span class="p">,</span>
      <span class="s2">"event"</span><span class="p">:</span><span class="s2">"FINISHED"</span>
    <span class="p">},</span>
    <span class="p">{</span>  
      <span class="s2">"url"</span><span class="p">:</span><span class="s2">"http://http://requestbin.agaveapi.co/o1aiawo1?job_id=${JOB_ID}&amp;amp;status=${JOB_STATUS}"</span><span class="p">,</span>
      <span class="s2">"event"</span><span class="p">:</span><span class="s2">"*"</span><span class="p">,</span>
      <span class="s2">"persistent"</span><span class="p">:</span><span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre>

<p>Notice that this example specifies a single input attribute, <code>dataset</code>. The <code>pyplot-0.1.0</code> app definition specified that the <code>dataset</code> input attribute could accept more than one value (maxCardinality = 2). In the job request object, that translates to an array of string values. Each string represents a piece of data that Agave will transfer into the job work directory prior to job execution. Any value accepted by the Files service when <a href="http://agaveapi.co/documentation/tutorials/data-management-tutorial/#importing-data">importing data</a> is accepted here. Some examples of valid values are given in the following table.</p>

<p>&lt;%= partial &ldquo;includes/tables/73&rdquo; %&gt;</p>

<p class="table-caption">Table 2. Examples of different syntaxes that input values can be specified in the job request object. Here we assume that the validator for the input field is such that these would pass.</p>

<p>The example job request also specifies <code>parameters</code> object with the parameters defined in the <code>pyplot-0.1.0</code> app description. Notice that the parameter <code>type</code> value specified in the app description is reflected here. Numbers are given as numbers, not strings. Boolean and flag attributes are given as boolean true and false values. As with the input section, there is also a parameter <code>chartType</code> that accepts multiple values. In this case that translates to an array of string value. Had the parameter type required another primary type, that would be used in the array instead.</p>

<p>Finally, we see a <code>notifications</code> array specifying that we want Agave send three notifications related to this job. The first is a one-time email when the job starts running. The second is a one-time email when the job reaches a terminal state. The third is a webhook to the url we specified. More on notifications in the section on monitoring below.</p>

<h3 id="job-submission-validation">Job submission validation</h3>

<p>If everything went well, you will receive a response that looks something like the following JSON object.</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X POST -F <span class="s2">"fileToUpload=@job.json"</span> https://<span class="nv">$API_BASE_URL</span>/jobs/<span class="nv">$API_VERSION</span>?pretty<span class="o">=</span><span class="nb">true</span>
</code></pre>
<pre class="highlight plaintext"><code>

[/tabgroup]

```javascript
{
  "status" : "success",
  "message" : null,
  "version" : "2.1.0-r6d11c",
  "result" : {
    "id" : "0001414144065563-5056a550b8-0001-007",
    "name" : "demo-pyplot-demo-advanced test-1414139896",
    "owner" : "$API_USERNAME",
    "appId" : "demo-pyplot-demo-advanced-0.1.0",
    "executionSystem" : "$PUBLIC_EXECUTION_SYSTEM",
    "batchQueue" : "debug",
    "nodeCount" : 1,
    "processorsPerNode" : 1,
    "memoryPerNode" : 1.0,
    "maxRunTime" : "01:00:00",
    "archive" : false,
    "retries" : 0,
    "localId" : "10321",
    "outputPath" : null,
    "status" : "FINISHED",
    "submitTime" : "2014-10-24T04:48:11.000-05:00",
    "startTime" : "2014-10-24T04:48:08.000-05:00",
    "endTime" : "2014-10-24T04:48:15.000-05:00",
    "inputs" : {
      "dataset" : "agave://$PUBLIC_STORAGE_SYSTEM/$API_USERNAME/inputs/pyplot/testdata.csv"
    },
    "parameters" : {
      "chartType" : "bar",
      "height" : "512",
      "showLegend" : "false",
      "xlabel" : "Time",
      "background" : "#FFF",
      "width" : "1024",
      "showXLabel" : "true",
      "separateCharts" : "false",
      "unpackInputs" : "false",
      "ylabel" : "Magnitude",
      "showYLabel" : "true"
    },
    "_links" : {
      "self" : {
        "href" : "https://$API_BASE_URL/jobs/v2/0001414144065563-5056a550b8-0001-007"
      },
      "app" : {
        "href" : "https://$API_BASE_URL/apps/v2/demo-pyplot-demo-advanced-0.1.0"
      },
      "executionSystem" : {
        "href" : "https://$API_BASE_URL/systems/v2/$PUBLIC_EXECUTION_SYSTEM"
      },
      "archiveData" : {
        "href" : "https://$API_BASE_URL/jobs/v2/0001414144065563-5056a550b8-0001-007/outputs/listings"
      },
      "owner" : {
        "href" : "https://$API_BASE_URL/profiles/v2/$API_USERNAME"
      },
      "permissions" : {
        "href" : "https://$API_BASE_URL/jobs/v2/0001414144065563-5056a550b8-0001-007/pems"
      },
      "history" : {
        "href" : "https://$API_BASE_URL/jobs/v2/0001414144065563-5056a550b8-0001-007/history"
      },
      "metadata" : {
        "href" : "https://$API_BASE_URL/meta/v2/data/?q={"associationIds":"0001414144065563-5056a550b8-0001-007"}"
      },
      "notifications" : {
        "href" : "https://$API_BASE_URL/notifications/v2/?associatedUuid=0001414144065563-5056a550b8-0001-007"
      }
    }
  }
}
</code></pre>

<h3 id="job-monitoring">Job monitoring</h3>

<p>Once you submit your job request, the job will be handed off to Agave&rsquo;s back end execution service. Your job may run right away, or it may wait in a batch queue on the execution system until the required resources are available. Either way, the execution process occurs completely asynchronous to the submission process. To monitor the status of your job, Agave supports two different mechanisms: polling and webhooks.</p>

<aside class="notice">For the sake of brevity, we placed a detailed explanation of the job lifecycle in a separate, aptly title post, <a href="http://agaveapi.co/documentation/tutorials/job-management-tutorial/the-job-lifecycle" title="The Job Lifecycle">The Job Lifecycle</a>. There you will find detailed information about how, when, and why everything moves from place to place and how you can peek behind the curtains.</aside>

<h4 id="polling">Polling</h4>

<p>If you have ever taken a long road trip with children, you are probably painfully aware of how polling works. Starting several minutes from the time you leave the house, a child asks, <a href="https://www.youtube.com/watch?v=4vUBsTJYK28&amp;w=640&amp;h=385" title="Are we there yet Shrek?" target="_blank">&ldquo;Are we there yet?&rdquo;</a> You reply, &ldquo;No.&rdquo; Several minutes later the child again asks, &ldquo;Are we there yet?&rdquo; You again reply, &ldquo;No.&rdquo; This process continues until you finally arrive at your destination. <strong>This is called polling and polling is bad</strong></p>

<p>Polling for your job status works the same way. After submitting your job, you start a while loop that queries the Jobs service for your job status until it detects that the job is in a terminal state. The following two URLs both return the status of your job. The first will result in a list of abbreviated job descriptions, the second will result in a full description of the job with the given $JOB_ID, exactly like that returned when submitting the job. The third will result in a much smaller response object that contains only the $JOB_ID and status being returned.</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://<span class="nv">$API_BASE_URL</span>/jobs/<span class="nv">$API_VERSION</span>
curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://<span class="nv">$API_BASE_URL</span>/jobs/<span class="nv">$API_VERSION</span>/0001414144065563-5056a550b8-0001-007
curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://<span class="nv">$API_BASE_URL</span>/jobs/<span class="nv">$API_VERSION</span>/0001414144065563-5056a550b8-0001-007/status
</code></pre>

<p>Sample response snippet</p>
<pre class="highlight javascript"><code><span class="p">{</span>
  <span class="s2">"status"</span> <span class="err">:</span> <span class="s2">"success"</span><span class="p">,</span>
  <span class="s2">"message"</span> <span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="s2">"version"</span> <span class="err">:</span> <span class="s2">"2.1.0-r6d11c"</span><span class="p">,</span>
  <span class="s2">"result"</span> <span class="err">:</span> <span class="p">{</span>
    <span class="s2">"id"</span> <span class="err">:</span> <span class="s2">"0001414144065563-5056a550b8-0001-007"</span><span class="p">,</span>
    <span class="s2">"status"</span> <span class="err">:</span> <span class="s2">"FINISHED"</span><span class="p">,</span>
    <span class="s2">"_links"</span> <span class="err">:</span> <span class="p">{</span>
      <span class="s2">"self"</span> <span class="err">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="err">:</span> <span class="s2">"$API_BASE_URL/jobs/$API_VERSION/0001414144065563-5056a550b8-0001-007"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The list of all possible job statuses is given in table 2.</p>

<p>&lt;%= partial &ldquo;includes/tables/71&rdquo; %&gt;</p>

<p class="table-caption">Table 2. Job statuses listed in progressive order from job submission to completion.</p>

<p>Polling is an incredibly effective approach, but it is bad practice for two reasons. First, it does not scale well. Querying for one job status every few seconds does not take much effort, but querying for 100 takes quite a bit of time and puts unnecessary load on Agave&rsquo;s servers. Second, polling provides what is effectively a binary response. It tells you whether a job is done or not done, it does not give you any information on what is actually going on with the job or where it is in the overall execution process.</p>

<p>The job history URL provides much more detailed information on the various state changes, system messages, and progress information associated with data staging. The syntax of the job history URL is as follows</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://<span class="nv">$API_BASE_URL</span>/jobs/<span class="nv">$API_VERSION</span>/0001414144065563-5056a550b8-0001-007/history
</code></pre>

<p>Sample response snippet</p>
<pre class="highlight javascript"><code><span class="p">{</span>  
  <span class="s2">"status"</span><span class="err">:</span><span class="s2">"success"</span><span class="p">,</span>
  <span class="s2">"message"</span><span class="err">:</span><span class="kc">null</span><span class="p">,</span>
  <span class="s2">"version"</span><span class="err">:</span><span class="s2">"2.1.0-r6d11c"</span><span class="p">,</span>
  <span class="s2">"result"</span><span class="err">:</span><span class="p">[</span>  
    <span class="p">{</span>  
      <span class="s2">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:47:45.000-05:00"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="p">:</span><span class="s2">"PENDING"</span><span class="p">,</span>
      <span class="s2">"description"</span><span class="p">:</span><span class="s2">"Job accepted and queued for submission."</span>
    <span class="p">},</span>
    <span class="p">{</span>  
      <span class="s2">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:47:47.000-05:00"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="p">:</span><span class="s2">"PROCESSING_INPUTS"</span><span class="p">,</span>
      <span class="s2">"description"</span><span class="p">:</span><span class="s2">"Attempt 1 to stage job inputs"</span>
    <span class="p">},</span>
    <span class="p">{</span>  
      <span class="s2">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:47:47.000-05:00"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="p">:</span><span class="s2">"PROCESSING_INPUTS"</span><span class="p">,</span>
      <span class="s2">"description"</span><span class="p">:</span><span class="s2">"Identifying input files for staging"</span>
    <span class="p">},</span>
    <span class="p">{</span>  
      <span class="s2">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:47:48.000-05:00"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="p">:</span><span class="s2">"STAGING_INPUTS"</span><span class="p">,</span>
      <span class="s2">"description"</span><span class="p">:</span><span class="s2">"Staging agave://$PUBLIC_STORAGE_SYSTEM/$API_USERNAME/inputs/pyplot/testdata.csv to remote job directory"</span>
    <span class="p">},</span>
    <span class="p">{</span>  
      <span class="s2">"progress"</span><span class="p">:{</span>  
        <span class="s2">"averageRate"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
        <span class="s2">"totalFiles"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">"source"</span><span class="p">:</span><span class="s2">"agave://$PUBLIC_STORAGE_SYSTEM/$API_USERNAME/inputs/pyplot/testdata.csv"</span><span class="p">,</span>
        <span class="s2">"totalActiveTransfers"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
        <span class="s2">"totalBytes"</span><span class="p">:</span><span class="mi">3212</span><span class="p">,</span>
        <span class="s2">"totalBytesTransferred"</span><span class="p">:</span><span class="mi">3212</span>
      <span class="p">},</span>
      <span class="s2">"created"</span><span class="err">:</span><span class="s2">"2014-10-24T04:47:48.000-05:00"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="err">:</span><span class="s2">"STAGING_INPUTS"</span><span class="p">,</span>
      <span class="s2">"description"</span><span class="err">:</span><span class="s2">"Copy in progress"</span>
    <span class="p">},</span>
    <span class="p">{</span>  
      <span class="s2">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:47:50.000-05:00"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="p">:</span><span class="s2">"STAGED"</span><span class="p">,</span>
      <span class="s2">"description"</span><span class="p">:</span><span class="s2">"Job inputs staged to execution system"</span>
    <span class="p">},</span>
    <span class="p">{</span>  
      <span class="s2">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:47:55.000-05:00"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="p">:</span><span class="s2">"SUBMITTING"</span><span class="p">,</span>
      <span class="s2">"description"</span><span class="p">:</span><span class="s2">"Preparing job for submission."</span>
    <span class="p">},</span>
    <span class="p">{</span>  
      <span class="s2">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:47:55.000-05:00"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="p">:</span><span class="s2">"SUBMITTING"</span><span class="p">,</span>
      <span class="s2">"description"</span><span class="p">:</span><span class="s2">"Attempt 1 to submit job"</span>
    <span class="p">},</span>
    <span class="p">{</span>  
      <span class="s2">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:48:08.000-05:00"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="p">:</span><span class="s2">"RUNNING"</span><span class="p">,</span>
      <span class="s2">"description"</span><span class="p">:</span><span class="s2">"Job started running"</span>
    <span class="p">},</span>
    <span class="p">{</span>  
      <span class="s2">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:48:12.000-05:00"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="p">:</span><span class="s2">"CLEANING_UP"</span>
    <span class="p">},</span>
    <span class="p">{</span>  
      <span class="s2">"created"</span><span class="p">:</span><span class="s2">"2014-10-24T04:48:15.000-05:00"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="p">:</span><span class="s2">"FINISHED"</span><span class="p">,</span>
      <span class="s2">"description"</span><span class="p">:</span><span class="s2">"Job completed. Skipping archiving at user request."</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre>

<p>Depending on the nature of your job and the reliability of the underlying systems, the response from this service can grow rather large, so it is important to be aware that this query can be an expensive call for your client application to make. Everything we said before about polling job status applies to polling job history with the additional caveat that you can chew through quite a bit of bandwidth polling this service, so keep that in mind if your application is bandwidth starved.</p>

<p>Often times, however, polling is unavoidable. In these situations, we recommend using an <a href="http://en.wikipedia.org/wiki/Exponential_backoff" title="Exponential Backoff" target="_blank">exponential backoff</a> to check job status. An exponential backoff is an alogrithm that increases the time between retries as the number of failures increases.</p>

<h4 id="webhooks">Webhooks</h4>

<p>Webhooks are the alternative, preferred way for your application to monitor the status of asynchronous actions in Agave. If you are a <a href="http://en.wikipedia.org/wiki/Design_Patterns_(book)" title="Gang of Four" target="_blank">Gang of Four</a> disciple, webhooks are a mechanism for implementing the <a href="http://en.wikipedia.org/wiki/Observer%5Fpattern" title="Observer Pattern" target="_blank">Observer Pattern</a>. They are widely used across the web and chances are that something you&rsquo;re using right now is leveraging them. In the context of Agave, a webhook is a URL that you give to Agave in advance of an event which it later POSTs a response to when that event occurs. A webhook can be any web accessible URL.</p>

<aside class="notice">For more information about webhooks, events, and notifications in Agave, please see the <a href="http://agaveapi.co/notifications-and-events/" title="Notifications and Events">Notifications and Events</a> page.</aside>

<p>The Jobs service provides several template variables for constructing dynamic URLs. Template variables can be included anywhere in your URL by surrounding the variable name in the following manner <code>${VARIABLE_NAME}</code>. When an event of interest occurs, the variables will be resolved and the resulting URL called. Several example urls are given below.</p>

<p>[code lang=text]
http://example.com/?job_id=${JOB_ID}&amp;job_status=${EVENT}
&ldquo;`</p>

<p>[code lang=text]
http://example.com/trigger/job/${JOB_NAME}/${EVENT}
&rdquo;`</p>

<p>[code lang=text]
http://example.com/webhooks/?nonce=sdfkajerouiwe234289fahlkqr&amp;id=${JOB_ID}&amp;status=${EVENT}&amp;start=${JOB_START_TIME}&amp;end=${JOB_END_TIME}&amp;url=${JOB_ARCHIVE_URL}
&ldquo;`</p>

<p>The full list of template variables are listed in Table 3.</p>

<p>&lt;%= partial &quot;includes/tables/33&rdquo; %&gt;</p>

<p class="table-caption">Table 3. Template variables available for use when defining webhooks for your job.</p>

<h4 id="email">Email</h4>

<p>In situations where you do not have a persistent web address, or access to a backend service, you may find it more convenient to subscribe for email notifications rather then providing a webhook. Agave supports email notifications support as well. Simply specify a valid email address in the <code>url</code> field in your job submission notification object and an email will be sent to that address when a relevant event occurs. A sample email message is given below.</p>

<p>[code lang=text]
The status of job 0001414144065563-5056a550b8-0001-007, &ldquo;demo-pyplot-demo-advanced test-1414139896,&rdquo; has changed to FINISHED.</p>

<p>Name: demo-pyplot-demo-advanced test-1414139896
URL: https://$API_BASE_URL/jobs/v2/0001414144065563-5056a550b8-0001-007
Message: Job completed successfully.
Submit Time: 2014-10-24T04:48:11.000-05:00
Start Time: 2014-10-24T04:48:08.000-05:0
End Time: 2014-10-24T04:48:15.000-05:00
Output Path: $API_USERNAME/archive/jobs/job-0001414144065563-5056a550b8-0001-007
Output URL: https://$API_BASE_URL/jobs/v2/0001414144065563-5056a550b8-0001-007/outputs
&ldquo;`</p>

<h3 id="job-outputs">Job outputs</h3>

<p>Throughout the lifecycle of a job, your inputs, application assets, and outputs are copied from and shuffled between several different locations. Though it is possible in many instances to explicitly locate and view all the moving pieces of your job through the Files service, resolving where those pieces are given the status, execution system, storage systems, data protocols, login protocols, and execution mechanisms of your job at a given time is&hellip;challenging. It is important, however, that you have the ability to monitor your job&rsquo;s output throughout the lifetime of the job.</p>

<p>To make tracking the output of a specific job easier to do, the Jobs service provides a special URL for referencing individual job outputs</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://<span class="nv">$API_BASE_URL</span>/jobs/<span class="nv">$API_VERSION</span>/<span class="nv">$JOB_ID</span>/outputs/listings/<span class="nv">$PATH</span>
</code></pre>

<p>The syntax of this service is consistent with the Files service syntax, as is the JSON response from the service. The response would be similar to the following:</p>
<pre class="highlight javascript"><code><span class="p">{</span>
  <span class="s2">"status"</span> <span class="err">:</span> <span class="s2">"success"</span><span class="p">,</span>
  <span class="s2">"message"</span> <span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="s2">"version"</span> <span class="err">:</span> <span class="s2">"2.1.0-r6d11c"</span><span class="p">,</span>
  <span class="s2">"result"</span> <span class="err">:</span> <span class="p">[</span> <span class="p">{</span>
    <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"output"</span><span class="p">,</span>
    <span class="s2">"path"</span> <span class="p">:</span> <span class="s2">"/output"</span><span class="p">,</span>
    <span class="s2">"lastModified"</span> <span class="p">:</span> <span class="s2">"2014-11-06T13:34:35.000-06:00"</span><span class="p">,</span>
    <span class="s2">"length"</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">"permission"</span> <span class="p">:</span> <span class="s2">"NONE"</span><span class="p">,</span>
    <span class="s2">"mimeType"</span> <span class="p">:</span> <span class="s2">"text/directory"</span><span class="p">,</span>
    <span class="s2">"format"</span> <span class="p">:</span> <span class="s2">"folder"</span><span class="p">,</span>
    <span class="s2">"type"</span> <span class="p">:</span> <span class="s2">"dir"</span><span class="p">,</span>
    <span class="s2">"_links"</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">"self"</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="p">:</span> <span class="s2">"https://$API_BASE_URL/jobs/$API_VERSION/0001414144065563-5056a550b8-0001-007/outputs/media/output"</span>
      <span class="p">},</span>
      <span class="s2">"system"</span> <span class="err">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="err">:</span> <span class="s2">"https://$API_BASE_URL/systems/$API_VERSION/data.agaveapi.co"</span>
      <span class="p">},</span>
      <span class="s2">"parent"</span> <span class="err">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="err">:</span> <span class="s2">"https://$API_BASE_URL/jobs/$API_VERSION/0001414144065563-5056a550b8-0001-007"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"demo-pyplot-demo-advanced-test-1414139896.err"</span><span class="p">,</span>
    <span class="s2">"path"</span> <span class="p">:</span> <span class="s2">"/demo-pyplot-demo-advanced-test-1414139896.err"</span><span class="p">,</span>
    <span class="s2">"lastModified"</span> <span class="p">:</span> <span class="s2">"2014-11-06T13:34:27.000-06:00"</span><span class="p">,</span>
    <span class="s2">"length"</span> <span class="p">:</span> <span class="mi">442</span><span class="p">,</span>
    <span class="s2">"permission"</span> <span class="p">:</span> <span class="s2">"NONE"</span><span class="p">,</span>
    <span class="s2">"mimeType"</span> <span class="p">:</span> <span class="s2">"application/octet-stream"</span><span class="p">,</span>
    <span class="s2">"format"</span> <span class="p">:</span> <span class="s2">"unknown"</span><span class="p">,</span>
    <span class="s2">"type"</span> <span class="p">:</span> <span class="s2">"file"</span><span class="p">,</span>
    <span class="s2">"_links"</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">"self"</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="p">:</span> <span class="s2">"https://$API_BASE_URL/jobs/$API_VERSION/0001414144065563-5056a550b8-0001-007/outputs/media/demo-pyplot-demo-advanced-test-1414139896.err"</span>
      <span class="p">},</span>
      <span class="s2">"system"</span> <span class="err">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="err">:</span> <span class="s2">"https://$API_BASE_URL/systems/$API_VERSION/data.agaveapi.co"</span>
      <span class="p">},</span>
      <span class="s2">"parent"</span> <span class="err">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="err">:</span> <span class="s2">"https://$API_BASE_URL/jobs/$API_VERSION/0001414144065563-5056a550b8-0001-007"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"demo-pyplot-demo-advanced-test-1414139896.out"</span><span class="p">,</span>
    <span class="s2">"path"</span> <span class="p">:</span> <span class="s2">"/demo-pyplot-demo-advanced-test-1414139896.out"</span><span class="p">,</span>
    <span class="s2">"lastModified"</span> <span class="p">:</span> <span class="s2">"2014-11-06T13:34:30.000-06:00"</span><span class="p">,</span>
    <span class="s2">"length"</span> <span class="p">:</span> <span class="mi">1396</span><span class="p">,</span>
    <span class="s2">"permission"</span> <span class="p">:</span> <span class="s2">"NONE"</span><span class="p">,</span>
    <span class="s2">"mimeType"</span> <span class="p">:</span> <span class="s2">"application/octet-stream"</span><span class="p">,</span>
    <span class="s2">"format"</span> <span class="p">:</span> <span class="s2">"unknown"</span><span class="p">,</span>
    <span class="s2">"type"</span> <span class="p">:</span> <span class="s2">"file"</span><span class="p">,</span>
    <span class="s2">"_links"</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">"self"</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="p">:</span> <span class="s2">"https://$API_BASE_URL/jobs/$API_VERSION/0001414144065563-5056a550b8-0001-007/outputs/media/demo-pyplot-demo-advanced-test-1414139896.out"</span>
      <span class="p">},</span>
      <span class="s2">"system"</span> <span class="err">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="err">:</span> <span class="s2">"https://$API_BASE_URL/systems/$API_VERSION/data.agaveapi.co"</span>
      <span class="p">},</span>
      <span class="s2">"parent"</span> <span class="err">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="err">:</span> <span class="s2">"https://$API_BASE_URL/jobs/$API_VERSION/0001414144065563-5056a550b8-0001-007"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"demo-pyplot-demo-advanced-test-1414139896.pid"</span><span class="p">,</span>
    <span class="s2">"path"</span> <span class="p">:</span> <span class="s2">"/demo-pyplot-demo-advanced-test-1414139896.pid"</span><span class="p">,</span>
    <span class="s2">"lastModified"</span> <span class="p">:</span> <span class="s2">"2014-11-06T13:34:33.000-06:00"</span><span class="p">,</span>
    <span class="s2">"length"</span> <span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s2">"permission"</span> <span class="p">:</span> <span class="s2">"NONE"</span><span class="p">,</span>
    <span class="s2">"mimeType"</span> <span class="p">:</span> <span class="s2">"application/octet-stream"</span><span class="p">,</span>
    <span class="s2">"format"</span> <span class="p">:</span> <span class="s2">"unknown"</span><span class="p">,</span>
    <span class="s2">"type"</span> <span class="p">:</span> <span class="s2">"file"</span><span class="p">,</span>
    <span class="s2">"_links"</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">"self"</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="p">:</span> <span class="s2">"https://$API_BASE_URL/jobs/$API_VERSION/0001414144065563-5056a550b8-0001-007/outputs/media/demo-pyplot-demo-advanced-test-1414139896.pid"</span>
      <span class="p">},</span>
      <span class="s2">"system"</span> <span class="err">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="err">:</span> <span class="s2">"https://$API_BASE_URL/systems/$API_VERSION/data.agaveapi.co"</span>
      <span class="p">},</span>
      <span class="s2">"parent"</span> <span class="err">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="err">:</span> <span class="s2">"https://$API_BASE_URL/jobs/$API_VERSION/0001414144065563-5056a550b8-0001-007"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"testdata.csv"</span><span class="p">,</span>
    <span class="s2">"path"</span> <span class="p">:</span> <span class="s2">"/testdata.csv"</span><span class="p">,</span>
    <span class="s2">"lastModified"</span> <span class="p">:</span> <span class="s2">"2014-11-06T13:34:42.000-06:00"</span><span class="p">,</span>
    <span class="s2">"length"</span> <span class="p">:</span> <span class="mi">3212</span><span class="p">,</span>
    <span class="s2">"permission"</span> <span class="p">:</span> <span class="s2">"NONE"</span><span class="p">,</span>
    <span class="s2">"mimeType"</span> <span class="p">:</span> <span class="s2">"application/octet-stream"</span><span class="p">,</span>
    <span class="s2">"format"</span> <span class="p">:</span> <span class="s2">"unknown"</span><span class="p">,</span>
    <span class="s2">"type"</span> <span class="p">:</span> <span class="s2">"file"</span><span class="p">,</span>
    <span class="s2">"_links"</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">"self"</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="p">:</span> <span class="s2">"https://$API_BASE_URL/jobs/$API_VERSION/0001414144065563-5056a550b8-0001-007/outputs/media/testdata.csv"</span>
      <span class="p">},</span>
      <span class="s2">"system"</span> <span class="err">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="err">:</span> <span class="s2">"https://$API_BASE_URL/systems/$API_VERSION/data.agaveapi.co"</span>
      <span class="p">},</span>
      <span class="s2">"parent"</span> <span class="err">:</span> <span class="p">{</span>
        <span class="s2">"href"</span> <span class="err">:</span> <span class="s2">"https://$API_BASE_URL/jobs/$API_VERSION/0001414144065563-5056a550b8-0001-007"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="p">]</span>
<span class="p">}</span>
</code></pre>

<p>To download a file you would use the following syntax</p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://<span class="nv">$API_BASE_URL</span>/jobs/<span class="nv">$API_VERSION</span>/<span class="nv">$JOB_ID</span>/outputs/media/<span class="nv">$PATH</span>
</code></pre>

<aside class="notice">The Jobs output service follows the same conventions of the Files service. Thus, you may specify a range header to retrieve a specific byte range. This is particularly helpful when tracking job progress since it gives you a mechanism to tail the output and error log files.</aside>

<p>Regardless of job status, the above services will always point to the most recent location of the job data. If you choose for the Jobs service to archive your job after completion, the URL will point to the archive folder of the job. If you do not choose to archive your data, or if archiving fails, the URL will point to the execution folder created for your job at runtime. Because Agave does not own any of the underlying hardware, it cannot guarantee that those locations will always exist. If, for example, the execution system enforces a purge policy, the output data may be deleted by the system administrators. Agave will let you know if the data is no longer present, however, it cannot prevent it from being deleted. This is another reason that it is important to archive data you feel will be needed in the future.</p>

<h3 id="managing-your-job">Managing your job</h3>

<p>Once your job is submitted, you have the ability to stop, delete, and resubmit it as a new job.
<code class="prettyprint">shell
curl -sk -H &quot;Authorization: Bearer $ACCESS_TOKEN&quot; -X POST -d &quot;action=kill&quot; https://$API_BASE_URL/jobs/$API_VERSION/$JOB_ID
</code> </p>

<p>[tab title=&quot;Deleting&rdquo;]
<code class="prettyprint">bash 
curl -sk -H &quot;Authorization: Bearer $ACCESS_TOKEN&quot; -X DELETE https://$API_BASE_URL/jobs/$API_VERSION/$JOB_ID
</code></p>

<p>[tab title=&ldquo;Resubmitting&rdquo;]
<code class="prettyprint">bash 
curl -sk -H &quot;Authorization: Bearer $ACCESS_TOKEN&quot; -X POST -d &quot;action=resubmit&quot; https://$API_BASE_URL/jobs/$API_VERSION/$JOB_ID
</code></p>

<p>[/tabgroup]</p>

<h3 id="permissions-and-sharing">Permissions and sharing</h3>

<p>As with the <a title="System Registration" href="http://agaveapi.co/system-registration/">Systems</a>, <a title="Application Management" href="http://agaveapi.co/application-management/">Apps</a>, and <a title="File Management" href="http://agaveapi.co/file-management/">Files</a> services, your jobs have their own set of access controls. Using these, you can share your job and its data with other Agave users. Job permissions are private by default. The permissions you give a job apply both to the job, its outputs, its metadata, and the permissions themselves. Thus, by sharing a job with another user, you share all aspects of that job.</p>

<p>Job permissions are managed through a set of URLs consistent with the permissions URL elsewhere in the API.</p>
<pre class="highlight shell"><code><span class="sb">```</span>bash
curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> https://<span class="nv">$API_BASE_URL</span>/jobs/<span class="nv">$API_VERSION</span>/<span class="nv">$JOB_ID</span>/pems
</code></pre>

<p>Permissions granted to a specific user: 
<code class="prettyprint">bash
curl -sk -H &quot;Authorization: Bearer  $ACCESS_TOKEN&quot; https://$API_BASE_URL/jobs/$API_VERSION/$JOB_ID/pems/$USERNAME
</code></p>

<p>[tab title=&ldquo;Adding &amp; Updating&rdquo;]
<code class="prettyprint">bash 
curl -sk -H &quot;Authorization: Bearer  $ACCESS_TOKEN&quot; -X POST -d &quot;permission:$PERMISSION&quot; https://$API_BASE_URL/jobs/$API_VERSION/$JOB_ID/$USERNAME
</code></p>

<p>[tab title=&ldquo;Deleting&rdquo;]
Deleting permissions for all users on a job: </p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X DELETE https://<span class="nv">$API_BASE_URL</span>/jobs/<span class="nv">$API_VERSION</span>/<span class="nv">$JOB_ID</span>
</code></pre>

<p>Deleting permissions for a specific user on a job: </p>
<pre class="highlight shell"><code>curl -sk -H <span class="s2">"Authorization: Bearer  </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">"</span> -X DELETE https://<span class="nv">$API_BASE_URL</span>/jobs/<span class="nv">$API_VERSION</span>/<span class="nv">$JOB_ID</span>/<span class="nv">$USERNAME</span>
</code></pre>

<p>[/tabgroup]</p>

<p>The available permission values are listed in Table 2.</p>

<p>&lt;%= partial &ldquo;includes/tables/70&rdquo; %&gt;</p>

<p class="table-caption">Table 2. Supported job permission values.</p>

<p>[alert]Job permissions are distinct from file permissions. In many instances, your job output will be accessible via the Files and Jobs services simultaneously. Granting a user permissions a job output file through the Files services does not alter the accessibility of that file through the Jobs service. It is important, then, that you consider to whom you grant permissions, and the implications of that decision in all areas of your application.[/alert]</p>

          </div>
          <div class="dark-box">
          </div>
        </div>
    </div>
    <script type="text/javascript">
      document.getElementById("fouc").style.display="block";
    </script>
  </body>
</html>
